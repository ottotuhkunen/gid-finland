/*! For license information please see main.df7580ee.js.LICENSE.txt */
(()=>{var e={4:(e,t,r)=>{"use strict";var o=r(853),n=r(43),i=r(950);function a(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}var l=Symbol.for("react.element"),c=Symbol.for("react.transitional.element"),u=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),p=Symbol.for("react.consumer"),g=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),b=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var A=Symbol.for("react.memo_cache_sentinel"),w=Symbol.iterator;function S(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=w&&e[w]||e["@@iterator"])?e:null}var E=Symbol.for("react.client.reference");function T(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===E?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case d:return"Fragment";case u:return"Portal";case f:return"Profiler";case h:return"StrictMode";case y:return"Suspense";case v:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case g:return(e.displayName||"Context")+".Provider";case p:return(e._context.displayName||"Context")+".Consumer";case _:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case x:return null!==(t=e.displayName||null)?t:T(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return T(e(t))}catch(r){}}return null}var P,C,R=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.assign;function I(e){if(void 0===P)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||"",C=-1<r.stack.indexOf("\n    at")?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+P+e+C}var O=!1;function D(e,t){if(!e||O)return"";O=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(n){var o=n}Reflect.construct(e,[],r)}else{try{r.call()}catch(i){o=i}e.call(r.prototype)}}else{try{throw Error()}catch(a){o=a}(r=e())&&"function"===typeof r.catch&&r.catch((function(){}))}}catch(s){if(s&&o&&"string"===typeof s.stack)return[s.stack,o.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var n=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");n&&n.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=o.DetermineComponentFrameRoot(),a=i[0],s=i[1];if(a&&s){var l=a.split("\n"),c=s.split("\n");for(n=o=0;o<l.length&&!l[o].includes("DetermineComponentFrameRoot");)o++;for(;n<c.length&&!c[n].includes("DetermineComponentFrameRoot");)n++;if(o===l.length||n===c.length)for(o=l.length-1,n=c.length-1;1<=o&&0<=n&&l[o]!==c[n];)n--;for(;1<=o&&0<=n;o--,n--)if(l[o]!==c[n]){if(1!==o||1!==n)do{if(o--,0>--n||l[o]!==c[n]){var u="\n"+l[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=n);break}}}finally{O=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?I(r):""}function k(e){switch(e.tag){case 26:case 27:case 5:return I(e.type);case 16:return I("Lazy");case 13:return I("Suspense");case 19:return I("SuspenseList");case 0:case 15:return e=D(e.type,!1);case 11:return e=D(e.type.render,!1);case 1:return e=D(e.type,!0);default:return""}}function N(e){try{var t="";do{t+=k(e),e=e.return}while(e);return t}catch(r){return"\nError generating stack: "+r.message+"\n"+r.stack}}function B(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function F(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function z(e){if(B(e)!==e)throw Error(a(188))}function U(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=U(e)))return t;e=e.sibling}return null}var V=Array.isArray,H=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G={pending:!1,data:null,method:null,action:null},j=[],W=-1;function K(e){return{current:e}}function J(e){0>W||(e.current=j[W],j[W]=null,W--)}function Z(e,t){W++,j[W]=e.current,e.current=t}var Y=K(null),q=K(null),$=K(null),X=K(null);function Q(e,t){switch(Z($,t),Z(q,e),Z(Y,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?qu(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=$u(e=qu(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}J(Y),Z(Y,t)}function ee(){J(Y),J(q),J($)}function te(e){null!==e.memoizedState&&Z(X,e);var t=Y.current,r=$u(t,e.type);t!==r&&(Z(q,e),Z(Y,r))}function re(e){q.current===e&&(J(Y),J(q)),X.current===e&&(J(X),Nd._currentValue=G)}var oe=Object.prototype.hasOwnProperty,ne=o.unstable_scheduleCallback,ie=o.unstable_cancelCallback,ae=o.unstable_shouldYield,se=o.unstable_requestPaint,le=o.unstable_now,ce=o.unstable_getCurrentPriorityLevel,ue=o.unstable_ImmediatePriority,de=o.unstable_UserBlockingPriority,he=o.unstable_NormalPriority,fe=o.unstable_LowPriority,me=o.unstable_IdlePriority,pe=o.log,ge=o.unstable_setDisableYieldValue,_e=null,ye=null;function ve(e){if("function"===typeof pe&&ge(e),ye&&"function"===typeof ye.setStrictMode)try{ye.setStrictMode(_e,e)}catch(t){}}var xe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(be(e)/Le|0)|0},be=Math.log,Le=Math.LN2;var Ae=128,we=4194304;function Se(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ee(e,t){var r=e.pendingLanes;if(0===r)return 0;var o=0,n=e.suspendedLanes,i=e.pingedLanes,a=e.warmLanes;e=0!==e.finishedLanes;var s=134217727&r;return 0!==s?0!==(r=s&~n)?o=Se(r):0!==(i&=s)?o=Se(i):e||0!==(a=s&~a)&&(o=Se(a)):0!==(s=r&~n)?o=Se(s):0!==i?o=Se(i):e||0!==(a=r&~a)&&(o=Se(a)),0===o?0:0!==t&&t!==o&&0===(t&n)&&((n=o&-o)>=(a=t&-t)||32===n&&0!==(4194176&a))?t:o}function Te(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Pe(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ce(){var e=Ae;return 0===(4194176&(Ae<<=1))&&(Ae=128),e}function Re(){var e=we;return 0===(62914560&(we<<=1))&&(we=4194304),e}function Me(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Ie(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Oe(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var o=31-xe(t);e.entangledLanes|=t,e.entanglements[o]=1073741824|e.entanglements[o]|4194218&r}function De(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var o=31-xe(r),n=1<<o;n&t|e[o]&t&&(e[o]|=t),r&=~n}}function ke(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Ne(){var e=H.p;return 0!==e?e:void 0===(e=window.event)?32:$d(e.type)}var Be=Math.random().toString(36).slice(2),Fe="__reactFiber$"+Be,ze="__reactProps$"+Be,Ue="__reactContainer$"+Be,Ve="__reactEvents$"+Be,He="__reactListeners$"+Be,Ge="__reactHandles$"+Be,je="__reactResources$"+Be,We="__reactMarker$"+Be;function Ke(e){delete e[Fe],delete e[ze],delete e[Ve],delete e[He],delete e[Ge]}function Je(e){var t=e[Fe];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ue]||r[Fe]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=ld(e);null!==e;){if(r=e[Fe])return r;e=ld(e)}return t}r=(e=r).parentNode}return null}function Ze(e){if(e=e[Fe]||e[Ue]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function Ye(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(a(33))}function qe(e){var t=e[je];return t||(t=e[je]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function $e(e){e[We]=!0}var Xe=new Set,Qe={};function et(e,t){tt(e,t),tt(e+"Capture",t)}function tt(e,t){for(Qe[e]=t,e=0;e<t.length;e++)Xe.add(t[e])}var rt=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),ot=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),nt={},it={};function at(e,t,r){if(n=t,oe.call(it,n)||!oe.call(nt,n)&&(ot.test(n)?it[n]=!0:(nt[n]=!0,0)))if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var o=t.toLowerCase().slice(0,5);if("data-"!==o&&"aria-"!==o)return void e.removeAttribute(t)}e.setAttribute(t,""+r)}var n}function st(e,t,r){if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+r)}}function lt(e,t,r,o){if(null===o)e.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(r)}e.setAttributeNS(t,r,""+o)}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ut(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function dt(e){e._valueTracker||(e._valueTracker=function(e){var t=ut(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var n=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){o=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return o},setValue:function(e){o=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),o="";return e&&(o=ut(e)?e.checked?"true":"false":e.value),(e=o)!==r&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var mt=/[\n"\\]/g;function pt(e){return e.replace(mt,(function(e){return"\\"+e.charCodeAt(0).toString(16)+" "}))}function gt(e,t,r,o,n,i,a,s){e.name="",null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?yt(e,a,ct(t)):null!=r?yt(e,a,ct(r)):null!=o&&e.removeAttribute("value"),null==n&&null!=i&&(e.defaultChecked=!!i),null!=n&&(e.checked=n&&"function"!==typeof n&&"symbol"!==typeof n),null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s?e.name=""+ct(s):e.removeAttribute("name")}function _t(e,t,r,o,n,i,a,s){if(null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.type=i),null!=t||null!=r){if(!("submit"!==i&&"reset"!==i||void 0!==t&&null!==t))return;r=null!=r?""+ct(r):"",t=null!=t?""+ct(t):r,s||t===e.value||(e.value=t),e.defaultValue=t}o="function"!==typeof(o=null!=o?o:n)&&"symbol"!==typeof o&&!!o,e.checked=s?e.checked:!!o,e.defaultChecked=!!o,null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a&&(e.name=a)}function yt(e,t,r){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function vt(e,t,r,o){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&o&&(e[r].defaultSelected=!0)}else{for(r=""+ct(r),t=null,n=0;n<e.length;n++){if(e[n].value===r)return e[n].selected=!0,void(o&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function xt(e,t,r){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=r)?e.defaultValue=null!=r?""+ct(r):"":e.defaultValue!==t&&(e.defaultValue=t)}function bt(e,t,r,o){if(null==t){if(null!=o){if(null!=r)throw Error(a(92));if(V(o)){if(1<o.length)throw Error(a(93));o=o[0]}r=o}null==r&&(r=""),t=r}r=ct(t),e.defaultValue=r,(o=e.textContent)===r&&""!==o&&null!==o&&(e.value=o)}function Lt(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var At=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function wt(e,t,r){var o=0===t.indexOf("--");null==r||"boolean"===typeof r||""===r?o?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":o?e.setProperty(t,r):"number"!==typeof r||0===r||At.has(t)?"float"===t?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function St(e,t,r){if(null!=t&&"object"!==typeof t)throw Error(a(62));if(e=e.style,null!=r){for(var o in r)!r.hasOwnProperty(o)||null!=t&&t.hasOwnProperty(o)||(0===o.indexOf("--")?e.setProperty(o,""):"float"===o?e.cssFloat="":e[o]="");for(var n in t)o=t[n],t.hasOwnProperty(n)&&r[n]!==o&&wt(e,n,o)}else for(var i in t)t.hasOwnProperty(i)&&wt(e,i,t[i])}function Et(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Pt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ct(e){return Pt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Rt=null;function Mt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var It=null,Ot=null;function Dt(e){var t=Ze(e);if(t&&(e=t.stateNode)){var r=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(gt(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+pt(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var o=r[t];if(o!==e&&o.form===e.form){var n=o[ze]||null;if(!n)throw Error(a(90));gt(o,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name)}}for(t=0;t<r.length;t++)(o=r[t]).form===e.form&&ht(o)}break e;case"textarea":xt(e,r.value,r.defaultValue);break e;case"select":null!=(t=r.value)&&vt(e,!!r.multiple,t,!1)}}}var kt=!1;function Nt(e,t,r){if(kt)return e(t,r);kt=!0;try{return e(t)}finally{if(kt=!1,(null!==It||null!==Ot)&&(Fc(),It&&(t=It,e=Ot,Ot=It=null,Dt(t),e)))for(t=0;t<e.length;t++)Dt(e[t])}}function Bt(e,t){var r=e.stateNode;if(null===r)return null;var o=r[ze]||null;if(null===o)return null;r=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(o=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!o;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(a(231,t,typeof r));return r}var Ft=!1;if(rt)try{var zt={};Object.defineProperty(zt,"passive",{get:function(){Ft=!0}}),window.addEventListener("test",zt,zt),window.removeEventListener("test",zt,zt)}catch(bh){Ft=!1}var Ut=null,Vt=null,Ht=null;function Gt(){if(Ht)return Ht;var e,t,r=Vt,o=r.length,n="value"in Ut?Ut.value:Ut.textContent,i=n.length;for(e=0;e<o&&r[e]===n[e];e++);var a=o-e;for(t=1;t<=a&&r[o-t]===n[i-t];t++);return Ht=n.slice(e,1<t?1-t:void 0)}function jt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Wt(){return!0}function Kt(){return!1}function Jt(e){function t(t,r,o,n,i){for(var a in this._reactName=t,this._targetInst=o,this.type=r,this.nativeEvent=n,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(n):n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Wt:Kt,this.isPropagationStopped=Kt,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Wt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Wt)},persist:function(){},isPersistent:Wt}),t}var Zt,Yt,qt,$t={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xt=Jt($t),Qt=M({},$t,{view:0,detail:0}),er=Jt(Qt),tr=M({},Qt,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qt&&(qt&&"mousemove"===e.type?(Zt=e.screenX-qt.screenX,Yt=e.screenY-qt.screenY):Yt=Zt=0,qt=e),Zt)},movementY:function(e){return"movementY"in e?e.movementY:Yt}}),rr=Jt(tr),or=Jt(M({},tr,{dataTransfer:0})),nr=Jt(M({},Qt,{relatedTarget:0})),ir=Jt(M({},$t,{animationName:0,elapsedTime:0,pseudoElement:0})),ar=Jt(M({},$t,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),sr=Jt(M({},$t,{data:0})),lr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ur={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=ur[e])&&!!t[e]}function hr(){return dr}var fr=Jt(M({},Qt,{key:function(e){if(e.key){var t=lr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=jt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?cr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hr,charCode:function(e){return"keypress"===e.type?jt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?jt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),mr=Jt(M({},tr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),pr=Jt(M({},Qt,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hr})),gr=Jt(M({},$t,{propertyName:0,elapsedTime:0,pseudoElement:0})),_r=Jt(M({},tr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),yr=Jt(M({},$t,{newState:0,oldState:0})),vr=[9,13,27,32],xr=rt&&"CompositionEvent"in window,br=null;rt&&"documentMode"in document&&(br=document.documentMode);var Lr=rt&&"TextEvent"in window&&!br,Ar=rt&&(!xr||br&&8<br&&11>=br),wr=String.fromCharCode(32),Sr=!1;function Er(e,t){switch(e){case"keyup":return-1!==vr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Pr=!1;var Cr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Cr[e.type]:"textarea"===t}function Mr(e,t,r,o){It?Ot?Ot.push(o):Ot=[o]:It=o,0<(t=Nu(t,"onChange")).length&&(r=new Xt("onChange","change",null,r,o),e.push({event:r,listeners:t}))}var Ir=null,Or=null;function Dr(e){Pu(e,0)}function kr(e){if(ht(Ye(e)))return e}function Nr(e,t){if("change"===e)return t}var Br=!1;if(rt){var Fr;if(rt){var zr="oninput"in document;if(!zr){var Ur=document.createElement("div");Ur.setAttribute("oninput","return;"),zr="function"===typeof Ur.oninput}Fr=zr}else Fr=!1;Br=Fr&&(!document.documentMode||9<document.documentMode)}function Vr(){Ir&&(Ir.detachEvent("onpropertychange",Hr),Or=Ir=null)}function Hr(e){if("value"===e.propertyName&&kr(Or)){var t=[];Mr(t,Or,e,Mt(e)),Nt(Dr,t)}}function Gr(e,t,r){"focusin"===e?(Vr(),Or=r,(Ir=t).attachEvent("onpropertychange",Hr)):"focusout"===e&&Vr()}function jr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return kr(Or)}function Wr(e,t){if("click"===e)return kr(t)}function Kr(e,t){if("input"===e||"change"===e)return kr(t)}var Jr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Zr(e,t){if(Jr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(o=0;o<r.length;o++){var n=r[o];if(!oe.call(t,n)||!Jr(e[n],t[n]))return!1}return!0}function Yr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function qr(e,t){var r,o=Yr(e);for(e=0;o;){if(3===o.nodeType){if(r=e+o.textContent.length,e<=t&&r>=t)return{node:o,offset:t-e};e=r}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Yr(o)}}function $r(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?$r(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Xr(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(o){r=!1}if(!r)break;t=ft((e=t.contentWindow).document)}return t}function Qr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function eo(e,t){var r=Xr(t);t=e.focusedElem;var o=e.selectionRange;if(r!==t&&t&&t.ownerDocument&&$r(t.ownerDocument.documentElement,t)){if(null!==o&&Qr(t))if(e=o.start,void 0===(r=o.end)&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if((r=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){r=r.getSelection();var n=t.textContent.length,i=Math.min(o.start,n);o=void 0===o.end?i:Math.min(o.end,n),!r.extend&&i>o&&(n=o,o=i,i=n),n=qr(t,i);var a=qr(t,o);n&&a&&(1!==r.rangeCount||r.anchorNode!==n.node||r.anchorOffset!==n.offset||r.focusNode!==a.node||r.focusOffset!==a.offset)&&((e=e.createRange()).setStart(n.node,n.offset),r.removeAllRanges(),i>o?(r.addRange(e),r.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),r.addRange(e)))}for(e=[],r=t;r=r.parentNode;)1===r.nodeType&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for("function"===typeof t.focus&&t.focus(),t=0;t<e.length;t++)(r=e[t]).element.scrollLeft=r.left,r.element.scrollTop=r.top}}var to=rt&&"documentMode"in document&&11>=document.documentMode,ro=null,oo=null,no=null,io=!1;function ao(e,t,r){var o=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;io||null==ro||ro!==ft(o)||("selectionStart"in(o=ro)&&Qr(o)?o={start:o.selectionStart,end:o.selectionEnd}:o={anchorNode:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset},no&&Zr(no,o)||(no=o,0<(o=Nu(oo,"onSelect")).length&&(t=new Xt("onSelect","select",null,t,r),e.push({event:t,listeners:o}),t.target=ro)))}function so(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var lo={animationend:so("Animation","AnimationEnd"),animationiteration:so("Animation","AnimationIteration"),animationstart:so("Animation","AnimationStart"),transitionrun:so("Transition","TransitionRun"),transitionstart:so("Transition","TransitionStart"),transitioncancel:so("Transition","TransitionCancel"),transitionend:so("Transition","TransitionEnd")},co={},uo={};function ho(e){if(co[e])return co[e];if(!lo[e])return e;var t,r=lo[e];for(t in r)if(r.hasOwnProperty(t)&&t in uo)return co[e]=r[t];return e}rt&&(uo=document.createElement("div").style,"AnimationEvent"in window||(delete lo.animationend.animation,delete lo.animationiteration.animation,delete lo.animationstart.animation),"TransitionEvent"in window||delete lo.transitionend.transition);var fo=ho("animationend"),mo=ho("animationiteration"),po=ho("animationstart"),go=ho("transitionrun"),_o=ho("transitionstart"),yo=ho("transitioncancel"),vo=ho("transitionend"),xo=new Map,bo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function Lo(e,t){xo.set(e,t),et(t,[e])}var Ao=[],wo=0,So=0;function Eo(){for(var e=wo,t=So=wo=0;t<e;){var r=Ao[t];Ao[t++]=null;var o=Ao[t];Ao[t++]=null;var n=Ao[t];Ao[t++]=null;var i=Ao[t];if(Ao[t++]=null,null!==o&&null!==n){var a=o.pending;null===a?n.next=n:(n.next=a.next,a.next=n),o.pending=n}0!==i&&Ro(r,n,i)}}function To(e,t,r,o){Ao[wo++]=e,Ao[wo++]=t,Ao[wo++]=r,Ao[wo++]=o,So|=o,e.lanes|=o,null!==(e=e.alternate)&&(e.lanes|=o)}function Po(e,t,r,o){return To(e,t,r,o),Mo(e)}function Co(e,t){return To(e,null,null,t),Mo(e)}function Ro(e,t,r){e.lanes|=r;var o=e.alternate;null!==o&&(o.lanes|=r);for(var n=!1,i=e.return;null!==i;)i.childLanes|=r,null!==(o=i.alternate)&&(o.childLanes|=r),22===i.tag&&(null===(e=i.stateNode)||1&e._visibility||(n=!0)),e=i,i=i.return;n&&null!==t&&3===e.tag&&(i=e.stateNode,n=31-xe(r),null===(e=(i=i.hiddenUpdates)[n])?i[n]=[t]:e.push(t),t.lane=536870912|r)}function Mo(e){if(50<Pc)throw Pc=0,Cc=null,Error(a(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Io={},Oo=new WeakMap;function Do(e,t){if("object"===typeof e&&null!==e){var r=Oo.get(e);return void 0!==r?r:(t={value:e,source:t,stack:N(t)},Oo.set(e,t),t)}return{value:e,source:t,stack:N(t)}}var ko=[],No=0,Bo=null,Fo=0,zo=[],Uo=0,Vo=null,Ho=1,Go="";function jo(e,t){ko[No++]=Fo,ko[No++]=Bo,Bo=e,Fo=t}function Wo(e,t,r){zo[Uo++]=Ho,zo[Uo++]=Go,zo[Uo++]=Vo,Vo=e;var o=Ho;e=Go;var n=32-xe(o)-1;o&=~(1<<n),r+=1;var i=32-xe(t)+n;if(30<i){var a=n-n%5;i=(o&(1<<a)-1).toString(32),o>>=a,n-=a,Ho=1<<32-xe(t)+n|r<<n|o,Go=i+e}else Ho=1<<i|r<<n|o,Go=e}function Ko(e){null!==e.return&&(jo(e,1),Wo(e,1,0))}function Jo(e){for(;e===Bo;)Bo=ko[--No],ko[No]=null,Fo=ko[--No],ko[No]=null;for(;e===Vo;)Vo=zo[--Uo],zo[Uo]=null,Go=zo[--Uo],zo[Uo]=null,Ho=zo[--Uo],zo[Uo]=null}var Zo=null,Yo=null,qo=!1,$o=null,Xo=!1,Qo=Error(a(519));function en(e){throw an(Do(Error(a(418,"")),e)),Qo}function tn(e){var t=e.stateNode,r=e.type,o=e.memoizedProps;switch(t[Fe]=e,t[ze]=o,r){case"dialog":Cu("cancel",t),Cu("close",t);break;case"iframe":case"object":case"embed":Cu("load",t);break;case"video":case"audio":for(r=0;r<Eu.length;r++)Cu(Eu[r],t);break;case"source":Cu("error",t);break;case"img":case"image":case"link":Cu("error",t),Cu("load",t);break;case"details":Cu("toggle",t);break;case"input":Cu("invalid",t),_t(t,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0),dt(t);break;case"select":Cu("invalid",t);break;case"textarea":Cu("invalid",t),bt(t,o.value,o.defaultValue,o.children),dt(t)}"string"!==typeof(r=o.children)&&"number"!==typeof r&&"bigint"!==typeof r||t.textContent===""+r||!0===o.suppressHydrationWarning||Hu(t.textContent,r)?(null!=o.popover&&(Cu("beforetoggle",t),Cu("toggle",t)),null!=o.onScroll&&Cu("scroll",t),null!=o.onScrollEnd&&Cu("scrollend",t),null!=o.onClick&&(t.onclick=Gu),t=!0):t=!1,t||en(e)}function rn(e){for(Zo=e.return;Zo;)switch(Zo.tag){case 3:case 27:return void(Xo=!0);case 5:case 13:return void(Xo=!1);default:Zo=Zo.return}}function on(e){if(e!==Zo)return!1;if(!qo)return rn(e),qo=!0,!1;var t,r=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||Xu(e.type,e.memoizedProps)),t=!t),t&&(r=!0),r&&Yo&&en(e),rn(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,r=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===r){Yo=sd(e.nextSibling);break e}r--}else"$"!==t&&"$!"!==t&&"$?"!==t||r++;e=e.nextSibling}Yo=null}}else Yo=Zo?sd(e.stateNode.nextSibling):null;return!0}function nn(){Yo=Zo=null,qo=!1}function an(e){null===$o?$o=[e]:$o.push(e)}var sn=Error(a(460)),ln=Error(a(474)),cn={then:function(){}};function un(e){return"fulfilled"===(e=e.status)||"rejected"===e}function dn(){}function hn(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(dn,dn),t=r),t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===sn)throw Error(a(483));throw e;default:if("string"===typeof t.status)t.then(dn,dn);else{if(null!==(e=tc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then((function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}}),(function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}}))}switch(t.status){case"fulfilled":return t.value;case"rejected":if((e=t.reason)===sn)throw Error(a(483));throw e}throw fn=t,sn}}var fn=null;function mn(){if(null===fn)throw Error(a(459));var e=fn;return fn=null,e}var pn=null,gn=0;function _n(e){var t=gn;return gn+=1,null===pn&&(pn=[]),hn(pn,e,t)}function yn(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function vn(e,t){if(t.$$typeof===l)throw Error(a(525));throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xn(e){return(0,e._init)(e._payload)}function bn(e){function t(t,r){if(e){var o=t.deletions;null===o?(t.deletions=[r],t.flags|=16):o.push(r)}}function r(r,o){if(!e)return null;for(;null!==o;)t(r,o),o=o.sibling;return null}function o(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function n(e,t){return(e=Bl(e,t)).index=0,e.sibling=null,e}function i(t,r,o){return t.index=o,e?null!==(o=t.alternate)?(o=o.index)<r?(t.flags|=33554434,r):o:(t.flags|=33554434,r):(t.flags|=1048576,r)}function s(t){return e&&null===t.alternate&&(t.flags|=33554434),t}function l(e,t,r,o){return null===t||6!==t.tag?((t=Hl(r,e.mode,o)).return=e,t):((t=n(t,r)).return=e,t)}function h(e,t,r,o){var i=r.type;return i===d?m(e,t,r.props.children,o,r.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===b&&xn(i)===t.type)?(yn(t=n(t,r.props),r),t.return=e,t):(yn(t=zl(r.type,r.key,r.props,null,e.mode,o),r),t.return=e,t)}function f(e,t,r,o){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Gl(r,e.mode,o)).return=e,t):((t=n(t,r.children||[])).return=e,t)}function m(e,t,r,o,i){return null===t||7!==t.tag?((t=Ul(r,e.mode,o,i)).return=e,t):((t=n(t,r)).return=e,t)}function p(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Hl(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case c:return yn(r=zl(t.type,t.key,t.props,null,e.mode,r),t),r.return=e,r;case u:return(t=Gl(t,e.mode,r)).return=e,t;case b:return p(e,t=(0,t._init)(t._payload),r)}if(V(t)||S(t))return(t=Ul(t,e.mode,r,null)).return=e,t;if("function"===typeof t.then)return p(e,_n(t),r);if(t.$$typeof===g)return p(e,Es(e,t),r);vn(e,t)}return null}function _(e,t,r,o){var n=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return null!==n?null:l(e,t,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case c:return r.key===n?h(e,t,r,o):null;case u:return r.key===n?f(e,t,r,o):null;case b:return _(e,t,r=(n=r._init)(r._payload),o)}if(V(r)||S(r))return null!==n?null:m(e,t,r,o,null);if("function"===typeof r.then)return _(e,t,_n(r),o);if(r.$$typeof===g)return _(e,t,Es(e,r),o);vn(e,r)}return null}function y(e,t,r,o,n){if("string"===typeof o&&""!==o||"number"===typeof o||"bigint"===typeof o)return l(t,e=e.get(r)||null,""+o,n);if("object"===typeof o&&null!==o){switch(o.$$typeof){case c:return h(t,e=e.get(null===o.key?r:o.key)||null,o,n);case u:return f(t,e=e.get(null===o.key?r:o.key)||null,o,n);case b:return y(e,t,r,o=(0,o._init)(o._payload),n)}if(V(o)||S(o))return m(t,e=e.get(r)||null,o,n,null);if("function"===typeof o.then)return y(e,t,r,_n(o),n);if(o.$$typeof===g)return y(e,t,r,Es(t,o),n);vn(t,o)}return null}function v(l,h,f,m){if("object"===typeof f&&null!==f&&f.type===d&&null===f.key&&(f=f.props.children),"object"===typeof f&&null!==f){switch(f.$$typeof){case c:e:{for(var x=f.key;null!==h;){if(h.key===x){if((x=f.type)===d){if(7===h.tag){r(l,h.sibling),(m=n(h,f.props.children)).return=l,l=m;break e}}else if(h.elementType===x||"object"===typeof x&&null!==x&&x.$$typeof===b&&xn(x)===h.type){r(l,h.sibling),yn(m=n(h,f.props),f),m.return=l,l=m;break e}r(l,h);break}t(l,h),h=h.sibling}f.type===d?((m=Ul(f.props.children,l.mode,m,f.key)).return=l,l=m):(yn(m=zl(f.type,f.key,f.props,null,l.mode,m),f),m.return=l,l=m)}return s(l);case u:e:{for(x=f.key;null!==h;){if(h.key===x){if(4===h.tag&&h.stateNode.containerInfo===f.containerInfo&&h.stateNode.implementation===f.implementation){r(l,h.sibling),(m=n(h,f.children||[])).return=l,l=m;break e}r(l,h);break}t(l,h),h=h.sibling}(m=Gl(f,l.mode,m)).return=l,l=m}return s(l);case b:return v(l,h,f=(x=f._init)(f._payload),m)}if(V(f))return function(n,a,s,l){for(var c=null,u=null,d=a,h=a=0,f=null;null!==d&&h<s.length;h++){d.index>h?(f=d,d=null):f=d.sibling;var m=_(n,d,s[h],l);if(null===m){null===d&&(d=f);break}e&&d&&null===m.alternate&&t(n,d),a=i(m,a,h),null===u?c=m:u.sibling=m,u=m,d=f}if(h===s.length)return r(n,d),qo&&jo(n,h),c;if(null===d){for(;h<s.length;h++)null!==(d=p(n,s[h],l))&&(a=i(d,a,h),null===u?c=d:u.sibling=d,u=d);return qo&&jo(n,h),c}for(d=o(d);h<s.length;h++)null!==(f=y(d,n,h,s[h],l))&&(e&&null!==f.alternate&&d.delete(null===f.key?h:f.key),a=i(f,a,h),null===u?c=f:u.sibling=f,u=f);return e&&d.forEach((function(e){return t(n,e)})),qo&&jo(n,h),c}(l,h,f,m);if(S(f)){if("function"!==typeof(x=S(f)))throw Error(a(150));return function(n,s,l,c){if(null==l)throw Error(a(151));for(var u=null,d=null,h=s,f=s=0,m=null,g=l.next();null!==h&&!g.done;f++,g=l.next()){h.index>f?(m=h,h=null):m=h.sibling;var v=_(n,h,g.value,c);if(null===v){null===h&&(h=m);break}e&&h&&null===v.alternate&&t(n,h),s=i(v,s,f),null===d?u=v:d.sibling=v,d=v,h=m}if(g.done)return r(n,h),qo&&jo(n,f),u;if(null===h){for(;!g.done;f++,g=l.next())null!==(g=p(n,g.value,c))&&(s=i(g,s,f),null===d?u=g:d.sibling=g,d=g);return qo&&jo(n,f),u}for(h=o(h);!g.done;f++,g=l.next())null!==(g=y(h,n,f,g.value,c))&&(e&&null!==g.alternate&&h.delete(null===g.key?f:g.key),s=i(g,s,f),null===d?u=g:d.sibling=g,d=g);return e&&h.forEach((function(e){return t(n,e)})),qo&&jo(n,f),u}(l,h,f=x.call(f),m)}if("function"===typeof f.then)return v(l,h,_n(f),m);if(f.$$typeof===g)return v(l,h,Es(l,f),m);vn(l,f)}return"string"===typeof f&&""!==f||"number"===typeof f||"bigint"===typeof f?(f=""+f,null!==h&&6===h.tag?(r(l,h.sibling),(m=n(h,f)).return=l,l=m):(r(l,h),(m=Hl(f,l.mode,m)).return=l,l=m),s(l)):r(l,h)}return function(e,t,r,o){try{gn=0;var n=v(e,t,r,o);return pn=null,n}catch(a){if(a===sn)throw a;var i=kl(29,a,null,e.mode);return i.lanes=o,i.return=e,i}}}var Ln=bn(!0),An=bn(!1),wn=K(null),Sn=K(0);function En(e,t){Z(Sn,e=cc),Z(wn,t),cc=e|t.baseLanes}function Tn(){Z(Sn,cc),Z(wn,wn.current)}function Pn(){cc=Sn.current,J(wn),J(Sn)}var Cn=K(null),Rn=null;function Mn(e){var t=e.alternate;Z(kn,1&kn.current),Z(Cn,e),null===Rn&&(null===t||null!==wn.current||null!==t.memoizedState)&&(Rn=e)}function In(e){if(22===e.tag){if(Z(kn,kn.current),Z(Cn,e),null===Rn){var t=e.alternate;null!==t&&null!==t.memoizedState&&(Rn=e)}}else On()}function On(){Z(kn,kn.current),Z(Cn,Cn.current)}function Dn(e){J(Cn),Rn===e&&(Rn=null),J(kn)}var kn=K(0);function Nn(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Bn="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach((function(e){return e()}))}},Fn=o.unstable_scheduleCallback,zn=o.unstable_NormalPriority,Un={$$typeof:g,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Vn(){return{controller:new Bn,data:new Map,refCount:0}}function Hn(e){e.refCount--,0===e.refCount&&Fn(zn,(function(){e.controller.abort()}))}var Gn=null,jn=0,Wn=0,Kn=null;function Jn(){if(0===--jn&&null!==Gn){null!==Kn&&(Kn.status="fulfilled");var e=Gn;Gn=null,Wn=0,Kn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Zn=R.S;R.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Gn){var r=Gn=[];jn=0,Wn=bu(),Kn={status:"pending",value:void 0,then:function(e){r.push(e)}}}jn++,t.then(Jn,Jn)}(0,t),null!==Zn&&Zn(e,t)};var Yn=K(null);function qn(){var e=Yn.current;return null!==e?e:tc.pooledCache}function $n(e,t){Z(Yn,null===t?Yn.current:t.pool)}function Xn(){var e=qn();return null===e?null:{parent:Un._currentValue,pool:e}}var Qn=0,ei=null,ti=null,ri=null,oi=!1,ni=!1,ii=!1,ai=0,si=0,li=null,ci=0;function ui(){throw Error(a(321))}function di(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Jr(e[r],t[r]))return!1;return!0}function hi(e,t,r,o,n,i){return Qn=i,ei=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=null===e||null===e.memoizedState?Ea:Ta,ii=!1,i=r(o,n),ii=!1,ni&&(i=mi(t,r,o,n)),fi(e),i}function fi(e){R.H=Sa;var t=null!==ti&&null!==ti.next;if(Qn=0,ri=ti=ei=null,oi=!1,si=0,li=null,t)throw Error(a(300));null===e||ja||null!==(e=e.dependencies)&&As(e)&&(ja=!0)}function mi(e,t,r,o){ei=e;var n=0;do{if(ni&&(li=null),si=0,ni=!1,25<=n)throw Error(a(301));if(n+=1,ri=ti=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}R.H=Pa,i=t(r,o)}while(ni);return i}function pi(){var e=R.H,t=e.useState()[0];return t="function"===typeof t.then?bi(t):t,e=e.useState()[0],(null!==ti?ti.memoizedState:null)!==e&&(ei.flags|=1024),t}function gi(){var e=0!==ai;return ai=0,e}function _i(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function yi(e){if(oi){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}oi=!1}Qn=0,ri=ti=ei=null,ni=!1,si=ai=0,li=null}function vi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ri?ei.memoizedState=ri=e:ri=ri.next=e,ri}function xi(){if(null===ti){var e=ei.alternate;e=null!==e?e.memoizedState:null}else e=ti.next;var t=null===ri?ei.memoizedState:ri.next;if(null!==t)ri=t,ti=e;else{if(null===e){if(null===ei.alternate)throw Error(a(467));throw Error(a(310))}e={memoizedState:(ti=e).memoizedState,baseState:ti.baseState,baseQueue:ti.baseQueue,queue:ti.queue,next:null},null===ri?ei.memoizedState=ri=e:ri=ri.next=e}return ri}function bi(e){var t=si;return si+=1,null===li&&(li=[]),e=hn(li,e,t),t=ei,null===(null===ri?t.memoizedState:ri.next)&&(t=t.alternate,R.H=null===t||null===t.memoizedState?Ea:Ta),e}function Li(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return bi(e);if(e.$$typeof===g)return Ss(e)}throw Error(a(438,String(e)))}function Ai(e){var t=null,r=ei.updateQueue;if(null!==r&&(t=r.memoCache),null==t){var o=ei.alternate;null!==o&&(null!==(o=o.updateQueue)&&(null!=(o=o.memoCache)&&(t={data:o.data.map((function(e){return e.slice()})),index:0})))}if(null==t&&(t={data:[],index:0}),null===r&&(r={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=r),r.memoCache=t,void 0===(r=t.data[t.index]))for(r=t.data[t.index]=Array(e),o=0;o<e;o++)r[o]=A;return t.index++,r}function wi(e,t){return"function"===typeof t?t(e):t}function Si(e){return Ei(xi(),ti,e)}function Ei(e,t,r){var o=e.queue;if(null===o)throw Error(a(311));o.lastRenderedReducer=r;var n=e.baseQueue,i=o.pending;if(null!==i){if(null!==n){var s=n.next;n.next=i.next,i.next=s}t.baseQueue=n=i,o.pending=null}if(i=e.baseState,null===n)e.memoizedState=i;else{var l=s=null,c=null,u=t=n.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(oc&h)===h:(Qn&h)===h){var f=u.revertLane;if(0===f)null!==c&&(c=c.next={lane:0,revertLane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Wn&&(d=!0);else{if((Qn&f)===f){u=u.next,f===Wn&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,s=i):c=c.next=h,ei.lanes|=f,dc|=f}h=u.action,ii&&r(i,h),i=u.hasEagerState?u.eagerState:r(i,h)}else f={lane:h,revertLane:u.revertLane,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=f,s=i):c=c.next=f,ei.lanes|=h,dc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?s=i:c.next=l,!Jr(i,e.memoizedState)&&(ja=!0,d&&null!==(r=Kn)))throw r;e.memoizedState=i,e.baseState=s,e.baseQueue=c,o.lastRenderedState=i}return null===n&&(o.lanes=0),[e.memoizedState,o.dispatch]}function Ti(e){var t=xi(),r=t.queue;if(null===r)throw Error(a(311));r.lastRenderedReducer=e;var o=r.dispatch,n=r.pending,i=t.memoizedState;if(null!==n){r.pending=null;var s=n=n.next;do{i=e(i,s.action),s=s.next}while(s!==n);Jr(i,t.memoizedState)||(ja=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),r.lastRenderedState=i}return[i,o]}function Pi(e,t,r){var o=ei,n=xi(),i=qo;if(i){if(void 0===r)throw Error(a(407));r=r()}else r=t();var s=!Jr((ti||n).memoizedState,r);if(s&&(n.memoizedState=r,ja=!0),n=n.queue,Qi(Mi.bind(null,o,n,e),[e]),n.getSnapshot!==t||s||null!==ri&&1&ri.memoizedState.tag){if(o.flags|=2048,Zi(9,Ri.bind(null,o,n,r,t),{destroy:void 0},null),null===tc)throw Error(a(349));i||0!==(60&Qn)||Ci(o,t,r)}return r}function Ci(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=ei.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function Ri(e,t,r,o){t.value=r,t.getSnapshot=o,Ii(t)&&Oi(e)}function Mi(e,t,r){return r((function(){Ii(t)&&Oi(e)}))}function Ii(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Jr(e,r)}catch(o){return!0}}function Oi(e){var t=Co(e,2);null!==t&&Ic(t,e,2)}function Di(e){var t=vi();if("function"===typeof e){var r=e;if(e=r(),ii){ve(!0);try{r()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:e},t}function ki(e,t,r,o){return e.baseState=r,Ei(e,ti,"function"===typeof o?o:wi)}function Ni(e,t,r,o,n){if(La(e))throw Error(a(485));if(null!==(e=t.action)){var i={payload:n,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==R.T?r(!0):i.isTransition=!1,o(i),null===(r=t.pending)?(i.next=t.pending=i,Bi(t,i)):(i.next=r.next,t.pending=r.next=i)}}function Bi(e,t){var r=t.action,o=t.payload,n=e.state;if(t.isTransition){var i=R.T,a={};R.T=a;try{var s=r(n,o),l=R.S;null!==l&&l(a,s),Fi(e,t,s)}catch(c){Ui(e,t,c)}finally{R.T=i}}else try{Fi(e,t,i=r(n,o))}catch(u){Ui(e,t,u)}}function Fi(e,t,r){null!==r&&"object"===typeof r&&"function"===typeof r.then?r.then((function(r){zi(e,t,r)}),(function(r){return Ui(e,t,r)})):zi(e,t,r)}function zi(e,t,r){t.status="fulfilled",t.value=r,Vi(t),e.state=r,null!==(t=e.pending)&&((r=t.next)===t?e.pending=null:(r=r.next,t.next=r,Bi(e,r)))}function Ui(e,t,r){var o=e.pending;if(e.pending=null,null!==o){o=o.next;do{t.status="rejected",t.reason=r,Vi(t),t=t.next}while(t!==o)}e.action=null}function Vi(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Hi(e,t){return t}function Gi(e,t){if(qo){var r=tc.formState;if(null!==r){e:{var o=ei;if(qo){if(Yo){t:{for(var n=Yo,i=Xo;8!==n.nodeType;){if(!i){n=null;break t}if(null===(n=sd(n.nextSibling))){n=null;break t}}n="F!"===(i=n.data)||"F"===i?n:null}if(n){Yo=sd(n.nextSibling),o="F!"===n.data;break e}}en(o)}o=!1}o&&(t=r[0])}}return(r=vi()).memoizedState=r.baseState=t,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:t},r.queue=o,r=va.bind(null,ei,o),o.dispatch=r,o=Di(!1),i=ba.bind(null,ei,!1,o.queue),n={state:t,dispatch:null,action:e,pending:null},(o=vi()).queue=n,r=Ni.bind(null,ei,n,i,r),n.dispatch=r,o.memoizedState=e,[t,r,!1]}function ji(e){return Wi(xi(),ti,e)}function Wi(e,t,r){t=Ei(e,t,Hi)[0],e=Si(wi)[0],t="object"===typeof t&&null!==t&&"function"===typeof t.then?bi(t):t;var o=xi(),n=o.queue,i=n.dispatch;return r!==o.memoizedState&&(ei.flags|=2048,Zi(9,Ki.bind(null,n,r),{destroy:void 0},null)),[t,i,e]}function Ki(e,t){e.action=t}function Ji(e){var t=xi(),r=ti;if(null!==r)return Wi(t,r,e);xi(),t=t.memoizedState;var o=(r=xi()).queue.dispatch;return r.memoizedState=e,[t,o,!1]}function Zi(e,t,r,o){return e={tag:e,create:t,inst:r,deps:o,next:null},null===(t=ei.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},ei.updateQueue=t),null===(r=t.lastEffect)?t.lastEffect=e.next=e:(o=r.next,r.next=e,e.next=o,t.lastEffect=e),e}function Yi(){return xi().memoizedState}function qi(e,t,r,o){var n=vi();ei.flags|=e,n.memoizedState=Zi(1|t,r,{destroy:void 0},void 0===o?null:o)}function $i(e,t,r,o){var n=xi();o=void 0===o?null:o;var i=n.memoizedState.inst;null!==ti&&null!==o&&di(o,ti.memoizedState.deps)?n.memoizedState=Zi(t,r,i,o):(ei.flags|=e,n.memoizedState=Zi(1|t,r,i,o))}function Xi(e,t){qi(8390656,8,e,t)}function Qi(e,t){$i(2048,8,e,t)}function ea(e,t){return $i(4,2,e,t)}function ta(e,t){return $i(4,4,e,t)}function ra(e,t){if("function"===typeof t){e=e();var r=t(e);return function(){"function"===typeof r?r():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function oa(e,t,r){r=null!==r&&void 0!==r?r.concat([e]):null,$i(4,4,ra.bind(null,t,e),r)}function na(){}function ia(e,t){var r=xi();t=void 0===t?null:t;var o=r.memoizedState;return null!==t&&di(t,o[1])?o[0]:(r.memoizedState=[e,t],e)}function aa(e,t){var r=xi();t=void 0===t?null:t;var o=r.memoizedState;if(null!==t&&di(t,o[1]))return o[0];if(o=e(),ii){ve(!0);try{e()}finally{ve(!1)}}return r.memoizedState=[o,t],o}function sa(e,t,r){return void 0===r||0!==(1073741824&Qn)?e.memoizedState=t:(e.memoizedState=r,e=Mc(),ei.lanes|=e,dc|=e,r)}function la(e,t,r,o){return Jr(r,t)?r:null!==wn.current?(e=sa(e,r,o),Jr(e,t)||(ja=!0),e):0===(42&Qn)?(ja=!0,e.memoizedState=r):(e=Mc(),ei.lanes|=e,dc|=e,t)}function ca(e,t,r,o,n){var i=H.p;H.p=0!==i&&8>i?i:8;var a=R.T,s={};R.T=s,ba(e,!1,t,r);try{var l=n(),c=R.S;if(null!==c&&c(s,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)xa(e,t,function(e,t){var r=[],o={status:"pending",value:null,reason:null,then:function(e){r.push(e)}};return e.then((function(){o.status="fulfilled",o.value=t;for(var e=0;e<r.length;e++)(0,r[e])(t)}),(function(e){for(o.status="rejected",o.reason=e,e=0;e<r.length;e++)(0,r[e])(void 0)})),o}(l,o),Rc());else xa(e,t,o,Rc())}catch(u){xa(e,t,{then:function(){},status:"rejected",reason:u},Rc())}finally{H.p=i,R.T=a}}function ua(){}function da(e,t,r,o){if(5!==e.tag)throw Error(a(476));var n=ha(e).queue;ca(e,n,t,G,null===r?ua:function(){return fa(e),r(o)})}function ha(e){var t=e.memoizedState;if(null!==t)return t;var r={};return(t={memoizedState:G,baseState:G,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:G},next:null}).next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:wi,lastRenderedState:r},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function fa(e){xa(e,ha(e).next.queue,{},Rc())}function ma(){return Ss(Nd)}function pa(){return xi().memoizedState}function ga(){return xi().memoizedState}function _a(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var r=Rc(),o=Is(t,e=Ms(r),r);return null!==o&&(Ic(o,t,r),Os(o,t,r)),t={cache:Vn()},void(e.payload=t)}t=t.return}}function ya(e,t,r){var o=Rc();r={lane:o,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},La(e)?Aa(t,r):null!==(r=Po(e,t,r,o))&&(Ic(r,e,o),wa(r,t,o))}function va(e,t,r){xa(e,t,r,Rc())}function xa(e,t,r,o){var n={lane:o,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(La(e))Aa(t,n);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=i(a,r);if(n.hasEagerState=!0,n.eagerState=s,Jr(s,a))return To(e,t,n,0),null===tc&&Eo(),!1}catch(l){}if(null!==(r=Po(e,t,n,o)))return Ic(r,e,o),wa(r,t,o),!0}return!1}function ba(e,t,r,o){if(o={lane:2,revertLane:bu(),action:o,hasEagerState:!1,eagerState:null,next:null},La(e)){if(t)throw Error(a(479))}else null!==(t=Po(e,r,o,2))&&Ic(t,e,2)}function La(e){var t=e.alternate;return e===ei||null!==t&&t===ei}function Aa(e,t){ni=oi=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function wa(e,t,r){if(0!==(4194176&r)){var o=t.lanes;r|=o&=e.pendingLanes,t.lanes=r,De(e,r)}}var Sa={readContext:Ss,use:Li,useCallback:ui,useContext:ui,useEffect:ui,useImperativeHandle:ui,useLayoutEffect:ui,useInsertionEffect:ui,useMemo:ui,useReducer:ui,useRef:ui,useState:ui,useDebugValue:ui,useDeferredValue:ui,useTransition:ui,useSyncExternalStore:ui,useId:ui};Sa.useCacheRefresh=ui,Sa.useMemoCache=ui,Sa.useHostTransitionStatus=ui,Sa.useFormState=ui,Sa.useActionState=ui,Sa.useOptimistic=ui;var Ea={readContext:Ss,use:Li,useCallback:function(e,t){return vi().memoizedState=[e,void 0===t?null:t],e},useContext:Ss,useEffect:Xi,useImperativeHandle:function(e,t,r){r=null!==r&&void 0!==r?r.concat([e]):null,qi(4194308,4,ra.bind(null,t,e),r)},useLayoutEffect:function(e,t){return qi(4194308,4,e,t)},useInsertionEffect:function(e,t){qi(4,2,e,t)},useMemo:function(e,t){var r=vi();t=void 0===t?null:t;var o=e();if(ii){ve(!0);try{e()}finally{ve(!1)}}return r.memoizedState=[o,t],o},useReducer:function(e,t,r){var o=vi();if(void 0!==r){var n=r(t);if(ii){ve(!0);try{r(t)}finally{ve(!1)}}}else n=t;return o.memoizedState=o.baseState=n,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},o.queue=e,e=e.dispatch=ya.bind(null,ei,e),[o.memoizedState,e]},useRef:function(e){return e={current:e},vi().memoizedState=e},useState:function(e){var t=(e=Di(e)).queue,r=va.bind(null,ei,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:na,useDeferredValue:function(e,t){return sa(vi(),e,t)},useTransition:function(){var e=Di(!1);return e=ca.bind(null,ei,e.queue,!0,!1),vi().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var o=ei,n=vi();if(qo){if(void 0===r)throw Error(a(407));r=r()}else{if(r=t(),null===tc)throw Error(a(349));0!==(60&oc)||Ci(o,t,r)}n.memoizedState=r;var i={value:r,getSnapshot:t};return n.queue=i,Xi(Mi.bind(null,o,i,e),[e]),o.flags|=2048,Zi(9,Ri.bind(null,o,i,r,t),{destroy:void 0},null),r},useId:function(){var e=vi(),t=tc.identifierPrefix;if(qo){var r=Go;t=":"+t+"R"+(r=(Ho&~(1<<32-xe(Ho)-1)).toString(32)+r),0<(r=ai++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=ci++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return vi().memoizedState=_a.bind(null,ei)}};Ea.useMemoCache=Ai,Ea.useHostTransitionStatus=ma,Ea.useFormState=Gi,Ea.useActionState=Gi,Ea.useOptimistic=function(e){var t=vi();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=ba.bind(null,ei,!0,r),r.dispatch=t,[e,t]};var Ta={readContext:Ss,use:Li,useCallback:ia,useContext:Ss,useEffect:Qi,useImperativeHandle:oa,useInsertionEffect:ea,useLayoutEffect:ta,useMemo:aa,useReducer:Si,useRef:Yi,useState:function(){return Si(wi)},useDebugValue:na,useDeferredValue:function(e,t){return la(xi(),ti.memoizedState,e,t)},useTransition:function(){var e=Si(wi)[0],t=xi().memoizedState;return["boolean"===typeof e?e:bi(e),t]},useSyncExternalStore:Pi,useId:pa};Ta.useCacheRefresh=ga,Ta.useMemoCache=Ai,Ta.useHostTransitionStatus=ma,Ta.useFormState=ji,Ta.useActionState=ji,Ta.useOptimistic=function(e,t){return ki(xi(),0,e,t)};var Pa={readContext:Ss,use:Li,useCallback:ia,useContext:Ss,useEffect:Qi,useImperativeHandle:oa,useInsertionEffect:ea,useLayoutEffect:ta,useMemo:aa,useReducer:Ti,useRef:Yi,useState:function(){return Ti(wi)},useDebugValue:na,useDeferredValue:function(e,t){var r=xi();return null===ti?sa(r,e,t):la(r,ti.memoizedState,e,t)},useTransition:function(){var e=Ti(wi)[0],t=xi().memoizedState;return["boolean"===typeof e?e:bi(e),t]},useSyncExternalStore:Pi,useId:pa};function Ca(e,t,r,o){r=null===(r=r(o,t=e.memoizedState))||void 0===r?t:M({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}Pa.useCacheRefresh=ga,Pa.useMemoCache=Ai,Pa.useHostTransitionStatus=ma,Pa.useFormState=Ji,Pa.useActionState=Ji,Pa.useOptimistic=function(e,t){var r=xi();return null!==ti?ki(r,0,e,t):(r.baseState=e,[e,r.queue.dispatch])};var Ra={isMounted:function(e){return!!(e=e._reactInternals)&&B(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var o=Rc(),n=Ms(o);n.payload=t,void 0!==r&&null!==r&&(n.callback=r),null!==(t=Is(e,n,o))&&(Ic(t,e,o),Os(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var o=Rc(),n=Ms(o);n.tag=1,n.payload=t,void 0!==r&&null!==r&&(n.callback=r),null!==(t=Is(e,n,o))&&(Ic(t,e,o),Os(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Rc(),o=Ms(r);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),null!==(t=Is(e,o,r))&&(Ic(t,e,r),Os(t,e,r))}};function Ma(e,t,r,o,n,i,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(o,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!Zr(r,o)||!Zr(n,i))}function Ia(e,t,r,o){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,o),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,o),t.state!==e&&Ra.enqueueReplaceState(t,t.state,null)}function Oa(e,t){var r=t;if("ref"in t)for(var o in r={},t)"ref"!==o&&(r[o]=t[o]);if(e=e.defaultProps)for(var n in r===t&&(r=M({},r)),e)void 0===r[n]&&(r[n]=e[n]);return r}var Da="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function ka(e){Da(e)}function Na(e){console.error(e)}function Ba(e){Da(e)}function Fa(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(r){setTimeout((function(){throw r}))}}function za(e,t,r){try{(0,e.onCaughtError)(r.value,{componentStack:r.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(o){setTimeout((function(){throw o}))}}function Ua(e,t,r){return(r=Ms(r)).tag=3,r.payload={element:null},r.callback=function(){Fa(e,t)},r}function Va(e){return(e=Ms(e)).tag=3,e}function Ha(e,t,r,o){var n=r.type.getDerivedStateFromError;if("function"===typeof n){var i=o.value;e.payload=function(){return n(i)},e.callback=function(){za(t,r,o)}}var a=r.stateNode;null!==a&&"function"===typeof a.componentDidCatch&&(e.callback=function(){za(t,r,o),"function"!==typeof n&&(null===Lc?Lc=new Set([this]):Lc.add(this));var e=o.stack;this.componentDidCatch(o.value,{componentStack:null!==e?e:""})})}var Ga=Error(a(461)),ja=!1;function Wa(e,t,r,o){t.child=null===e?An(t,null,r,o):Ln(t,e.child,r,o)}function Ka(e,t,r,o,n){r=r.render;var i=t.ref;if("ref"in o){var a={};for(var s in o)"ref"!==s&&(a[s]=o[s])}else a=o;return ws(t),o=hi(e,t,r,a,i,n),s=gi(),null===e||ja?(qo&&s&&Ko(t),t.flags|=1,Wa(e,t,o,n),t.child):(_i(e,t,n),hs(e,t,n))}function Ja(e,t,r,o,n){if(null===e){var i=r.type;return"function"!==typeof i||Nl(i)||void 0!==i.defaultProps||null!==r.compare?((e=zl(r.type,null,o,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Za(e,t,i,o,n))}if(i=e.child,!fs(e,n)){var a=i.memoizedProps;if((r=null!==(r=r.compare)?r:Zr)(a,o)&&e.ref===t.ref)return hs(e,t,n)}return t.flags|=1,(e=Bl(i,o)).ref=t.ref,e.return=t,t.child=e}function Za(e,t,r,o,n){if(null!==e){var i=e.memoizedProps;if(Zr(i,o)&&e.ref===t.ref){if(ja=!1,t.pendingProps=o=i,!fs(e,n))return t.lanes=e.lanes,hs(e,t,n);0!==(131072&e.flags)&&(ja=!0)}}return Xa(e,t,r,o,n)}function Ya(e,t,r){var o=t.pendingProps,n=o.children,i=0!==(2&t.stateNode._pendingVisibility),a=null!==e?e.memoizedState:null;if($a(e,t),"hidden"===o.mode||i){if(0!==(128&t.flags)){if(o=null!==a?a.baseLanes|r:r,null!==e){for(n=t.child=e.child,i=0;null!==n;)i=i|n.lanes|n.childLanes,n=n.sibling;t.childLanes=i&~o}else t.childLanes=0,t.child=null;return qa(e,t,o,r)}if(0===(536870912&r))return t.lanes=t.childLanes=536870912,qa(e,t,null!==a?a.baseLanes|r:r,r);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&$n(0,null!==a?a.cachePool:null),null!==a?En(t,a):Tn(),In(t)}else null!==a?($n(0,a.cachePool),En(t,a),On(),t.memoizedState=null):(null!==e&&$n(0,null),Tn(),On());return Wa(e,t,n,r),t.child}function qa(e,t,r,o){var n=qn();return n=null===n?null:{parent:Un._currentValue,pool:n},t.memoizedState={baseLanes:r,cachePool:n},null!==e&&$n(0,null),Tn(),In(t),null!==e&&Ls(e,t,o,!0),null}function $a(e,t){var r=t.ref;if(null===r)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!==typeof r&&"object"!==typeof r)throw Error(a(284));null!==e&&e.ref===r||(t.flags|=2097664)}}function Xa(e,t,r,o,n){return ws(t),r=hi(e,t,r,o,void 0,n),o=gi(),null===e||ja?(qo&&o&&Ko(t),t.flags|=1,Wa(e,t,r,n),t.child):(_i(e,t,n),hs(e,t,n))}function Qa(e,t,r,o,n,i){return ws(t),t.updateQueue=null,r=mi(t,o,r,n),fi(e),o=gi(),null===e||ja?(qo&&o&&Ko(t),t.flags|=1,Wa(e,t,r,i),t.child):(_i(e,t,i),hs(e,t,i))}function es(e,t,r,o,n){if(ws(t),null===t.stateNode){var i=Io,a=r.contextType;"object"===typeof a&&null!==a&&(i=Ss(a)),i=new r(o,i),t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,i.updater=Ra,t.stateNode=i,i._reactInternals=t,(i=t.stateNode).props=o,i.state=t.memoizedState,i.refs={},Cs(t),a=r.contextType,i.context="object"===typeof a&&null!==a?Ss(a):Io,i.state=t.memoizedState,"function"===typeof(a=r.getDerivedStateFromProps)&&(Ca(t,r,a,o),i.state=t.memoizedState),"function"===typeof r.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(a=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),a!==i.state&&Ra.enqueueReplaceState(i,i.state,null),Bs(t,o,i,n),Ns(),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.flags|=4194308),o=!0}else if(null===e){i=t.stateNode;var s=t.memoizedProps,l=Oa(r,s);i.props=l;var c=i.context,u=r.contextType;a=Io,"object"===typeof u&&null!==u&&(a=Ss(u));var d=r.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof i.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(s||c!==a)&&Ia(t,i,o,a),Ps=!1;var h=t.memoizedState;i.state=h,Bs(t,o,i,n),Ns(),c=t.memoizedState,s||h!==c||Ps?("function"===typeof d&&(Ca(t,r,d,o),c=t.memoizedState),(l=Ps||Ma(t,r,l,o,h,c,a))?(u||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=c),i.props=o,i.state=c,i.context=a,o=l):("function"===typeof i.componentDidMount&&(t.flags|=4194308),o=!1)}else{i=t.stateNode,Rs(e,t),u=Oa(r,a=t.memoizedProps),i.props=u,d=t.pendingProps,h=i.context,c=r.contextType,l=Io,"object"===typeof c&&null!==c&&(l=Ss(c)),(c="function"===typeof(s=r.getDerivedStateFromProps)||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(a!==d||h!==l)&&Ia(t,i,o,l),Ps=!1,h=t.memoizedState,i.state=h,Bs(t,o,i,n),Ns();var f=t.memoizedState;a!==d||h!==f||Ps||null!==e&&null!==e.dependencies&&As(e.dependencies)?("function"===typeof s&&(Ca(t,r,s,o),f=t.memoizedState),(u=Ps||Ma(t,r,u,o,h,f,l)||null!==e&&null!==e.dependencies&&As(e.dependencies))?(c||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(o,f,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(o,f,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=f),i.props=o,i.state=f,i.context=l,o=u):("function"!==typeof i.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),o=!1)}return i=o,$a(e,t),o=0!==(128&t.flags),i||o?(i=t.stateNode,r=o&&"function"!==typeof r.getDerivedStateFromError?null:i.render(),t.flags|=1,null!==e&&o?(t.child=Ln(t,e.child,null,n),t.child=Ln(t,null,r,n)):Wa(e,t,r,n),t.memoizedState=i.state,e=t.child):e=hs(e,t,n),e}function ts(e,t,r,o){return nn(),t.flags|=256,Wa(e,t,r,o),t.child}var rs={dehydrated:null,treeContext:null,retryLane:0};function os(e){return{baseLanes:e,cachePool:Xn()}}function ns(e,t,r){return e=null!==e?e.childLanes&~r:0,t&&(e|=mc),e}function is(e,t,r){var o,n=t.pendingProps,i=!1,s=0!==(128&t.flags);if((o=s)||(o=(null===e||null!==e.memoizedState)&&0!==(2&kn.current)),o&&(i=!0,t.flags&=-129),o=0!==(32&t.flags),t.flags&=-33,null===e){if(qo){if(i?Mn(t):On(),qo){var l,c=Yo;if(l=c){e:{for(l=c,c=Xo;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=sd(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Vo?{id:Ho,overflow:Go}:null,retryLane:536870912},(l=kl(18,null,null,0)).stateNode=c,l.return=t,t.child=l,Zo=t,Yo=null,l=!0):l=!1}l||en(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return"$!"===c.data?t.lanes=16:t.lanes=536870912,null;Dn(t)}return c=n.children,n=n.fallback,i?(On(),c=ss({mode:"hidden",children:c},i=t.mode),n=Ul(n,i,r,null),c.return=t,n.return=t,c.sibling=n,t.child=c,(i=t.child).memoizedState=os(r),i.childLanes=ns(e,o,r),t.memoizedState=rs,n):(Mn(t),as(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(s)256&t.flags?(Mn(t),t.flags&=-257,t=ls(e,t,r)):null!==t.memoizedState?(On(),t.child=e.child,t.flags|=128,t=null):(On(),i=n.fallback,c=t.mode,n=ss({mode:"visible",children:n.children},c),(i=Ul(i,c,r,null)).flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,Ln(t,e.child,null,r),(n=t.child).memoizedState=os(r),n.childLanes=ns(e,o,r),t.memoizedState=rs,t=i);else if(Mn(t),"$!"===c.data){if(o=c.nextSibling&&c.nextSibling.dataset)var u=o.dgst;o=u,(n=Error(a(419))).stack="",n.digest=o,an({value:n,source:null,stack:null}),t=ls(e,t,r)}else if(ja||Ls(e,t,r,!1),o=0!==(r&e.childLanes),ja||o){if(null!==(o=tc)){if(0!==(42&(n=r&-r)))n=1;else switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=64;break;case 268435456:n=134217728;break;default:n=0}if(0!==(n=0!==(n&(o.suspendedLanes|r))?0:n)&&n!==l.retryLane)throw l.retryLane=n,Co(e,n),Ic(o,e,n),Ga}"$?"===c.data||jc(),t=ls(e,t,r)}else"$?"===c.data?(t.flags|=128,t.child=e.child,t=su.bind(null,e),c._reactRetry=t,t=null):(e=l.treeContext,Yo=sd(c.nextSibling),Zo=t,qo=!0,$o=null,Xo=!1,null!==e&&(zo[Uo++]=Ho,zo[Uo++]=Go,zo[Uo++]=Vo,Ho=e.id,Go=e.overflow,Vo=t),(t=as(t,n.children)).flags|=4096);return t}return i?(On(),i=n.fallback,c=t.mode,u=(l=e.child).sibling,(n=Bl(l,{mode:"hidden",children:n.children})).subtreeFlags=31457280&l.subtreeFlags,null!==u?i=Bl(u,i):(i=Ul(i,c,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,null===(c=e.child.memoizedState)?c=os(r):(null!==(l=c.cachePool)?(u=Un._currentValue,l=l.parent!==u?{parent:u,pool:u}:l):l=Xn(),c={baseLanes:c.baseLanes|r,cachePool:l}),i.memoizedState=c,i.childLanes=ns(e,o,r),t.memoizedState=rs,n):(Mn(t),e=(r=e.child).sibling,(r=Bl(r,{mode:"visible",children:n.children})).return=t,r.sibling=null,null!==e&&(null===(o=t.deletions)?(t.deletions=[e],t.flags|=16):o.push(e)),t.child=r,t.memoizedState=null,r)}function as(e,t){return(t=ss({mode:"visible",children:t},e.mode)).return=e,e.child=t}function ss(e,t){return Vl(e,t,0,null)}function ls(e,t,r){return Ln(t,e.child,null,r),(e=as(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function cs(e,t,r){e.lanes|=t;var o=e.alternate;null!==o&&(o.lanes|=t),xs(e.return,t,r)}function us(e,t,r,o,n){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:r,tailMode:n}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=o,i.tail=r,i.tailMode=n)}function ds(e,t,r){var o=t.pendingProps,n=o.revealOrder,i=o.tail;if(Wa(e,t,o.children,r),0!==(2&(o=kn.current)))o=1&o|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&cs(e,r,t);else if(19===e.tag)cs(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}switch(Z(kn,o),n){case"forwards":for(r=t.child,n=null;null!==r;)null!==(e=r.alternate)&&null===Nn(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),us(t,!1,n,r,i);break;case"backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===Nn(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}us(t,!0,r,null,i);break;case"together":us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function hs(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),dc|=t.lanes,0===(r&t.childLanes)){if(null===e)return null;if(Ls(e,t,r,!1),0===(r&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(r=Bl(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Bl(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function fs(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!As(e))}function ms(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps)ja=!0;else{if(!fs(e,r)&&0===(128&t.flags))return ja=!1,function(e,t,r){switch(t.tag){case 3:Q(t,t.stateNode.containerInfo),ys(t,Un,e.memoizedState.cache),nn();break;case 27:case 5:te(t);break;case 4:Q(t,t.stateNode.containerInfo);break;case 10:ys(t,t.type,t.memoizedProps.value);break;case 13:var o=t.memoizedState;if(null!==o)return null!==o.dehydrated?(Mn(t),t.flags|=128,null):0!==(r&t.child.childLanes)?is(e,t,r):(Mn(t),null!==(e=hs(e,t,r))?e.sibling:null);Mn(t);break;case 19:var n=0!==(128&e.flags);if((o=0!==(r&t.childLanes))||(Ls(e,t,r,!1),o=0!==(r&t.childLanes)),n){if(o)return ds(e,t,r);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),Z(kn,kn.current),o)break;return null;case 22:case 23:return t.lanes=0,Ya(e,t,r);case 24:ys(t,Un,e.memoizedState.cache)}return hs(e,t,r)}(e,t,r);ja=0!==(131072&e.flags)}else ja=!1,qo&&0!==(1048576&t.flags)&&Wo(t,Fo,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var o=t.elementType,n=o._init;if(o=n(o._payload),t.type=o,"function"!==typeof o){if(void 0!==o&&null!==o){if((n=o.$$typeof)===_){t.tag=11,t=Ka(null,t,o,e,r);break e}if(n===x){t.tag=14,t=Ja(null,t,o,e,r);break e}}throw t=T(o)||o,Error(a(306,t,""))}Nl(o)?(e=Oa(o,e),t.tag=1,t=es(null,t,o,e,r)):(t.tag=0,t=Xa(null,t,o,e,r))}return t;case 0:return Xa(e,t,t.type,t.pendingProps,r);case 1:return es(e,t,o=t.type,n=Oa(o,t.pendingProps),r);case 3:e:{if(Q(t,t.stateNode.containerInfo),null===e)throw Error(a(387));var i=t.pendingProps;o=(n=t.memoizedState).element,Rs(e,t),Bs(t,i,null,r);var s=t.memoizedState;if(i=s.cache,ys(t,Un,i),i!==n.cache&&bs(t,[Un],r,!0),Ns(),i=s.element,n.isDehydrated){if(n={element:i,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=n,t.memoizedState=n,256&t.flags){t=ts(e,t,i,r);break e}if(i!==o){an(o=Do(Error(a(424)),t)),t=ts(e,t,i,r);break e}for(Yo=sd(t.stateNode.containerInfo.firstChild),Zo=t,qo=!0,$o=null,Xo=!0,r=An(t,null,i,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(nn(),i===o){t=hs(e,t,r);break e}Wa(e,t,i,r)}t=t.child}return t;case 26:return $a(e,t),null===e?(r=gd(t.type,null,t.pendingProps,null))?t.memoizedState=r:qo||(r=t.type,e=t.pendingProps,(o=Yu($.current).createElement(r))[Fe]=t,o[ze]=e,Ku(o,r,e),$e(o),t.stateNode=o):t.memoizedState=gd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return te(t),null===e&&qo&&(o=t.stateNode=cd(t.type,t.pendingProps,$.current),Zo=t,Xo=!0,Yo=sd(o.firstChild)),o=t.pendingProps.children,null!==e||qo?Wa(e,t,o,r):t.child=Ln(t,null,o,r),$a(e,t),t.child;case 5:return null===e&&qo&&((n=o=Yo)&&(null!==(o=function(e,t,r,o){for(;1===e.nodeType;){var n=r;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!o&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(o){if(!e[We])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(i!==n.rel||e.getAttribute("href")!==(null==n.href?null:n.href)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin)||e.getAttribute("title")!==(null==n.title?null:n.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==n.src?null:n.src)||e.getAttribute("type")!==(null==n.type?null:n.type)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==n.name?null:""+n.name;if("hidden"===n.type&&e.getAttribute("name")===i)return e}if(null===(e=sd(e.nextSibling)))break}return null}(o,t.type,t.pendingProps,Xo))?(t.stateNode=o,Zo=t,Yo=sd(o.firstChild),Xo=!1,n=!0):n=!1),n||en(t)),te(t),n=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,Xu(n,i)?o=null:null!==s&&Xu(n,s)&&(t.flags|=32),null!==t.memoizedState&&(n=hi(e,t,pi,null,null,r),Nd._currentValue=n),$a(e,t),Wa(e,t,o,r),t.child;case 6:return null===e&&qo&&((e=r=Yo)&&(null!==(r=function(e,t,r){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!r)return null;if(null===(e=sd(e.nextSibling)))return null}return e}(r,t.pendingProps,Xo))?(t.stateNode=r,Zo=t,Yo=null,e=!0):e=!1),e||en(t)),null;case 13:return is(e,t,r);case 4:return Q(t,t.stateNode.containerInfo),o=t.pendingProps,null===e?t.child=Ln(t,null,o,r):Wa(e,t,o,r),t.child;case 11:return Ka(e,t,t.type,t.pendingProps,r);case 7:return Wa(e,t,t.pendingProps,r),t.child;case 8:case 12:return Wa(e,t,t.pendingProps.children,r),t.child;case 10:return o=t.pendingProps,ys(t,t.type,o.value),Wa(e,t,o.children,r),t.child;case 9:return n=t.type._context,o=t.pendingProps.children,ws(t),o=o(n=Ss(n)),t.flags|=1,Wa(e,t,o,r),t.child;case 14:return Ja(e,t,t.type,t.pendingProps,r);case 15:return Za(e,t,t.type,t.pendingProps,r);case 19:return ds(e,t,r);case 22:return Ya(e,t,r);case 24:return ws(t),o=Ss(Un),null===e?(null===(n=qn())&&(n=tc,i=Vn(),n.pooledCache=i,i.refCount++,null!==i&&(n.pooledCacheLanes|=r),n=i),t.memoizedState={parent:o,cache:n},Cs(t),ys(t,Un,n)):(0!==(e.lanes&r)&&(Rs(e,t),Bs(t,null,null,r),Ns()),n=e.memoizedState,i=t.memoizedState,n.parent!==o?(n={parent:o,cache:o},t.memoizedState=n,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=n),ys(t,Un,o)):(o=i.cache,ys(t,Un,o),o!==n.cache&&bs(t,[Un],r,!0))),Wa(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(a(156,t.tag))}var ps=K(null),gs=null,_s=null;function ys(e,t,r){Z(ps,t._currentValue),t._currentValue=r}function vs(e){e._currentValue=ps.current,J(ps)}function xs(e,t,r){for(;null!==e;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==o&&(o.childLanes|=t)):null!==o&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===r)break;e=e.return}}function bs(e,t,r,o){var n=e.child;for(null!==n&&(n.return=e);null!==n;){var i=n.dependencies;if(null!==i){var s=n.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=n;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=r,null!==(l=i.alternate)&&(l.lanes|=r),xs(i.return,r,e),o||(s=null);break e}i=l.next}}else if(18===n.tag){if(null===(s=n.return))throw Error(a(341));s.lanes|=r,null!==(i=s.alternate)&&(i.lanes|=r),xs(s,r,e),s=null}else s=n.child;if(null!==s)s.return=n;else for(s=n;null!==s;){if(s===e){s=null;break}if(null!==(n=s.sibling)){n.return=s.return,s=n;break}s=s.return}n=s}}function Ls(e,t,r,o){e=null;for(var n=t,i=!1;null!==n;){if(!i)if(0!==(524288&n.flags))i=!0;else if(0!==(262144&n.flags))break;if(10===n.tag){var s=n.alternate;if(null===s)throw Error(a(387));if(null!==(s=s.memoizedProps)){var l=n.type;Jr(n.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(n===X.current){if(null===(s=n.alternate))throw Error(a(387));s.memoizedState.memoizedState!==n.memoizedState.memoizedState&&(null!==e?e.push(Nd):e=[Nd])}n=n.return}null!==e&&bs(t,e,r,o),t.flags|=262144}function As(e){for(e=e.firstContext;null!==e;){if(!Jr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ws(e){gs=e,_s=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Ss(e){return Ts(gs,e)}function Es(e,t){return null===gs&&ws(e),Ts(e,t)}function Ts(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},null===_s){if(null===e)throw Error(a(308));_s=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else _s=_s.next=t;return r}var Ps=!1;function Cs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Rs(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ms(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Is(e,t,r){var o=e.updateQueue;if(null===o)return null;if(o=o.shared,0!==(2&ec)){var n=o.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),o.pending=t,t=Mo(e),Ro(e,null,r),t}return To(e,o,t,r),Mo(e)}function Os(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194176&r))){var o=t.lanes;r|=o&=e.pendingLanes,t.lanes=r,De(e,r)}}function Ds(e,t){var r=e.updateQueue,o=e.alternate;if(null!==o&&r===(o=o.updateQueue)){var n=null,i=null;if(null!==(r=r.firstBaseUpdate)){do{var a={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};null===i?n=i=a:i=i.next=a,r=r.next}while(null!==r);null===i?n=i=t:i=i.next=t}else n=i=t;return r={baseState:o.baseState,firstBaseUpdate:n,lastBaseUpdate:i,shared:o.shared,callbacks:o.callbacks},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var ks=!1;function Ns(){if(ks){if(null!==Kn)throw Kn}}function Bs(e,t,r,o){ks=!1;var n=e.updateQueue;Ps=!1;var i=n.firstBaseUpdate,a=n.lastBaseUpdate,s=n.shared.pending;if(null!==s){n.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?i=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==i){var d=n.baseState;for(a=0,u=c=l=null,s=i;;){var h=-536870913&s.lane,f=h!==s.lane;if(f?(oc&h)===h:(o&h)===h){0!==h&&h===Wn&&(ks=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});e:{var m=e,p=s;h=t;var g=r;switch(p.tag){case 1:if("function"===typeof(m=p.payload)){d=m.call(g,d,h);break e}d=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=p.payload)?m.call(g,d,h):m)||void 0===h)break e;d=M({},d,h);break e;case 2:Ps=!0}}null!==(h=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=n.callbacks)?n.callbacks=[h]:f.push(h))}else f={lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,a|=h;if(null===(s=s.next)){if(null===(s=n.shared.pending))break;s=(f=s).next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}null===u&&(l=d),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,null===i&&(n.shared.lanes=0),dc|=a,e.lanes=a,e.memoizedState=d}}function Fs(e,t){if("function"!==typeof e)throw Error(a(191,e));e.call(t)}function zs(e,t){var r=e.callbacks;if(null!==r)for(e.callbacks=null,e=0;e<r.length;e++)Fs(r[e],t)}function Us(e,t){try{var r=t.updateQueue,o=null!==r?r.lastEffect:null;if(null!==o){var n=o.next;r=n;do{if((r.tag&e)===e){o=void 0;var i=r.create,a=r.inst;o=i(),a.destroy=o}r=r.next}while(r!==n)}}catch(s){ou(t,t.return,s)}}function Vs(e,t,r){try{var o=t.updateQueue,n=null!==o?o.lastEffect:null;if(null!==n){var i=n.next;o=i;do{if((o.tag&e)===e){var a=o.inst,s=a.destroy;if(void 0!==s){a.destroy=void 0,n=t;var l=r;try{s()}catch(c){ou(n,l,c)}}}o=o.next}while(o!==i)}}catch(c){ou(t,t.return,c)}}function Hs(e){var t=e.updateQueue;if(null!==t){var r=e.stateNode;try{zs(t,r)}catch(o){ou(e,e.return,o)}}}function Gs(e,t,r){r.props=Oa(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(o){ou(e,t,o)}}function js(e,t){try{var r=e.ref;if(null!==r){var o=e.stateNode;switch(e.tag){case 26:case 27:case 5:var n=o;break;default:n=o}"function"===typeof r?e.refCleanup=r(n):r.current=n}}catch(i){ou(e,t,i)}}function Ws(e,t){var r=e.ref,o=e.refCleanup;if(null!==r)if("function"===typeof o)try{o()}catch(n){ou(e,t,n)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof r)try{r(null)}catch(i){ou(e,t,i)}else r.current=null}function Ks(e){var t=e.type,r=e.memoizedProps,o=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&o.focus();break e;case"img":r.src?o.src=r.src:r.srcSet&&(o.srcset=r.srcSet)}}catch(n){ou(e,e.return,n)}}function Js(e,t,r){try{var o=e.stateNode;!function(e,t,r,o){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var n=null,i=null,s=null,l=null,c=null,u=null,d=null;for(m in r){var h=r[m];if(r.hasOwnProperty(m)&&null!=h)switch(m){case"checked":case"value":break;case"defaultValue":c=h;default:o.hasOwnProperty(m)||ju(e,t,m,null,o,h)}}for(var f in o){var m=o[f];if(h=r[f],o.hasOwnProperty(f)&&(null!=m||null!=h))switch(f){case"type":i=m;break;case"name":n=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":s=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(a(137,t));break;default:m!==h&&ju(e,t,f,m,o,h)}}return void gt(e,s,l,c,u,d,i,n);case"select":for(i in m=s=l=f=null,r)if(c=r[i],r.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":m=c;default:o.hasOwnProperty(i)||ju(e,t,i,null,o,c)}for(n in o)if(i=o[n],c=r[n],o.hasOwnProperty(n)&&(null!=i||null!=c))switch(n){case"value":f=i;break;case"defaultValue":l=i;break;case"multiple":s=i;default:i!==c&&ju(e,t,n,i,o,c)}return t=l,r=s,o=m,void(null!=f?vt(e,!!r,f,!1):!!o!==!!r&&(null!=t?vt(e,!!r,t,!0):vt(e,!!r,r?[]:"",!1)));case"textarea":for(l in m=f=null,r)if(n=r[l],r.hasOwnProperty(l)&&null!=n&&!o.hasOwnProperty(l))switch(l){case"value":case"children":break;default:ju(e,t,l,null,o,n)}for(s in o)if(n=o[s],i=r[s],o.hasOwnProperty(s)&&(null!=n||null!=i))switch(s){case"value":f=n;break;case"defaultValue":m=n;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=n)throw Error(a(91));break;default:n!==i&&ju(e,t,s,n,o,i)}return void xt(e,f,m);case"option":for(var p in r)if(f=r[p],r.hasOwnProperty(p)&&null!=f&&!o.hasOwnProperty(p))if("selected"===p)e.selected=!1;else ju(e,t,p,null,o,f);for(c in o)if(f=o[c],m=r[c],o.hasOwnProperty(c)&&f!==m&&(null!=f||null!=m))if("selected"===c)e.selected=f&&"function"!==typeof f&&"symbol"!==typeof f;else ju(e,t,c,f,o,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in r)f=r[g],r.hasOwnProperty(g)&&null!=f&&!o.hasOwnProperty(g)&&ju(e,t,g,null,o,f);for(u in o)if(f=o[u],m=r[u],o.hasOwnProperty(u)&&f!==m&&(null!=f||null!=m))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t));break;default:ju(e,t,u,f,o,m)}return;default:if(Et(t)){for(var _ in r)f=r[_],r.hasOwnProperty(_)&&void 0!==f&&!o.hasOwnProperty(_)&&Wu(e,t,_,void 0,o,f);for(d in o)f=o[d],m=r[d],!o.hasOwnProperty(d)||f===m||void 0===f&&void 0===m||Wu(e,t,d,f,o,m);return}}for(var y in r)f=r[y],r.hasOwnProperty(y)&&null!=f&&!o.hasOwnProperty(y)&&ju(e,t,y,null,o,f);for(h in o)f=o[h],m=r[h],!o.hasOwnProperty(h)||f===m||null==f&&null==m||ju(e,t,h,f,o,m)}(o,e.type,r,t),o[ze]=t}catch(n){ou(e,e.return,n)}}function Zs(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function Ys(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Zs(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function qs(e,t,r){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=Gu));else if(4!==o&&27!==o&&null!==(e=e.child))for(qs(e,t,r),e=e.sibling;null!==e;)qs(e,t,r),e=e.sibling}function $s(e,t,r){var o=e.tag;if(5===o||6===o)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==o&&27!==o&&null!==(e=e.child))for($s(e,t,r),e=e.sibling;null!==e;)$s(e,t,r),e=e.sibling}var Xs=!1,Qs=!1,el=!1,tl="function"===typeof WeakSet?WeakSet:Set,rl=null,ol=!1;function nl(e,t,r){var o=r.flags;switch(r.tag){case 0:case 11:case 15:_l(e,r),4&o&&Us(5,r);break;case 1:if(_l(e,r),4&o)if(e=r.stateNode,null===t)try{e.componentDidMount()}catch(s){ou(r,r.return,s)}else{var n=Oa(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(n,t,e.__reactInternalSnapshotBeforeUpdate)}catch(l){ou(r,r.return,l)}}64&o&&Hs(r),512&o&&js(r,r.return);break;case 3:if(_l(e,r),64&o&&null!==(o=r.updateQueue)){if(e=null,null!==r.child)switch(r.child.tag){case 27:case 5:case 1:e=r.child.stateNode}try{zs(o,e)}catch(s){ou(r,r.return,s)}}break;case 26:_l(e,r),512&o&&js(r,r.return);break;case 27:case 5:_l(e,r),null===t&&4&o&&Ks(r),512&o&&js(r,r.return);break;case 12:default:_l(e,r);break;case 13:_l(e,r),4&o&&ul(e,r);break;case 22:if(!(n=null!==r.memoizedState||Xs)){t=null!==t&&null!==t.memoizedState||Qs;var i=Xs,a=Qs;Xs=n,(Qs=t)&&!a?vl(e,r,0!==(8772&r.subtreeFlags)):_l(e,r),Xs=i,Qs=a}512&o&&("manual"===r.memoizedProps.mode?js(r,r.return):Ws(r,r.return))}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ke(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var al=null,sl=!1;function ll(e,t,r){for(r=r.child;null!==r;)cl(e,t,r),r=r.sibling}function cl(e,t,r){if(ye&&"function"===typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(_e,r)}catch(a){}switch(r.tag){case 26:Qs||Ws(r,t),ll(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode).parentNode.removeChild(r);break;case 27:Qs||Ws(r,t);var o=al,n=sl;for(al=r.stateNode,ll(e,t,r),t=(r=r.stateNode).attributes;t.length;)r.removeAttributeNode(t[0]);Ke(r),al=o,sl=n;break;case 5:Qs||Ws(r,t);case 6:n=al;var i=sl;if(al=null,ll(e,t,r),sl=i,null!==(al=n))if(sl)try{e=al,o=r.stateNode,8===e.nodeType?e.parentNode.removeChild(o):e.removeChild(o)}catch(s){ou(r,t,s)}else try{al.removeChild(r.stateNode)}catch(s){ou(r,t,s)}break;case 18:null!==al&&(sl?(t=al,r=r.stateNode,8===t.nodeType?id(t.parentNode,r):1===t.nodeType&&id(t,r),ph(t)):id(al,r.stateNode));break;case 4:o=al,n=sl,al=r.stateNode.containerInfo,sl=!0,ll(e,t,r),al=o,sl=n;break;case 0:case 11:case 14:case 15:Qs||Vs(2,r,t),Qs||Vs(4,r,t),ll(e,t,r);break;case 1:Qs||(Ws(r,t),"function"===typeof(o=r.stateNode).componentWillUnmount&&Gs(r,t,o)),ll(e,t,r);break;case 21:ll(e,t,r);break;case 22:Qs||Ws(r,t),Qs=(o=Qs)||null!==r.memoizedState,ll(e,t,r),Qs=o;break;default:ll(e,t,r)}}function ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{ph(e)}catch(r){ou(t,t.return,r)}}function dl(e,t){var r=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new tl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new tl),t;default:throw Error(a(435,e.tag))}}(e);t.forEach((function(t){var o=lu.bind(null,e,t);r.has(t)||(r.add(t),t.then(o,o))}))}function hl(e,t){var r=t.deletions;if(null!==r)for(var o=0;o<r.length;o++){var n=r[o],i=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 27:case 5:al=l.stateNode,sl=!1;break e;case 3:case 4:al=l.stateNode.containerInfo,sl=!0;break e}l=l.return}if(null===al)throw Error(a(160));cl(i,s,n),al=null,sl=!1,null!==(i=n.alternate)&&(i.return=null),n.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}var fl=null;function ml(e,t){var r=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:hl(t,e),pl(e),4&o&&(Vs(3,e,e.return),Us(3,e),Vs(5,e,e.return));break;case 1:hl(t,e),pl(e),512&o&&(Qs||null===r||Ws(r,r.return)),64&o&&Xs&&(null!==(e=e.updateQueue)&&(null!==(o=e.callbacks)&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===r?o:r.concat(o))));break;case 26:var n=fl;if(hl(t,e),pl(e),512&o&&(Qs||null===r||Ws(r,r.return)),4&o){var i=null!==r?r.memoizedState:null;if(o=e.memoizedState,null===r)if(null===o)if(null===e.stateNode){e:{o=e.type,r=e.memoizedProps,n=n.ownerDocument||n;t:switch(o){case"title":(!(i=n.getElementsByTagName("title")[0])||i[We]||i[Fe]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=n.createElement(o),n.head.insertBefore(i,n.querySelector("head > title"))),Ku(i,o,r),i[Fe]=e,$e(i),o=i;break e;case"link":var s=Td("link","href",n).get(o+(r.href||""));if(s)for(var l=0;l<s.length;l++)if((i=s[l]).getAttribute("href")===(null==r.href?null:r.href)&&i.getAttribute("rel")===(null==r.rel?null:r.rel)&&i.getAttribute("title")===(null==r.title?null:r.title)&&i.getAttribute("crossorigin")===(null==r.crossOrigin?null:r.crossOrigin)){s.splice(l,1);break t}Ku(i=n.createElement(o),o,r),n.head.appendChild(i);break;case"meta":if(s=Td("meta","content",n).get(o+(r.content||"")))for(l=0;l<s.length;l++)if((i=s[l]).getAttribute("content")===(null==r.content?null:""+r.content)&&i.getAttribute("name")===(null==r.name?null:r.name)&&i.getAttribute("property")===(null==r.property?null:r.property)&&i.getAttribute("http-equiv")===(null==r.httpEquiv?null:r.httpEquiv)&&i.getAttribute("charset")===(null==r.charSet?null:r.charSet)){s.splice(l,1);break t}Ku(i=n.createElement(o),o,r),n.head.appendChild(i);break;default:throw Error(a(468,o))}i[Fe]=e,$e(i),o=i}e.stateNode=o}else Pd(n,e.type,e.stateNode);else e.stateNode=Ld(n,o,e.memoizedProps);else i!==o?(null===i?null!==r.stateNode&&(r=r.stateNode).parentNode.removeChild(r):i.count--,null===o?Pd(n,e.type,e.stateNode):Ld(n,o,e.memoizedProps)):null===o&&null!==e.stateNode&&Js(e,e.memoizedProps,r.memoizedProps)}break;case 27:if(4&o&&null===e.alternate){n=e.stateNode,i=e.memoizedProps;try{for(var c=n.firstChild;c;){var u=c.nextSibling,d=c.nodeName;c[We]||"HEAD"===d||"BODY"===d||"SCRIPT"===d||"STYLE"===d||"LINK"===d&&"stylesheet"===c.rel.toLowerCase()||n.removeChild(c),c=u}for(var h=e.type,f=n.attributes;f.length;)n.removeAttributeNode(f[0]);Ku(n,h,i),n[Fe]=e,n[ze]=i}catch(p){ou(e,e.return,p)}}case 5:if(hl(t,e),pl(e),512&o&&(Qs||null===r||Ws(r,r.return)),32&e.flags){n=e.stateNode;try{Lt(n,"")}catch(p){ou(e,e.return,p)}}4&o&&null!=e.stateNode&&Js(e,n=e.memoizedProps,null!==r?r.memoizedProps:n),1024&o&&(el=!0);break;case 6:if(hl(t,e),pl(e),4&o){if(null===e.stateNode)throw Error(a(162));o=e.memoizedProps,r=e.stateNode;try{r.nodeValue=o}catch(p){ou(e,e.return,p)}}break;case 3:if(Ed=null,n=fl,fl=hd(t.containerInfo),hl(t,e),fl=n,pl(e),4&o&&null!==r&&r.memoizedState.isDehydrated)try{ph(t.containerInfo)}catch(p){ou(e,e.return,p)}el&&(el=!1,gl(e));break;case 4:o=fl,fl=hd(e.stateNode.containerInfo),hl(t,e),pl(e),fl=o;break;case 12:hl(t,e),pl(e);break;case 13:hl(t,e),pl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==r&&null!==r.memoizedState)&&(vc=le()),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,dl(e,o)));break;case 22:if(512&o&&(Qs||null===r||Ws(r,r.return)),c=null!==e.memoizedState,u=null!==r&&null!==r.memoizedState,Xs=(d=Xs)||c,Qs=(h=Qs)||u,hl(t,e),Qs=h,Xs=d,pl(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&o&&(t._visibility=c?-2&t._visibility:1|t._visibility,c&&(t=Xs||Qs,null===r||u||t||yl(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))e:for(r=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===r){u=r=t;try{if(n=u.stateNode,c)"function"===typeof(i=n.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{s=u.stateNode;var m=void 0!==(l=u.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null;s.style.display=null==m||"boolean"===typeof m?"":(""+m).trim()}}catch(p){ou(u,u.return,p)}}}else if(6===t.tag){if(null===r){u=t;try{u.stateNode.nodeValue=c?"":u.memoizedProps}catch(p){ou(u,u.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}4&o&&(null!==(o=e.updateQueue)&&(null!==(r=o.retryQueue)&&(o.retryQueue=null,dl(e,r))));break;case 19:hl(t,e),pl(e),4&o&&(null!==(o=e.updateQueue)&&(e.updateQueue=null,dl(e,o)));break;case 21:break;default:hl(t,e),pl(e)}}function pl(e){var t=e.flags;if(2&t){try{if(27!==e.tag){e:{for(var r=e.return;null!==r;){if(Zs(r)){var o=r;break e}r=r.return}throw Error(a(160))}switch(o.tag){case 27:var n=o.stateNode;$s(e,Ys(e),n);break;case 5:var i=o.stateNode;32&o.flags&&(Lt(i,""),o.flags&=-33),$s(e,Ys(e),i);break;case 3:case 4:var s=o.stateNode.containerInfo;qs(e,Ys(e),s);break;default:throw Error(a(161))}}}catch(l){ou(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;gl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function _l(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)nl(e,t.alternate,t),t=t.sibling}function yl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Vs(4,t,t.return),yl(t);break;case 1:Ws(t,t.return);var r=t.stateNode;"function"===typeof r.componentWillUnmount&&Gs(t,t.return,r),yl(t);break;case 26:case 27:case 5:Ws(t,t.return),yl(t);break;case 22:Ws(t,t.return),null===t.memoizedState&&yl(t);break;default:yl(t)}e=e.sibling}}function vl(e,t,r){for(r=r&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var o=t.alternate,n=e,i=t,a=i.flags;switch(i.tag){case 0:case 11:case 15:vl(n,i,r),Us(4,i);break;case 1:if(vl(n,i,r),"function"===typeof(n=(o=i).stateNode).componentDidMount)try{n.componentDidMount()}catch(c){ou(o,o.return,c)}if(null!==(n=(o=i).updateQueue)){var s=o.stateNode;try{var l=n.shared.hiddenCallbacks;if(null!==l)for(n.shared.hiddenCallbacks=null,n=0;n<l.length;n++)Fs(l[n],s)}catch(c){ou(o,o.return,c)}}r&&64&a&&Hs(i),js(i,i.return);break;case 26:case 27:case 5:vl(n,i,r),r&&null===o&&4&a&&Ks(i),js(i,i.return);break;case 12:default:vl(n,i,r);break;case 13:vl(n,i,r),r&&4&a&&ul(n,i);break;case 22:null===i.memoizedState&&vl(n,i,r),js(i,i.return)}t=t.sibling}}function xl(e,t){var r=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==r&&(null!=e&&e.refCount++,null!=r&&Hn(r))}function bl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hn(e))}function Ll(e,t,r,o){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Al(e,t,r,o),t=t.sibling}function Al(e,t,r,o){var n=t.flags;switch(t.tag){case 0:case 11:case 15:Ll(e,t,r,o),2048&n&&Us(9,t);break;case 3:Ll(e,t,r,o),2048&n&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hn(e)));break;case 12:if(2048&n){Ll(e,t,r,o),e=t.stateNode;try{var i=t.memoizedProps,a=i.id,s=i.onPostCommit;"function"===typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){ou(t,t.return,l)}}else Ll(e,t,r,o);break;case 23:break;case 22:i=t.stateNode,null!==t.memoizedState?4&i._visibility?Ll(e,t,r,o):Sl(e,t):4&i._visibility?Ll(e,t,r,o):(i._visibility|=4,wl(e,t,r,o,0!==(10256&t.subtreeFlags))),2048&n&&xl(t.alternate,t);break;case 24:Ll(e,t,r,o),2048&n&&bl(t.alternate,t);break;default:Ll(e,t,r,o)}}function wl(e,t,r,o,n){for(n=n&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var i=e,a=t,s=r,l=o,c=a.flags;switch(a.tag){case 0:case 11:case 15:wl(i,a,s,l,n),Us(8,a);break;case 23:break;case 22:var u=a.stateNode;null!==a.memoizedState?4&u._visibility?wl(i,a,s,l,n):Sl(i,a):(u._visibility|=4,wl(i,a,s,l,n)),n&&2048&c&&xl(a.alternate,a);break;case 24:wl(i,a,s,l,n),n&&2048&c&&bl(a.alternate,a);break;default:wl(i,a,s,l,n)}t=t.sibling}}function Sl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var r=e,o=t,n=o.flags;switch(o.tag){case 22:Sl(r,o),2048&n&&xl(o.alternate,o);break;case 24:Sl(r,o),2048&n&&bl(o.alternate,o);break;default:Sl(r,o)}t=t.sibling}}var El=8192;function Tl(e){if(e.subtreeFlags&El)for(e=e.child;null!==e;)Pl(e),e=e.sibling}function Pl(e){switch(e.tag){case 26:Tl(e),e.flags&El&&null!==e.memoizedState&&function(e,t,r){if(null===Rd)throw Error(a(475));var o=Rd;if("stylesheet"===t.type&&("string"!==typeof r.media||!1!==matchMedia(r.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var n=_d(r.href),i=e.querySelector(yd(n));if(i)return null!==(e=i._p)&&"object"===typeof e&&"function"===typeof e.then&&(o.count++,o=Id.bind(o),e.then(o,o)),t.state.loading|=4,t.instance=i,void $e(i);i=e.ownerDocument||e,r=vd(r),(n=ud.get(n))&&wd(r,n),$e(i=i.createElement("link"));var s=i;s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),Ku(i,"link",r),t.instance=i}null===o.stylesheets&&(o.stylesheets=new Map),o.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(o.count++,t=Id.bind(o),e.addEventListener("load",t),e.addEventListener("error",t))}}(fl,e.memoizedState,e.memoizedProps);break;case 5:default:Tl(e);break;case 3:case 4:var t=fl;fl=hd(e.stateNode.containerInfo),Tl(e),fl=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=El,El=16777216,Tl(e),El=t):Tl(e))}}function Cl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Rl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var r=0;r<t.length;r++){var o=t[r];rl=o,Ol(o,e)}Cl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)Ml(e),e=e.sibling}function Ml(e){switch(e.tag){case 0:case 11:case 15:Rl(e),2048&e.flags&&Vs(9,e,e.return);break;case 3:case 12:default:Rl(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,Il(e)):Rl(e)}}function Il(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var r=0;r<t.length;r++){var o=t[r];rl=o,Ol(o,e)}Cl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Vs(8,t,t.return),Il(t);break;case 22:4&(r=t.stateNode)._visibility&&(r._visibility&=-5,Il(t));break;default:Il(t)}e=e.sibling}}function Ol(e,t){for(;null!==rl;){var r=rl;switch(r.tag){case 0:case 11:case 15:Vs(8,r,t);break;case 23:case 22:if(null!==r.memoizedState&&null!==r.memoizedState.cachePool){var o=r.memoizedState.cachePool.pool;null!=o&&o.refCount++}break;case 24:Hn(r.memoizedState.cache)}if(null!==(o=r.child))o.return=r,rl=o;else e:for(r=e;null!==rl;){var n=(o=rl).sibling,i=o.return;if(il(o),o===r){rl=null;break e}if(null!==n){n.return=i,rl=n;break e}rl=i}}}function Dl(e,t,r,o){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kl(e,t,r,o){return new Dl(e,t,r,o)}function Nl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bl(e,t){var r=e.alternate;return null===r?((r=kl(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=31457280&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Fl(e,t){e.flags&=31457282;var r=e.alternate;return null===r?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function zl(e,t,r,o,n,i){var s=0;if(o=e,"function"===typeof e)Nl(e)&&(s=1);else if("string"===typeof e)s=function(e,t,r){if(1===r||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,r,Y.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case d:return Ul(r.children,n,i,t);case h:s=8,n|=24;break;case f:return(e=kl(12,r,t,2|n)).elementType=f,e.lanes=i,e;case y:return(e=kl(13,r,t,n)).elementType=y,e.lanes=i,e;case v:return(e=kl(19,r,t,n)).elementType=v,e.lanes=i,e;case L:return Vl(r,n,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case m:case g:s=10;break e;case p:s=9;break e;case _:s=11;break e;case x:s=14;break e;case b:s=16,o=null;break e}s=29,r=Error(a(130,null===e?"null":typeof e,"")),o=null}return(t=kl(s,r,t,n)).elementType=e,t.type=o,t.lanes=i,t}function Ul(e,t,r,o){return(e=kl(7,e,o,t)).lanes=r,e}function Vl(e,t,r,o){(e=kl(22,e,o,t)).elementType=L,e.lanes=r;var n={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=n._current;if(null===e)throw Error(a(456));if(0===(2&n._pendingVisibility)){var t=Co(e,2);null!==t&&(n._pendingVisibility|=2,Ic(t,e,2))}},attach:function(){var e=n._current;if(null===e)throw Error(a(456));if(0!==(2&n._pendingVisibility)){var t=Co(e,2);null!==t&&(n._pendingVisibility&=-3,Ic(t,e,2))}}};return e.stateNode=n,e}function Hl(e,t,r){return(e=kl(6,e,null,t)).lanes=r,e}function Gl(e,t,r){return(t=kl(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jl(e){e.flags|=4}function Wl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!Cd(t)){if(null!==(t=Cn.current)&&((4194176&oc)===oc?null!==Rn:(62914560&oc)!==oc&&0===(536870912&oc)||t!==Rn))throw fn=cn,ln;e.flags|=8192}}function Kl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Re():536870912,e.lanes|=t,pc|=t)}function Jl(e,t){if(!qo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var o=null;null!==r;)null!==r.alternate&&(o=r),r=r.sibling;null===o?t||null===e.tail?e.tail=null:e.tail.sibling=null:o.sibling=null}}function Zl(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,o=0;if(t)for(var n=e.child;null!==n;)r|=n.lanes|n.childLanes,o|=31457280&n.subtreeFlags,o|=31457280&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)r|=n.lanes|n.childLanes,o|=n.subtreeFlags,o|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=o,e.childLanes=r,t}function Yl(e,t,r){var o=t.pendingProps;switch(Jo(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return Zl(t),null;case 3:return r=t.stateNode,o=null,null!==e&&(o=e.memoizedState.cache),t.memoizedState.cache!==o&&(t.flags|=2048),vs(Un),ee(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(on(t)?jl(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==$o&&(Dc($o),$o=null))),Zl(t),null;case 26:return r=t.memoizedState,null===e?(jl(t),null!==r?(Zl(t),Wl(t,r)):(Zl(t),t.flags&=-16777217)):r?r!==e.memoizedState?(jl(t),Zl(t),Wl(t,r)):(Zl(t),t.flags&=-16777217):(e.memoizedProps!==o&&jl(t),Zl(t),t.flags&=-16777217),null;case 27:re(t),r=$.current;var n=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==o&&jl(t);else{if(!o){if(null===t.stateNode)throw Error(a(166));return Zl(t),null}e=Y.current,on(t)?tn(t):(e=cd(n,o,r),t.stateNode=e,jl(t))}return Zl(t),null;case 5:if(re(t),r=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==o&&jl(t);else{if(!o){if(null===t.stateNode)throw Error(a(166));return Zl(t),null}if(e=Y.current,on(t))tn(t);else{switch(n=Yu($.current),e){case 1:e=n.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:e=n.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":e=n.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":e=n.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":(e=n.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof o.is?n.createElement("select",{is:o.is}):n.createElement("select"),o.multiple?e.multiple=!0:o.size&&(e.size=o.size);break;default:e="string"===typeof o.is?n.createElement(r,{is:o.is}):n.createElement(r)}}e[Fe]=t,e[ze]=o;e:for(n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&27!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break e;for(;null===n.sibling;){if(null===n.return||n.return===t)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}t.stateNode=e;e:switch(Ku(e,r,o),r){case"button":case"input":case"select":case"textarea":e=!!o.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&jl(t)}}return Zl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==o&&jl(t);else{if("string"!==typeof o&&null===t.stateNode)throw Error(a(166));if(e=$.current,on(t)){if(e=t.stateNode,r=t.memoizedProps,o=null,null!==(n=Zo))switch(n.tag){case 27:case 5:o=n.memoizedProps}e[Fe]=t,(e=!!(e.nodeValue===r||null!==o&&!0===o.suppressHydrationWarning||Hu(e.nodeValue,r)))||en(t)}else(e=Yu(e).createTextNode(o))[Fe]=t,t.stateNode=e}return Zl(t),null;case 13:if(o=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(n=on(t),null!==o&&null!==o.dehydrated){if(null===e){if(!n)throw Error(a(318));if(!(n=null!==(n=t.memoizedState)?n.dehydrated:null))throw Error(a(317));n[Fe]=t}else nn(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Zl(t),n=!1}else null!==$o&&(Dc($o),$o=null),n=!0;if(!n)return 256&t.flags?(Dn(t),t):(Dn(t),null)}if(Dn(t),0!==(128&t.flags))return t.lanes=r,t;if(r=null!==o,e=null!==e&&null!==e.memoizedState,r){n=null,null!==(o=t.child).alternate&&null!==o.alternate.memoizedState&&null!==o.alternate.memoizedState.cachePool&&(n=o.alternate.memoizedState.cachePool.pool);var i=null;null!==o.memoizedState&&null!==o.memoizedState.cachePool&&(i=o.memoizedState.cachePool.pool),i!==n&&(o.flags|=2048)}return r!==e&&r&&(t.child.flags|=8192),Kl(t,t.updateQueue),Zl(t),null;case 4:return ee(),null===e&&Iu(t.stateNode.containerInfo),Zl(t),null;case 10:return vs(t.type),Zl(t),null;case 19:if(J(kn),null===(n=t.memoizedState))return Zl(t),null;if(o=0!==(128&t.flags),null===(i=n.rendering))if(o)Jl(n,!1);else{if(0!==uc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=Nn(e))){for(t.flags|=128,Jl(n,!1),e=i.updateQueue,t.updateQueue=e,Kl(t,e),t.subtreeFlags=0,e=r,r=t.child;null!==r;)Fl(r,e),r=r.sibling;return Z(kn,1&kn.current|2),t.child}e=e.sibling}null!==n.tail&&le()>xc&&(t.flags|=128,o=!0,Jl(n,!1),t.lanes=4194304)}else{if(!o)if(null!==(e=Nn(i))){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,Kl(t,e),Jl(n,!0),null===n.tail&&"hidden"===n.tailMode&&!i.alternate&&!qo)return Zl(t),null}else 2*le()-n.renderingStartTime>xc&&536870912!==r&&(t.flags|=128,o=!0,Jl(n,!1),t.lanes=4194304);n.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=n.last)?e.sibling=i:t.child=i,n.last=i)}return null!==n.tail?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=le(),t.sibling=null,e=kn.current,Z(kn,o?1&e|2:1&e),t):(Zl(t),null);case 22:case 23:return Dn(t),Pn(),o=null!==t.memoizedState,null!==e?null!==e.memoizedState!==o&&(t.flags|=8192):o&&(t.flags|=8192),o?0!==(536870912&r)&&0===(128&t.flags)&&(Zl(t),6&t.subtreeFlags&&(t.flags|=8192)):Zl(t),null!==(r=t.updateQueue)&&Kl(t,r.retryQueue),r=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),o=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(o=t.memoizedState.cachePool.pool),o!==r&&(t.flags|=2048),null!==e&&J(Yn),null;case 24:return r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),vs(Un),Zl(t),null;case 25:return null}throw Error(a(156,t.tag))}function ql(e,t){switch(Jo(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return vs(Un),ee(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return re(t),null;case 13:if(Dn(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));nn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return J(kn),null;case 4:return ee(),null;case 10:return vs(t.type),null;case 22:case 23:return Dn(t),Pn(),null!==e&&J(Yn),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return vs(Un),null;default:return null}}function $l(e,t){switch(Jo(t),t.tag){case 3:vs(Un),ee();break;case 26:case 27:case 5:re(t);break;case 4:ee();break;case 13:Dn(t);break;case 19:J(kn);break;case 10:vs(t.type);break;case 22:case 23:Dn(t),Pn(),null!==e&&J(Yn);break;case 24:vs(Un)}}var Xl={getCacheForType:function(e){var t=Ss(Un),r=t.data.get(e);return void 0===r&&(r=e(),t.data.set(e,r)),r}},Ql="function"===typeof WeakMap?WeakMap:Map,ec=0,tc=null,rc=null,oc=0,nc=0,ic=null,ac=!1,sc=!1,lc=!1,cc=0,uc=0,dc=0,hc=0,fc=0,mc=0,pc=0,gc=null,_c=null,yc=!1,vc=0,xc=1/0,bc=null,Lc=null,Ac=!1,wc=null,Sc=0,Ec=0,Tc=null,Pc=0,Cc=null;function Rc(){if(0!==(2&ec)&&0!==oc)return oc&-oc;if(null!==R.T){return 0!==Wn?Wn:bu()}return Ne()}function Mc(){0===mc&&(mc=0===(536870912&oc)||qo?Ce():536870912);var e=Cn.current;return null!==e&&(e.flags|=32),mc}function Ic(e,t,r){(e===tc&&2===nc||null!==e.cancelPendingCommit)&&(Uc(e,0),Bc(e,oc,mc,!1)),Ie(e,r),0!==(2&ec)&&e===tc||(e===tc&&(0===(2&ec)&&(hc|=r),4===uc&&Bc(e,oc,mc,!1)),pu(e))}function Oc(e,t,r){if(0!==(6&ec))throw Error(a(327));for(var o=!r&&0===(60&t)&&0===(t&e.expiredLanes)||Te(e,t),n=o?function(e,t){var r=ec;ec|=2;var o=Hc(),n=Gc();tc!==e||oc!==t?(bc=null,xc=le()+500,Uc(e,t)):sc=Te(e,t);e:for(;;)try{if(0!==nc&&null!==rc){t=rc;var i=ic;t:switch(nc){case 1:nc=0,ic=null,qc(e,t,i,1);break;case 2:if(un(i)){nc=0,ic=null,Yc(t);break}t=function(){2===nc&&tc===e&&(nc=7),pu(e)},i.then(t,t);break e;case 3:nc=7;break e;case 4:nc=5;break e;case 7:un(i)?(nc=0,ic=null,Yc(t)):(nc=0,ic=null,qc(e,t,i,7));break;case 5:var s=null;switch(rc.tag){case 26:s=rc.memoizedState;case 5:case 27:var l=rc;if(!s||Cd(s)){nc=0,ic=null;var c=l.sibling;if(null!==c)rc=c;else{var u=l.return;null!==u?(rc=u,$c(u)):rc=null}break t}}nc=0,ic=null,qc(e,t,i,5);break;case 6:nc=0,ic=null,qc(e,t,i,6);break;case 8:zc(),uc=6;break e;default:throw Error(a(462))}}Jc();break}catch(d){Vc(e,d)}return _s=gs=null,R.H=o,R.A=n,ec=r,null!==rc?0:(tc=null,oc=0,Eo(),uc)}(e,t):Wc(e,t,!0),i=o;;){if(0===n){sc&&!o&&Bc(e,t,0,!1);break}if(6===n)Bc(e,t,0,!ac);else{if(r=e.current.alternate,i&&!Nc(r)){n=Wc(e,t,!1),i=!1;continue}if(2===n){if(i=t,e.errorRecoveryDisabledLanes&i)var s=0;else s=0!==(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0;if(0!==s){t=s;e:{var l=e;n=gc;var c=l.current.memoizedState.isDehydrated;if(c&&(Uc(l,s).flags|=256),2!==(s=Wc(l,s,!1))){if(lc&&!c){l.errorRecoveryDisabledLanes|=i,hc|=i,n=4;break e}i=_c,_c=n,null!==i&&Dc(i)}n=s}if(i=!1,2!==n)continue}}if(1===n){Uc(e,0),Bc(e,t,0,!0);break}e:{switch(o=e,n){case 0:case 1:throw Error(a(345));case 4:if((4194176&t)===t){Bc(o,t,mc,!ac);break e}break;case 2:_c=null;break;case 3:case 5:break;default:throw Error(a(329))}if(o.finishedWork=r,o.finishedLanes=t,(62914560&t)===t&&10<(i=vc+300-le())){if(Bc(o,t,mc,!ac),0!==Ee(o,0))break e;o.timeoutHandle=ed(kc.bind(null,o,r,_c,bc,yc,t,mc,hc,pc,ac,2,-0,0),i)}else kc(o,r,_c,bc,yc,t,mc,hc,pc,ac,0,-0,0)}}break}pu(e)}function Dc(e){null===_c?_c=e:_c.push.apply(_c,e)}function kc(e,t,r,o,n,i,s,l,c,u,d,h,f){var m=t.subtreeFlags;if((8192&m||16785408===(16785408&m))&&(Rd={stylesheets:null,count:0,unsuspend:Md},Pl(t),null!==(t=function(){if(null===Rd)throw Error(a(475));var e=Rd;return e.stylesheets&&0===e.count&&Dd(e,e.stylesheets),0<e.count?function(t){var r=setTimeout((function(){if(e.stylesheets&&Dd(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}}),6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(r)}}:null}())))return e.cancelPendingCommit=t(Qc.bind(null,e,r,o,n,s,l,c,1,h,f)),void Bc(e,i,s,!u);Qc(e,r,o,n,s,l,c,d,h,f)}function Nc(e){for(var t=e;;){var r=t.tag;if((0===r||11===r||15===r)&&16384&t.flags&&(null!==(r=t.updateQueue)&&null!==(r=r.stores)))for(var o=0;o<r.length;o++){var n=r[o],i=n.getSnapshot;n=n.value;try{if(!Jr(i(),n))return!1}catch(a){return!1}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bc(e,t,r,o){t&=~fc,t&=~hc,e.suspendedLanes|=t,e.pingedLanes&=~t,o&&(e.warmLanes|=t),o=e.expirationTimes;for(var n=t;0<n;){var i=31-xe(n),a=1<<i;o[i]=-1,n&=~a}0!==r&&Oe(e,r,t)}function Fc(){return 0!==(6&ec)||(gu(0,!1),!1)}function zc(){if(null!==rc){if(0===nc)var e=rc.return;else _s=gs=null,yi(e=rc),pn=null,gn=0,e=rc;for(;null!==e;)$l(e.alternate,e),e=e.return;rc=null}}function Uc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;-1!==r&&(e.timeoutHandle=-1,td(r)),null!==(r=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,r()),zc(),tc=e,rc=r=Bl(e.current,null),oc=t,nc=0,ic=null,ac=!1,sc=Te(e,t),lc=!1,pc=mc=fc=hc=dc=uc=0,_c=gc=null,yc=!1,0!==(8&t)&&(t|=32&t);var o=e.entangledLanes;if(0!==o)for(e=e.entanglements,o&=t;0<o;){var n=31-xe(o),i=1<<n;t|=e[n],o&=~i}return cc=t,Eo(),r}function Vc(e,t){ei=null,R.H=Sa,t===sn?(t=mn(),nc=3):t===ln?(t=mn(),nc=4):nc=t===Ga?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,ic=t,null===rc&&(uc=1,Fa(e,Do(t,e.current)))}function Hc(){var e=R.H;return R.H=Sa,null===e?Sa:e}function Gc(){var e=R.A;return R.A=Xl,e}function jc(){uc=4,ac||(4194176&oc)!==oc&&null!==Cn.current||(sc=!0),0===(134217727&dc)&&0===(134217727&hc)||null===tc||Bc(tc,oc,mc,!1)}function Wc(e,t,r){var o=ec;ec|=2;var n=Hc(),i=Gc();tc===e&&oc===t||(bc=null,Uc(e,t)),t=!1;var a=uc;e:for(;;)try{if(0!==nc&&null!==rc){var s=rc,l=ic;switch(nc){case 8:zc(),a=6;break e;case 3:case 2:case 6:null===Cn.current&&(t=!0);var c=nc;if(nc=0,ic=null,qc(e,s,l,c),r&&sc){a=0;break e}break;default:c=nc,nc=0,ic=null,qc(e,s,l,c)}}Kc(),a=uc;break}catch(u){Vc(e,u)}return t&&e.shellSuspendCounter++,_s=gs=null,ec=o,R.H=n,R.A=i,null===rc&&(tc=null,oc=0,Eo()),a}function Kc(){for(;null!==rc;)Zc(rc)}function Jc(){for(;null!==rc&&!ae();)Zc(rc)}function Zc(e){var t=ms(e.alternate,e,cc);e.memoizedProps=e.pendingProps,null===t?$c(e):rc=t}function Yc(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=Qa(r,t,t.pendingProps,t.type,void 0,oc);break;case 11:t=Qa(r,t,t.pendingProps,t.type.render,t.ref,oc);break;case 5:yi(t);default:$l(r,t),t=ms(r,t=rc=Fl(t,cc),cc)}e.memoizedProps=e.pendingProps,null===t?$c(e):rc=t}function qc(e,t,r,o){_s=gs=null,yi(t),pn=null,gn=0;var n=t.return;try{if(function(e,t,r,o,n){if(r.flags|=32768,null!==o&&"object"===typeof o&&"function"===typeof o.then){if(null!==(t=r.alternate)&&Ls(t,r,n,!0),null!==(r=Cn.current)){switch(r.tag){case 13:return null===Rn?jc():null===r.alternate&&0===uc&&(uc=3),r.flags&=-257,r.flags|=65536,r.lanes=n,o===cn?r.flags|=16384:(null===(t=r.updateQueue)?r.updateQueue=new Set([o]):t.add(o),nu(e,o,n)),!1;case 22:return r.flags|=65536,o===cn?r.flags|=16384:(null===(t=r.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([o])},r.updateQueue=t):null===(r=t.retryQueue)?t.retryQueue=new Set([o]):r.add(o),nu(e,o,n)),!1}throw Error(a(435,r.tag))}return nu(e,o,n),jc(),!1}if(qo)return null!==(t=Cn.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=n,o!==Qo&&an(Do(e=Error(a(422),{cause:o}),r))):(o!==Qo&&an(Do(t=Error(a(423),{cause:o}),r)),(e=e.current.alternate).flags|=65536,n&=-n,e.lanes|=n,o=Do(o,r),Ds(e,n=Ua(e.stateNode,o,n)),4!==uc&&(uc=2)),!1;var i=Error(a(520),{cause:o});if(i=Do(i,r),null===gc?gc=[i]:gc.push(i),4!==uc&&(uc=2),null===t)return!0;o=Do(o,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=n&-n,r.lanes|=e,Ds(r,e=Ua(r.stateNode,o,e)),!1;case 1:if(t=r.type,i=r.stateNode,0===(128&r.flags)&&("function"===typeof t.getDerivedStateFromError||null!==i&&"function"===typeof i.componentDidCatch&&(null===Lc||!Lc.has(i))))return r.flags|=65536,n&=-n,r.lanes|=n,Ha(n=Va(n),e,r,o),Ds(r,n),!1}r=r.return}while(null!==r);return!1}(e,n,t,r,oc))return uc=1,Fa(e,Do(r,e.current)),void(rc=null)}catch(i){if(null!==n)throw rc=n,i;return uc=1,Fa(e,Do(r,e.current)),void(rc=null)}32768&t.flags?(qo||1===o?e=!0:sc||0!==(536870912&oc)?e=!1:(ac=e=!0,(2===o||3===o||6===o)&&(null!==(o=Cn.current)&&13===o.tag&&(o.flags|=16384))),Xc(t,e)):$c(t)}function $c(e){var t=e;do{if(0!==(32768&t.flags))return void Xc(t,ac);e=t.return;var r=Yl(t.alternate,t,cc);if(null!==r)return void(rc=r);if(null!==(t=t.sibling))return void(rc=t);rc=t=e}while(null!==t);0===uc&&(uc=5)}function Xc(e,t){do{var r=ql(e.alternate,e);if(null!==r)return r.flags&=32767,void(rc=r);if(null!==(r=e.return)&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&null!==(e=e.sibling))return void(rc=e);rc=e=r}while(null!==e);uc=6,rc=null}function Qc(e,t,r,o,n,i,s,l,c,u){var d=R.T,h=H.p;try{H.p=2,R.T=null,function(e,t,r,o,n,i,s,l){do{tu()}while(null!==wc);if(0!==(6&ec))throw Error(a(327));var c=e.finishedWork;if(o=e.finishedLanes,null===c)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var u=c.lanes|c.childLanes;if(function(e,t,r,o,n,i){var a=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(r=a&~r;0<r;){var u=31-xe(r),d=1<<u;s[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var f=h[u];null!==f&&(f.lane&=-536870913)}r&=~d}0!==o&&Oe(e,o,0),0!==i&&0===n&&0!==e.tag&&(e.suspendedLanes|=i&~(a&~t))}(e,o,u|=So,i,s,l),e===tc&&(rc=tc=null,oc=0),0===(10256&c.subtreeFlags)&&0===(10256&c.flags)||Ac||(Ac=!0,Ec=u,Tc=r,function(e,t){ne(e,t)}(he,(function(){return tu(),null}))),r=0!==(15990&c.flags),0!==(15990&c.subtreeFlags)||r?(r=R.T,R.T=null,i=H.p,H.p=2,s=ec,ec|=4,function(e,t){if(e=e.containerInfo,Ju=jd,Qr(e=Xr(e))){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var o=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(o&&0!==o.rangeCount){r=o.anchorNode;var n=o.anchorOffset,i=o.focusNode;o=o.focusOffset;try{r.nodeType,i.nodeType}catch(g){r=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var m;h!==r||0!==n&&3!==h.nodeType||(l=s+n),h!==i||0!==o&&3!==h.nodeType||(c=s+o),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)f=h,h=m;for(;;){if(h===e)break t;if(f===r&&++u===n&&(l=s),f===i&&++d===o&&(c=s),null!==(m=h.nextSibling))break;f=(h=f).parentNode}h=m}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Zu={focusedElem:e,selectionRange:r},jd=!1,rl=t;null!==rl;)if(e=(t=rl).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,rl=e;else for(;null!==rl;){switch(i=(t=rl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==i){e=void 0,r=t,n=i.memoizedProps,i=i.memoizedState,o=r.stateNode;try{var p=Oa(r.type,n,(r.elementType,r.type));e=o.getSnapshotBeforeUpdate(p,i),o.__reactInternalSnapshotBeforeUpdate=e}catch(_){ou(r,r.return,_)}}break;case 3:if(0!==(1024&e))if(9===(r=(e=t.stateNode.containerInfo).nodeType))ad(e);else if(1===r)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ad(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,rl=e;break}rl=t.return}p=ol,ol=!1}(e,c),ml(c,e),eo(Zu,e.containerInfo),jd=!!Ju,Zu=Ju=null,e.current=c,nl(e,c.alternate,c),se(),ec=s,H.p=i,R.T=r):e.current=c,Ac?(Ac=!1,wc=e,Sc=o):eu(e,u),u=e.pendingLanes,0===u&&(Lc=null),function(e){if(ye&&"function"===typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(_e,e,void 0,128===(128&e.current.flags))}catch(t){}}(c.stateNode),pu(e),null!==t)for(n=e.onRecoverableError,c=0;c<t.length;c++)u=t[c],n(u.value,{componentStack:u.stack});0!==(3&Sc)&&tu(),u=e.pendingLanes,0!==(4194218&o)&&0!==(42&u)?e===Cc?Pc++:(Pc=0,Cc=e):Pc=0,gu(0,!1)}(e,t,r,o,h,n,i,s)}finally{R.T=d,H.p=h}}function eu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Hn(t)))}function tu(){if(null!==wc){var e=wc,t=Ec;Ec=0;var r=ke(Sc),o=R.T,n=H.p;try{if(H.p=32>r?32:r,R.T=null,null===wc)var i=!1;else{r=Tc,Tc=null;var s=wc,l=Sc;if(wc=null,Sc=0,0!==(6&ec))throw Error(a(331));var c=ec;if(ec|=4,Ml(s.current),Al(s,s.current,l,r),ec=c,gu(0,!1),ye&&"function"===typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(_e,s)}catch(u){}i=!0}return i}finally{H.p=n,R.T=o,eu(e,t)}}return!1}function ru(e,t,r){t=Do(r,t),null!==(e=Is(e,t=Ua(e.stateNode,t,2),2))&&(Ie(e,2),pu(e))}function ou(e,t,r){if(3===e.tag)ru(e,e,r);else for(;null!==t;){if(3===t.tag){ru(t,e,r);break}if(1===t.tag){var o=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof o.componentDidCatch&&(null===Lc||!Lc.has(o))){e=Do(r,e),null!==(o=Is(t,r=Va(2),2))&&(Ha(r,o,t,e),Ie(o,2),pu(o));break}}t=t.return}}function nu(e,t,r){var o=e.pingCache;if(null===o){o=e.pingCache=new Ql;var n=new Set;o.set(t,n)}else void 0===(n=o.get(t))&&(n=new Set,o.set(t,n));n.has(r)||(lc=!0,n.add(r),e=iu.bind(null,e,t,r),t.then(e,e))}function iu(e,t,r){var o=e.pingCache;null!==o&&o.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,tc===e&&(oc&r)===r&&(4===uc||3===uc&&(62914560&oc)===oc&&300>le()-vc?0===(2&ec)&&Uc(e,0):fc|=r,pc===oc&&(pc=0)),pu(e)}function au(e,t){0===t&&(t=Re()),null!==(e=Co(e,t))&&(Ie(e,t),pu(e))}function su(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),au(e,r)}function lu(e,t){var r=0;switch(e.tag){case 13:var o=e.stateNode,n=e.memoizedState;null!==n&&(r=n.retryLane);break;case 19:o=e.stateNode;break;case 22:o=e.stateNode._retryCache;break;default:throw Error(a(314))}null!==o&&o.delete(t),au(e,r)}var cu=null,uu=null,du=!1,hu=!1,fu=!1,mu=0;function pu(e){var t;e!==uu&&null===e.next&&(null===uu?cu=uu=e:uu=uu.next=e),hu=!0,du||(du=!0,t=_u,od((function(){0!==(6&ec)?ne(ue,t):t()})))}function gu(e,t){if(!fu&&hu){fu=!0;do{for(var r=!1,o=cu;null!==o;){if(!t)if(0!==e){var n=o.pendingLanes;if(0===n)var i=0;else{var a=o.suspendedLanes,s=o.pingedLanes;i=(1<<31-xe(42|e)+1)-1,i=201326677&(i&=n&~(a&~s))?201326677&i|1:i?2|i:0}0!==i&&(r=!0,xu(o,i))}else i=oc,0===(3&(i=Ee(o,o===tc?i:0)))||Te(o,i)||(r=!0,xu(o,i));o=o.next}}while(r);fu=!1}}function _u(){hu=du=!1;var e=0;0!==mu&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==Qu&&(Qu=e,!0);return Qu=null,!1}()&&(e=mu),mu=0);for(var t=le(),r=null,o=cu;null!==o;){var n=o.next,i=yu(o,t);0===i?(o.next=null,null===r?cu=n:r.next=n,null===n&&(uu=r)):(r=o,(0!==e||0!==(3&i))&&(hu=!0)),o=n}gu(e,!1)}function yu(e,t){for(var r=e.suspendedLanes,o=e.pingedLanes,n=e.expirationTimes,i=-62914561&e.pendingLanes;0<i;){var a=31-xe(i),s=1<<a,l=n[a];-1===l?0!==(s&r)&&0===(s&o)||(n[a]=Pe(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}if(r=oc,r=Ee(e,e===(t=tc)?r:0),o=e.callbackNode,0===r||e===t&&2===nc||null!==e.cancelPendingCommit)return null!==o&&null!==o&&ie(o),e.callbackNode=null,e.callbackPriority=0;if(0===(3&r)||Te(e,r)){if((t=r&-r)===e.callbackPriority)return t;switch(null!==o&&ie(o),ke(r)){case 2:case 8:r=de;break;case 32:default:r=he;break;case 268435456:r=me}return o=vu.bind(null,e),r=ne(r,o),e.callbackPriority=t,e.callbackNode=r,t}return null!==o&&null!==o&&ie(o),e.callbackPriority=2,e.callbackNode=null,2}function vu(e,t){var r=e.callbackNode;if(tu()&&e.callbackNode!==r)return null;var o=oc;return 0===(o=Ee(e,e===tc?o:0))?null:(Oc(e,o,t),yu(e,le()),null!=e.callbackNode&&e.callbackNode===r?vu.bind(null,e):null)}function xu(e,t){if(tu())return null;Oc(e,t,!0)}function bu(){return 0===mu&&(mu=Ce()),mu}function Lu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:Ct(""+e)}function Au(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}for(var wu=0;wu<bo.length;wu++){var Su=bo[wu];Lo(Su.toLowerCase(),"on"+(Su[0].toUpperCase()+Su.slice(1)))}Lo(fo,"onAnimationEnd"),Lo(mo,"onAnimationIteration"),Lo(po,"onAnimationStart"),Lo("dblclick","onDoubleClick"),Lo("focusin","onFocus"),Lo("focusout","onBlur"),Lo(go,"onTransitionRun"),Lo(_o,"onTransitionStart"),Lo(yo,"onTransitionCancel"),Lo(vo,"onTransitionEnd"),tt("onMouseEnter",["mouseout","mouseover"]),tt("onMouseLeave",["mouseout","mouseover"]),tt("onPointerEnter",["pointerout","pointerover"]),tt("onPointerLeave",["pointerout","pointerover"]),et("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),et("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),et("onBeforeInput",["compositionend","keypress","textInput","paste"]),et("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),et("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Tu=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Eu));function Pu(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var o=e[r],n=o.event;o=o.listeners;e:{var i=void 0;if(t)for(var a=o.length-1;0<=a;a--){var s=o[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==i&&n.isPropagationStopped())break e;i=s,n.currentTarget=c;try{i(n)}catch(u){Da(u)}n.currentTarget=null,i=l}else for(a=0;a<o.length;a++){if(l=(s=o[a]).instance,c=s.currentTarget,s=s.listener,l!==i&&n.isPropagationStopped())break e;i=s,n.currentTarget=c;try{i(n)}catch(u){Da(u)}n.currentTarget=null,i=l}}}}function Cu(e,t){var r=t[Ve];void 0===r&&(r=t[Ve]=new Set);var o=e+"__bubble";r.has(o)||(Ou(t,e,2,!1),r.add(o))}function Ru(e,t,r){var o=0;t&&(o|=4),Ou(r,e,o,t)}var Mu="_reactListening"+Math.random().toString(36).slice(2);function Iu(e){if(!e[Mu]){e[Mu]=!0,Xe.forEach((function(t){"selectionchange"!==t&&(Tu.has(t)||Ru(t,!1,e),Ru(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Mu]||(t[Mu]=!0,Ru("selectionchange",!1,t))}}function Ou(e,t,r,o){switch($d(t)){case 2:var n=Wd;break;case 8:n=Kd;break;default:n=Jd}r=n.bind(null,t,r,e),n=void 0,!Ft||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),o?void 0!==n?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):void 0!==n?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function Du(e,t,r,o,n){var i=o;if(0===(1&t)&&0===(2&t)&&null!==o)e:for(;;){if(null===o)return;var a=o.tag;if(3===a||4===a){var s=o.stateNode.containerInfo;if(s===n||8===s.nodeType&&s.parentNode===n)break;if(4===a)for(a=o.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;a=a.return}for(;null!==s;){if(null===(a=Je(s)))return;if(5===(l=a.tag)||6===l||26===l||27===l){o=i=a;continue e}s=s.parentNode}}o=o.return}Nt((function(){var o=i,n=Mt(r),a=[];e:{var s=xo.get(e);if(void 0!==s){var l=Xt,c=e;switch(e){case"keypress":if(0===jt(r))break e;case"keydown":case"keyup":l=fr;break;case"focusin":c="focus",l=nr;break;case"focusout":c="blur",l=nr;break;case"beforeblur":case"afterblur":l=nr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=rr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=or;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=pr;break;case fo:case mo:case po:l=ir;break;case vo:l=gr;break;case"scroll":case"scrollend":l=er;break;case"wheel":l=_r;break;case"copy":case"cut":case"paste":l=ar;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=mr;break;case"toggle":case"beforetoggle":l=yr}var u=0!==(4&t),d=!u&&("scroll"===e||"scrollend"===e),h=u?null!==s?s+"Capture":null:s;u=[];for(var f,m=o;null!==m;){var p=m;if(f=p.stateNode,5!==(p=p.tag)&&26!==p&&27!==p||null===f||null===h||null!=(p=Bt(m,h))&&u.push(ku(m,p,f)),d)break;m=m.return}0<u.length&&(s=new l(s,c,null,r,n),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||r===Rt||!(c=r.relatedTarget||r.fromElement)||!Je(c)&&!c[Ue])&&(l||s)&&(s=n.window===n?n:(s=n.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=o,null!==(c=(c=r.relatedTarget||r.toElement)?Je(c):null)&&(d=B(c),u=c.tag,c!==d||5!==u&&27!==u&&6!==u)&&(c=null)):(l=null,c=o),l!==c)){if(u=rr,p="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(u=mr,p="onPointerLeave",h="onPointerEnter",m="pointer"),d=null==l?s:Ye(l),f=null==c?s:Ye(c),(s=new u(p,m+"leave",l,r,n)).target=d,s.relatedTarget=f,p=null,Je(n)===o&&((u=new u(h,m+"enter",c,r,n)).target=f,u.relatedTarget=d,p=u),d=p,l&&c)e:{for(h=c,m=0,f=u=l;f;f=Bu(f))m++;for(f=0,p=h;p;p=Bu(p))f++;for(;0<m-f;)u=Bu(u),m--;for(;0<f-m;)h=Bu(h),f--;for(;m--;){if(u===h||null!==h&&u===h.alternate)break e;u=Bu(u),h=Bu(h)}u=null}else u=null;null!==l&&Fu(a,s,l,u,!1),null!==c&&null!==d&&Fu(a,d,c,u,!0)}if("select"===(l=(s=o?Ye(o):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Nr;else if(Rr(s))if(Br)g=Kr;else{g=jr;var _=Gr}else!(l=s.nodeName)||"input"!==l.toLowerCase()||"checkbox"!==s.type&&"radio"!==s.type?o&&Et(o.elementType)&&(g=Nr):g=Wr;switch(g&&(g=g(e,o))?Mr(a,g,r,n):(_&&_(e,s,o),"focusout"===e&&o&&"number"===s.type&&null!=o.memoizedProps.value&&yt(s,"number",s.value)),_=o?Ye(o):window,e){case"focusin":(Rr(_)||"true"===_.contentEditable)&&(ro=_,oo=o,no=null);break;case"focusout":no=oo=ro=null;break;case"mousedown":io=!0;break;case"contextmenu":case"mouseup":case"dragend":io=!1,ao(a,r,n);break;case"selectionchange":if(to)break;case"keydown":case"keyup":ao(a,r,n)}var y;if(xr)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Pr?Er(e,r)&&(v="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(v="onCompositionStart");v&&(Ar&&"ko"!==r.locale&&(Pr||"onCompositionStart"!==v?"onCompositionEnd"===v&&Pr&&(y=Gt()):(Vt="value"in(Ut=n)?Ut.value:Ut.textContent,Pr=!0)),0<(_=Nu(o,v)).length&&(v=new sr(v,e,null,r,n),a.push({event:v,listeners:_}),y?v.data=y:null!==(y=Tr(r))&&(v.data=y))),(y=Lr?function(e,t){switch(e){case"compositionend":return Tr(t);case"keypress":return 32!==t.which?null:(Sr=!0,wr);case"textInput":return(e=t.data)===wr&&Sr?null:e;default:return null}}(e,r):function(e,t){if(Pr)return"compositionend"===e||!xr&&Er(e,t)?(e=Gt(),Ht=Vt=Ut=null,Pr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ar&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(v=Nu(o,"onBeforeInput")).length&&(_=new sr("onBeforeInput","beforeinput",null,r,n),a.push({event:_,listeners:v}),_.data=y)),function(e,t,r,o,n){if("submit"===t&&r&&r.stateNode===n){var i=Lu((n[ze]||null).action),a=o.submitter;a&&null!==(t=(t=a[ze]||null)?Lu(t.formAction):a.getAttribute("formAction"))&&(i=t,a=null);var s=new Xt("action","action",null,o,n);e.push({event:s,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(0!==mu){var e=a?Au(n,a):new FormData(n);da(r,{pending:!0,data:e,method:n.method,action:i},null,e)}}else"function"===typeof i&&(s.preventDefault(),e=a?Au(n,a):new FormData(n),da(r,{pending:!0,data:e,method:n.method,action:i},i,e))},currentTarget:n}]})}}(a,e,o,r,n)}Pu(a,t)}))}function ku(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Nu(e,t){for(var r=t+"Capture",o=[];null!==e;){var n=e,i=n.stateNode;5!==(n=n.tag)&&26!==n&&27!==n||null===i||(null!=(n=Bt(e,r))&&o.unshift(ku(e,n,i)),null!=(n=Bt(e,t))&&o.push(ku(e,n,i))),e=e.return}return o}function Bu(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Fu(e,t,r,o,n){for(var i=t._reactName,a=[];null!==r&&r!==o;){var s=r,l=s.alternate,c=s.stateNode;if(s=s.tag,null!==l&&l===o)break;5!==s&&26!==s&&27!==s||null===c||(l=c,n?null!=(c=Bt(r,i))&&a.unshift(ku(r,c,l)):n||null!=(c=Bt(r,i))&&a.push(ku(r,c,l))),r=r.return}0!==a.length&&e.push({event:t,listeners:a})}var zu=/\r\n?/g,Uu=/\u0000|\uFFFD/g;function Vu(e){return("string"===typeof e?e:""+e).replace(zu,"\n").replace(Uu,"")}function Hu(e,t){return t=Vu(t),Vu(e)===t}function Gu(){}function ju(e,t,r,o,n,i){switch(r){case"children":"string"===typeof o?"body"===t||"textarea"===t&&""===o||Lt(e,o):("number"===typeof o||"bigint"===typeof o)&&"body"!==t&&Lt(e,""+o);break;case"className":st(e,"class",o);break;case"tabIndex":st(e,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":st(e,r,o);break;case"style":St(e,o,i);break;case"data":if("object"!==t){st(e,"data",o);break}case"src":case"href":if(""===o&&("a"!==t||"href"!==r)){e.removeAttribute(r);break}if(null==o||"function"===typeof o||"symbol"===typeof o||"boolean"===typeof o){e.removeAttribute(r);break}o=Ct(""+o),e.setAttribute(r,o);break;case"action":case"formAction":if("function"===typeof o){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof i&&("formAction"===r?("input"!==t&&ju(e,t,"name",n.name,n,null),ju(e,t,"formEncType",n.formEncType,n,null),ju(e,t,"formMethod",n.formMethod,n,null),ju(e,t,"formTarget",n.formTarget,n,null)):(ju(e,t,"encType",n.encType,n,null),ju(e,t,"method",n.method,n,null),ju(e,t,"target",n.target,n,null))),null==o||"symbol"===typeof o||"boolean"===typeof o){e.removeAttribute(r);break}o=Ct(""+o),e.setAttribute(r,o);break;case"onClick":null!=o&&(e.onclick=Gu);break;case"onScroll":null!=o&&Cu("scroll",e);break;case"onScrollEnd":null!=o&&Cu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!==typeof o||!("__html"in o))throw Error(a(61));if(null!=(r=o.__html)){if(null!=n.children)throw Error(a(60));e.innerHTML=r}}break;case"multiple":e.multiple=o&&"function"!==typeof o&&"symbol"!==typeof o;break;case"muted":e.muted=o&&"function"!==typeof o&&"symbol"!==typeof o;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==o||"function"===typeof o||"boolean"===typeof o||"symbol"===typeof o){e.removeAttribute("xlink:href");break}r=Ct(""+o),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(r,""+o):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":!0===o?e.setAttribute(r,""):!1!==o&&null!=o&&"function"!==typeof o&&"symbol"!==typeof o?e.setAttribute(r,o):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&!isNaN(o)&&1<=o?e.setAttribute(r,o):e.removeAttribute(r);break;case"rowSpan":case"start":null==o||"function"===typeof o||"symbol"===typeof o||isNaN(o)?e.removeAttribute(r):e.setAttribute(r,o);break;case"popover":Cu("beforetoggle",e),Cu("toggle",e),at(e,"popover",o);break;case"xlinkActuate":lt(e,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":lt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":lt(e,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":lt(e,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":lt(e,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":lt(e,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":lt(e,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":lt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":lt(e,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":at(e,"is",o);break;case"innerText":case"textContent":break;default:(!(2<r.length)||"o"!==r[0]&&"O"!==r[0]||"n"!==r[1]&&"N"!==r[1])&&at(e,r=Tt.get(r)||r,o)}}function Wu(e,t,r,o,n,i){switch(r){case"style":St(e,o,i);break;case"dangerouslySetInnerHTML":if(null!=o){if("object"!==typeof o||!("__html"in o))throw Error(a(61));if(null!=(r=o.__html)){if(null!=n.children)throw Error(a(60));e.innerHTML=r}}break;case"children":"string"===typeof o?Lt(e,o):("number"===typeof o||"bigint"===typeof o)&&Lt(e,""+o);break;case"onScroll":null!=o&&Cu("scroll",e);break;case"onScrollEnd":null!=o&&Cu("scrollend",e);break;case"onClick":null!=o&&(e.onclick=Gu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Qe.hasOwnProperty(r)||("o"!==r[0]||"n"!==r[1]||(n=r.endsWith("Capture"),t=r.slice(2,n?r.length-7:void 0),"function"===typeof(i=null!=(i=e[ze]||null)?i[r]:null)&&e.removeEventListener(t,i,n),"function"!==typeof o)?r in e?e[r]=o:!0===o?e.setAttribute(r,""):at(e,r,o):("function"!==typeof i&&null!==i&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,o,n)))}}function Ku(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Cu("error",e),Cu("load",e);var o,n=!1,i=!1;for(o in r)if(r.hasOwnProperty(o)){var s=r[o];if(null!=s)switch(o){case"src":n=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:ju(e,t,o,s,r,null)}}return i&&ju(e,t,"srcSet",r.srcSet,r,null),void(n&&ju(e,t,"src",r.src,r,null));case"input":Cu("invalid",e);var l=o=s=i=null,c=null,u=null;for(n in r)if(r.hasOwnProperty(n)){var d=r[n];if(null!=d)switch(n){case"name":i=d;break;case"type":s=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":o=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(a(137,t));break;default:ju(e,t,n,d,r,null)}}return _t(e,o,l,c,u,s,i,!1),void dt(e);case"select":for(i in Cu("invalid",e),n=s=o=null,r)if(r.hasOwnProperty(i)&&null!=(l=r[i]))switch(i){case"value":o=l;break;case"defaultValue":s=l;break;case"multiple":n=l;default:ju(e,t,i,l,r,null)}return t=o,r=s,e.multiple=!!n,void(null!=t?vt(e,!!n,t,!1):null!=r&&vt(e,!!n,r,!0));case"textarea":for(s in Cu("invalid",e),o=i=n=null,r)if(r.hasOwnProperty(s)&&null!=(l=r[s]))switch(s){case"value":n=l;break;case"defaultValue":i=l;break;case"children":o=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91));break;default:ju(e,t,s,l,r,null)}return bt(e,n,i,o),void dt(e);case"option":for(c in r)if(r.hasOwnProperty(c)&&null!=(n=r[c]))if("selected"===c)e.selected=n&&"function"!==typeof n&&"symbol"!==typeof n;else ju(e,t,c,n,r,null);return;case"dialog":Cu("cancel",e),Cu("close",e);break;case"iframe":case"object":Cu("load",e);break;case"video":case"audio":for(n=0;n<Eu.length;n++)Cu(Eu[n],e);break;case"image":Cu("error",e),Cu("load",e);break;case"details":Cu("toggle",e);break;case"embed":case"source":case"link":Cu("error",e),Cu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in r)if(r.hasOwnProperty(u)&&null!=(n=r[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t));default:ju(e,t,u,n,r,null)}return;default:if(Et(t)){for(d in r)r.hasOwnProperty(d)&&(void 0!==(n=r[d])&&Wu(e,t,d,n,r,void 0));return}}for(l in r)r.hasOwnProperty(l)&&(null!=(n=r[l])&&ju(e,t,l,n,r,null))}var Ju=null,Zu=null;function Yu(e){return 9===e.nodeType?e:e.ownerDocument}function qu(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $u(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function Xu(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Qu=null;var ed="function"===typeof setTimeout?setTimeout:void 0,td="function"===typeof clearTimeout?clearTimeout:void 0,rd="function"===typeof Promise?Promise:void 0,od="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rd?function(e){return rd.resolve(null).then(e).catch(nd)}:ed;function nd(e){setTimeout((function(){throw e}))}function id(e,t){var r=t,o=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&8===n.nodeType)if("/$"===(r=n.data)){if(0===o)return e.removeChild(n),void ph(t);o--}else"$"!==r&&"$?"!==r&&"$!"!==r||o++;r=n}while(r);ph(t)}function ad(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":ad(r),Ke(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===r.rel.toLowerCase())continue}e.removeChild(r)}}function sd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function ld(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}function cd(e,t,r){switch(t=Yu(r),e){case"html":if(!(e=t.documentElement))throw Error(a(452));return e;case"head":if(!(e=t.head))throw Error(a(453));return e;case"body":if(!(e=t.body))throw Error(a(454));return e;default:throw Error(a(451))}}var ud=new Map,dd=new Set;function hd(e){return"function"===typeof e.getRootNode?e.getRootNode():e.ownerDocument}var fd=H.d;H.d={f:function(){var e=fd.f(),t=Fc();return e||t},r:function(e){var t=Ze(e);null!==t&&5===t.tag&&"form"===t.type?fa(t):fd.r(e)},D:function(e){fd.D(e),pd("dns-prefetch",e,null)},C:function(e,t){fd.C(e,t),pd("preconnect",e,t)},L:function(e,t,r){fd.L(e,t,r);var o=md;if(o&&e&&t){var n='link[rel="preload"][as="'+pt(t)+'"]';"image"===t&&r&&r.imageSrcSet?(n+='[imagesrcset="'+pt(r.imageSrcSet)+'"]',"string"===typeof r.imageSizes&&(n+='[imagesizes="'+pt(r.imageSizes)+'"]')):n+='[href="'+pt(e)+'"]';var i=n;switch(t){case"style":i=_d(e);break;case"script":i=xd(e)}ud.has(i)||(e=M({rel:"preload",href:"image"===t&&r&&r.imageSrcSet?void 0:e,as:t},r),ud.set(i,e),null!==o.querySelector(n)||"style"===t&&o.querySelector(yd(i))||"script"===t&&o.querySelector(bd(i))||(Ku(t=o.createElement("link"),"link",e),$e(t),o.head.appendChild(t)))}},m:function(e,t){fd.m(e,t);var r=md;if(r&&e){var o=t&&"string"===typeof t.as?t.as:"script",n='link[rel="modulepreload"][as="'+pt(o)+'"][href="'+pt(e)+'"]',i=n;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=xd(e)}if(!ud.has(i)&&(e=M({rel:"modulepreload",href:e},t),ud.set(i,e),null===r.querySelector(n))){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(bd(i)))return}Ku(o=r.createElement("link"),"link",e),$e(o),r.head.appendChild(o)}}},X:function(e,t){fd.X(e,t);var r=md;if(r&&e){var o=qe(r).hoistableScripts,n=xd(e),i=o.get(n);i||((i=r.querySelector(bd(n)))||(e=M({src:e,async:!0},t),(t=ud.get(n))&&Sd(e,t),$e(i=r.createElement("script")),Ku(i,"link",e),r.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(n,i))}},S:function(e,t,r){fd.S(e,t,r);var o=md;if(o&&e){var n=qe(o).hoistableStyles,i=_d(e);t=t||"default";var a=n.get(i);if(!a){var s={loading:0,preload:null};if(a=o.querySelector(yd(i)))s.loading=5;else{e=M({rel:"stylesheet",href:e,"data-precedence":t},r),(r=ud.get(i))&&wd(e,r);var l=a=o.createElement("link");$e(l),Ku(l,"link",e),l._p=new Promise((function(e,t){l.onload=e,l.onerror=t})),l.addEventListener("load",(function(){s.loading|=1})),l.addEventListener("error",(function(){s.loading|=2})),s.loading|=4,Ad(a,t,o)}a={type:"stylesheet",instance:a,count:1,state:s},n.set(i,a)}}},M:function(e,t){fd.M(e,t);var r=md;if(r&&e){var o=qe(r).hoistableScripts,n=xd(e),i=o.get(n);i||((i=r.querySelector(bd(n)))||(e=M({src:e,async:!0,type:"module"},t),(t=ud.get(n))&&Sd(e,t),$e(i=r.createElement("script")),Ku(i,"link",e),r.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},o.set(n,i))}}};var md="undefined"===typeof document?null:document;function pd(e,t,r){var o=md;if(o&&"string"===typeof t&&t){var n=pt(t);n='link[rel="'+e+'"][href="'+n+'"]',"string"===typeof r&&(n+='[crossorigin="'+r+'"]'),dd.has(n)||(dd.add(n),e={rel:e,crossOrigin:r,href:t},null===o.querySelector(n)&&(Ku(t=o.createElement("link"),"link",e),$e(t),o.head.appendChild(t)))}}function gd(e,t,r,o){var n,i,s,l,c=(c=$.current)?hd(c):null;if(!c)throw Error(a(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof r.precedence&&"string"===typeof r.href?(t=_d(r.href),(o=(r=qe(c).hoistableStyles).get(t))||(o={type:"style",instance:null,count:0,state:null},r.set(t,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===r.rel&&"string"===typeof r.href&&"string"===typeof r.precedence){e=_d(r.href);var u=qe(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(yd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),ud.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},ud.set(e,r),u||(n=c,i=e,s=r,l=d.state,n.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=n.createElement("link"),l.preload=i,i.addEventListener("load",(function(){return l.loading|=1})),i.addEventListener("error",(function(){return l.loading|=2})),Ku(i,"link",s),$e(i),n.head.appendChild(i))))),t&&null===o)throw Error(a(528,""));return d}if(t&&null!==o)throw Error(a(529,""));return null;case"script":return t=r.async,"string"===typeof(r=r.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=xd(r),(o=(r=qe(c).hoistableScripts).get(t))||(o={type:"script",instance:null,count:0,state:null},r.set(t,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,e))}}function _d(e){return'href="'+pt(e)+'"'}function yd(e){return'link[rel="stylesheet"]['+e+"]"}function vd(e){return M({},e,{"data-precedence":e.precedence,precedence:null})}function xd(e){return'[src="'+pt(e)+'"]'}function bd(e){return"script[async]"+e}function Ld(e,t,r){if(t.count++,null===t.instance)switch(t.type){case"style":var o=e.querySelector('style[data-href~="'+pt(r.href)+'"]');if(o)return t.instance=o,$e(o),o;var n=M({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return $e(o=(e.ownerDocument||e).createElement("style")),Ku(o,"style",n),Ad(o,r.precedence,e),t.instance=o;case"stylesheet":n=_d(r.href);var i=e.querySelector(yd(n));if(i)return t.state.loading|=4,t.instance=i,$e(i),i;o=vd(r),(n=ud.get(n))&&wd(o,n),$e(i=(e.ownerDocument||e).createElement("link"));var s=i;return s._p=new Promise((function(e,t){s.onload=e,s.onerror=t})),Ku(i,"link",o),t.state.loading|=4,Ad(i,r.precedence,e),t.instance=i;case"script":return i=xd(r.src),(n=e.querySelector(bd(i)))?(t.instance=n,$e(n),n):(o=r,(n=ud.get(i))&&Sd(o=M({},r),n),$e(n=(e=e.ownerDocument||e).createElement("script")),Ku(n,"link",o),e.head.appendChild(n),t.instance=n);case"void":return null;default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(o=t.instance,t.state.loading|=4,Ad(o,r.precedence,e));return t.instance}function Ad(e,t,r){for(var o=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),n=o.length?o[o.length-1]:null,i=n,a=0;a<o.length;a++){var s=o[a];if(s.dataset.precedence===t)i=s;else if(i!==n)break}i?i.parentNode.insertBefore(e,i.nextSibling):(t=9===r.nodeType?r.head:r).insertBefore(e,t.firstChild)}function wd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Sd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Ed=null;function Td(e,t,r){if(null===Ed){var o=new Map,n=Ed=new Map;n.set(r,o)}else(o=(n=Ed).get(r))||(o=new Map,n.set(r,o));if(o.has(e))return o;for(o.set(e,null),r=r.getElementsByTagName(e),n=0;n<r.length;n++){var i=r[n];if(!(i[We]||i[Fe]||"link"===e&&"stylesheet"===i.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==i.namespaceURI){var a=i.getAttribute(t)||"";a=e+a;var s=o.get(a);s?s.push(i):o.set(a,[i])}}return o}function Pd(e,t,r){(e=e.ownerDocument||e).head.insertBefore(r,"title"===t?e.querySelector("head > title"):null)}function Cd(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Rd=null;function Md(){}function Id(){if(this.count--,0===this.count)if(this.stylesheets)Dd(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Od=null;function Dd(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Od=new Map,t.forEach(kd,e),Od=null,Id.call(e))}function kd(e,t){if(!(4&t.state.loading)){var r=Od.get(e);if(r)var o=r.get(null);else{r=new Map,Od.set(e,r);for(var n=e.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<n.length;i++){var a=n[i];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(r.set(a.dataset.precedence,a),o=a)}o&&r.set(null,o)}a=(n=t.instance).getAttribute("data-precedence"),(i=r.get(a)||o)===o&&r.set(null,n),r.set(a,n),this.count++,o=Id.bind(this),n.addEventListener("load",o),n.addEventListener("error",o),i?i.parentNode.insertBefore(n,i.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(n,e.firstChild),t.state.loading|=4}}var Nd={$$typeof:g,Provider:null,Consumer:null,_currentValue:G,_currentValue2:G,_threadCount:0};function Bd(e,t,r,o,n,i,a,s){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Me(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Me(0),this.hiddenUpdates=Me(null),this.identifierPrefix=o,this.onUncaughtError=n,this.onCaughtError=i,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=s,this.incompleteTransitions=new Map}function Fd(e,t,r,o,n,i,a,s,l,c,u,d){return e=new Bd(e,t,r,a,s,l,c,d),t=1,!0===i&&(t|=24),i=kl(3,null,null,t),e.current=i,i.stateNode=e,(t=Vn()).refCount++,e.pooledCache=t,t.refCount++,i.memoizedState={element:o,isDehydrated:r,cache:t},Cs(i),e}function zd(e){return e?e=Io:Io}function Ud(e,t,r,o,n,i){n=zd(n),null===o.context?o.context=n:o.pendingContext=n,(o=Ms(t)).payload={element:r},null!==(i=void 0===i?null:i)&&(o.callback=i),null!==(r=Is(e,o,t))&&(Ic(r,0,t),Os(r,e,t))}function Vd(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function Hd(e,t){Vd(e,t),(e=e.alternate)&&Vd(e,t)}function Gd(e){if(13===e.tag){var t=Co(e,67108864);null!==t&&Ic(t,0,67108864),Hd(e,67108864)}}var jd=!0;function Wd(e,t,r,o){var n=R.T;R.T=null;var i=H.p;try{H.p=2,Jd(e,t,r,o)}finally{H.p=i,R.T=n}}function Kd(e,t,r,o){var n=R.T;R.T=null;var i=H.p;try{H.p=8,Jd(e,t,r,o)}finally{H.p=i,R.T=n}}function Jd(e,t,r,o){if(jd){var n=Zd(o);if(null===n)Du(e,t,o,Yd,r),ah(e,o);else if(function(e,t,r,o,n){switch(t){case"focusin":return Qd=sh(Qd,e,t,r,o,n),!0;case"dragenter":return eh=sh(eh,e,t,r,o,n),!0;case"mouseover":return th=sh(th,e,t,r,o,n),!0;case"pointerover":var i=n.pointerId;return rh.set(i,sh(rh.get(i)||null,e,t,r,o,n)),!0;case"gotpointercapture":return i=n.pointerId,oh.set(i,sh(oh.get(i)||null,e,t,r,o,n)),!0}return!1}(n,e,t,r,o))o.stopPropagation();else if(ah(e,o),4&t&&-1<ih.indexOf(e)){for(;null!==n;){var i=Ze(n);if(null!==i)switch(i.tag){case 3:if((i=i.stateNode).current.memoizedState.isDehydrated){var a=Se(i.pendingLanes);if(0!==a){var s=i;for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var l=1<<31-xe(a);s.entanglements[1]|=l,a&=~l}pu(i),0===(6&ec)&&(xc=le()+500,gu(0,!1))}}break;case 13:null!==(s=Co(i,2))&&Ic(s,0,2),Fc(),Hd(i,2)}if(null===(i=Zd(o))&&Du(e,t,o,Yd,r),i===n)break;n=i}null!==n&&o.stopPropagation()}else Du(e,t,o,null,r)}}function Zd(e){return qd(e=Mt(e))}var Yd=null;function qd(e){if(Yd=null,null!==(e=Je(e))){var t=B(e);if(null===t)e=null;else{var r=t.tag;if(13===r){if(null!==(e=F(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Yd=e,null}function $d(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ue:return 2;case de:return 8;case he:case fe:return 32;case me:return 268435456;default:return 32}default:return 32}}var Xd=!1,Qd=null,eh=null,th=null,rh=new Map,oh=new Map,nh=[],ih="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ah(e,t){switch(e){case"focusin":case"focusout":Qd=null;break;case"dragenter":case"dragleave":eh=null;break;case"mouseover":case"mouseout":th=null;break;case"pointerover":case"pointerout":rh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":oh.delete(t.pointerId)}}function sh(e,t,r,o,n,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:o,nativeEvent:i,targetContainers:[n]},null!==t&&(null!==(t=Ze(t))&&Gd(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function lh(e){var t=Je(e.target);if(null!==t){var r=B(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=F(r)))return e.blockedOn=t,void function(e,t){var r=H.p;try{return H.p=e,t()}finally{H.p=r}}(e.priority,(function(){if(13===r.tag){var e=Rc(),t=Co(r,e);null!==t&&Ic(t,0,e),Hd(r,e)}}))}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function ch(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Zd(e.nativeEvent);if(null!==r)return null!==(t=Ze(r))&&Gd(t),e.blockedOn=r,!1;var o=new(r=e.nativeEvent).constructor(r.type,r);Rt=o,r.target.dispatchEvent(o),Rt=null,t.shift()}return!0}function uh(e,t,r){ch(e)&&r.delete(t)}function dh(){Xd=!1,null!==Qd&&ch(Qd)&&(Qd=null),null!==eh&&ch(eh)&&(eh=null),null!==th&&ch(th)&&(th=null),rh.forEach(uh),oh.forEach(uh)}function hh(e,t){e.blockedOn===t&&(e.blockedOn=null,Xd||(Xd=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,dh)))}var fh=null;function mh(e){fh!==e&&(fh=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,(function(){fh===e&&(fh=null);for(var t=0;t<e.length;t+=3){var r=e[t],o=e[t+1],n=e[t+2];if("function"!==typeof o){if(null===qd(o||r))continue;break}var i=Ze(r);null!==i&&(e.splice(t,3),t-=3,da(i,{pending:!0,data:n,method:r.method,action:o},o,n))}})))}function ph(e){function t(t){return hh(t,e)}null!==Qd&&hh(Qd,e),null!==eh&&hh(eh,e),null!==th&&hh(th,e),rh.forEach(t),oh.forEach(t);for(var r=0;r<nh.length;r++){var o=nh[r];o.blockedOn===e&&(o.blockedOn=null)}for(;0<nh.length&&null===(r=nh[0]).blockedOn;)lh(r),null===r.blockedOn&&nh.shift();if(null!=(r=(e.ownerDocument||e).$$reactFormReplay))for(o=0;o<r.length;o+=3){var n=r[o],i=r[o+1],a=n[ze]||null;if("function"===typeof i)a||mh(r);else if(a){var s=null;if(i&&i.hasAttribute("formAction")){if(n=i,a=i[ze]||null)s=a.formAction;else if(null!==qd(n))continue}else s=a.action;"function"===typeof s?r[o+1]=s:(r.splice(o,3),o-=3),mh(r)}}}function gh(e){this._internalRoot=e}function _h(e){this._internalRoot=e}_h.prototype.render=gh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Ud(t.current,Rc(),e,t,null,null)},_h.prototype.unmount=gh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&tu(),Ud(e.current,2,null,e,null,null),Fc(),t[Ue]=null}},_h.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ne();e={blockedOn:null,target:e,priority:t};for(var r=0;r<nh.length&&0!==t&&t<nh[r].priority;r++);nh.splice(r,0,e),0===r&&lh(e)}};var yh=n.version;if("19.0.0"!==yh)throw Error(a(527,yh,"19.0.0"));H.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=B(e)))throw Error(a(188));return t!==e?null:e}for(var r=e,o=t;;){var n=r.return;if(null===n)break;var i=n.alternate;if(null===i){if(null!==(o=n.return)){r=o;continue}break}if(n.child===i.child){for(i=n.child;i;){if(i===r)return z(n),e;if(i===o)return z(n),t;i=i.sibling}throw Error(a(188))}if(r.return!==o.return)r=n,o=i;else{for(var s=!1,l=n.child;l;){if(l===r){s=!0,r=n,o=i;break}if(l===o){s=!0,o=n,r=i;break}l=l.sibling}if(!s){for(l=i.child;l;){if(l===r){s=!0,r=i,o=n;break}if(l===o){s=!0,o=i,r=n;break}l=l.sibling}if(!s)throw Error(a(189))}}if(r.alternate!==o)throw Error(a(190))}if(3!==r.tag)throw Error(a(188));return r.stateNode.current===r?e:t}(t),e=null===(e=null!==e?U(e):null)?null:e.stateNode};var vh={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:R,findFiberByHostInstance:Je,reconcilerVersion:"19.0.0"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var xh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xh.isDisabled&&xh.supportsFiber)try{_e=xh.inject(vh),ye=xh}catch(Lh){}}t.createRoot=function(e,t){if(!s(e))throw Error(a(299));var r=!1,o="",n=ka,i=Na,l=Ba;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(o=t.identifierPrefix),void 0!==t.onUncaughtError&&(n=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Fd(e,1,!1,null,0,r,o,n,i,l,0,null),e[Ue]=t.current,Iu(8===e.nodeType?e.parentNode:e),new gh(t)},t.hydrateRoot=function(e,t,r){if(!s(e))throw Error(a(299));var o=!1,n="",i=ka,l=Na,c=Ba,u=null;return null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(o=!0),void 0!==r.identifierPrefix&&(n=r.identifierPrefix),void 0!==r.onUncaughtError&&(i=r.onUncaughtError),void 0!==r.onCaughtError&&(l=r.onCaughtError),void 0!==r.onRecoverableError&&(c=r.onRecoverableError),void 0!==r.unstable_transitionCallbacks&&r.unstable_transitionCallbacks,void 0!==r.formState&&(u=r.formState)),(t=Fd(e,1,!0,t,0,o,n,i,l,c,0,u)).context=zd(null),r=t.current,(n=Ms(o=Rc())).callback=null,Is(r,n,o),t.current.lanes=o,Ie(t,o),pu(t),e[Ue]=t.current,Iu(e),new _h(t)},t.version="19.0.0"},43:(e,t,r)=>{"use strict";e.exports=r(288)},139:(e,t)=>{var r;!function(){"use strict";var o={}.hasOwnProperty;function n(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=a(e,i(r)))}return e}function i(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return n.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var r in e)o.call(e,r)&&e[r]&&(t=a(t,r));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(n.default=n,e.exports=n):void 0===(r=function(){return n}.apply(t,[]))||(e.exports=r)}()},288:(e,t)=>{"use strict";var r=Symbol.for("react.transitional.element"),o=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function _(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||m}function y(){}function v(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||m}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var x=v.prototype=new y;x.constructor=v,p(x,_.prototype),x.isPureReactComponent=!0;var b=Array.isArray,L={H:null,A:null,T:null,S:null},A=Object.prototype.hasOwnProperty;function w(e,t,o,n,i,a){return o=a.ref,{$$typeof:r,type:e,key:t,ref:void 0!==o?o:null,props:a}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var E=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function P(){}function C(e,t,n,i,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(s){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case r:case o:u=!0;break;case h:return C((u=e._init)(e._payload),t,n,i,a)}}if(u)return a=a(e),u=""===i?"."+T(e,0):i,b(a)?(n="",null!=u&&(n=u.replace(E,"$&/")+"/"),C(a,t,n,"",(function(e){return e}))):null!=a&&(S(a)&&(l=a,c=n+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(E,"$&/")+"/")+u,a=w(l.type,c,void 0,0,0,l.props)),t.push(a)),1;u=0;var d,m=""===i?".":i+":";if(b(e))for(var p=0;p<e.length;p++)u+=C(i=e[p],t,n,s=m+T(i,p),a);else if("function"===typeof(p=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=f&&d[f]||d["@@iterator"])?d:null))for(e=p.call(e),p=0;!(i=e.next()).done;)u+=C(i=i.value,t,n,s=m+T(i,p++),a);else if("object"===s){if("function"===typeof e.then)return C(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(P,P):(e.status="pending",e.then((function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)}),(function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,n,i,a);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function R(e,t,r){if(null==e)return e;var o=[],n=0;return C(e,o,"","",(function(e){return t.call(r,e,n++)})),o}function M(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function O(){}t.Children={map:R,forEach:function(e,t,r){R(e,(function(){t.apply(this,arguments)}),r)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=n,t.Profiler=a,t.PureComponent=v,t.StrictMode=i,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var o=p({},e.props),n=e.key;if(null!=t)for(i in void 0!==t.ref&&void 0,void 0!==t.key&&(n=""+t.key),t)!A.call(t,i)||"key"===i||"__self"===i||"__source"===i||"ref"===i&&void 0===t.ref||(o[i]=t[i]);var i=arguments.length-2;if(1===i)o.children=r;else if(1<i){for(var a=Array(i),s=0;s<i;s++)a[s]=arguments[s+2];o.children=a}return w(e.type,n,void 0,0,0,o)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,r){var o,n={},i=null;if(null!=t)for(o in void 0!==t.key&&(i=""+t.key),t)A.call(t,o)&&"key"!==o&&"__self"!==o&&"__source"!==o&&(n[o]=t[o]);var a=arguments.length-2;if(1===a)n.children=r;else if(1<a){for(var s=Array(a),l=0;l<a;l++)s[l]=arguments[l+2];n.children=s}if(e&&e.defaultProps)for(o in a=e.defaultProps)void 0===n[o]&&(n[o]=a[o]);return w(e,i,void 0,0,0,n)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:M}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.T,r={};L.T=r;try{var o=e(),n=L.S;null!==n&&n(r,o),"object"===typeof o&&null!==o&&"function"===typeof o.then&&o.then(O,I)}catch(i){I(i)}finally{L.T=t}},t.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},t.use=function(e){return L.H.use(e)},t.useActionState=function(e,t,r){return L.H.useActionState(e,t,r)},t.useCallback=function(e,t){return L.H.useCallback(e,t)},t.useContext=function(e){return L.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return L.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return L.H.useEffect(e,t)},t.useId=function(){return L.H.useId()},t.useImperativeHandle=function(e,t,r){return L.H.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return L.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return L.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return L.H.useMemo(e,t)},t.useOptimistic=function(e,t){return L.H.useOptimistic(e,t)},t.useReducer=function(e,t,r){return L.H.useReducer(e,t,r)},t.useRef=function(e){return L.H.useRef(e)},t.useState=function(e){return L.H.useState(e)},t.useSyncExternalStore=function(e,t,r){return L.H.useSyncExternalStore(e,t,r)},t.useTransition=function(){return L.H.useTransition()},t.version="19.0.0"},391:(e,t,r)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(4)},579:(e,t,r)=>{"use strict";e.exports=r(799)},672:(e,t,r)=>{"use strict";var o=r(43);function n(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(n(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},s=Symbol.for("react.portal");var l=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(n(299));return function(e,t,r){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:s,key:null==o?null:""+o,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.flushSync=function(e){var t=l.T,r=a.p;try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=r,a.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var r=t.as,o=c(r,t.crossOrigin),n="string"===typeof t.integrity?t.integrity:void 0,i="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===r?a.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:o,integrity:n,fetchPriority:i}):"script"===r&&a.d.X(e,{crossOrigin:o,integrity:n,fetchPriority:i,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var r=c(t.as,t.crossOrigin);a.d.M(e,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var r=t.as,o=c(r,t.crossOrigin);a.d.L(e,r,{crossOrigin:o,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var r=c(t.as,t.crossOrigin);a.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,r){return l.H.useFormState(e,t,r)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0"},684:function(e){e.exports=function(){"use strict";var e,t,r;function o(o,n){if(e)if(t){var i="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",a={};e(a),r=n(a),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([i],{type:"text/javascript"})))}else t=n;else e=n}return o(["exports"],(function(e){var t="3.4.0";let r;const o={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==r){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{r=null!={NODE_ENV:"production",PUBLIC_URL:"/gid-finland",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/gid-finland",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_URL_REGEX):e}catch(t){r=e}}return r},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!o.API_URL)return null;try{const e=new URL(o.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function n(e){return o.API_URL_REGEX.test(e)}function i(e){return 0===e.indexOf("mapbox:")}function a(e){return o.API_CDN_URL_REGEX.test(e)}function s(e){return o.API_SPRITE_REGEX.test(e)}function l(e){return o.API_STYLE_REGEX.test(e)&&!s(e)}const c={create:"create",load:"load",fullLoad:"fullLoad"};function u(e){const t=e.name.split("?")[0];return a(t)&&t.includes("mapbox-gl.js")?"javascript":a(t)&&t.includes("mapbox-gl.css")?"css":function(e){return o.API_FONTS_REGEX.test(e)}(t)?"fontRange":s(t)?"sprite":l(t)?"style":function(e){return o.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h={},f={};Object.defineProperty(f,"__esModule",{value:!0}),f.setMatrixArrayType=function(e){f.ARRAY_TYPE=p=e},f.toRadian=function(e){return e*_},f.equals=function(e,t){return Math.abs(e-t)<=m*Math.max(1,Math.abs(e),Math.abs(t))},f.RANDOM=f.ARRAY_TYPE=f.EPSILON=void 0;var m=1e-6;f.EPSILON=m;var p="undefined"!=typeof Float32Array?Float32Array:Array;f.ARRAY_TYPE=p;var g=Math.random;f.RANDOM=g;var _=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var y={};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}Object.defineProperty(y,"__esModule",{value:!0}),y.create=function(){var e=new x.ARRAY_TYPE(4);return x.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},y.clone=function(e){var t=new x.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},y.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},y.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},y.fromValues=function(e,t,r,o){var n=new x.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=o,n},y.set=function(e,t,r,o,n){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e},y.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},y.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*i-n*o;return a?(e[0]=i*(a=1/a),e[1]=-o*a,e[2]=-n*a,e[3]=r*a,e):null},y.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},y.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},y.multiply=L,y.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=o*l+i*s,e[1]=n*l+a*s,e[2]=o*-s+i*l,e[3]=n*-s+a*l,e},y.scale=function(e,t,r){var o=t[1],n=t[2],i=t[3],a=r[0],s=r[1];return e[0]=t[0]*a,e[1]=o*a,e[2]=n*s,e[3]=i*s,e},y.fromRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=r,e[2]=-r,e[3]=o,e},y.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},y.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},y.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},y.LDU=function(e,t,r,o){return e[2]=o[2]/o[0],r[0]=o[0],r[1]=o[1],r[3]=o[3]-e[2]*r[1],[e,t,r]},y.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},y.subtract=A,y.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},y.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=x.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-s)<=x.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-l)<=x.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=x.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},y.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},y.multiplyScalarAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e},y.sub=y.mul=void 0;var x=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==v(e)&&"function"!=typeof e)return{default:e};var t=b(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(b=function(e){return e?r:t})(e)}function L(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=o*s+i*l,e[1]=n*s+a*l,e[2]=o*c+i*u,e[3]=n*c+a*u,e}function A(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}y.mul=L,y.sub=A;var w={};function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}Object.defineProperty(w,"__esModule",{value:!0}),w.create=function(){var e=new E.ARRAY_TYPE(6);return E.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},w.clone=function(e){var t=new E.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},w.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},w.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},w.fromValues=function(e,t,r,o,n,i){var a=new E.ARRAY_TYPE(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=o,a[4]=n,a[5]=i,a},w.set=function(e,t,r,o,n,i,a){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e[4]=i,e[5]=a,e},w.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=r*i-o*n;return l?(e[0]=i*(l=1/l),e[1]=-o*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*s-i*a)*l,e[5]=(o*a-r*s)*l,e):null},w.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},w.multiply=P,w.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=o*u+i*c,e[1]=n*u+a*c,e[2]=o*-c+i*u,e[3]=n*-c+a*u,e[4]=s,e[5]=l,e},w.scale=function(e,t,r){var o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=r[0],c=r[1];return e[0]=t[0]*l,e[1]=o*l,e[2]=n*c,e[3]=i*c,e[4]=a,e[5]=s,e},w.translate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=o*c+i*u+s,e[5]=n*c+a*u+l,e},w.fromRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=r,e[2]=-r,e[3]=o,e[4]=0,e[5]=0,e},w.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},w.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},w.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},w.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},w.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},w.subtract=C,w.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},w.multiplyScalarAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e[4]=t[4]+r[4]*o,e[5]=t[5]+r[5]*o,e},w.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},w.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=t[0],c=t[1],u=t[2],d=t[3],h=t[4],f=t[5];return Math.abs(r-l)<=E.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-c)<=E.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(n-u)<=E.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-d)<=E.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-h)<=E.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-f)<=E.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},w.sub=w.mul=void 0;var E=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==S(e)&&"function"!=typeof e)return{default:e};var t=T(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function P(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=r[0],u=r[1],d=r[2],h=r[3],f=r[4],m=r[5];return e[0]=o*c+i*u,e[1]=n*c+a*u,e[2]=o*d+i*h,e[3]=n*d+a*h,e[4]=o*f+i*m+s,e[5]=n*f+a*m+l,e}function C(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}w.mul=P,w.sub=C;var R={};function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}Object.defineProperty(R,"__esModule",{value:!0}),R.create=function(){var e=new I.ARRAY_TYPE(9);return I.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},R.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},R.clone=function(e){var t=new I.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},R.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},R.fromValues=function(e,t,r,o,n,i,a,s,l){var c=new I.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=o,c[4]=n,c[5]=i,c[6]=a,c[7]=s,c[8]=l,c},R.set=function(e,t,r,o,n,i,a,s,l,c){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e},R.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},R.transpose=function(e,t){if(e===t){var r=t[1],o=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=o,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},R.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=u*a-s*c,h=-u*i+s*l,f=c*i-a*l,m=r*d+o*h+n*f;return m?(e[0]=d*(m=1/m),e[1]=(-u*o+n*c)*m,e[2]=(s*o-n*a)*m,e[3]=h*m,e[4]=(u*r-n*l)*m,e[5]=(-s*r+n*i)*m,e[6]=f*m,e[7]=(-c*r+o*l)*m,e[8]=(a*r-o*i)*m,e):null},R.adjoint=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=n*c-o*u,e[2]=o*s-n*a,e[3]=s*l-i*u,e[4]=r*u-n*l,e[5]=n*i-r*s,e[6]=i*c-a*l,e[7]=o*l-r*c,e[8]=r*a-o*i,e},R.determinant=function(e){var t=e[3],r=e[4],o=e[5],n=e[6],i=e[7],a=e[8];return e[0]*(a*r-o*i)+e[1]*(-a*t+o*n)+e[2]*(i*t-r*n)},R.multiply=D,R.translate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],f=r[1];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=s,e[5]=l,e[6]=h*o+f*a+c,e[7]=h*n+f*s+u,e[8]=h*i+f*l+d,e},R.rotate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=Math.sin(r),f=Math.cos(r);return e[0]=f*o+h*a,e[1]=f*n+h*s,e[2]=f*i+h*l,e[3]=f*a-h*o,e[4]=f*s-h*n,e[5]=f*l-h*i,e[6]=c,e[7]=u,e[8]=d,e},R.scale=function(e,t,r){var o=r[0],n=r[1];return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},R.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},R.fromRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=r,e[2]=0,e[3]=-r,e[4]=o,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},R.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},R.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},R.fromQuat=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r+r,s=o+o,l=n+n,c=r*a,u=o*a,d=o*s,h=n*a,f=n*s,m=n*l,p=i*a,g=i*s,_=i*l;return e[0]=1-d-m,e[3]=u-_,e[6]=h+g,e[1]=u+_,e[4]=1-c-m,e[7]=f-p,e[2]=h-g,e[5]=f+p,e[8]=1-c-d,e},R.normalFromMat4=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],m=t[12],p=t[13],g=t[14],_=t[15],y=r*s-o*a,v=r*l-n*a,x=r*c-i*a,b=o*l-n*s,L=o*c-i*s,A=n*c-i*l,w=u*p-d*m,S=u*g-h*m,E=u*_-f*m,T=d*g-h*p,P=d*_-f*p,C=h*_-f*g,R=y*C-v*P+x*T+b*E-L*S+A*w;return R?(e[0]=(s*C-l*P+c*T)*(R=1/R),e[1]=(l*E-a*C-c*S)*R,e[2]=(a*P-s*E+c*w)*R,e[3]=(n*P-o*C-i*T)*R,e[4]=(r*C-n*E+i*S)*R,e[5]=(o*E-r*P-i*w)*R,e[6]=(p*A-g*L+_*b)*R,e[7]=(g*x-m*A-_*v)*R,e[8]=(m*L-p*x+_*y)*R,e):null},R.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},R.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},R.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},R.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},R.subtract=k,R.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},R.multiplyScalarAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e[4]=t[4]+r[4]*o,e[5]=t[5]+r[5]*o,e[6]=t[6]+r[6]*o,e[7]=t[7]+r[7]*o,e[8]=t[8]+r[8]*o,e},R.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},R.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=t[0],h=t[1],f=t[2],m=t[3],p=t[4],g=t[5],_=t[6],y=t[7],v=t[8];return Math.abs(r-d)<=I.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-h)<=I.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(n-f)<=I.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-m)<=I.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-p)<=I.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-g)<=I.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=I.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=I.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-v)<=I.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},R.sub=R.mul=void 0;var I=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==M(e)&&"function"!=typeof e)return{default:e};var t=O(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(O=function(e){return e?r:t})(e)}function D(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],f=r[1],m=r[2],p=r[3],g=r[4],_=r[5],y=r[6],v=r[7],x=r[8];return e[0]=h*o+f*a+m*c,e[1]=h*n+f*s+m*u,e[2]=h*i+f*l+m*d,e[3]=p*o+g*a+_*c,e[4]=p*n+g*s+_*u,e[5]=p*i+g*l+_*d,e[6]=y*o+v*a+x*c,e[7]=y*n+v*s+x*u,e[8]=y*i+v*l+x*d,e}function k(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}R.mul=D,R.sub=k;var N={};function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}Object.defineProperty(N,"__esModule",{value:!0}),N.create=function(){var e=new F.ARRAY_TYPE(16);return F.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},N.clone=function(e){var t=new F.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},N.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},N.fromValues=function(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){var g=new F.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=o,g[4]=n,g[5]=i,g[6]=a,g[7]=s,g[8]=l,g[9]=c,g[10]=u,g[11]=d,g[12]=h,g[13]=f,g[14]=m,g[15]=p,g},N.set=function(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=h,e[12]=f,e[13]=m,e[14]=p,e[15]=g,e},N.identity=U,N.transpose=function(e,t){if(e===t){var r=t[1],o=t[2],n=t[3],i=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=i,e[11]=t[14],e[12]=n,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},N.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],m=t[12],p=t[13],g=t[14],_=t[15],y=r*s-o*a,v=r*l-n*a,x=r*c-i*a,b=o*l-n*s,L=o*c-i*s,A=n*c-i*l,w=u*p-d*m,S=u*g-h*m,E=u*_-f*m,T=d*g-h*p,P=d*_-f*p,C=h*_-f*g,R=y*C-v*P+x*T+b*E-L*S+A*w;return R?(e[0]=(s*C-l*P+c*T)*(R=1/R),e[1]=(n*P-o*C-i*T)*R,e[2]=(p*A-g*L+_*b)*R,e[3]=(h*L-d*A-f*b)*R,e[4]=(l*E-a*C-c*S)*R,e[5]=(r*C-n*E+i*S)*R,e[6]=(g*x-m*A-_*v)*R,e[7]=(u*A-h*x+f*v)*R,e[8]=(a*P-s*E+c*w)*R,e[9]=(o*E-r*P-i*w)*R,e[10]=(m*L-p*x+_*y)*R,e[11]=(d*x-u*L-f*y)*R,e[12]=(s*S-a*T-l*w)*R,e[13]=(r*T-o*S+n*w)*R,e[14]=(p*v-m*b-g*y)*R,e[15]=(u*b-d*v+h*y)*R,e):null},N.adjoint=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],m=t[12],p=t[13],g=t[14],_=t[15];return e[0]=s*(h*_-f*g)-d*(l*_-c*g)+p*(l*f-c*h),e[1]=-(o*(h*_-f*g)-d*(n*_-i*g)+p*(n*f-i*h)),e[2]=o*(l*_-c*g)-s*(n*_-i*g)+p*(n*c-i*l),e[3]=-(o*(l*f-c*h)-s*(n*f-i*h)+d*(n*c-i*l)),e[4]=-(a*(h*_-f*g)-u*(l*_-c*g)+m*(l*f-c*h)),e[5]=r*(h*_-f*g)-u*(n*_-i*g)+m*(n*f-i*h),e[6]=-(r*(l*_-c*g)-a*(n*_-i*g)+m*(n*c-i*l)),e[7]=r*(l*f-c*h)-a*(n*f-i*h)+u*(n*c-i*l),e[8]=a*(d*_-f*p)-u*(s*_-c*p)+m*(s*f-c*d),e[9]=-(r*(d*_-f*p)-u*(o*_-i*p)+m*(o*f-i*d)),e[10]=r*(s*_-c*p)-a*(o*_-i*p)+m*(o*c-i*s),e[11]=-(r*(s*f-c*d)-a*(o*f-i*d)+u*(o*c-i*s)),e[12]=-(a*(d*g-h*p)-u*(s*g-l*p)+m*(s*h-l*d)),e[13]=r*(d*g-h*p)-u*(o*g-n*p)+m*(o*h-n*d),e[14]=-(r*(s*g-l*p)-a*(o*g-n*p)+m*(o*l-n*s)),e[15]=r*(s*h-l*d)-a*(o*h-n*d)+u*(o*l-n*s),e},N.determinant=function(e){var t=e[0],r=e[1],o=e[2],n=e[3],i=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],f=e[12],m=e[13],p=e[14],g=e[15];return(t*a-r*i)*(d*g-h*p)-(t*s-o*i)*(u*g-h*m)+(t*l-n*i)*(u*p-d*m)+(r*s-o*a)*(c*g-h*f)-(r*l-n*a)*(c*p-d*f)+(o*l-n*s)*(c*m-u*f)},N.multiply=V,N.translate=function(e,t,r){var o,n,i,a,s,l,c,u,d,h,f,m,p=r[0],g=r[1],_=r[2];return t===e?(e[12]=t[0]*p+t[4]*g+t[8]*_+t[12],e[13]=t[1]*p+t[5]*g+t[9]*_+t[13],e[14]=t[2]*p+t[6]*g+t[10]*_+t[14],e[15]=t[3]*p+t[7]*g+t[11]*_+t[15]):(n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],f=t[10],m=t[11],e[0]=o=t[0],e[1]=n,e[2]=i,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=f,e[11]=m,e[12]=o*p+s*g+d*_+t[12],e[13]=n*p+l*g+h*_+t[13],e[14]=i*p+c*g+f*_+t[14],e[15]=a*p+u*g+m*_+t[15]),e},N.scale=function(e,t,r){var o=r[0],n=r[1],i=r[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},N.rotate=function(e,t,r,o){var n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b,L,A,w,S,E,T,P=o[0],C=o[1],R=o[2],M=Math.hypot(P,C,R);return M<F.EPSILON?null:(P*=M=1/M,C*=M,R*=M,n=Math.sin(r),i=Math.cos(r),l=t[1],c=t[2],u=t[3],h=t[5],f=t[6],m=t[7],g=t[9],_=t[10],y=t[11],v=P*P*(a=1-i)+i,L=P*C*a-R*n,A=C*C*a+i,w=R*C*a+P*n,S=P*R*a+C*n,E=C*R*a-P*n,T=R*R*a+i,e[0]=(s=t[0])*v+(d=t[4])*(x=C*P*a+R*n)+(p=t[8])*(b=R*P*a-C*n),e[1]=l*v+h*x+g*b,e[2]=c*v+f*x+_*b,e[3]=u*v+m*x+y*b,e[4]=s*L+d*A+p*w,e[5]=l*L+h*A+g*w,e[6]=c*L+f*A+_*w,e[7]=u*L+m*A+y*w,e[8]=s*S+d*E+p*T,e[9]=l*S+h*E+g*T,e[10]=c*S+f*E+_*T,e[11]=u*S+m*E+y*T,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},N.rotateX=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*n+c*o,e[5]=a*n+u*o,e[6]=s*n+d*o,e[7]=l*n+h*o,e[8]=c*n-i*o,e[9]=u*n-a*o,e[10]=d*n-s*o,e[11]=h*n-l*o,e},N.rotateY=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n-c*o,e[1]=a*n-u*o,e[2]=s*n-d*o,e[3]=l*n-h*o,e[8]=i*o+c*n,e[9]=a*o+u*n,e[10]=s*o+d*n,e[11]=l*o+h*n,e},N.rotateZ=function(e,t,r){var o=Math.sin(r),n=Math.cos(r),i=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*n+c*o,e[1]=a*n+u*o,e[2]=s*n+d*o,e[3]=l*n+h*o,e[4]=c*n-i*o,e[5]=u*n-a*o,e[6]=d*n-s*o,e[7]=h*n-l*o,e},N.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},N.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},N.fromRotation=function(e,t,r){var o,n,i,a=r[0],s=r[1],l=r[2],c=Math.hypot(a,s,l);return c<F.EPSILON?null:(a*=c=1/c,s*=c,l*=c,o=Math.sin(t),n=Math.cos(t),e[0]=a*a*(i=1-n)+n,e[1]=s*a*i+l*o,e[2]=l*a*i-s*o,e[3]=0,e[4]=a*s*i-l*o,e[5]=s*s*i+n,e[6]=l*s*i+a*o,e[7]=0,e[8]=a*l*i+s*o,e[9]=s*l*i-a*o,e[10]=l*l*i+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},N.fromXRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},N.fromYRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},N.fromZRotation=function(e,t){var r=Math.sin(t),o=Math.cos(t);return e[0]=o,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},N.fromRotationTranslation=H,N.fromQuat2=function(e,t){var r=new F.ARRAY_TYPE(3),o=-t[0],n=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=o*o+n*n+i*i+a*a;return d>0?(r[0]=2*(s*a+u*o+l*i-c*n)/d,r[1]=2*(l*a+u*n+c*o-s*i)/d,r[2]=2*(c*a+u*i+s*n-l*o)/d):(r[0]=2*(s*a+u*o+l*i-c*n),r[1]=2*(l*a+u*n+c*o-s*i),r[2]=2*(c*a+u*i+s*n-l*o)),H(e,t,r),e},N.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},N.getScaling=G,N.getRotation=function(e,t){var r=new F.ARRAY_TYPE(3);G(r,t);var o=1/r[0],n=1/r[1],i=1/r[2],a=t[0]*o,s=t[1]*n,l=t[2]*i,c=t[4]*o,u=t[5]*n,d=t[6]*i,h=t[8]*o,f=t[9]*n,m=t[10]*i,p=a+u+m,g=0;return p>0?(g=2*Math.sqrt(p+1),e[3]=.25*g,e[0]=(d-f)/g,e[1]=(h-l)/g,e[2]=(s-c)/g):a>u&&a>m?(g=2*Math.sqrt(1+a-u-m),e[3]=(d-f)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(h+l)/g):u>m?(g=2*Math.sqrt(1+u-a-m),e[3]=(h-l)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(d+f)/g):(g=2*Math.sqrt(1+m-a-u),e[3]=(s-c)/g,e[0]=(h+l)/g,e[1]=(d+f)/g,e[2]=.25*g),e},N.fromRotationTranslationScale=function(e,t,r,o){var n=t[0],i=t[1],a=t[2],s=t[3],l=n+n,c=i+i,u=a+a,d=n*l,h=n*c,f=n*u,m=i*c,p=i*u,g=a*u,_=s*l,y=s*c,v=s*u,x=o[0],b=o[1],L=o[2];return e[0]=(1-(m+g))*x,e[1]=(h+v)*x,e[2]=(f-y)*x,e[3]=0,e[4]=(h-v)*b,e[5]=(1-(d+g))*b,e[6]=(p+_)*b,e[7]=0,e[8]=(f+y)*L,e[9]=(p-_)*L,e[10]=(1-(d+m))*L,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},N.fromRotationTranslationScaleOrigin=function(e,t,r,o,n){var i=t[0],a=t[1],s=t[2],l=t[3],c=i+i,u=a+a,d=s+s,h=i*c,f=i*u,m=i*d,p=a*u,g=a*d,_=s*d,y=l*c,v=l*u,x=l*d,b=o[0],L=o[1],A=o[2],w=n[0],S=n[1],E=n[2],T=(1-(p+_))*b,P=(f+x)*b,C=(m-v)*b,R=(f-x)*L,M=(1-(h+_))*L,I=(g+y)*L,O=(m+v)*A,D=(g-y)*A,k=(1-(h+p))*A;return e[0]=T,e[1]=P,e[2]=C,e[3]=0,e[4]=R,e[5]=M,e[6]=I,e[7]=0,e[8]=O,e[9]=D,e[10]=k,e[11]=0,e[12]=r[0]+w-(T*w+R*S+O*E),e[13]=r[1]+S-(P*w+M*S+D*E),e[14]=r[2]+E-(C*w+I*S+k*E),e[15]=1,e},N.fromQuat=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r+r,s=o+o,l=n+n,c=r*a,u=o*a,d=o*s,h=n*a,f=n*s,m=n*l,p=i*a,g=i*s,_=i*l;return e[0]=1-d-m,e[1]=u+_,e[2]=h-g,e[3]=0,e[4]=u-_,e[5]=1-c-m,e[6]=f+p,e[7]=0,e[8]=h+g,e[9]=f-p,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},N.frustum=function(e,t,r,o,n,i,a){var s=1/(r-t),l=1/(n-o),c=1/(i-a);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*l,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+o)*l,e[10]=(a+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*c,e[15]=0,e},N.perspectiveNO=j,N.perspectiveZO=function(e,t,r,o,n){var i,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(i=1/(o-n)),e[14]=n*o*i):(e[10]=-1,e[14]=-o),e},N.perspectiveFromFieldOfView=function(e,t,r,o){var n=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(n+i);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(n-i)*c*.5,e[10]=o/(r-o),e[11]=-1,e[12]=0,e[13]=0,e[14]=o*r/(r-o),e[15]=0,e},N.orthoNO=W,N.orthoZO=function(e,t,r,o,n,i,a){var s=1/(t-r),l=1/(o-n),c=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*s,e[13]=(n+o)*l,e[14]=i*c,e[15]=1,e},N.lookAt=function(e,t,r,o){var n,i,a,s,l,c,u,d,h,f,m=t[0],p=t[1],g=t[2],_=o[0],y=o[1],v=o[2],x=r[0],b=r[1],L=r[2];return Math.abs(m-x)<F.EPSILON&&Math.abs(p-b)<F.EPSILON&&Math.abs(g-L)<F.EPSILON?U(e):(u=m-x,d=p-b,h=g-L,n=y*(h*=f=1/Math.hypot(u,d,h))-v*(d*=f),i=v*(u*=f)-_*h,a=_*d-y*u,(f=Math.hypot(n,i,a))?(n*=f=1/f,i*=f,a*=f):(n=0,i=0,a=0),s=d*a-h*i,l=h*n-u*a,c=u*i-d*n,(f=Math.hypot(s,l,c))?(s*=f=1/f,l*=f,c*=f):(s=0,l=0,c=0),e[0]=n,e[1]=s,e[2]=u,e[3]=0,e[4]=i,e[5]=l,e[6]=d,e[7]=0,e[8]=a,e[9]=c,e[10]=h,e[11]=0,e[12]=-(n*m+i*p+a*g),e[13]=-(s*m+l*p+c*g),e[14]=-(u*m+d*p+h*g),e[15]=1,e)},N.targetTo=function(e,t,r,o){var n=t[0],i=t[1],a=t[2],s=o[0],l=o[1],c=o[2],u=n-r[0],d=i-r[1],h=a-r[2],f=u*u+d*d+h*h;f>0&&(u*=f=1/Math.sqrt(f),d*=f,h*=f);var m=l*h-c*d,p=c*u-s*h,g=s*d-l*u;return(f=m*m+p*p+g*g)>0&&(m*=f=1/Math.sqrt(f),p*=f,g*=f),e[0]=m,e[1]=p,e[2]=g,e[3]=0,e[4]=d*g-h*p,e[5]=h*m-u*g,e[6]=u*p-d*m,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=n,e[13]=i,e[14]=a,e[15]=1,e},N.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},N.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},N.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},N.subtract=K,N.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},N.multiplyScalarAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e[4]=t[4]+r[4]*o,e[5]=t[5]+r[5]*o,e[6]=t[6]+r[6]*o,e[7]=t[7]+r[7]*o,e[8]=t[8]+r[8]*o,e[9]=t[9]+r[9]*o,e[10]=t[10]+r[10]*o,e[11]=t[11]+r[11]*o,e[12]=t[12]+r[12]*o,e[13]=t[13]+r[13]*o,e[14]=t[14]+r[14]*o,e[15]=t[15]+r[15]*o,e},N.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},N.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],m=e[12],p=e[13],g=e[14],_=e[15],y=t[0],v=t[1],x=t[2],b=t[3],L=t[4],A=t[5],w=t[6],S=t[7],E=t[8],T=t[9],P=t[10],C=t[11],R=t[12],M=t[13],I=t[14],O=t[15];return Math.abs(r-y)<=F.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(o-v)<=F.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(n-x)<=F.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-b)<=F.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-L)<=F.EPSILON*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(s-A)<=F.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(l-w)<=F.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-S)<=F.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(u-E)<=F.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(d-T)<=F.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(h-P)<=F.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(f-C)<=F.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(m-R)<=F.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(p-M)<=F.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(g-I)<=F.EPSILON*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(_-O)<=F.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))},N.sub=N.mul=N.ortho=N.perspective=void 0;var F=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==B(e)&&"function"!=typeof e)return{default:e};var t=z(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function z(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(z=function(e){return e?r:t})(e)}function U(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],f=t[10],m=t[11],p=t[12],g=t[13],_=t[14],y=t[15],v=r[0],x=r[1],b=r[2],L=r[3];return e[0]=v*o+x*s+b*d+L*p,e[1]=v*n+x*l+b*h+L*g,e[2]=v*i+x*c+b*f+L*_,e[3]=v*a+x*u+b*m+L*y,e[4]=(v=r[4])*o+(x=r[5])*s+(b=r[6])*d+(L=r[7])*p,e[5]=v*n+x*l+b*h+L*g,e[6]=v*i+x*c+b*f+L*_,e[7]=v*a+x*u+b*m+L*y,e[8]=(v=r[8])*o+(x=r[9])*s+(b=r[10])*d+(L=r[11])*p,e[9]=v*n+x*l+b*h+L*g,e[10]=v*i+x*c+b*f+L*_,e[11]=v*a+x*u+b*m+L*y,e[12]=(v=r[12])*o+(x=r[13])*s+(b=r[14])*d+(L=r[15])*p,e[13]=v*n+x*l+b*h+L*g,e[14]=v*i+x*c+b*f+L*_,e[15]=v*a+x*u+b*m+L*y,e}function H(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=o+o,l=n+n,c=i+i,u=o*s,d=o*l,h=o*c,f=n*l,m=n*c,p=i*c,g=a*s,_=a*l,y=a*c;return e[0]=1-(f+p),e[1]=d+y,e[2]=h-_,e[3]=0,e[4]=d-y,e[5]=1-(u+p),e[6]=m+g,e[7]=0,e[8]=h+_,e[9]=m-g,e[10]=1-(u+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function G(e,t){var r=t[4],o=t[5],n=t[6],i=t[8],a=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(r,o,n),e[2]=Math.hypot(i,a,s),e}function j(e,t,r,o,n){var i,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+o)*(i=1/(o-n)),e[14]=2*n*o*i):(e[10]=-1,e[14]=-2*o),e}function W(e,t,r,o,n,i,a){var s=1/(t-r),l=1/(o-n),c=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(n+o)*l,e[14]=(a+i)*c,e[15]=1,e}function K(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}N.perspective=j,N.ortho=W,N.mul=V,N.sub=K;var J={},Z={};function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}Object.defineProperty(Z,"__esModule",{value:!0}),Z.create=X,Z.clone=function(e){var t=new q.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Z.length=Q,Z.fromValues=function(e,t,r){var o=new q.ARRAY_TYPE(3);return o[0]=e,o[1]=t,o[2]=r,o},Z.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Z.set=function(e,t,r,o){return e[0]=t,e[1]=r,e[2]=o,e},Z.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},Z.subtract=ee,Z.multiply=te,Z.divide=re,Z.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Z.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Z.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},Z.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},Z.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Z.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},Z.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e},Z.distance=oe,Z.squaredDistance=ne,Z.squaredLength=ie,Z.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Z.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Z.normalize=function(e,t){var r=t[0],o=t[1],n=t[2],i=r*r+o*o+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},Z.dot=ae,Z.cross=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[0],s=r[1],l=r[2];return e[0]=n*l-i*s,e[1]=i*a-o*l,e[2]=o*s-n*a,e},Z.lerp=function(e,t,r,o){var n=t[0],i=t[1],a=t[2];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e[2]=a+o*(r[2]-a),e},Z.hermite=function(e,t,r,o,n,i){var a=i*i,s=a*(2*i-3)+1,l=a*(i-2)+i,c=a*(i-1),u=a*(3-2*i);return e[0]=t[0]*s+r[0]*l+o[0]*c+n[0]*u,e[1]=t[1]*s+r[1]*l+o[1]*c+n[1]*u,e[2]=t[2]*s+r[2]*l+o[2]*c+n[2]*u,e},Z.bezier=function(e,t,r,o,n,i){var a=1-i,s=a*a,l=i*i,c=s*a,u=3*i*s,d=3*l*a,h=l*i;return e[0]=t[0]*c+r[0]*u+o[0]*d+n[0]*h,e[1]=t[1]*c+r[1]*u+o[1]*d+n[1]*h,e[2]=t[2]*c+r[2]*u+o[2]*d+n[2]*h,e},Z.random=function(e,t){t=t||1;var r=2*q.RANDOM()*Math.PI,o=2*q.RANDOM()-1,n=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=o*t,e},Z.transformMat4=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[3]*o+r[7]*n+r[11]*i+r[15];return e[0]=(r[0]*o+r[4]*n+r[8]*i+r[12])/(a=a||1),e[1]=(r[1]*o+r[5]*n+r[9]*i+r[13])/a,e[2]=(r[2]*o+r[6]*n+r[10]*i+r[14])/a,e},Z.transformMat3=function(e,t,r){var o=t[0],n=t[1],i=t[2];return e[0]=o*r[0]+n*r[3]+i*r[6],e[1]=o*r[1]+n*r[4]+i*r[7],e[2]=o*r[2]+n*r[5]+i*r[8],e},Z.transformQuat=function(e,t,r){var o=r[0],n=r[1],i=r[2],a=t[0],s=t[1],l=t[2],c=n*l-i*s,u=i*a-o*l,d=o*s-n*a,h=n*d-i*u,f=i*c-o*d,m=o*u-n*c,p=2*r[3];return u*=p,d*=p,f*=2,m*=2,e[0]=a+(c*=p)+(h*=2),e[1]=s+u+f,e[2]=l+d+m,e},Z.rotateX=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[0],i[1]=n[1]*Math.cos(o)-n[2]*Math.sin(o),i[2]=n[1]*Math.sin(o)+n[2]*Math.cos(o),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},Z.rotateY=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[2]*Math.sin(o)+n[0]*Math.cos(o),i[1]=n[1],i[2]=n[2]*Math.cos(o)-n[0]*Math.sin(o),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},Z.rotateZ=function(e,t,r,o){var n=[],i=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],i[0]=n[0]*Math.cos(o)-n[1]*Math.sin(o),i[1]=n[0]*Math.sin(o)+n[1]*Math.cos(o),i[2]=n[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e},Z.angle=function(e,t){var r=e[0],o=e[1],n=e[2],i=t[0],a=t[1],s=t[2],l=Math.sqrt(r*r+o*o+n*n)*Math.sqrt(i*i+a*a+s*s),c=l&&ae(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Z.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Z.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Z.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Z.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=t[0],a=t[1],s=t[2];return Math.abs(r-i)<=q.EPSILON*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(o-a)<=q.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(n-s)<=q.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},Z.forEach=Z.sqrLen=Z.len=Z.sqrDist=Z.dist=Z.div=Z.mul=Z.sub=void 0;var q=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==Y(e)&&"function"!=typeof e)return{default:e};var t=$(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function $(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return($=function(e){return e?r:t})(e)}function X(){var e=new q.ARRAY_TYPE(3);return q.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Q(e){return Math.hypot(e[0],e[1],e[2])}function ee(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function te(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function re(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function oe(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function ne(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2];return r*r+o*o+n*n}function ie(e){var t=e[0],r=e[1],o=e[2];return t*t+r*r+o*o}function ae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Z.sub=ee,Z.mul=te,Z.div=re,Z.dist=oe,Z.sqrDist=ne,Z.len=Q,Z.sqrLen=ie;var se,le=(se=X(),function(e,t,r,o,n,i){var a,s;for(t||(t=3),r||(r=0),s=o?Math.min(o*t+r,e.length):e.length,a=r;a<s;a+=t)se[0]=e[a],se[1]=e[a+1],se[2]=e[a+2],n(se,se,i),e[a]=se[0],e[a+1]=se[1],e[a+2]=se[2];return e});Z.forEach=le;var ce={};function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}Object.defineProperty(ce,"__esModule",{value:!0}),ce.create=fe,ce.clone=function(e){var t=new de.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ce.fromValues=function(e,t,r,o){var n=new de.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=o,n},ce.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ce.set=function(e,t,r,o,n){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e},ce.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},ce.subtract=me,ce.multiply=pe,ce.divide=ge,ce.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},ce.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},ce.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},ce.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},ce.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},ce.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},ce.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e[2]=t[2]+r[2]*o,e[3]=t[3]+r[3]*o,e},ce.distance=_e,ce.squaredDistance=ye,ce.length=ve,ce.squaredLength=xe,ce.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},ce.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},ce.normalize=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*r+o*o+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=o*a,e[2]=n*a,e[3]=i*a,e},ce.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ce.cross=function(e,t,r,o){var n=r[0]*o[1]-r[1]*o[0],i=r[0]*o[2]-r[2]*o[0],a=r[0]*o[3]-r[3]*o[0],s=r[1]*o[2]-r[2]*o[1],l=r[1]*o[3]-r[3]*o[1],c=r[2]*o[3]-r[3]*o[2],u=t[0],d=t[1],h=t[2],f=t[3];return e[0]=d*c-h*l+f*s,e[1]=-u*c+h*a-f*i,e[2]=u*l-d*a+f*n,e[3]=-u*s+d*i-h*n,e},ce.lerp=function(e,t,r,o){var n=t[0],i=t[1],a=t[2],s=t[3];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e[2]=a+o*(r[2]-a),e[3]=s+o*(r[3]-s),e},ce.random=function(e,t){var r,o,n,i,a,s;t=t||1;do{a=(r=2*de.RANDOM()-1)*r+(o=2*de.RANDOM()-1)*o}while(a>=1);do{s=(n=2*de.RANDOM()-1)*n+(i=2*de.RANDOM()-1)*i}while(s>=1);var l=Math.sqrt((1-a)/s);return e[0]=t*r,e[1]=t*o,e[2]=t*n*l,e[3]=t*i*l,e},ce.transformMat4=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3];return e[0]=r[0]*o+r[4]*n+r[8]*i+r[12]*a,e[1]=r[1]*o+r[5]*n+r[9]*i+r[13]*a,e[2]=r[2]*o+r[6]*n+r[10]*i+r[14]*a,e[3]=r[3]*o+r[7]*n+r[11]*i+r[15]*a,e},ce.transformQuat=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=r[0],s=r[1],l=r[2],c=r[3],u=c*o+s*i-l*n,d=c*n+l*o-a*i,h=c*i+a*n-s*o,f=-a*o-s*n-l*i;return e[0]=u*c+f*-a+d*-l-h*-s,e[1]=d*c+f*-s+h*-a-u*-l,e[2]=h*c+f*-l+u*-s-d*-a,e[3]=t[3],e},ce.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},ce.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ce.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},ce.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=de.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-s)<=de.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-l)<=de.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=de.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))},ce.forEach=ce.sqrLen=ce.len=ce.sqrDist=ce.dist=ce.div=ce.mul=ce.sub=void 0;var de=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==ue(e)&&"function"!=typeof e)return{default:e};var t=he(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function he(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(he=function(e){return e?r:t})(e)}function fe(){var e=new de.ARRAY_TYPE(4);return de.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function me(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function pe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function ge(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function _e(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function ye(e,t){var r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2],i=t[3]-e[3];return r*r+o*o+n*n+i*i}function ve(e){return Math.hypot(e[0],e[1],e[2],e[3])}function xe(e){var t=e[0],r=e[1],o=e[2],n=e[3];return t*t+r*r+o*o+n*n}ce.sub=me,ce.mul=pe,ce.div=ge,ce.dist=_e,ce.sqrDist=ye,ce.len=ve,ce.sqrLen=xe;var be=function(){var e=fe();return function(t,r,o,n,i,a){var s,l;for(r||(r=4),o||(o=0),l=n?Math.min(n*r+o,t.length):t.length,s=o;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],i(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}ce.forEach=be,Object.defineProperty(J,"__esModule",{value:!0}),J.create=Ce,J.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},J.setAxisAngle=Re,J.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),o=Math.sin(r/2);return o>Ae.EPSILON?(e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o):(e[0]=1,e[1]=0,e[2]=0),r},J.getAngle=function(e,t){var r=Be(e,t);return Math.acos(2*r*r-1)},J.multiply=Me,J.rotateX=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=o*l+a*s,e[1]=n*l+i*s,e[2]=i*l-n*s,e[3]=a*l-o*s,e},J.rotateY=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=o*l-i*s,e[1]=n*l+a*s,e[2]=i*l+o*s,e[3]=a*l-n*s,e},J.rotateZ=function(e,t,r){r*=.5;var o=t[0],n=t[1],i=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=o*l+n*s,e[1]=n*l-o*s,e[2]=i*l+a*s,e[3]=a*l-i*s,e},J.calculateW=function(e,t){var r=t[0],o=t[1],n=t[2];return e[0]=r,e[1]=o,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-o*o-n*n)),e},J.exp=Ie,J.ln=Oe,J.pow=function(e,t,r){return Oe(e,t),Ne(e,e,r),Ie(e,e),e},J.slerp=De,J.random=function(e){var t=Ae.RANDOM(),r=Ae.RANDOM(),o=Ae.RANDOM(),n=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=i*Math.sin(2*Math.PI*o),e[3]=i*Math.cos(2*Math.PI*o),e},J.invert=function(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=r*r+o*o+n*n+i*i,s=a?1/a:0;return e[0]=-r*s,e[1]=-o*s,e[2]=-n*s,e[3]=i*s,e},J.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},J.fromMat3=ke,J.fromEuler=function(e,t,r,o){var n=.5*Math.PI/180;t*=n,r*=n,o*=n;var i=Math.sin(t),a=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(o),u=Math.cos(o);return e[0]=i*l*u-a*s*c,e[1]=a*s*u+i*l*c,e[2]=a*l*c-i*s*u,e[3]=a*l*u+i*s*c,e},J.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},J.setAxes=J.sqlerp=J.rotationTo=J.equals=J.exactEquals=J.normalize=J.sqrLen=J.squaredLength=J.len=J.length=J.lerp=J.dot=J.scale=J.mul=J.add=J.set=J.copy=J.fromValues=J.clone=void 0;var Ae=Pe(f),we=Pe(R),Se=Pe(Z),Ee=Pe(ce);function Te(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Te=function(e){return e?r:t})(e)}function Pe(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Le(e)&&"function"!=typeof e)return{default:e};var r=Te(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=n?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=e[i]}return o.default=e,r&&r.set(e,o),o}function Ce(){var e=new Ae.ARRAY_TYPE(4);return Ae.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Re(e,t,r){r*=.5;var o=Math.sin(r);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(r),e}function Me(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=o*u+a*s+n*c-i*l,e[1]=n*u+a*l+i*s-o*c,e[2]=i*u+a*c+o*l-n*s,e[3]=a*u-o*s-n*l-i*c,e}function Ie(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=Math.sqrt(r*r+o*o+n*n),s=Math.exp(i),l=a>0?s*Math.sin(a)/a:0;return e[0]=r*l,e[1]=o*l,e[2]=n*l,e[3]=s*Math.cos(a),e}function Oe(e,t){var r=t[0],o=t[1],n=t[2],i=t[3],a=Math.sqrt(r*r+o*o+n*n),s=a>0?Math.atan2(a,i)/a:0;return e[0]=r*s,e[1]=o*s,e[2]=n*s,e[3]=.5*Math.log(r*r+o*o+n*n+i*i),e}function De(e,t,r,o){var n,i,a,s,l,c=t[0],u=t[1],d=t[2],h=t[3],f=r[0],m=r[1],p=r[2],g=r[3];return(i=c*f+u*m+d*p+h*g)<0&&(i=-i,f=-f,m=-m,p=-p,g=-g),1-i>Ae.EPSILON?(n=Math.acos(i),a=Math.sin(n),s=Math.sin((1-o)*n)/a,l=Math.sin(o*n)/a):(s=1-o,l=o),e[0]=s*c+l*f,e[1]=s*u+l*m,e[2]=s*d+l*p,e[3]=s*h+l*g,e}function ke(e,t){var r,o=t[0]+t[4]+t[8];if(o>0)r=Math.sqrt(o+1),e[3]=.5*r,e[0]=(t[5]-t[7])*(r=.5/r),e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,e[3]=(t[3*i+a]-t[3*a+i])*(r=.5/r),e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}J.clone=Ee.clone,J.fromValues=Ee.fromValues,J.copy=Ee.copy,J.set=Ee.set,J.add=Ee.add,J.mul=Me;var Ne=Ee.scale;J.scale=Ne;var Be=Ee.dot;J.dot=Be,J.lerp=Ee.lerp;var Fe=Ee.length;J.length=Fe,J.len=Fe;var ze=Ee.squaredLength;J.squaredLength=ze,J.sqrLen=ze;var Ue=Ee.normalize;J.normalize=Ue,J.exactEquals=Ee.exactEquals,J.equals=Ee.equals;var Ve,He,Ge,je=(Ve=Se.create(),He=Se.fromValues(1,0,0),Ge=Se.fromValues(0,1,0),function(e,t,r){var o=Se.dot(t,r);return o<-.999999?(Se.cross(Ve,He,t),Se.len(Ve)<1e-6&&Se.cross(Ve,Ge,t),Se.normalize(Ve,Ve),Re(e,Ve,Math.PI),e):o>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Se.cross(Ve,t,r),e[0]=Ve[0],e[1]=Ve[1],e[2]=Ve[2],e[3]=1+o,Ue(e,e))});J.rotationTo=je;var We,Ke,Je=(We=Ce(),Ke=Ce(),function(e,t,r,o,n,i){return De(We,t,n,i),De(Ke,r,o,i),De(e,We,Ke,2*i*(1-i)),e});J.sqlerp=Je;var Ze,Ye=(Ze=we.create(),function(e,t,r,o){return Ze[0]=r[0],Ze[3]=r[1],Ze[6]=r[2],Ze[1]=o[0],Ze[4]=o[1],Ze[7]=o[2],Ze[2]=-t[0],Ze[5]=-t[1],Ze[8]=-t[2],Ue(e,ke(e,Ze))});J.setAxes=Ye;var qe={};function $e(e){return $e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$e(e)}Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=function(){var e=new Xe.ARRAY_TYPE(8);return Xe.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},qe.clone=function(e){var t=new Xe.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},qe.fromValues=function(e,t,r,o,n,i,a,s){var l=new Xe.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=o,l[4]=n,l[5]=i,l[6]=a,l[7]=s,l},qe.fromRotationTranslationValues=function(e,t,r,o,n,i,a){var s=new Xe.ARRAY_TYPE(8);s[0]=e,s[1]=t,s[2]=r,s[3]=o;var l=.5*n,c=.5*i,u=.5*a;return s[4]=l*o+c*r-u*t,s[5]=c*o+u*e-l*r,s[6]=u*o+l*t-c*e,s[7]=-l*e-c*t-u*r,s},qe.fromRotationTranslation=ot,qe.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},qe.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},qe.fromMat4=function(e,t){var r=Qe.create();et.getRotation(r,t);var o=new Xe.ARRAY_TYPE(3);return et.getTranslation(o,t),ot(e,r,o),e},qe.copy=nt,qe.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},qe.set=function(e,t,r,o,n,i,a,s,l){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e[4]=i,e[5]=a,e[6]=s,e[7]=l,e},qe.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},qe.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},qe.getTranslation=function(e,t){var r=t[4],o=t[5],n=t[6],i=t[7],a=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(r*c+i*a+o*l-n*s),e[1]=2*(o*c+i*s+n*a-r*l),e[2]=2*(n*c+i*l+r*s-o*a),e},qe.translate=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=.5*r[0],l=.5*r[1],c=.5*r[2],u=t[4],d=t[5],h=t[6],f=t[7];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=a*s+n*c-i*l+u,e[5]=a*l+i*s-o*c+d,e[6]=a*c+o*l-n*s+h,e[7]=-o*s-n*l-i*c+f,e},qe.rotateX=function(e,t,r){var o=-t[0],n=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*o+l*i-c*n,h=l*a+u*n+c*o-s*i,f=c*a+u*i+s*n-l*o,m=u*a-s*o-l*n-c*i;return Qe.rotateX(e,t,r),e[4]=d*(a=e[3])+m*(o=e[0])+h*(i=e[2])-f*(n=e[1]),e[5]=h*a+m*n+f*o-d*i,e[6]=f*a+m*i+d*n-h*o,e[7]=m*a-d*o-h*n-f*i,e},qe.rotateY=function(e,t,r){var o=-t[0],n=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*o+l*i-c*n,h=l*a+u*n+c*o-s*i,f=c*a+u*i+s*n-l*o,m=u*a-s*o-l*n-c*i;return Qe.rotateY(e,t,r),e[4]=d*(a=e[3])+m*(o=e[0])+h*(i=e[2])-f*(n=e[1]),e[5]=h*a+m*n+f*o-d*i,e[6]=f*a+m*i+d*n-h*o,e[7]=m*a-d*o-h*n-f*i,e},qe.rotateZ=function(e,t,r){var o=-t[0],n=-t[1],i=-t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=s*a+u*o+l*i-c*n,h=l*a+u*n+c*o-s*i,f=c*a+u*i+s*n-l*o,m=u*a-s*o-l*n-c*i;return Qe.rotateZ(e,t,r),e[4]=d*(a=e[3])+m*(o=e[0])+h*(i=e[2])-f*(n=e[1]),e[5]=h*a+m*n+f*o-d*i,e[6]=f*a+m*i+d*n-h*o,e[7]=m*a-d*o-h*n-f*i,e},qe.rotateByQuatAppend=function(e,t,r){var o=r[0],n=r[1],i=r[2],a=r[3],s=t[0],l=t[1],c=t[2],u=t[3];return e[0]=s*a+u*o+l*i-c*n,e[1]=l*a+u*n+c*o-s*i,e[2]=c*a+u*i+s*n-l*o,e[3]=u*a-s*o-l*n-c*i,e[4]=(s=t[4])*a+(u=t[7])*o+(l=t[5])*i-(c=t[6])*n,e[5]=l*a+u*n+c*o-s*i,e[6]=c*a+u*i+s*n-l*o,e[7]=u*a-s*o-l*n-c*i,e},qe.rotateByQuatPrepend=function(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=o*u+a*s+n*c-i*l,e[1]=n*u+a*l+i*s-o*c,e[2]=i*u+a*c+o*l-n*s,e[3]=a*u-o*s-n*l-i*c,e[4]=o*(u=r[7])+a*(s=r[4])+n*(c=r[6])-i*(l=r[5]),e[5]=n*u+a*l+i*s-o*c,e[6]=i*u+a*c+o*l-n*s,e[7]=a*u-o*s-n*l-i*c,e},qe.rotateAroundAxis=function(e,t,r,o){if(Math.abs(o)<Xe.EPSILON)return nt(e,t);var n=Math.hypot(r[0],r[1],r[2]);o*=.5;var i=Math.sin(o),a=i*r[0]/n,s=i*r[1]/n,l=i*r[2]/n,c=Math.cos(o),u=t[0],d=t[1],h=t[2],f=t[3];e[0]=u*c+f*a+d*l-h*s,e[1]=d*c+f*s+h*a-u*l,e[2]=h*c+f*l+u*s-d*a,e[3]=f*c-u*a-d*s-h*l;var m=t[4],p=t[5],g=t[6],_=t[7];return e[4]=m*c+_*a+p*l-g*s,e[5]=p*c+_*s+g*a-m*l,e[6]=g*c+_*l+m*s-p*a,e[7]=_*c-m*a-p*s-g*l,e},qe.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e},qe.multiply=it,qe.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e},qe.lerp=function(e,t,r,o){var n=1-o;return at(t,r)<0&&(o=-o),e[0]=t[0]*n+r[0]*o,e[1]=t[1]*n+r[1]*o,e[2]=t[2]*n+r[2]*o,e[3]=t[3]*n+r[3]*o,e[4]=t[4]*n+r[4]*o,e[5]=t[5]*n+r[5]*o,e[6]=t[6]*n+r[6]*o,e[7]=t[7]*n+r[7]*o,e},qe.invert=function(e,t){var r=lt(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e},qe.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},qe.normalize=function(e,t){var r=lt(t);if(r>0){r=Math.sqrt(r);var o=t[0]/r,n=t[1]/r,i=t[2]/r,a=t[3]/r,s=t[4],l=t[5],c=t[6],u=t[7],d=o*s+n*l+i*c+a*u;e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=(s-o*d)/r,e[5]=(l-n*d)/r,e[6]=(c-i*d)/r,e[7]=(u-a*d)/r}return e},qe.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},qe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},qe.equals=function(e,t){var r=e[0],o=e[1],n=e[2],i=e[3],a=e[4],s=e[5],l=e[6],c=e[7],u=t[0],d=t[1],h=t[2],f=t[3],m=t[4],p=t[5],g=t[6],_=t[7];return Math.abs(r-u)<=Xe.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-d)<=Xe.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(n-h)<=Xe.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-f)<=Xe.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-m)<=Xe.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-p)<=Xe.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-g)<=Xe.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=Xe.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},qe.sqrLen=qe.squaredLength=qe.len=qe.length=qe.dot=qe.mul=qe.setReal=qe.getReal=void 0;var Xe=rt(f),Qe=rt(J),et=rt(N);function tt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(tt=function(e){return e?r:t})(e)}function rt(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==$e(e)&&"function"!=typeof e)return{default:e};var r=tt(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=n?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=e[i]}return o.default=e,r&&r.set(e,o),o}function ot(e,t,r){var o=.5*r[0],n=.5*r[1],i=.5*r[2],a=t[0],s=t[1],l=t[2],c=t[3];return e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=o*c+n*l-i*s,e[5]=n*c+i*a-o*l,e[6]=i*c+o*s-n*a,e[7]=-o*a-n*s-i*l,e}function nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function it(e,t,r){var o=t[0],n=t[1],i=t[2],a=t[3],s=r[4],l=r[5],c=r[6],u=r[7],d=t[4],h=t[5],f=t[6],m=t[7],p=r[0],g=r[1],_=r[2],y=r[3];return e[0]=o*y+a*p+n*_-i*g,e[1]=n*y+a*g+i*p-o*_,e[2]=i*y+a*_+o*g-n*p,e[3]=a*y-o*p-n*g-i*_,e[4]=o*u+a*s+n*c-i*l+d*y+m*p+h*_-f*g,e[5]=n*u+a*l+i*s-o*c+h*y+m*g+f*p-d*_,e[6]=i*u+a*c+o*l-n*s+f*y+m*_+d*g-h*p,e[7]=a*u-o*s-n*l-i*c+m*y-d*p-h*g-f*_,e}qe.getReal=Qe.copy,qe.setReal=Qe.copy,qe.mul=it;var at=Qe.dot;qe.dot=at;var st=Qe.length;qe.length=st,qe.len=st;var lt=Qe.squaredLength;qe.squaredLength=lt,qe.sqrLen=lt;var ct={};function ut(e){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(e)}Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=ft,ct.clone=function(e){var t=new dt.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},ct.fromValues=function(e,t){var r=new dt.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},ct.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},ct.set=function(e,t,r){return e[0]=t,e[1]=r,e},ct.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},ct.subtract=mt,ct.multiply=pt,ct.divide=gt,ct.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},ct.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},ct.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},ct.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},ct.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},ct.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},ct.scaleAndAdd=function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e},ct.distance=_t,ct.squaredDistance=yt,ct.length=vt,ct.squaredLength=xt,ct.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},ct.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},ct.normalize=function(e,t){var r=t[0],o=t[1],n=r*r+o*o;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},ct.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},ct.cross=function(e,t,r){var o=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=o,e},ct.lerp=function(e,t,r,o){var n=t[0],i=t[1];return e[0]=n+o*(r[0]-n),e[1]=i+o*(r[1]-i),e},ct.random=function(e,t){t=t||1;var r=2*dt.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},ct.transformMat2=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[2]*n,e[1]=r[1]*o+r[3]*n,e},ct.transformMat2d=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[2]*n+r[4],e[1]=r[1]*o+r[3]*n+r[5],e},ct.transformMat3=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[3]*n+r[6],e[1]=r[1]*o+r[4]*n+r[7],e},ct.transformMat4=function(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[4]*n+r[12],e[1]=r[1]*o+r[5]*n+r[13],e},ct.rotate=function(e,t,r,o){var n=t[0]-r[0],i=t[1]-r[1],a=Math.sin(o),s=Math.cos(o);return e[0]=n*s-i*a+r[0],e[1]=n*a+i*s+r[1],e},ct.angle=function(e,t){var r=e[0],o=e[1],n=t[0],i=t[1],a=Math.sqrt(r*r+o*o)*Math.sqrt(n*n+i*i);return Math.acos(Math.min(Math.max(a&&(r*n+o*i)/a,-1),1))},ct.zero=function(e){return e[0]=0,e[1]=0,e},ct.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},ct.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ct.equals=function(e,t){var r=e[0],o=e[1],n=t[0],i=t[1];return Math.abs(r-n)<=dt.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(o-i)<=dt.EPSILON*Math.max(1,Math.abs(o),Math.abs(i))},ct.forEach=ct.sqrLen=ct.sqrDist=ct.dist=ct.div=ct.mul=ct.sub=ct.len=void 0;var dt=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==ut(e)&&"function"!=typeof e)return{default:e};var t=ht(void 0);if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}(f);function ht(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ht=function(e){return e?r:t})(e)}function ft(){var e=new dt.ARRAY_TYPE(2);return dt.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function mt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function pt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function gt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function _t(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function yt(e,t){var r=t[0]-e[0],o=t[1]-e[1];return r*r+o*o}function vt(e){return Math.hypot(e[0],e[1])}function xt(e){var t=e[0],r=e[1];return t*t+r*r}ct.len=vt,ct.sub=mt,ct.mul=pt,ct.div=gt,ct.dist=_t,ct.sqrDist=yt,ct.sqrLen=xt;var bt=function(){var e=ft();return function(t,r,o,n,i,a){var s,l;for(r||(r=2),o||(o=0),l=n?Math.min(n*r+o,t.length):t.length,s=o;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],i(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}();function Lt(e){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lt(e)}ct.forEach=bt,Object.defineProperty(h,"__esModule",{value:!0}),e.aa=h.vec4=e.Q=h.vec3=h.vec2=h.quat2=e.bl=h.quat=e.a9=h.mat4=e.ct=h.mat3=h.mat2d=e.b7=h.mat2=h.glMatrix=void 0;var At=Dt(f);h.glMatrix=At;var wt=Dt(y);e.b7=h.mat2=wt;var St=Dt(w);h.mat2d=St;var Et=Dt(R);e.ct=h.mat3=Et;var Tt=Dt(N);e.a9=h.mat4=Tt;var Pt=Dt(J);e.bl=h.quat=Pt;var Ct=Dt(qe);h.quat2=Ct;var Rt=Dt(ct);h.vec2=Rt;var Mt=Dt(Z);e.Q=h.vec3=Mt;var It=Dt(ce);function Ot(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(Ot=function(e){return e?r:t})(e)}function Dt(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Lt(e)&&"function"!=typeof e)return{default:e};var r=Ot(t);if(r&&r.has(e))return r.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=n?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(o,i,a):o[i]=e[i]}return o.default=e,r&&r.set(e,o),o}e.aa=h.vec4=It;var kt=Nt;function Nt(e,t,r,o){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=o}Nt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,o=0;o<8;o++){var n=this.sampleCurveX(r)-e;if(Math.abs(n)<t)return r;var i=this.sampleCurveDerivativeX(r);if(Math.abs(i)<1e-6)break;r-=n/i}var a=0,s=1;for(r=e,o=0;o<20&&(n=this.sampleCurveX(r),!(Math.abs(n-e)<t));o++)e>n?a=r:s=r,r=.5*(s-a)+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Bt=d(kt),Ft=zt;function zt(e,t){this.x=e,this.y=t}zt.prototype={clone:function(){return new zt(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),o=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=o,this},_rotateAround:function(e,t){var r=Math.cos(e),o=Math.sin(e),n=t.y+o*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-o*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},zt.convert=function(e){return e instanceof zt?e:Array.isArray(e)?new zt(e[0],e[1]):e};var Ut=d(Ft);const Vt=Math.PI/180,Ht=180/Math.PI;function Gt(e){return e*Vt}function jt(e){return e*Ht}const Wt=[[0,0],[1,0],[1,1],[0,1]];function Kt(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function Jt(e,t,r,o){const n=new Bt(e,t,r,o);return function(e){return n.solve(e)}}const Zt=Jt(.25,.1,.25,1);function Yt(e,t,r){return Math.min(r,Math.max(t,e))}function qt(e,t,r){return(r=Yt((r-e)/(t-e),0,1))*r*(3-2*r)}function $t(e,t,r){const o=r-t,n=((e-t)%o+o)%o+t;return n===t?r:n}function Xt(e,t,r){if(!e.length)return r(null,[]);let o=e.length;const n=new Array(e.length);let i=null;e.forEach(((e,a)=>{t(e,((e,t)=>{e&&(i=e),n[a]=t,0==--o&&r(i,n)}))}))}function Qt(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];for(const n of r)for(const t in n)e[t]=n[t];return e}let er=1;function tr(){return er++}function rr(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function or(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function nr(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ir(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function ar(e,t){return-1!==e.indexOf(t,e.length-t.length)}function sr(e,t,r){const o={};for(const n in e)o[n]=t.call(this,e[n],n,e);return o}function lr(e,t,r){const o={};for(const n in e)t.call(this,e[n],n,e)&&(o[n]=e[n]);return o}function cr(e){return Array.isArray(e)?e.map(cr):"object"==typeof e&&e?sr(e,cr):e}const ur={};function dr(e){ur[e]||("undefined"!=typeof console&&console.warn(e),ur[e]=!0)}function hr(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function fr(e){let t=0;for(let r,o,n=0,i=e.length,a=i-1;n<i;a=n++)r=e[n],o=e[a],t+=(o.x-r.x)*(r.y+o.y);return t}function mr(e){let[t,r,o]=e;const n=Gt(r+90),i=Gt(o);return{x:t*Math.cos(n)*Math.sin(i),y:t*Math.sin(n)*Math.sin(i),z:t*Math.cos(i),azimuthal:r,polar:o}}function pr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function gr(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,r,o,n)=>{const i=o||n;return t[r]=!i||i.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let _r,yr,vr,xr,br,Lr,Ar=null;function wr(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function Sr(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Er(e,t,r,o){for(;t<r;){const n=t+r>>1;e[n]<o?t=n+1:r=n}return t}function Tr(e,t,r,o){for(;t<r;){const n=t+r>>1;e[n]<=o?t=n+1:r=n}return t}function Pr(e){return e>0?1/(1.001-e):1+e}function Cr(e){return e>0?1-1/(1.001-e):-e}function Rr(){return null==_r&&(_r=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),_r}const Mr={now:()=>void 0!==xr?xr:performance.now(),setNow(e){xr=e},restoreNow(){xr=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:r,height:o}=e;br||(br=document.createElement("canvas"));const n=br.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(r>br.width||o>br.height)&&(br.width=r,br.height=o),n.clearRect(-t,-t,r+2*t,o+2*t),n.drawImage(e,0,0,r,o),n.getImageData(-t,-t,r+2*t,o+2*t)},resolveURL:e=>(yr||(yr=document.createElement("a")),yr.href=e,yr.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==vr&&(vr=window.matchMedia("(prefers-reduced-motion: reduce)")),vr.matches)},hasCanvasFingerprintNoise(){if(void 0!==Lr)return Lr;if(!Rr())return Lr=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let n=0;n<e.width;++n)t.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,t.fillRect(n,0,1,1);const o=t.getImageData(0,0,e.width,e.height);r=0;for(let n=0;n<o.data.length;++n)if(n%4!=3&&r++!==o.data[n])return Lr=!0,!0;return Lr=!1,!1}};function Ir(e,t){const r=e.indexOf("?");if(r<0)return`${e}?${new URLSearchParams(t).toString()}`;const o=new URLSearchParams(e.slice(r));for(const n in t)o.set(n,t[n]);return`${e.slice(0,r)}?${o.toString()}`}function Or(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const r=e.indexOf("?");if(r<0)return e;const o=new URLSearchParams,n=new URLSearchParams(e.slice(r));for(const a of t.persistentParams){const e=n.get(a);e&&o.set(a,e)}const i=o.toString();return`${e.slice(0,r)}${i.length>0?`?${i}`:""}`}const Dr="mapbox-tiles";let kr,Nr,Br=500,Fr=50;function zr(){try{return caches}catch(e){}}function Ur(){const e=zr();e&&!kr&&(kr=e.open(Dr))}let Vr=1/0;const Hr={supported:!1,testSupport:function(e){!Wr&&jr&&(Kr?Zr(e):Gr=e)}};let Gr,jr,Wr=!1,Kr=!1;const Jr="undefined"!=typeof self?self:{};function Zr(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,jr),e.isContextLost())return;Hr.supported=!0}catch(e){}e.deleteTexture(t),Wr=!0}Jr.document&&(jr=Jr.document.createElement("img"),jr.onload=function(){Gr&&Zr(Gr),Gr=null,Kr=!0},jr.onerror=function(){Wr=!0,Gr=null},jr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Yr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Yr);class qr extends Error{constructor(e,t,r){401===t&&n(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $r=pr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Xr=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test($r())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const r=new AbortController,o=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:$r(),referrerPolicy:e.referrerPolicy,signal:r.signal});let i=!1,a=!1;const s=(l=o.url).indexOf("sku=")>0&&n(l);var l;"json"===e.type&&o.headers.set("Accept","application/json");const c=(r,n,i)=>{if(a)return;if(r&&"SecurityError"!==r.message&&dr(r.toString()),n&&i)return u(n);const l=Date.now();fetch(o).then((r=>{if(r.ok){const e=s?r.clone():null;return u(r,e,l)}return t(new qr(r.statusText,r.status,e.url))})).catch((r=>{"AbortError"!==r.name&&t(new Error(`${r.message} ${e.url}`))}))},u=(r,n,s)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{a||(n&&s&&function(e,t,r){if(Ur(),!kr)return;const o=gr(t.headers.get("Cache-Control")||"");if(o["no-store"])return;const n={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e))),o["max-age"]&&n.headers.set("Expires",new Date(r+1e3*o["max-age"]).toUTCString());const i=n.headers.get("Expires");if(!i)return;if(new Date(i).getTime()-r<42e4)return;let a=Or(e.url,{persistentParams:["language","worldview"]});if(206===t.status){const t=e.headers.get("Range");if(!t)return;n.status=200,a=Ir(a,{range:t})}!function(e,t){if(void 0===Nr)try{new Response(new ReadableStream),Nr=!0}catch(e){Nr=!1}Nr?t(e.body):e.blob().then(t)}(t,(e=>{const t=new Response(e,n);Ur(),kr&&kr.then((e=>e.put(a,t))).catch((e=>dr(e.message)))}))}(o,n,s),i=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>{a||t(new Error(e.message))}))};return s?function(e,t){if(Ur(),!kr)return t(null);kr.then((r=>{let o=Or(e.url,{persistentParams:["language","worldview"]});const n=e.headers.get("Range");n&&(o=Ir(o,{range:n})),r.match(o).then((e=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=gr(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(e);r.delete(o),n&&r.put(o,e.clone()),t(null,e,n)})).catch(t)})).catch(t)}(o,c):c(null,null),{cancel:()=>{a=!0,i||r.abort()}}}(e,t);if(pr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(e,t){const r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const o in e.headers)r.setRequestHeader(o,e.headers[o]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let o=r.response;if("json"===e.type)try{o=JSON.parse(r.response)}catch(e){return t(e)}t(null,o,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else t(new qr(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},Qr=function(e,t){return Xr(Qt(e,{type:"arrayBuffer"}),t)};function eo(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const to="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ro,oo;ro=[],oo=0;const no=function(e,t){if(Hr.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),oo>=o.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ro.push(r),r}oo++;let r=!1;const n=()=>{if(!r)for(r=!0,oo--;ro.length&&oo<o.MAX_PARALLEL_IMAGE_REQUESTS;){const e=ro.shift(),{requestParameters:t,callback:r,cancelled:o}=e;o||(e.cancel=no(t,r).cancel)}},i=Qr(e,((e,r,o,i)=>{n(),e?t(e):r&&(self.createImageBitmap?function(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then((e=>{t(null,e)})).catch((e=>{t(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((e,r)=>t(e,r,o,i))):function(e,t){const r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame((()=>{r.src=to}))},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(o):to}(r,((e,r)=>t(e,r,o,i))))}));return{cancel:()=>{i.cancel(),n()}}},io="01",ao="NO_ACCESS_TOKEN",so=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lo(e){const t=e.match(so);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function co(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const uo="mapbox.eventData";function ho(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class fo{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=ho(o.ACCESS_TOKEN);let r="";return r=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):o.ACCESS_TOKEN||"",e?`${uo}.${e}:${r}`:`${uo}:${r}`}fetchEventData(){const e=wr("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const o=localStorage.getItem(r);o&&(this.anonId=o)}catch(e){dr("Unable to read from LocalStorage")}}saveEventData(){const e=wr("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid"),o=this.anonId;if(e&&o)try{localStorage.setItem(r,o),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){dr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){if(!o.EVENTS_URL)return;const i=lo(o.EVENTS_URL);i.params.push(`access_token=${n||o.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},s=t?Qt(a,t):a,l={url:co(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return Xr(Qt(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const mo=new class extends fo{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){o.EVENTS_URL&&o.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>i(e)||n(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=ho(o.ACCESS_TOKEN),n=r?r.u:o.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;nr(this.anonId)||(this.anonId=rr(),i=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(a),r=(a-this.eventData.lastSuccess)/864e5;i=i||r>=1||r<-1||e.getDate()!==t.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:io,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=a,this.eventData.tokenU=n)}),e):this.processRequests()}},po=mo.postTurnstileEvent.bind(mo),go=new class extends fo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,o.EVENTS_URL&&(r||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(ao)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:o}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),nr(this.anonId)||(this.anonId=rr()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:io,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):r&&(this.success[r]=!0)}),e))}remove(){this.errorCb=null}},_o=go.postMapLoadEvent.bind(go),yo=new class extends fo{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(e){let t=this.mapInstanceIdMap.get(e);return t||(t=rr(),this.mapInstanceIdMap.set(e,t)),t}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(e,t){const{map:r,style:n,importedStyles:i}=t;if(!o.EVENTS_URL||!e&&!o.ACCESS_TOKEN)return;const a=this.getMapInstanceId(r),s={mapInstanceId:a,eventId:this.getEventId(a),style:n};i.length&&(s.importedStyles=i),this.queueRequest({timestamp:Date.now(),payload:s},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,(()=>{}),e)}},vo=yo.postStyleLoadEvent.bind(yo),xo=new class extends fo{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){o.EVENTS_URL&&(e||o.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:o}=this.queue.shift(),n=function(e){const r=performance.getEntriesByType("resource"),o=performance.getEntriesByType("mark"),n=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const o of e[r]){const e=`${r}ResolveRangeMin`,n=`${r}ResolveRangeMax`,i=`${r}RequestCount`,a=`${r}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,o.startTime),t[n]=Math.max(t[n]||-1/0,o.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==o.transferSize&&0===o.transferSize&&s(a),s(i)}return t}(function(e,t){const r={};if(e)for(const o of e){const e=t(o);void 0===r[e]&&(r[e]=[]),r[e].push(o)}return r}(r,u)),i=window.devicePixelRatio,a=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=a?a.effectiveType:void 0,d={counters:[],metadata:[],attributes:[]},h=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const t in n)h(d.counters,t,n[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(h(d.counters,"interactionRangeMin",e.interactionRange[0]),h(d.counters,"interactionRangeMax",e.interactionRange[1])),o)for(const t of Object.keys(c)){const e=c[t],r=o.find((t=>t.name===e));r&&h(d.counters,e,r.startTime)}return h(d.counters,"visibilityHidden",e.visibilityHidden),h(d.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(l(e)){const t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/${t[1]}`}}}(r)),h(d.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),h(d.attributes,"fogEnabled",e.fogEnabled?"true":"false"),h(d.attributes,"projection",e.projection),h(d.attributes,"zoom",e.zoom),h(d.metadata,"devicePixelRatio",i),h(d.metadata,"connectionEffectiveType",s),h(d.metadata,"navigatorUserAgent",navigator.userAgent),h(d.metadata,"screenWidth",window.screen.width),h(d.metadata,"screenHeight",window.screen.height),h(d.metadata,"windowWidth",window.innerWidth),h(d.metadata,"windowHeight",window.innerHeight),h(d.metadata,"mapWidth",e.width/i),h(d.metadata,"mapHeight",e.height/i),h(d.metadata,"webglRenderer",e.renderer),h(d.metadata,"webglVendor",e.vendor),h(d.metadata,"sdkVersion",t),h(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(o);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(r,n,(()=>{}),e)}},bo=xo.postPerformanceEvent.bind(xo),Lo=new class extends fo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){if(!o.API_URL||!o.SESSION_PATH)return;const i=lo(o.API_URL+o.SESSION_PATH);i.params.push(`sku=${t||""}`),i.params.push(`access_token=${n||o.ACCESS_TOKEN||""}`);const a={url:co(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Xr(Qt(e,{method:"GET"}),t)}(a,(e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,o.SESSION_PATH&&o.API_URL&&(r||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(ao)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},Ao=Lo.getSessionAPI.bind(Lo),wo=new Set;var So={exports:{}},Eo={exports:{}};Eo.exports=function(e,t){var r,o,n,i,a,s,l,c;for(o=e.length-(r=3&e.length),n=t,a=3432918353,s=461845907,c=0;c<o;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(i=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0};var To=Eo.exports,Po={exports:{}};Po.exports=function(e,t){for(var r,o=e.length,n=t^o,i=0;o>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++i;switch(o){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};var Co=To,Ro=Po.exports;So.exports=Co,So.exports.murmur3=Co,So.exports.murmur2=Ro;var Mo=d(So.exports);function Io(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function Oo(e,t,r){if(r&&r[e]){const o=r[e].indexOf(t);-1!==o&&r[e].splice(o,1)}}class Do{constructor(e){Qt(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class ko extends Do{constructor(e){super("error",Qt({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class No{on(e,t){return this._listeners=this._listeners||{},Io(e,t,this._listeners),this}off(e,t){return Oo(e,t,this._listeners),Oo(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},Io(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Do(e,t||{}));const r=e.type;if(this.listens(r)){e.target=this;const t=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);const o=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const i of o)Oo(r,i,this._oneTimeListeners),i.call(this,e);const n=this._eventedParent;n&&(Qt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof ko&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}e.z=void 0;var Bo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Fo(e){return(e=Math.round(e))<0?0:e>255?255:e}function zo(e){return Fo("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Uo(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Vo(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{e.z={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in Bo)return Bo[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var o=r.indexOf("("),n=r.indexOf(")");if(-1!==o&&n+1===r.length){var i=r.substr(0,o),a=r.substr(o+1,n-(o+1)).split(","),s=1;switch(i){case"rgba":if(4!==a.length)return null;s=Uo(a.pop());case"rgb":return 3!==a.length?null:[zo(a[0]),zo(a[1]),zo(a[2]),s];case"hsla":if(4!==a.length)return null;s=Uo(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,c=Uo(a[1]),u=Uo(a[2]),d=u<=.5?u*(c+1):u+c-u*c,h=2*u-d;return[Fo(255*Vo(h,d,l+1/3)),Fo(255*Vo(h,d,l)),Fo(255*Vo(h,d,l-1/3)),s];default:return null}}return null}}catch(e){}class Ho{constructor(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=r,this.a=o}static parse(t){if(!t)return;if(t instanceof Ho)return t;if("string"!=typeof t)return;const r=e.z(t);return r?new Ho(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,t,r,o]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${o})`}toArray(){const{r:e,g:t,b:r,a:o}=this;return 0===o?[0,0,0,0]:[255*e/o,255*t/o,255*r/o,o]}toArray01(){const{r:e,g:t,b:r,a:o}=this;return 0===o?[0,0,0,0]:[e/o,t/o,r/o,o]}toArray01Scaled(e){const{r:t,g:r,b:o,a:n}=this;return 0===n?[0,0,0]:[t/n*e,r/n*e,o/n*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:r,a:o}=this;return[e,t,r,o]}toArray01Linear(){const{r:e,g:t,b:r,a:o}=this;return 0===o?[0,0,0,0]:[Math.pow(e/o,2.2),Math.pow(t/o,2.2),Math.pow(r/o,2.2),o]}}function Go(e,t,r){return e*(1-r)+t*r}function jo(e,t,r){return e.map(((e,o)=>Go(e,t[o],r)))}Ho.black=new Ho(0,0,0,1),Ho.white=new Ho(1,1,1,1),Ho.transparent=new Ho(0,0,0,0),Ho.red=new Ho(1,0,0,1),Ho.blue=new Ho(0,0,1,1);var Wo=Object.freeze({__proto__:null,array:jo,color:function(e,t,r){return new Ho(Go(e.r,t.r,r),Go(e.g,t.g,r),Go(e.b,t.b,r),Go(e.a,t.a,r))},number:Go});function Ko(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];for(const n of r)for(const t in n)e[t]=n[t];return e}class Jo extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Zo{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[r,o]of t)this.bindings[r]=o}concat(e){return new Zo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Yo={kind:"null"},qo={kind:"number"},$o={kind:"string"},Xo={kind:"boolean"},Qo={kind:"color"},en={kind:"object"},tn={kind:"value"},rn={kind:"collator"},on={kind:"formatted"},nn={kind:"resolvedImage"};function an(e,t){return{kind:"array",itemType:e,N:t}}function sn(e){if("array"===e.kind){const t=sn(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const ln=[Yo,qo,$o,Xo,Qo,on,en,an(tn),nn];function cn(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!cn(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of ln)if(!cn(e,t))return null}return`Expected ${sn(e)} but found ${sn(t)} instead.`}function un(e,t){return t.some((t=>t.kind===e.kind))}function dn(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class hn{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fn{constructor(e,t,r,o,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=o,this.textColor=n}}class mn{constructor(e){this.sections=e}static fromString(e){return new mn([new fn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof mn?e:mn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(r)}return e}}class pn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,t){return e?new pn({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function gn(e,t,r,o){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===o||"number"==typeof o&&o>=0&&o<=1?null:`Invalid rgba value [${[e,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof o?[e,t,r,o]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function _n(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Ho)return!0;if(e instanceof hn)return!0;if(e instanceof mn)return!0;if(e instanceof pn)return!0;if(Array.isArray(e)){for(const t of e)if(!_n(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!_n(e[t]))return!1;return!0}return!1}function yn(e){if(null===e)return Yo;if("string"==typeof e)return $o;if("boolean"==typeof e)return Xo;if("number"==typeof e)return qo;if(e instanceof Ho)return Qo;if(e instanceof hn)return rn;if(e instanceof mn)return on;if(e instanceof pn)return nn;if(Array.isArray(e)){const t=e.length;let r;for(const o of e){const e=yn(o);if(r){if(r===e)continue;r=tn;break}r=e}return an(r||tn,t)}return en}function vn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ho||e instanceof mn||e instanceof pn?e.toString():JSON.stringify(e)}class xn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!_n(e[1]))return t.error("invalid value");const r=e[1];let o=yn(r);const n=t.expectedType;return"array"!==o.kind||0!==o.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(o=n),new xn(o,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ho?["rgba"].concat(this.value.toArray()):this.value instanceof mn?this.value.serialize():this.value}}class bn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ln={string:$o,number:qo,boolean:Xo,object:en};class An{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,o=1;const n=e[0];if("array"===n){let n,i;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in Ln)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Ln[r],o++}else n=tn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);i=e[2],o++}r=an(n,i)}else r=Ln[n];const i=[];for(;o<e.length;o++){const r=t.parse(e[o],o,tn);if(!r)return null;i.push(r)}return new An(r,i)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!cn(this.type,yn(r)))return r;if(t===this.args.length-1)throw new bn(`Expected value to be of type ${sn(this.type)}, but found ${sn(yn(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const o=e.N;("number"==typeof o||this.args.length>1)&&t.push(o)}}return t.concat(this.args.map((e=>e.serialize())))}}class wn{constructor(e){this.type=on,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const o=[];let n=!1;for(let i=1;i<=e.length-1;++i){const r=e[i];if(n&&"object"==typeof r&&!Array.isArray(r)){n=!1;let e=null;if(r["font-scale"]&&(e=t.parse(r["font-scale"],1,qo),!e))return null;let i=null;if(r["text-font"]&&(i=t.parse(r["text-font"],1,an($o)),!i))return null;let a=null;if(r["text-color"]&&(a=t.parse(r["text-color"],1,Qo),!a))return null;const s=o[o.length-1];s.scale=e,s.font=i,s.textColor=a}else{const r=t.parse(e[i],1,tn);if(!r)return null;const a=r.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,o.push({content:r,scale:null,font:null,textColor:null})}}return new wn(o)}evaluate(e){return new mn(this.sections.map((t=>{const r=t.content.evaluate(e);return yn(r)===nn?new fn("",r,null,null,null):new fn(vn(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class Sn{constructor(e,t){this.type=nn,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const r=t.parse(e[1],1,$o);if(!r)return t.error("No image name provided.");if(2===e.length)return new Sn(r);const o=t.parse(e[2],1,$o);return o?new Sn(r,o):t.error("Secondary image variant is not a string.")}evaluate(e){const t=pn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function En(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Tn={"to-boolean":Xo,"to-color":Qo,"to-number":qo,"to-string":$o};class Pn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0],o=[];let n=Yo;if("to-array"===r){if(!Array.isArray(e[1]))return null;const r=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error(`Expected ${t.expectedType.kind} but found array.`);n=an(t.expectedType.itemType,r)}else{if(!(r>0&&_n(e[1][0])))return null;n=an(yn(e[1][0]),r)}for(let i=0;i<r;i++){const r=e[1][i];let a;if("array"===En(r))a=t.parse(r,void 0,n.itemType);else{const e=En(r);if(e!==n.itemType.kind)return t.error(`Expected ${n.itemType.kind} but found ${e}.`);a=t.registry.literal.parse(["literal",void 0===r?null:r],t)}if(!a)return null;o.push(a)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");n=Tn[r];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,tn);if(!n)return null;o.push(n)}}return new Pn(n,o)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const o of this.args){if(t=o.evaluate(e),r=null,t instanceof Ho)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:gn(t[0],t[1],t[2],t[3]),!r))return new Ho(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new bn(r||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const o=Number(t);if(!isNaN(o))return o}throw new bn(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?mn.fromString(vn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?pn.fromString(vn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):vn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new wn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Sn(this.args[0]).serialize();const e="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Cn=["Unknown","Point","LineString","Polygon"];class Rn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Cn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(o*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ho.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class Mn{constructor(e,t,r,o,n){this.name=e,this.type=t,this._evaluate=r,this.args=o,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=Mn.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const r=e[0],o=Mn.definitions[r];if(!o)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(o)?o[0]:o.type,i=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,a=[];let s=null,l=-1;for(const[c,u]of i){if(Array.isArray(c)&&c.length!==e.length-1)continue;a.push(c),l++,s=new ji(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const o=[];let i=!1;for(let t=1;t<e.length;t++){const r=e[t],n=Array.isArray(c)?c[t-1]:c.type,a=s.parse(r,1+o.length,n);if(!a){i=!0;break}o.push(a)}if(!i)if(Array.isArray(c)&&c.length!==o.length)s.error(`Expected ${c.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(c)?c[e]:c.type,r=o[e];s.concat(e+1).checkSubtype(t,r.type)}if(0===s.errors.length)return new Mn(r,n,u,o,l)}}if(1===a.length)t.errors.push(...s.errors);else{const r=(a.length?a:i.map((e=>{let[t]=e;return t}))).map(In).join(" | "),o=[];for(let n=1;n<e.length;n++){const r=t.parse(e[n],1+o.length);if(!r)return null;o.push(sn(r.type))}t.error(`Expected arguments of type ${r}, but found (${o.join(", ")}) instead.`)}return null}static register(e,t){Mn.definitions=t;for(const r in t)e[r]=Mn}}function In(e){return Array.isArray(e)?`(${e.map(sn).join(", ")})`:`(${sn(e.type)}...)`}class On{constructor(e,t,r){this.type=rn,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const o=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Xo);if(!o)return null;const n=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Xo);if(!n)return null;let i=null;return r.locale&&(i=t.parse(r.locale,1,$o),!i)?null:new On(o,n,i)}evaluate(e){return new hn(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Dn={exports:{}};Dn.exports=function(){function e(r,o,n,i,a){for(;i>n;){if(i-n>600){var s=i-n+1,l=o-n+1,c=Math.log(s),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(s-u)/s)*(l-s/2<0?-1:1);e(r,o,Math.max(n,Math.floor(o-l*u/s+d)),Math.min(i,Math.floor(o+(s-l)*u/s+d)),a)}var h=r[o],f=n,m=i;for(t(r,n,o),a(r[i],h)>0&&t(r,n,i);f<m;){for(t(r,f,m),f++,m--;a(r[f],h)<0;)f++;for(;a(r[m],h)>0;)m--}0===a(r[n],h)?t(r,n,m):t(r,++m,i),m<=o&&(n=m+1),o<=m&&(i=m-1)}}function t(e,t,r){var o=e[t];e[t]=e[r],e[r]=o}function r(e,t){return e<t?-1:e>t?1:0}return function(t,o,n,i,a){e(t,o,n||0,i||t.length-1,a||r)}}();var kn=d(Dn.exports);function Nn(e){let t=0;for(let r,o,n=0,i=e.length,a=i-1;n<i;a=n++)r=e[n],o=e[a],t+=(o.x-r.x)*(r.y+o.y);return t}function Bn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Fn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function zn(e,t,r){const o=e[0]-t[0],n=e[1]-t[1],i=e[0]-r[0],a=e[1]-r[1];return o*a-i*n==0&&o*i<=0&&n*a<=0}function Un(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,c=s-1;t<s;c=t++){const s=l[c],u=l[t];if(zn(e,s,u))return r;(i=s)[1]>(n=e)[1]!=(a=u)[1]>n[1]&&n[0]<(a[0]-i[0])*(n[1]-i[1])/(a[1]-i[1])+i[0]&&(o=!o)}}var n,i,a;return o}function Vn(e,t,r,o){const n=o[0]-r[0],i=o[1]-r[1],a=(e[0]-r[0])*i-n*(e[1]-r[1]),s=(t[0]-r[0])*i-n*(t[1]-r[1]);return a>0&&s<0||a<0&&s>0}function Hn(e,t,r,o){return 0!=(n=[o[0]-r[0],o[1]-r[1]])[0]*(i=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*i[0]&&!(!Vn(e,t,r,o)||!Vn(r,o,e,t));var n,i}const Gn=8192;function jn(e,t){const r=(180+e[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(r*n*Gn),Math.round(o*n*Gn)]}function Wn(e,t){for(let r=0;r<t.length;r++)if(Un(e,t[r]))return!0;return!1}function Kn(e,t,r){for(const o of r)for(let r=0,n=o.length,i=n-1;r<n;i=r++)if(Hn(e,t,o[i],o[r]))return!0;return!1}function Jn(e,t){for(let r=0;r<e.length;++r)if(!Un(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(Kn(e[r],e[r+1],t))return!1;return!0}function Zn(e,t){for(let r=0;r<t.length;r++)if(Jn(e,t[r]))return!0;return!1}function Yn(e,t,r){const o=[];for(let n=0;n<e.length;n++){const i=[];for(let o=0;o<e[n].length;o++){const a=jn(e[n][o],r);Bn(t,a),i.push(a)}o.push(i)}return o}function qn(e,t,r){const o=[];for(let n=0;n<e.length;n++){const i=Yn(e[n],t,r);o.push(i)}return o}function $n(e,t,r,o){if(e[0]<r[0]||e[0]>r[2]){const t=.5*o;let n=e[0]-r[0]>t?-o:r[0]-e[0]>t?o:0;0===n&&(n=e[0]-r[2]>t?-o:r[2]-e[0]>t?o:0),e[0]+=n}Bn(t,e)}function Xn(e,t,r,o){const n=Math.pow(2,o.z)*Gn,i=[o.x*Gn,o.y*Gn],a=[];if(!e)return a;for(const s of e)for(const e of s){const o=[e.x+i[0],e.y+i[1]];$n(o,t,r,n),a.push(o)}return a}function Qn(e,t,r,o){const n=Math.pow(2,o.z)*Gn,i=[o.x*Gn,o.y*Gn],a=[];if(!e)return a;for(const l of e){const e=[];for(const r of l){const o=[r.x+i[0],r.y+i[1]];Bn(t,o),e.push(o)}a.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const o of e)$n(o,t,r,n)}var s;return a}class ei{constructor(e,t){this.type=Xo,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(_n(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new ei(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ei(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ei(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const i=Yn(t.coordinates,o,n),a=Xn(e.geometry(),r,o,n);if(!Fn(r,o))return!1;for(const e of a)if(!Un(e,i))return!1}if("MultiPolygon"===t.type){const i=qn(t.coordinates,o,n),a=Xn(e.geometry(),r,o,n);if(!Fn(r,o))return!1;for(const e of a)if(!Wn(e,i))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const i=Yn(t.coordinates,o,n),a=Qn(e.geometry(),r,o,n);if(!Fn(r,o))return!1;for(const e of a)if(!Jn(e,i))return!1}if("MultiPolygon"===t.type){const i=qn(t.coordinates,o,n),a=Qn(e.geometry(),r,o,n);if(!Fn(r,o))return!1;for(const e of a)if(!Zn(e,i))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ti={exports:{}};!function(e){e.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,r=t*(2-t),o=Math.PI/180,n=function(t,n){if(void 0===t)throw new Error("No latitude given.");if(n&&!e[n])throw new Error("Unknown unit "+n+". Use one of: "+Object.keys(e).join(", "));var i=6378.137*o*(n?e[n]:1),a=Math.cos(t*o),s=1/(1-r*(1-a*a)),l=Math.sqrt(s);this.kx=i*l*a,this.ky=i*l*s*(1-r)},i={units:{configurable:!0}};function a(e,t){return e[0]===t[0]&&e[1]===t[1]}function s(e,t,r){var o=l(t[0]-e[0]);return[e[0]+o*r,e[1]+(t[1]-e[1])*r]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return n.fromTile=function(e,t,r){var i=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),a=Math.atan(.5*(Math.exp(i)-Math.exp(-i)))/o;return new n(a,r)},i.units.get=function(){return e},n.prototype.distance=function(e,t){var r=l(e[0]-t[0])*this.kx,o=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+o*o)},n.prototype.bearing=function(e,t){var r=l(t[0]-e[0])*this.kx;return Math.atan2(r,(t[1]-e[1])*this.ky)/o},n.prototype.destination=function(e,t,r){var n=r*o;return this.offset(e,Math.sin(n)*t,Math.cos(n)*t)},n.prototype.offset=function(e,t,r){return[e[0]+t/this.kx,e[1]+r/this.ky]},n.prototype.lineDistance=function(e){for(var t=0,r=0;r<e.length-1;r++)t+=this.distance(e[r],e[r+1]);return t},n.prototype.area=function(e){for(var t=0,r=0;r<e.length;r++)for(var o=e[r],n=0,i=o.length,a=i-1;n<i;a=n++)t+=l(o[n][0]-o[a][0])*(o[n][1]+o[a][1])*(r?-1:1);return Math.abs(t)/2*this.kx*this.ky},n.prototype.along=function(e,t){var r=0;if(t<=0)return e[0];for(var o=0;o<e.length-1;o++){var n=e[o],i=e[o+1],a=this.distance(n,i);if((r+=a)>t)return s(n,i,(t-(r-a))/a)}return e[e.length-1]},n.prototype.pointToSegmentDistance=function(e,t,r){var o=t[0],n=t[1],i=l(r[0]-o)*this.kx,a=(r[1]-n)*this.ky,s=0;return 0===i&&0===a||((s=(l(e[0]-o)*this.kx*i+(e[1]-n)*this.ky*a)/(i*i+a*a))>1?(o=r[0],n=r[1]):s>0&&(o+=i/this.kx*s,n+=a/this.ky*s)),i=l(e[0]-o)*this.kx,a=(e[1]-n)*this.ky,Math.sqrt(i*i+a*a)},n.prototype.pointOnLine=function(e,t){for(var r,o,n,i,a=1/0,s=0;s<e.length-1;s++){var c=e[s][0],u=e[s][1],d=l(e[s+1][0]-c)*this.kx,h=(e[s+1][1]-u)*this.ky,f=0;0===d&&0===h||((f=(l(t[0]-c)*this.kx*d+(t[1]-u)*this.ky*h)/(d*d+h*h))>1?(c=e[s+1][0],u=e[s+1][1]):f>0&&(c+=d/this.kx*f,u+=h/this.ky*f));var m=(d=l(t[0]-c)*this.kx)*d+(h=(t[1]-u)*this.ky)*h;m<a&&(a=m,r=c,o=u,n=s,i=f)}return{point:[r,o],index:n,t:Math.max(0,Math.min(1,i))}},n.prototype.lineSlice=function(e,t,r){var o=this.pointOnLine(r,e),n=this.pointOnLine(r,t);if(o.index>n.index||o.index===n.index&&o.t>n.t){var i=o;o=n,n=i}var s=[o.point],l=o.index+1,c=n.index;!a(r[l],s[0])&&l<=c&&s.push(r[l]);for(var u=l+1;u<=c;u++)s.push(r[u]);return a(r[c],n.point)||s.push(n.point),s},n.prototype.lineSliceAlong=function(e,t,r){for(var o=0,n=[],i=0;i<r.length-1;i++){var a=r[i],l=r[i+1],c=this.distance(a,l);if((o+=c)>e&&0===n.length&&n.push(s(a,l,(e-(o-c))/c)),o>=t)return n.push(s(a,l,(t-(o-c))/c)),n;o>e&&n.push(l)}return n},n.prototype.bufferPoint=function(e,t){var r=t/this.ky,o=t/this.kx;return[e[0]-o,e[1]-r,e[0]+o,e[1]+r]},n.prototype.bufferBBox=function(e,t){var r=t/this.ky,o=t/this.kx;return[e[0]-o,e[1]-r,e[2]+o,e[3]+r]},n.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(n,i),n}()}(ti);var ri=d(ti.exports),oi={exports:{}};!function(e){e.exports=function(){var e=function(e,r){if(void 0===e&&(e=[]),void 0===r&&(r=t),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,r=this.compare,o=t[e];e>0;){var n=e-1>>1,i=t[n];if(r(o,i)>=0)break;t[e]=i,e=n}t[e]=o},e.prototype._down=function(e){for(var t=this.data,r=this.compare,o=this.length>>1,n=t[e];e<o;){var i=1+(e<<1),a=t[i],s=i+1;if(s<this.length&&r(t[s],a)<0&&(i=s,a=t[s]),r(a,n)>=0)break;t[e]=a,e=i}t[e]=n},e}()}(oi);var ni=d(oi.exports),ii=8192;function ai(e,t){return t.dist-e.dist}const si=100,li=50;function ci(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ui(e){return e[1]-e[0]+1}function di(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function hi(e,t){if(e[0]>e[1])return[null,null];const r=ui(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===r)return[e,null];const t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function fi(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!di(t,e.length))return r;for(let o=t[0];o<=t[1];++o)Bn(r,e[o]);return r}function mi(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let o=0;o<e[r].length;++o)Bn(t,e[r][o]);return t}function pi(e,t,r){if(ci(e)||ci(t))return NaN;let o=0,n=0;return e[2]<t[0]&&(o=t[0]-e[2]),e[0]>t[2]&&(o=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),r.distance([0,0],[o,n])}function gi(e){return 360*e-180}function _i(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function yi(e,t){const r=Math.pow(2,t.z),o=(e.y/ii+t.y)/r;return[gi((e.x/ii+t.x)/r),_i(o)]}function vi(e,t){const r=[];for(let o=0;o<e.length;++o)r.push(yi(e[o],t));return r}function xi(e,t,r){const o=r.pointOnLine(t,e).point;return r.distance(e,o)}function bi(e,t,r,o,n){const i=r.slice(o[0],o[1]+1);let a=1/0;for(let s=t[0];s<=t[1];++s)if(0===(a=Math.min(a,xi(e[s],i,n))))return 0;return a}function Li(e,t,r,o,n){const i=Math.min(n.pointToSegmentDistance(e,r,o),n.pointToSegmentDistance(t,r,o)),a=Math.min(n.pointToSegmentDistance(r,e,t),n.pointToSegmentDistance(o,e,t));return Math.min(i,a)}function Ai(e,t,r,o,n){if(!di(t,e.length)||!di(o,r.length))return NaN;let i=1/0;for(let a=t[0];a<t[1];++a)for(let t=o[0];t<o[1];++t){if(Hn(e[a],e[a+1],r[t],r[t+1]))return 0;i=Math.min(i,Li(e[a],e[a+1],r[t],r[t+1],n))}return i}function wi(e,t,r,o,n){if(!di(t,e.length)||!di(o,r.length))return NaN;let i=1/0;for(let a=t[0];a<=t[1];++a)for(let t=o[0];t<=o[1];++t)if(0===(i=Math.min(i,n.distance(e[a],r[t]))))return i;return i}function Si(e,t,r){if(Un(e,t,!0))return 0;let o=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(o=Math.min(o,r.pointToSegmentDistance(e,n[t-1],n[0]))))return o;if(0===(o=Math.min(o,xi(e,n,r))))return o}return o}function Ei(e,t,r,o){if(!di(t,e.length))return NaN;for(let i=t[0];i<=t[1];++i)if(Un(e[i],r,!0))return 0;let n=1/0;for(let i=t[0];i<t[1];++i)for(const t of r)for(let r=0,a=t.length,s=a-1;r<a;s=r++){if(Hn(e[i],e[i+1],t[s],t[r]))return 0;n=Math.min(n,Li(e[i],e[i+1],t[s],t[r],o))}return n}function Ti(e,t){for(const r of e)for(let e=0;e<=r.length-1;++e)if(Un(r[e],t,!0))return!0;return!1}function Pi(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const n=mi(e),i=mi(t);if(o!==1/0&&pi(n,i,r)>=o)return o;if(Fn(n,i)){if(Ti(e,t))return 0}else if(Ti(t,e))return 0;let a=o;for(const s of e)for(let e=0,o=s.length,n=o-1;e<o;n=e++)for(const i of t)for(let t=0,o=i.length,l=o-1;t<o;l=t++){if(Hn(s[n],s[e],i[l],i[t]))return 0;a=Math.min(a,Li(s[n],s[e],i[l],i[t],r))}return a}function Ci(e,t,r,o,n,i,a){if(null===i||null===a)return;const s=pi(fi(o,i),fi(n,a),r);s<t&&e.push({dist:s,range1:i,range2:a})}function Ri(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,i=Math.min(o.distance(e[0],r[0][0]),n);if(0===i)return i;const a=new ni([{dist:0,range1:[0,e.length-1],range2:[0,0]}],ai),s=t?li:si,l=mi(r);for(;a.length;){const n=a.pop();if(n.dist>=i)continue;const c=n.range1;if(ui(c)<=s){if(!di(c,e.length))return NaN;if(t){const t=Ei(e,c,r,o);if(0===(i=Math.min(i,t)))return i}else for(let t=c[0];t<=c[1];++t){const n=Si(e[t],r,o);if(0===(i=Math.min(i,n)))return i}}else{const r=hi(c,t);if(null!==r[0]){const t=pi(fi(e,r[0]),l,o);t<i&&a.push({dist:t,range1:r[0],range2:[0,0]})}if(null!==r[1]){const t=pi(fi(e,r[1]),l,o);t<i&&a.push({dist:t,range1:r[1],range2:[0,0]})}}}return i}function Mi(e,t,r,o,n){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=Math.min(i,n.distance(e[0],r[0]));if(0===a)return a;const s=new ni([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],ai),l=t?li:si,c=o?li:si;for(;s.length;){const i=s.pop();if(i.dist>=a)continue;const u=i.range1,d=i.range2;if(ui(u)<=l&&ui(d)<=c){if(!di(u,e.length)||!di(d,r.length))return NaN;if(t&&o?a=Math.min(a,Ai(e,u,r,d,n)):t||o?t&&!o?a=Math.min(a,bi(r,d,e,u,n)):!t&&o&&(a=Math.min(a,bi(e,u,r,d,n))):a=Math.min(a,wi(e,u,r,d,n)),0===a)return a}else{const i=hi(u,t),l=hi(d,o);Ci(s,a,n,e,r,i[0],l[0]),Ci(s,a,n,e,r,i[0],l[1]),Ci(s,a,n,e,r,i[1],l[0]),Ci(s,a,n,e,r,i[1],l[1])}}return a}function Ii(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const i=fi(e,[0,e.length-1]);for(const a of r)if(!(n!==1/0&&pi(i,fi(a,[0,a.length-1]),o)>=n)&&(n=Math.min(n,Mi(e,t,a,!0,o,n)),0===n))return n;return n}function Oi(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const i=fi(e,[0,e.length-1]);for(const a of r){if(n!==1/0&&pi(i,mi(a),o)>=n)continue;const r=Ri(e,t,a,o,n);if(isNaN(r))return r;if(0===(n=Math.min(n,r)))return n}return n}function Di(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class ki{constructor(e,t){this.type=qo,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(_n(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(Di(t.features[e].geometry.type))return new ki(t,t.features[e].geometry)}else if("Feature"===t.type){if(Di(t.geometry.type))return new ki(t,t.geometry)}else if(Di(t.type))return new ki(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),r=e.canonicalID();if(null!=t&&null!=r){if("Point"===e.geometryType())return function(e,t,r){const o=[];for(const i of e)for(const e of i)o.push(yi(e,t));const n=new ri(o[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?Mi(o,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n):"MultiLineString"===r.type?Ii(o,!1,r.coordinates,n):"Polygon"===r.type||"MultiPolygon"===r.type?Oi(o,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,n):null}(t,r,this.geometries);if("LineString"===e.geometryType())return function(e,t,r){const o=[];for(const i of e){const e=[];for(const r of i)e.push(yi(r,t));o.push(e)}const n=new ri(o[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Ii("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,o,n);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const i=Ii(r.coordinates[t],!0,o,n,e);if(isNaN(i))return i;if(0===(e=Math.min(e,i)))return e}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let t=0;t<o.length;t++){const i=Oi(o[t],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,n,e);if(isNaN(i))return i;if(0===(e=Math.min(e,i)))return e}return e}return null}(t,r,this.geometries);if("Polygon"===e.geometryType())return function(e,t,r){const o=[];for(const i of function(e){const t=e.length;if(t<=1)return[e];const r=[];let o,n;for(let i=0;i<t;i++){const t=Nn(e[i]);0!==t&&(e[i].area=Math.abs(t),void 0===n&&(n=t<0),n===t<0?(o&&r.push(o),o=[e[i]]):o.push(e[i]))}return o&&r.push(o),r}(e)){const e=[];for(let r=0;r<i.length;++r)e.push(vi(i[r],t));o.push(e)}const n=new ri(o[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Oi("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,o,n);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const i=Oi(r.coordinates[t],!0,o,n,e);if(isNaN(i))return i;if(0===(e=Math.min(e,i)))return e}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,t,r){let o=1/0;for(const n of e)for(const e of t){const t=Pi(n,e,r,o);if(isNaN(t))return t;if(0===(o=Math.min(o,t)))return o}return o}("Polygon"===r.type?[r.coordinates]:r.coordinates,o,n):null}(t,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ni(e,t){switch(e){case"string":return vn(t);case"number":return+t;case"boolean":return!!t;case"color":return Ho.parse(t);case"formatted":return mn.fromString(vn(t));case"resolvedImage":return pn.fromString(vn(t))}return t}function Bi(e,t,r,o){return void 0!==o&&(e=o*Math.round(e/o)),void 0!==t&&e<t&&(e=t),void 0!==r&&e>r&&(e=r),e}class Fi{constructor(e,t,r){this.type=e,this.key=t,this.scope=r}static parse(e,t){let r=t.expectedType;if(null==r&&(r=tn),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const o=t.parse(e[1],1);if(!(o instanceof xn))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const n=t.parse(e[2],2);return n instanceof xn?new Fi(r,vn(o.value),vn(n.value)):t.error("Scope of 'config' expression must be a string literal.")}return new Fi(r,vn(o.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),r=e.getConfig(t);if(!r)return null;const{type:o,value:n,values:i,minValue:a,maxValue:s,stepValue:l}=r,c=r.default.evaluate(e);let u=c;if(n){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),u=n.evaluate(e),e.scope=t}return o&&(u=Ni(o,u)),void 0===u||void 0===a&&void 0===s&&void 0===l||("number"==typeof u?u=Bi(u,a,s,l):Array.isArray(u)&&(u=u.map((e=>"number"==typeof e?Bi(e,a,s,l):e)))),void 0!==n&&void 0!==u&&i&&!i.includes(u)&&(u=c,o&&(u=Ni(o,u))),(o&&o!==this.type||void 0!==u&&yn(u)!==this.type)&&(u=Ni(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function zi(e){if(e instanceof Mn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof ei)return!1;if(e instanceof ki)return!1;let t=!0;return e.eachChild((e=>{t&&!zi(e)&&(t=!1)})),t}function Ui(e){if(e instanceof Mn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ui(e)&&(t=!1)})),t}function Vi(e){if(e instanceof Fi)return!1;let t=!0;return e.eachChild((e=>{t&&!Vi(e)&&(t=!1)})),t}function Hi(e,t){if(e instanceof Mn&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Hi(e,t)&&(r=!1)})),r}class Gi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Gi(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ji{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Zo,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=o,this.errors=n,this.expectedType=r,this._scope=i,this.options=a}parse(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||r?this.concat(t,r,o)._parse(e,n):this._parse(e,n)}_parse(e,t){function r(e,t,r){return"assert"===r?new An(t,[e]):"coerce"===r?new Pn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o="string"==typeof e[0]?this.registry[e[0]]:void 0;if(o){let n=o.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,o=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==o.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==o.kind&&"string"!==o.kind){if(this.checkSubtype(e,o))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof xn)&&"resolvedImage"!==n.type.kind&&Wi(n)){const t=new Rn(this._scope,this.options);try{n=new xn(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return Pn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const o="number"==typeof e?this.path.concat(e):this.path,n=r?this.scope.concat(r):this.scope;return new ji(this.registry,o,t||null,n,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];const n=`${this.key}${r.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Jo(n,e))}checkSubtype(e,t){const r=cn(e,t);return r&&this.error(r),r}}function Wi(e){if(e instanceof Gi)return Wi(e.boundExpression);if(e instanceof Mn&&"error"===e.name)return!1;if(e instanceof On)return!1;if(e instanceof ei)return!1;if(e instanceof ki)return!1;if(e instanceof Fi)return!1;const t=e instanceof Pn||e instanceof An;let r=!0;return e.eachChild((e=>{r=t?r&&Wi(e):r&&e instanceof xn})),!!r&&zi(e)&&Hi(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ki(e,t){const r=e.length-1;let o,n,i=0,a=r,s=0;for(;i<=a;)if(s=Math.floor((i+a)/2),o=e[s],n=e[s+1],o<=t){if(s===r||t<n)return s;i=s+1}else{if(!(o>t))throw new bn("Input is not a number.");a=s-1}return 0}class Ji{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[o,n]of r)this.labels.push(o),this.outputs.push(n)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,qo);if(!r)return null;const o=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const r=1===i?-1/0:e[i],a=e[i+1],s=i,l=i+1;if("number"!=typeof r)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(o.length&&o[o.length-1][0]>=r)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,n);if(!c)return null;n=n||c.type,o.push([r,c])}return new Ji(n,r,o)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=t[0])return r[0].evaluate(e);const n=t.length;return o>=t[n-1]?r[n-1].evaluate(e):r[Ki(t,o)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Zi=.95047,Yi=1.08883,qi=4/29,$i=6/29,Xi=3*$i*$i,Qi=$i*$i*$i,ea=Math.PI/180,ta=180/Math.PI;function ra(e){return e>Qi?Math.pow(e,1/3):e/Xi+qi}function oa(e){return e>$i?e*e*e:Xi*(e-qi)}function na(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ia(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function aa(e){const t=ia(e.r),r=ia(e.g),o=ia(e.b),n=ra((.4124564*t+.3575761*r+.1804375*o)/Zi),i=ra((.2126729*t+.7151522*r+.072175*o)/1);return{l:116*i-16,a:500*(n-i),b:200*(i-ra((.0193339*t+.119192*r+.9503041*o)/Yi)),alpha:e.a}}function sa(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,o=isNaN(e.b)?t:t-e.b/200;return t=1*oa(t),r=Zi*oa(r),o=Yi*oa(o),new Ho(na(3.2404542*r-1.5371385*t-.4985314*o),na(-.969266*r+1.8760108*t+.041556*o),na(.0556434*r-.2040259*t+1.0572252*o),e.alpha)}function la(e,t,r){const o=t-e;return e+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const ca={forward:aa,reverse:sa,interpolate:function(e,t,r){return{l:Go(e.l,t.l,r),a:Go(e.a,t.a,r),b:Go(e.b,t.b,r),alpha:Go(e.alpha,t.alpha,r)}}},ua={forward:function(e){const{l:t,a:r,b:o}=aa(e),n=Math.atan2(o,r)*ta;return{h:n<0?n+360:n,c:Math.sqrt(r*r+o*o),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ea,r=e.c;return sa({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:la(e.h,t.h,r),c:Go(e.c,t.c,r),l:Go(e.l,t.l,r),alpha:Go(e.alpha,t.alpha,r)}}};var da=Object.freeze({__proto__:null,hcl:ua,lab:ca});class ha{constructor(e,t,r,o,n){this.type=e,this.operator=t,this.interpolation=r,this.input=o,this.labels=[],this.outputs=[];for(const[i,a]of n)this.labels.push(i),this.outputs.push(a)}static interpolationFactor(e,t,r,o){let n=0;if("exponential"===e.name)n=fa(t,e.base,r,o);else if("linear"===e.name)n=fa(t,1,r,o);else if("cubic-bezier"===e.name){const i=e.controlPoints;n=new Bt(i[0],i[1],i[2],i[3]).solve(fa(t,1,r,o))}return n}static parse(e,t){let[r,o,n,...i]=e;if(!Array.isArray(o)||0===o.length)return t.error("Expected an interpolation type expression.",1);if("linear"===o[0])o={name:"linear"};else if("exponential"===o[0]){const e=o[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:e}}else{if("cubic-bezier"!==o[0])return t.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const e=o.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,qo),!n)return null;const a=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=Qo:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<i.length;l+=2){const e=i[l],r=i[l+1],o=l+3,n=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',o);const c=t.parse(r,n,s);if(!c)return null;s=s||c.type,a.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new ha(s,r,o,n,a):t.error(`Type ${sn(s)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=t[0])return r[0].evaluate(e);const n=t.length;if(o>=t[n-1])return r[n-1].evaluate(e);const i=Ki(t,o),a=ha.interpolationFactor(this.interpolation,o,t[i],t[i+1]),s=r[i].evaluate(e),l=r[i+1].evaluate(e);return"interpolate"===this.operator?Wo[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?ua.reverse(ua.interpolate(ua.forward(s),ua.forward(l),a)):ca.reverse(ca.interpolate(ca.forward(s),ca.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function fa(e,t,r,o){const n=o-r,i=e-r;return 0===n?0:1===t?i/n:(Math.pow(t,i)-1)/(Math.pow(t,n)-1)}class ma{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const o=t.expectedType;o&&"value"!==o.kind&&(r=o);const n=[];for(const a of e.slice(1)){const e=t.parse(a,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,n.push(e)}const i=o&&n.some((e=>cn(o,e.type)));return new ma(i?tn:r,n)}evaluate(e){let t,r=null,o=0;for(const n of this.args){if(o++,r=n.evaluate(e),r&&r instanceof pn&&!r.available&&(t||(t=r),r=null,o===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class pa{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const o=e[n];if("string"!=typeof o)return t.error(`Expected string, but found ${typeof o} instead.`,n);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const i=t.parse(e[n+1],n+1);if(!i)return null;r.push([o,i])}const o=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return o?new pa(r,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}class ga{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,qo),o=t.parse(e[2],2,an(t.expectedType||tn));return r&&o?new ga(o.type.itemType,r,o):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new bn(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new bn(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new bn(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _a{constructor(e,t){this.type=Xo,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,tn),o=t.parse(e[2],2,tn);return r&&o?un(r.type,[Xo,$o,qo,Yo,tn])?new _a(r,o):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!dn(t,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(yn(t))} instead.`);if(!dn(r,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${sn(yn(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ya{constructor(e,t,r){this.type=qo,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,tn),o=t.parse(e[2],2,tn);if(!r||!o)return null;if(!un(r.type,[Xo,$o,qo,Yo,tn]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(r.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,qo);return n?new ya(r,o,n):null}return new ya(r,o)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!dn(t,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${sn(yn(t))} instead.`);if(!dn(r,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${sn(yn(r))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return r.indexOf(t,o)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class va{constructor(e,t,r,o,n,i){this.inputType=e,this.type=t,this.input=r,this.cases=o,this.outputs=n,this.otherwise=i}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,o;t.expectedType&&"value"!==t.expectedType.kind&&(o=t.expectedType);const n={},i=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const s=e[l+1];Array.isArray(a)||(a=[a]);const c=t.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,yn(e)))return null}else r=yn(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=i.length}const u=t.parse(s,l,o);if(!u)return null;o=o||u.type,i.push(u)}const a=t.parse(e[1],1,tn);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,o);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(r,a.type)?null:new va(r,o,a,n,i,s):null}evaluate(e){const t=this.input.evaluate(e);return(yn(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],o={};for(const i of t){const e=o[this.cases[i]];void 0===e?(o[this.cases[i]]=r.length,r.push([this.cases[i],[i]])):r[e][1].push(i)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[i,a]of r)e.push(1===a.length?n(a[0]):a.map(n)),e.push(this.outputs[i].serialize());return e.push(this.otherwise.serialize()),e}}class xa{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const o=[];for(let i=1;i<e.length-1;i+=2){const n=t.parse(e[i],i,Xo);if(!n)return null;const a=t.parse(e[i+1],i+1,r);if(!a)return null;o.push([n,a]),r=r||a.type}const n=t.parse(e[e.length-1],e.length-1,r);return n?new xa(r,o,n):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((e=>{let[t,r]=e;return r.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class ba{constructor(e,t,r,o){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=o}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,tn),o=t.parse(e[2],2,qo);if(!r||!o)return null;if(!un(r.type,[an(tn),$o,tn]))return t.error(`Expected first argument to be of type array or string, but found ${sn(r.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,qo);return n?new ba(r.type,r,o,n):null}return new ba(r.type,r,o)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!dn(t,["string","array"]))throw new bn(`Expected first argument to be of type array or string, but found ${sn(yn(t))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return t.slice(r,o)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function La(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Aa(e,t,r,o){return 0===o.compare(t,r)}function wa(e,t,r){const o="=="!==e&&"!="!==e;return class n{constructor(e,t,r){this.type=Xo,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let i=t.parse(e[1],1,tn);if(!i)return null;if(!La(r,i.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${sn(i.type)}'.`);let a=t.parse(e[2],2,tn);if(!a)return null;if(!La(r,a.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${sn(a.type)}'.`);if(i.type.kind!==a.type.kind&&"value"!==i.type.kind&&"value"!==a.type.kind)return t.error(`Cannot compare types '${sn(i.type)}' and '${sn(a.type)}'.`);o&&("value"===i.type.kind&&"value"!==a.type.kind?i=new An(a.type,[i]):"value"!==i.type.kind&&"value"===a.type.kind&&(a=new An(i.type,[a])));let s=null;if(4===e.length){if("string"!==i.type.kind&&"string"!==a.type.kind&&"value"!==i.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,rn),!s)return null}return new n(i,a,s)}evaluate(n){const i=this.lhs.evaluate(n),a=this.rhs.evaluate(n);if(o&&this.hasUntypedArgument){const t=yn(i),r=yn(a);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new bn(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const e=yn(i),r=yn(a);if("string"!==e.kind||"string"!==r.kind)return t(n,i,a)}return this.collator?r(n,i,a,this.collator.evaluate(n)):t(n,i,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Sa=wa("==",(function(e,t,r){return t===r}),Aa),Ea=wa("!=",(function(e,t,r){return t!==r}),(function(e,t,r,o){return!Aa(0,t,r,o)})),Ta=wa("<",(function(e,t,r){return t<r}),(function(e,t,r,o){return o.compare(t,r)<0})),Pa=wa(">",(function(e,t,r){return t>r}),(function(e,t,r,o){return o.compare(t,r)>0})),Ca=wa("<=",(function(e,t,r){return t<=r}),(function(e,t,r,o){return o.compare(t,r)<=0})),Ra=wa(">=",(function(e,t,r){return t>=r}),(function(e,t,r,o){return o.compare(t,r)>=0}));class Ma{constructor(e,t,r,o,n,i){this.type=$o,this.number=e,this.locale=t,this.currency=r,this.unit=o,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,qo);if(!r)return null;const o=e[2];if("object"!=typeof o||Array.isArray(o))return t.error("NumberFormat options argument must be an object.");let n=null;if(o.locale&&(n=t.parse(o.locale,1,$o),!n))return null;let i=null;if(o.currency&&(i=t.parse(o.currency,1,$o),!i))return null;let a=null;if(o.unit&&(a=t.parse(o.unit,1,$o),!a))return null;let s=null;if(o["min-fraction-digits"]&&(s=t.parse(o["min-fraction-digits"],1,qo),!s))return null;let l=null;return o["max-fraction-digits"]&&(l=t.parse(o["max-fraction-digits"],1,qo),!l)?null:new Ma(r,n,i,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ia{constructor(e){this.type=qo,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${sn(r.type)} instead.`):new Ia(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new bn(`Expected value to be of type string or array, but found ${sn(yn(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function Oa(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Da={"==":Sa,"!=":Ea,">":Pa,"<":Ta,">=":Ra,"<=":Ca,array:An,at:ga,boolean:An,case:xa,coalesce:ma,collator:On,format:wn,image:Sn,in:_a,"index-of":ya,interpolate:ha,"interpolate-hcl":ha,"interpolate-lab":ha,length:Ia,let:pa,literal:xn,match:va,number:An,"number-format":Ma,object:An,slice:ba,step:Ji,string:An,"to-boolean":Pn,"to-color":Pn,"to-number":Pn,"to-string":Pn,var:Gi,within:ei,distance:ki,config:Fi};function ka(e,t){let[r,o,n,i]=t;r=r.evaluate(e),o=o.evaluate(e),n=n.evaluate(e);const a=i?i.evaluate(e):1,s=gn(r,o,n,a);if(s)throw new bn(s);return new Ho(r/255*a,o/255*a,n/255*a,a)}function Na(e,t){let[r,o,n,i]=t;r=r.evaluate(e),o=o.evaluate(e),n=n.evaluate(e);const a=i?i.evaluate(e):1,s=function(e,t,r,o){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===o||"number"==typeof o&&o>=0&&o<=1?null:`Invalid hsla value [${[e,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof o?[e,t,r,o]:[e,t,r]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof o?[e,t,r,o]:[e,t,r]).join(", ")}]: 'h' must be between 0 and 360.`}(r,o,n,a);if(s)throw new bn(s);const l=`hsla(${r}, ${o}%, ${n}%, ${a})`,c=Ho.parse(l);if(!c)throw new bn(`Failed to parse HSLA color: ${l}`);return c}function Ba(e,t){return e in t}function Fa(e,t){const r=t[e];return void 0===r?null:r}function za(e){return{type:e}}function Ua(e){return{result:"success",value:e}}function Va(e){return{result:"error",value:e}}function Ha(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Ga(e){return"data-driven"===e["property-type"]}function ja(e){return Ha(e.expression,"measure-light")}function Wa(e){return Ha(e.expression,"zoom")}function Ka(e){return!!e.expression&&e.expression.interpolated}function Ja(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Za(e){return e}function Ya(e,t){const r="color"===t.type,o=e.stops&&"object"==typeof e.stops[0][0],n=o||!(o||void 0!==e.property),i=e.type||(Ka(t)?"exponential":"interval");if(r&&((e=Ko({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],Ho.parse(e[1])]))),e.default=Ho.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!da[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let a,s,l;if("exponential"===i)a=Qa;else if("interval"===i)a=Xa;else if("categorical"===i){a=$a,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==i)throw new Error(`Unknown function type "${i}"`);a=es}if(o){const r={},o=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],i=n[0].zoom;void 0===r[i]&&(r[i]={zoom:i,type:e.type,property:e.property,default:e.default,stops:[]},o.push(i)),r[i].stops.push([n[0].value,n[1]])}const n=[];for(const e of o)n.push([r[e].zoom,Ya(r[e],t)]);const i={name:"linear"};return{kind:"composite",interpolationType:i,interpolationFactor:ha.interpolationFactor.bind(void 0,i),zoomStops:n.map((e=>e[0])),evaluate:(r,o)=>{let{zoom:i}=r;return Qa({stops:n,base:e.base},t,i).evaluate(i,o)}}}if(n){const r="exponential"===i?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:ha.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:r=>{let{zoom:o}=r;return a(e,t,o,s,l)}}}return{kind:"source",evaluate(r,o){const n=o&&o.properties?o.properties[e.property]:void 0;return void 0===n?qa(e.default,t.default):a(e,t,n,s,l)}}}function qa(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function $a(e,t,r,o,n){return qa(typeof r===n?o[r]:void 0,e.default,t.default)}function Xa(e,t,r){if("number"!==En(r))return qa(e.default,t.default);const o=e.stops.length;if(1===o)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[o-1][0])return e.stops[o-1][1];const n=Ki(e.stops.map((e=>e[0])),r);return e.stops[n][1]}function Qa(e,t,r){const o=void 0!==e.base?e.base:1;if("number"!==En(r))return qa(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=Ki(e.stops.map((e=>e[0])),r),a=function(e,t,r,o){const n=o-r,i=e-r;return 0===n?0:1===t?i/n:(Math.pow(t,i)-1)/(Math.pow(t,n)-1)}(r,o,e.stops[i][0],e.stops[i+1][0]),s=e.stops[i][1],l=e.stops[i+1][1];let c=Wo[t.type]||Za;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=da[e.colorSpace];c=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),a))}return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const o=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==o&&void 0!==n)return c(o,n,a)}}:c(s,l,a)}function es(e,t,r){return"color"===t.type?r=Ho.parse(r):"formatted"===t.type?r=mn.fromString(r.toString()):"resolvedImage"===t.type?r=pn.fromString(r.toString()):En(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),qa(r,e.default,t.default)}Mn.register(Da,{error:[{kind:"error"},[$o],(e,t)=>{let[r]=t;throw new bn(r.evaluate(e))}],typeof:[$o,[tn],(e,t)=>{let[r]=t;return sn(yn(r.evaluate(e)))}],"to-rgba":[an(qo,4),[Qo],(e,t)=>{let[r]=t;return r.evaluate(e).toArray()}],rgb:[Qo,[qo,qo,qo],ka],rgba:[Qo,[qo,qo,qo,qo],ka],hsl:[Qo,[qo,qo,qo],Na],hsla:[Qo,[qo,qo,qo,qo],Na],has:{type:Xo,overloads:[[[$o],(e,t)=>{let[r]=t;return Ba(r.evaluate(e),e.properties())}],[[$o,en],(e,t)=>{let[r,o]=t;return Ba(r.evaluate(e),o.evaluate(e))}]]},get:{type:tn,overloads:[[[$o],(e,t)=>{let[r]=t;return Fa(r.evaluate(e),e.properties())}],[[$o,en],(e,t)=>{let[r,o]=t;return Fa(r.evaluate(e),o.evaluate(e))}]]},"feature-state":[tn,[$o],(e,t)=>{let[r]=t;return Fa(r.evaluate(e),e.featureState||{})}],properties:[en,[],e=>e.properties()],"geometry-type":[$o,[],e=>e.geometryType()],id:[tn,[],e=>e.id()],zoom:[qo,[],e=>e.globals.zoom],pitch:[qo,[],e=>e.globals.pitch||0],"distance-from-center":[qo,[],e=>e.distanceFromCenter()],"measure-light":[qo,[$o],(e,t)=>{let[r]=t;return e.measureLight(r.evaluate(e))}],"heatmap-density":[qo,[],e=>e.globals.heatmapDensity||0],"line-progress":[qo,[],e=>e.globals.lineProgress||0],"raster-value":[qo,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[qo,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[qo,[],e=>e.globals.skyRadialProgress||0],accumulated:[tn,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[qo,za(qo),(e,t)=>{let r=0;for(const o of t)r+=o.evaluate(e);return r}],"*":[qo,za(qo),(e,t)=>{let r=1;for(const o of t)r*=o.evaluate(e);return r}],"-":{type:qo,overloads:[[[qo,qo],(e,t)=>{let[r,o]=t;return r.evaluate(e)-o.evaluate(e)}],[[qo],(e,t)=>{let[r]=t;return-r.evaluate(e)}]]},"/":[qo,[qo,qo],(e,t)=>{let[r,o]=t;return r.evaluate(e)/o.evaluate(e)}],"%":[qo,[qo,qo],(e,t)=>{let[r,o]=t;return r.evaluate(e)%o.evaluate(e)}],ln2:[qo,[],()=>Math.LN2],pi:[qo,[],()=>Math.PI],e:[qo,[],()=>Math.E],"^":[qo,[qo,qo],(e,t)=>{let[r,o]=t;return Math.pow(r.evaluate(e),o.evaluate(e))}],sqrt:[qo,[qo],(e,t)=>{let[r]=t;return Math.sqrt(r.evaluate(e))}],log10:[qo,[qo],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))/Math.LN10}],ln:[qo,[qo],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))}],log2:[qo,[qo],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))/Math.LN2}],sin:[qo,[qo],(e,t)=>{let[r]=t;return Math.sin(r.evaluate(e))}],cos:[qo,[qo],(e,t)=>{let[r]=t;return Math.cos(r.evaluate(e))}],tan:[qo,[qo],(e,t)=>{let[r]=t;return Math.tan(r.evaluate(e))}],asin:[qo,[qo],(e,t)=>{let[r]=t;return Math.asin(r.evaluate(e))}],acos:[qo,[qo],(e,t)=>{let[r]=t;return Math.acos(r.evaluate(e))}],atan:[qo,[qo],(e,t)=>{let[r]=t;return Math.atan(r.evaluate(e))}],min:[qo,za(qo),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[qo,za(qo),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[qo,[qo],(e,t)=>{let[r]=t;return Math.abs(r.evaluate(e))}],round:[qo,[qo],(e,t)=>{let[r]=t;const o=r.evaluate(e);return o<0?-Math.round(-o):Math.round(o)}],floor:[qo,[qo],(e,t)=>{let[r]=t;return Math.floor(r.evaluate(e))}],ceil:[qo,[qo],(e,t)=>{let[r]=t;return Math.ceil(r.evaluate(e))}],"filter-==":[Xo,[$o,tn],(e,t)=>{let[r,o]=t;return e.properties()[r.value]===o.value}],"filter-id-==":[Xo,[tn],(e,t)=>{let[r]=t;return e.id()===r.value}],"filter-type-==":[Xo,[$o],(e,t)=>{let[r]=t;return e.geometryType()===r.value}],"filter-<":[Xo,[$o,tn],(e,t)=>{let[r,o]=t;const n=e.properties()[r.value],i=o.value;return typeof n==typeof i&&n<i}],"filter-id-<":[Xo,[tn],(e,t)=>{let[r]=t;const o=e.id(),n=r.value;return typeof o==typeof n&&o<n}],"filter->":[Xo,[$o,tn],(e,t)=>{let[r,o]=t;const n=e.properties()[r.value],i=o.value;return typeof n==typeof i&&n>i}],"filter-id->":[Xo,[tn],(e,t)=>{let[r]=t;const o=e.id(),n=r.value;return typeof o==typeof n&&o>n}],"filter-<=":[Xo,[$o,tn],(e,t)=>{let[r,o]=t;const n=e.properties()[r.value],i=o.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[Xo,[tn],(e,t)=>{let[r]=t;const o=e.id(),n=r.value;return typeof o==typeof n&&o<=n}],"filter->=":[Xo,[$o,tn],(e,t)=>{let[r,o]=t;const n=e.properties()[r.value],i=o.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[Xo,[tn],(e,t)=>{let[r]=t;const o=e.id(),n=r.value;return typeof o==typeof n&&o>=n}],"filter-has":[Xo,[tn],(e,t)=>{let[r]=t;return r.value in e.properties()}],"filter-has-id":[Xo,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Xo,[an($o)],(e,t)=>{let[r]=t;return r.value.indexOf(e.geometryType())>=0}],"filter-id-in":[Xo,[an(tn)],(e,t)=>{let[r]=t;return r.value.indexOf(e.id())>=0}],"filter-in-small":[Xo,[$o,an(tn)],(e,t)=>{let[r,o]=t;return o.value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[Xo,[$o,an(tn)],(e,t)=>{let[r,o]=t;return function(e,t,r,o){for(;r<=o;){const n=r+o>>1;if(t[n]===e)return!0;t[n]>e?o=n-1:r=n+1}return!1}(e.properties()[r.value],o.value,0,o.value.length-1)}],all:{type:Xo,overloads:[[[Xo,Xo],(e,t)=>{let[r,o]=t;return r.evaluate(e)&&o.evaluate(e)}],[za(Xo),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:Xo,overloads:[[[Xo,Xo],(e,t)=>{let[r,o]=t;return r.evaluate(e)||o.evaluate(e)}],[za(Xo),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[Xo,[Xo],(e,t)=>{let[r]=t;return!r.evaluate(e)}],"is-supported-script":[Xo,[$o],(e,t)=>{let[r]=t;const o=e.globals&&e.globals.isSupportedScript;return!o||o(r.evaluate(e))}],upcase:[$o,[$o],(e,t)=>{let[r]=t;return r.evaluate(e).toUpperCase()}],downcase:[$o,[$o],(e,t)=>{let[r]=t;return r.evaluate(e).toLowerCase()}],concat:[$o,za(tn),(e,t)=>t.map((t=>vn(t.evaluate(e)))).join("")],"resolved-locale":[$o,[rn],(e,t)=>{let[r]=t;return r.evaluate(e).resolvedLocale()}],random:[qo,[qo,qo,tn],(e,t)=>{const[r,o,n]=t.map((t=>t.evaluate(e)));if(r>o)return r;if(r===o)return r;let i;if("string"==typeof n)i=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(n);else{if("number"!=typeof n)throw new bn(`Invalid seed input: ${n}`);i=n}return r+Oa(i)()*(o-r)}]});class ts{constructor(e,t,r,o){this.expression=e,this._warningHistory={},this._evaluator=new Rn(r,o),this._defaultValue=t?function(e){return"color"===e.type&&(Ja(e.default)||Array.isArray(e.default))?new Ho(0,0,0,0):"color"===e.type?Ho.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,o,n,i,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=o||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=i,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,o,n,i,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=o||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=i||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function rs(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Da}function os(e,t,r,o){const n=new ji(Da,[],t?function(e){const t={color:Qo,string:$o,number:qo,enum:$o,boolean:Xo,formatted:on,resolvedImage:nn};return"array"===e.type?an(t[e.value]||tn,e.length):t[e.type]}(t):void 0,void 0,void 0,r,o),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?Ua(new ts(i,t,r,o)):Va(n.errors)}class ns{constructor(e,t,r){this.kind=e,this._styleExpression=t,this.isLightConstant=r,this.isStateDependent="constant"!==e&&!Ui(t.expression),this.isConfigDependent=!Vi(t.expression)}evaluateWithoutErrorHandling(e,t,r,o,n,i){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,o,n,i)}evaluate(e,t,r,o,n,i){return this._styleExpression.evaluate(e,t,r,o,n,i)}}class is{constructor(e,t,r,o,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ui(t.expression),this.isLightConstant=n,this.isConfigDependent=!Vi(t.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,t,r,o,n,i){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,o,n,i)}evaluate(e,t,r,o,n,i){return this._styleExpression.evaluate(e,t,r,o,n,i)}interpolationFactor(e,t,r){return this.interpolationType?ha.interpolationFactor(this.interpolationType,e,t,r):0}}function as(e,t,r,o){if("error"===(e=os(e,t,r,o)).result)return e;const n=e.value.expression,i=zi(n);if(!i&&!Ga(t))return Va([new Jo("","data expressions not supported")]);const a=Hi(n,["zoom","pitch","distance-from-center"]);if(!a&&!Wa(t))return Va([new Jo("","zoom expressions not supported")]);const s=Hi(n,["measure-light"]);if(!s&&!ja(t))return Va([new Jo("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=ls(n);return c||a||l?c instanceof Jo?Va([c]):c instanceof ha&&!Ka(t)?Va([new Jo("",'"interpolate" expressions cannot be used with this property')]):Ua(c?new is(i?"camera":"composite",e.value,c.labels,c instanceof ha?c.interpolation:void 0,s):new ns(i?"constant":"source",e.value,s)):Va([new Jo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ss{constructor(e,t){this._parameters=e,this._specification=t,Ko(this,Ya(this._parameters,this._specification))}static deserialize(e){return new ss(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ls(e){let t=null;if(e instanceof pa)t=ls(e.result);else if(e instanceof ma){for(const r of e.args)if(t=ls(r),t)break}else(e instanceof Ji||e instanceof ha)&&e.input instanceof Mn&&"zoom"===e.input.name&&(t=e);return t instanceof Jo||e.eachChild((e=>{const r=ls(e);r instanceof Jo?t=r:t&&r&&t!==r&&(t=new Jo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var cs=ds,us=3;function ds(e,t,r){var o=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(r=n[2]);for(var i=0;i<this.d*this.d;i++){var a=n[us+i],s=n[us+i+1];o.push(a===s?null:n.subarray(a,s))}var l=n[us+o.length+1];this.keys=n.subarray(n[us+o.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var c=0;c<this.d*this.d;c++)o.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var u=r/t*e;this.min=-u,this.max=e+u}ds.prototype.insert=function(e,t,r,o,n){this._forEachCell(t,r,o,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(n)},ds.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ds.prototype._insertCell=function(e,t,r,o,n,i){this.cells[n].push(i)},ds.prototype.query=function(e,t,r,o,n){var i=this.min,a=this.max;if(e<=i&&t<=i&&a<=r&&a<=o&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,r,o,this._queryCell,s,{},n),s},ds.prototype._queryCell=function(e,t,r,o,n,i,a,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,d=0;d<l.length;d++){var h=l[d];if(void 0===a[h]){var f=4*h;(s?s(u[f+0],u[f+1],u[f+2],u[f+3]):e<=u[f+2]&&t<=u[f+3]&&r>=u[f+0]&&o>=u[f+1])?(a[h]=!0,i.push(c[h])):a[h]=!1}}},ds.prototype._forEachCell=function(e,t,r,o,n,i,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(r),d=this._convertToCellCoord(o),h=l;h<=u;h++)for(var f=c;f<=d;f++){var m=this.d*f+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&n.call(this,e,t,r,o,m,i,a,s))return}},ds.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ds.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ds.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=us+this.cells.length+1+1,r=0,o=0;o<this.cells.length;o++)r+=this.cells[o].length;var n=new Int32Array(t+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var i=t,a=0;a<e.length;a++){var s=e[a];n[us+a]=i,n.set(s,i),i+=s.length}return n[us+e.length]=i,n.set(this.keys,i),n[us+e.length+1]=i+=this.keys.length,n.set(this.bboxes,i),i+=this.bboxes.length,n.buffer};var hs=d(cs);const fs={};function ms(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),fs[t]={klass:e,omit:r.omit||[]}}ms(Object,"Object"),hs.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},hs.deserialize=function(e){return new hs(e.buffer)},Object.defineProperty(hs,"name",{value:"Grid"}),ms(hs,"Grid"),ms(Ho,"Color"),ms(Error,"Error"),ms(mn,"Formatted"),ms(fn,"FormattedSection"),ms(qr,"AJAXError"),ms(pn,"ResolvedImage"),ms(ss,"StylePropertyFunction"),ms(ts,"StyleExpression",{omit:["_evaluator"]}),ms(is,"ZoomDependentExpression"),ms(ns,"ZoomConstantExpression"),ms(Mn,"CompoundExpression",{omit:["_evaluate"]});for(const px in Da)fs[Da[px]._classRegistryKey]||ms(Da[px],`Expression${px}`);function ps(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function gs(e){return self.ImageBitmap&&e instanceof ImageBitmap}function _s(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ps(e)||gs(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const r=e;return t&&t.add(r.buffer),r}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const o of e)r.push(_s(o,t));return r}if(e instanceof Map){const t={$name:"Map"};for(const[r,o]of e.entries())t[r]=_s(o);return t}if("object"==typeof e){const r=e.constructor,o=r._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);const n=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&(fs[o].omit.indexOf(r)>=0||(n[r]=_s(e[r],t)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==o&&(n.$name=o),n}throw new Error("can't serialize object of type "+typeof e)}function ys(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ps(e)||gs(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(ys);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const r of Object.keys(e))"$name"!==r&&t.set(r,ys(e[r]));return t}const{klass:r}=fs[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(e);const o=Object.create(r.prototype);for(const n of Object.keys(e))"$name"!==n&&(o[n]=ys(e[n]));return o}throw new Error("can't deserialize object of type "+typeof e)}const vs={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function xs(e){for(const t of e)if(As(t.charCodeAt(0)))return!0;return!1}function bs(e){for(const t of e)if(!Ls(t.charCodeAt(0)))return!1;return!0}function Ls(e){return!(vs.Arabic(e)||vs["Arabic Supplement"](e)||vs["Arabic Extended-A"](e)||vs["Arabic Presentation Forms-A"](e)||vs["Arabic Presentation Forms-B"](e))}function As(e){return!(746!==e&&747!==e&&(e<4352||!(vs["Bopomofo Extended"](e)||vs.Bopomofo(e)||vs["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||vs["CJK Compatibility Ideographs"](e)||vs["CJK Compatibility"](e)||vs["CJK Radicals Supplement"](e)||vs["CJK Strokes"](e)||!(!vs["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||vs["CJK Unified Ideographs Extension A"](e)||vs["CJK Unified Ideographs"](e)||vs["Enclosed CJK Letters and Months"](e)||vs["Hangul Compatibility Jamo"](e)||vs["Hangul Jamo Extended-A"](e)||vs["Hangul Jamo Extended-B"](e)||vs["Hangul Jamo"](e)||vs["Hangul Syllables"](e)||vs.Hiragana(e)||vs["Ideographic Description Characters"](e)||vs.Kanbun(e)||vs["Kangxi Radicals"](e)||vs["Katakana Phonetic Extensions"](e)||vs.Katakana(e)&&12540!==e||!(!vs["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!vs["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||vs["Unified Canadian Aboriginal Syllabics"](e)||vs["Unified Canadian Aboriginal Syllabics Extended"](e)||vs["Vertical Forms"](e)||vs["Yijing Hexagram Symbols"](e)||vs["Yi Syllables"](e)||vs["Yi Radicals"](e))))}function ws(e){return!(As(e)||function(e){return!!(vs["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||vs["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||vs["Letterlike Symbols"](e)||vs["Number Forms"](e)||vs["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||vs["Control Pictures"](e)&&9251!==e||vs["Optical Character Recognition"](e)||vs["Enclosed Alphanumerics"](e)||vs["Geometric Shapes"](e)||vs["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vs["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vs["CJK Symbols and Punctuation"](e)||vs.Katakana(e)||vs["Private Use Area"](e)||vs["CJK Compatibility Forms"](e)||vs["Small Form Variants"](e)||vs["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Ss(e){return e>=1424&&e<=2303||vs["Arabic Presentation Forms-A"](e)||vs["Arabic Presentation Forms-B"](e)}function Es(e,t){return!(!t&&Ss(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||vs.Khmer(e))}function Ts(e){for(const t of e)if(Ss(t.charCodeAt(0)))return!0;return!1}const Ps="deferred",Cs="loading",Rs="loaded";let Ms=null,Is="unavailable",Os=null;const Ds=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Is="error"),Ms&&Ms(e)};function ks(){Ns.fire(new Do("pluginStateChange",{pluginStatus:Is,pluginURL:Os}))}const Ns=new No,Bs=function(){return Is},Fs=function(){if(Is!==Ps||!Os)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is=Cs,ks(),Os&&Qr({url:Os},(e=>{e?Ds(e):(Is=Rs,ks())}))},zs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Is===Rs||null!=zs.applyArabicShaping,isLoading:()=>Is===Cs,setState(e){Is=e.pluginStatus,Os=e.pluginURL},isParsed:()=>null!=zs.applyArabicShaping&&null!=zs.processBidirectionalText&&null!=zs.processStyledBidirectionalText,getPluginURL:()=>Os};class Us{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!Es(r.charCodeAt(0),t))return!1;return!0}(e,zs.isLoaded())}}class Vs{constructor(e,t,r,o){this.property=e,this.value=t,this.expression=function(e,t,r,o){if(Ja(e))return new ss(e,t);if(rs(e)||Array.isArray(e)&&e.length>0){const n=as(e,t,r,o);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=Ho.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification,r,o)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class Hs{constructor(e,t,r){this.property=e,this.value=new Vs(e,void 0,t,r)}transitioned(e,t){return new js(this.property,this.value,t,Qt({},e.transition,this.transition),e.now)}untransitioned(){return new js(this.property,this.value,null,{},0)}}class Gs{constructor(e,t,r){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=r,this.isConfigDependent=!1}getValue(e){return cr(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Hs(this._values[e].property,this._scope,this._options)),this._values[e].value=new Vs(this._values[e].property,null===t?void 0:cr(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const r=this._properties.properties;if(e)for(const o in e){const t=e[o];if(ar(o,"-transition")){const e=o.slice(0,-11);r[e]&&this.setTransition(e,t)}else r[o]&&this.setValue(o,t)}}getTransition(e){return cr(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Hs(this._values[e].property)),this._values[e].transition=cr(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const o=this.getTransition(t);void 0!==o&&(e[`${t}-transition`]=o)}return e}transitioned(e,t){const r=new Ws(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].transitioned(e,t._values[o]);return r}untransitioned(){const e=new Ws(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class js{constructor(e,t,r,o,n){const i=o.delay||0,a=o.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+i,this.end=this.begin+a,e.specification.transition&&(o.delay||o.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const o=e.now||0,n=this.value.possiblyEvaluate(e,t,r),i=this.prior;if(i){if(o>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(o<this.begin)return i.possiblyEvaluate(e,t,r);{const a=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(e,t,r),n,Kt(a))}}return n}}class Ws{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const o=new Zs(this._properties);for(const n of Object.keys(this._values))o._values[n]=this._values[n].possiblyEvaluate(e,t,r);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ks{constructor(e,t,r){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=r,this.isConfigDependent=!1}getValue(e){return cr(this._values[e].value)}setValue(e,t){this._values[e]=new Vs(this._values[e].property,null===t?void 0:cr(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r){const o=new Zs(this._properties);for(const n of Object.keys(this._values))o._values[n]=this._values[n].possiblyEvaluate(e,t,r);return o}}class Js{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,o){return this.property.evaluate(this.value,this.parameters,e,t,r,o)}}class Zs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ys{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const o=Wo[this.specification.type];return o?o(e,t,r):e}}class qs{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,o){return new Js(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,o)}:e.expression,t)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Js(this,{kind:"constant",value:void 0},e.parameters);const o=Wo[this.specification.type];return o?new Js(this,{kind:"constant",value:o(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,o,n,i){return"constant"===e.kind?e.value:e.evaluate(t,r,o,n,i)}}class $s{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,o){return!!e.expression.evaluate(t,null,{},r,o)}interpolate(){return!1}}class Xs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Us(0,{});for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const n=this.defaultPropertyValues[r]=new Vs(o,void 0),i=this.defaultTransitionablePropertyValues[r]=new Hs(o);this.defaultTransitioningPropertyValues[r]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=n.possiblyEvaluate(t)}}}function Qs(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function el(e){if(Array.isArray(e))return e.map(el);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=el(e[r]);return t}return Qs(e)}ms(qs,"DataDrivenProperty"),ms(Ys,"DataConstantProperty"),ms($s,"ColorRampProperty");var tl=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rl(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!rl(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ol(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rl(e)||(e=ul(e));const r=e;let o=!0;try{o=function(e){if(!al(e))return e;let t=el(e);return il(t),t=nl(t),t}(r)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const n=tl[`filter_${t}`],i=os(o,n);let a=null;if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(e,t,r)=>i.value.evaluate(e,t,{},r);let s=null,l=null;if(o!==r){const e=os(r,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(t,r,o,n,i)=>e.value.evaluate(t,r,{},o,void 0,void 0,n,i),l=!zi(e.value.expression)}return{filter:a,dynamicFilter:s||void 0,needGeometry:cl(o),needFeature:!!l}}function nl(e){if(!Array.isArray(e))return e;const t=function(e){if(sl.has(e[0]))for(let t=1;t<e.length;t++)if(al(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>nl(e)))}function il(e){let t=!1;const r=[];if("case"===e[0]){for(let o=1;o<e.length-1;o+=2)t=t||al(e[o]),r.push(e[o+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||al(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||al(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let o=1;o<e.length;o++)il(e[o])}function al(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++)if(al(e[r]))return!0;return!1}const sl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ll(e,t){return e<t?-1:e>t?1:0}function cl(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(cl(e[t]))return!0;return!1}function ul(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?dl(e[1],e[2],"=="):"!="===t?ml(dl(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?dl(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(ul))):"all"===t?["all"].concat(e.slice(1).map(ul)):"none"===t?["all"].concat(e.slice(1).map(ul).map(ml)):"in"===t?hl(e[1],e.slice(2)):"!in"===t?ml(hl(e[1],e.slice(2))):"has"===t?fl(e[1]):"!has"!==t||ml(fl(e[1]));var r}function dl(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function hl(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(ll)]]:["filter-in-small",e,["literal",t]]}}function fl(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ml(e){return["!",e]}const pl="\x1f";function gl(e,t){return t?`${e}${pl}${t}`:e}const _l="-transition",yl=new Set(["fill","line","background","hillshade","raster"]);class vl extends No{constructor(e,t,r,o){if(super(),this.id=e.id,this.fqid=gl(this.id,r),this.type=e.type,this.scope=r,this.options=o,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Ks(t.layout,this.scope,o),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new Gs(t.paint,this.scope,o);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zs(t.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return yl.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return ar(e,_l)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const r=this._transitionablePaint,o=r._properties.properties;if(ar(e,_l)){const n=e.slice(0,-11);return o[n]&&r.setTransition(n,t||void 0),!1}if(!o[e])return!1;const n=r._values[e],i=n.value.isDataDriven(),a=n.value;r.setValue(e,t),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const s=r._values[e].value,l=s.isDataDriven(),c=ar(e,"pattern")||"line-dasharray"===e;return l||i||c||this._handleOverridablePaintPropertyUpdate(e,a,s)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return lr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Js&&Ga(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ol(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,r,o,n,i,a,s,l){}queryIntersectsMatchingFeature(e,t,r,o){}}const xl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bl{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ll{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Al(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=0,o=0;return{members:e.map((e=>{const n=xl[e.type].BYTES_PER_ELEMENT,i=r=wl(r,Math.max(t,n)),a=e.components||1;return o=Math.max(o,n),r+=n*a,{name:e.name,type:e.type,components:a,offset:i}})),size:wl(r,Math.max(o,t)),alignment:t}}function wl(e,t){return Math.ceil(e/t)*t}class Sl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const o=2*e;return this.int16[o+0]=t,this.int16[o+1]=r,e}}Sl.prototype.bytesPerElement=4,ms(Sl,"StructArrayLayout2i4");class El extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r)}emplace(e,t,r,o){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=r,this.int16[n+2]=o,e}}El.prototype.bytesPerElement=6,ms(El,"StructArrayLayout3i6");class Tl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,o)}emplace(e,t,r,o,n){const i=4*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=o,this.int16[i+3]=n,e}}Tl.prototype.bytesPerElement=8,ms(Tl,"StructArrayLayout4i8");class Pl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,o,n)}emplace(e,t,r,o,n,i){const a=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=o,this.int16[a+3]=n,this.int16[a+4]=i,e}}Pl.prototype.bytesPerElement=10,ms(Pl,"StructArrayLayout5i10");class Cl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,o,n,i,a)}emplace(e,t,r,o,n,i,a,s){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[c+4]=o,this.uint8[c+5]=n,this.uint8[c+6]=i,this.uint8[c+7]=a,this.float32[u+2]=s,e}}Cl.prototype.bytesPerElement=12,ms(Cl,"StructArrayLayout2i4ub1f12");class Rl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,o)}emplace(e,t,r,o,n){const i=4*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=o,this.float32[i+3]=n,e}}Rl.prototype.bytesPerElement=16,ms(Rl,"StructArrayLayout4f16");class Ml extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const o=2*e;return this.float32[o+0]=t,this.float32[o+1]=r,e}}Ml.prototype.bytesPerElement=8,ms(Ml,"StructArrayLayout2f8");class Il extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,o,n)}emplace(e,t,r,o,n,i){const a=6*e,s=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=r,this.uint16[a+2]=o,this.uint16[a+3]=n,this.float32[s+2]=i,e}}Il.prototype.bytesPerElement=12,ms(Il,"StructArrayLayout4ui1f12");class Ol extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,o)}emplace(e,t,r,o,n){const i=4*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=o,this.uint16[i+3]=n,e}}Ol.prototype.bytesPerElement=8,ms(Ol,"StructArrayLayout4ui8");class Dl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,o,n,i)}emplace(e,t,r,o,n,i,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=o,this.int16[s+3]=n,this.int16[s+4]=i,this.int16[s+5]=a,e}}Dl.prototype.bytesPerElement=12,ms(Dl,"StructArrayLayout6i12");class kl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a,s,l,c,u,d){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,o,n,i,a,s,l,c,u,d)}emplace(e,t,r,o,n,i,a,s,l,c,u,d,h){const f=12*e;return this.int16[f+0]=t,this.int16[f+1]=r,this.int16[f+2]=o,this.int16[f+3]=n,this.uint16[f+4]=i,this.uint16[f+5]=a,this.uint16[f+6]=s,this.uint16[f+7]=l,this.int16[f+8]=c,this.int16[f+9]=u,this.int16[f+10]=d,this.int16[f+11]=h,e}}kl.prototype.bytesPerElement=24,ms(kl,"StructArrayLayout4i4ui4i24");class Nl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,o,n,i)}emplace(e,t,r,o,n,i,a){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=o,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=a,e}}Nl.prototype.bytesPerElement=20,ms(Nl,"StructArrayLayout3i3f20");class Bl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Bl.prototype.bytesPerElement=4,ms(Bl,"StructArrayLayout1ul4");class Fl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const o=2*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,e}}Fl.prototype.bytesPerElement=4,ms(Fl,"StructArrayLayout2ui4");class zl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a,s,l,c,u,d,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,r,o,n,i,a,s,l,c,u,d,h)}emplace(e,t,r,o,n,i,a,s,l,c,u,d,h,f){const m=20*e,p=10*e;return this.int16[m+0]=t,this.int16[m+1]=r,this.int16[m+2]=o,this.int16[m+3]=n,this.int16[m+4]=i,this.float32[p+3]=a,this.float32[p+4]=s,this.float32[p+5]=l,this.float32[p+6]=c,this.int16[m+14]=u,this.uint32[p+8]=d,this.uint16[m+18]=h,this.uint16[m+19]=f,e}}zl.prototype.bytesPerElement=40,ms(zl,"StructArrayLayout5i4f1i1ul2ui40");class Ul extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,o,n,i,a)}emplace(e,t,r,o,n,i,a,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=o,this.int16[l+4]=n,this.int16[l+5]=i,this.int16[l+6]=a,this.int16[l+7]=s,e}}Ul.prototype.bytesPerElement=16,ms(Ul,"StructArrayLayout3i2i2i16");class Vl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,o,n)}emplace(e,t,r,o,n,i){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=o,this.int16[s+6]=n,this.int16[s+7]=i,e}}Vl.prototype.bytesPerElement=16,ms(Vl,"StructArrayLayout2f1f2i16");class Hl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,o)}emplace(e,t,r,o,n){const i=12*e,a=3*e;return this.uint8[i+0]=t,this.uint8[i+1]=r,this.float32[a+1]=o,this.float32[a+2]=n,e}}Hl.prototype.bytesPerElement=12,ms(Hl,"StructArrayLayout2ub2f12");class Gl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r)}emplace(e,t,r,o){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,this.uint16[n+2]=o,e}}Gl.prototype.bytesPerElement=6,ms(Gl,"StructArrayLayout3ui6");class jl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x)}emplace(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b){const L=30*e,A=15*e,w=60*e;return this.int16[L+0]=t,this.int16[L+1]=r,this.int16[L+2]=o,this.float32[A+2]=n,this.float32[A+3]=i,this.uint16[L+8]=a,this.uint16[L+9]=s,this.uint32[A+5]=l,this.uint32[A+6]=c,this.uint32[A+7]=u,this.uint16[L+16]=d,this.uint16[L+17]=h,this.uint16[L+18]=f,this.float32[A+10]=m,this.float32[A+11]=p,this.uint8[w+48]=g,this.uint8[w+49]=_,this.uint8[w+50]=y,this.uint32[A+13]=v,this.int16[L+28]=x,this.uint8[w+58]=b,e}}jl.prototype.bytesPerElement=60,ms(jl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b,L,A,w,S,E,T,P,C,R,M){const I=this.length;return this.resize(I+1),this.emplace(I,e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b,L,A,w,S,E,T,P,C,R,M)}emplace(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b,L,A,w,S,E,T,P,C,R,M,I){const O=20*e,D=40*e,k=80*e;return this.float32[O+0]=t,this.float32[O+1]=r,this.int16[D+4]=o,this.int16[D+5]=n,this.int16[D+6]=i,this.int16[D+7]=a,this.int16[D+8]=s,this.int16[D+9]=l,this.int16[D+10]=c,this.int16[D+11]=u,this.int16[D+12]=d,this.uint16[D+13]=h,this.uint16[D+14]=f,this.uint16[D+15]=m,this.uint16[D+16]=p,this.uint16[D+17]=g,this.uint16[D+18]=_,this.uint16[D+19]=y,this.uint16[D+20]=v,this.uint16[D+21]=x,this.uint16[D+22]=b,this.uint16[D+23]=L,this.uint16[D+24]=A,this.uint16[D+25]=w,this.uint16[D+26]=S,this.uint16[D+27]=E,this.uint32[O+14]=T,this.float32[O+15]=P,this.float32[O+16]=C,this.float32[O+17]=R,this.float32[O+18]=M,this.uint8[k+76]=I,e}}Wl.prototype.bytesPerElement=80,ms(Wl,"StructArrayLayout2f9i15ui1ul4f1ub80");class Kl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Kl.prototype.bytesPerElement=4,ms(Kl,"StructArrayLayout1f4");class Jl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,o,n)}emplace(e,t,r,o,n,i){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=o,this.float32[a+3]=n,this.float32[a+4]=i,e}}Jl.prototype.bytesPerElement=20,ms(Jl,"StructArrayLayout5f20");class Zl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,o,n,i,a)}emplace(e,t,r,o,n,i,a,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=o,this.float32[l+3]=n,this.float32[l+4]=i,this.float32[l+5]=a,this.float32[l+6]=s,e}}Zl.prototype.bytesPerElement=28,ms(Zl,"StructArrayLayout7f28");class Yl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,o){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r,o)}emplace(e,t,r,o,n){const i=6*e;return this.uint32[3*e+0]=t,this.uint16[i+2]=r,this.uint16[i+3]=o,this.uint16[i+4]=n,e}}Yl.prototype.bytesPerElement=12,ms(Yl,"StructArrayLayout1ul3ui12");class ql extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ql.prototype.bytesPerElement=2,ms(ql,"StructArrayLayout1ui2");class $l extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r)}emplace(e,t,r,o){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=r,this.float32[n+2]=o,e}}$l.prototype.bytesPerElement=12,ms($l,"StructArrayLayout3f12");class Xl extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p)}emplace(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=r,this.float32[_+2]=o,this.float32[_+3]=n,this.float32[_+4]=i,this.float32[_+5]=a,this.float32[_+6]=s,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=d,this.float32[_+11]=h,this.float32[_+12]=f,this.float32[_+13]=m,this.float32[_+14]=p,this.float32[_+15]=g,e}}Xl.prototype.bytesPerElement=64,ms(Xl,"StructArrayLayout16f64");class Ql extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,o,n,i,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,o,n,i,a)}emplace(e,t,r,o,n,i,a,s){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,this.uint16[l+2]=o,this.uint16[l+3]=n,this.float32[c+2]=i,this.float32[c+3]=a,this.float32[c+4]=s,e}}Ql.prototype.bytesPerElement=20,ms(Ql,"StructArrayLayout4ui3f20");class ec extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}ec.prototype.bytesPerElement=2,ms(ec,"StructArrayLayout1i2");class tc extends Ll{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}tc.prototype.bytesPerElement=1,ms(tc,"StructArrayLayout1ub1");class rc extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}rc.prototype.size=40;class oc extends zl{get(e){return new rc(this,e)}}ms(oc,"CollisionBoxArray");class nc extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}nc.prototype.size=60;class ic extends jl{get(e){return new nc(this,e)}}ms(ic,"PlacedSymbolArray");class ac extends bl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}ac.prototype.size=80;class sc extends Wl{get(e){return new ac(this,e)}}ms(sc,"SymbolInstanceArray");class lc extends Kl{getoffsetX(e){return this.float32[1*e+0]}}ms(lc,"GlyphOffsetArray");class cc extends Sl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ms(cc,"SymbolLineVertexArray");class uc extends bl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}uc.prototype.size=12;class dc extends Yl{get(e){return new uc(this,e)}}ms(dc,"FeatureIndexArray");class hc extends Fl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ms(hc,"FillExtrusionCentroidArray");const fc=Al([{name:"a_pos",components:2,type:"Int16"}],4),mc=Al([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class pc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,r,o){let n=this.segments[this.segments.length-1];return e>pc.MAX_VERTEX_ARRAY_LENGTH&&dr(`Max vertices per segment is ${pc.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>pc.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==o)&&(n={vertexOffset:t,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==o&&(n.sortKey=o),this.segments.push(n)),n}prepareSegment(e,t,r,o){return this._prepareSegment(e,t.length,r.length,o)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,o){return new pc([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:o,vaos:{},sortKey:0}])}}function gc(e,t){return 256*(e=Yt(Math.floor(e),0,255))+Yt(Math.floor(t),0,255)}pc.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ms(pc,"SegmentVector");const _c=Al([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yc=Al([{name:"a_dash",components:4,type:"Uint16"}]);class vc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,r,o){this.ids.push(xc(e)),this.positions.push(t,r,o)}eachPosition(e,t){const r=xc(e);let o=0,n=this.ids.length-1;for(;o<n;){const e=o+n>>1;this.ids[e]>=r?n=e:o=e+1}for(;this.ids[o]===r;)t(this.positions[3*o],this.positions[3*o+1],this.positions[3*o+2]),o++}static serialize(e,t){const r=new Float64Array(e.ids),o=new Uint32Array(e.positions);return bc(r,o,0,r.length-1),t&&(t.add(r.buffer),t.add(o.buffer)),{ids:r,positions:o}}static deserialize(e){const t=new vc;let r;t.ids=e.ids,t.positions=e.positions;for(const o of t.ids)o!==r&&t.uniqueIds.push(o),r=o;return t.indexed=!0,t}}function xc(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Mo(String(e))}function bc(e,t,r,o){for(;r<o;){const n=e[r+o>>1];let i=r-1,a=o+1;for(;;){do{i++}while(e[i]<n);do{a--}while(e[a]>n);if(i>=a)break;Lc(e,i,a),Lc(t,3*i,3*a),Lc(t,3*i+1,3*a+1),Lc(t,3*i+2,3*a+2)}a-r<o-a?(bc(e,t,r,a),r=a+1):(bc(e,t,a+1,o),o=a)}}function Lc(e,t,r){const o=e[t];e[t]=e[r],e[r]=o}ms(vc,"FeaturePositionMap");class Ac{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wc extends Ac{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class Sc extends Ac{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ec extends Ac{constructor(e){super(e),this.current=[0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Tc extends Ac{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Pc extends Ac{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Cc extends Ac{constructor(e){super(e),this.current=Ho.transparent}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Rc=new Float32Array(16);class Mc extends Ac{constructor(e){super(e),this.current=Rc}set(e,t,r){if(this.fetchUniformLocation(e,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Ic=new Float32Array(9),Oc=new Float32Array(4);class Dc extends Ac{constructor(e){super(e),this.current=Oc}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let o=0;o<4;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function kc(e){return[gc(255*e.r,255*e.g),gc(255*e.b,255*e.a)]}class Nc{constructor(e,t,r){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=r}setUniform(e,t,r,o,n){t.set(e,n,o.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Cc(e):new Sc(e)}}class Bc{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,r,o,n){const i="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;i&&t.set(e,n,i)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Pc(e):new Sc(e)}}class Fc{constructor(e,t,r,o){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,r,o,n,i,a){const s=this.paintVertexArray.length,l=this.expression.evaluate(new Us(0,{brightness:i}),t,{},n,o,a);this.paintVertexArray.resize(e),this._setPaintValue(s,e,l)}updatePaintArray(e,t,r,o,n,i,a){const s=this.expression.evaluate({zoom:0,brightness:a},r,o,void 0,n);this._setPaintValue(e,t,s)}_setPaintValue(e,t,r){if("color"===this.type){const o=kc(r);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,o[0],o[1])}else{for(let o=e;o<t;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zc{constructor(e,t,r,o,n,i){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=r,this.useIntegerZoom=o,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,r,o,n,i,a){const s=this.expression.evaluate(new Us(this.zoom,{brightness:i}),t,{},n,o,a),l=this.expression.evaluate(new Us(this.zoom+1,{brightness:i}),t,{},n,o,a),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,s,l)}updatePaintArray(e,t,r,o,n,i,a){const s=this.expression.evaluate({zoom:this.zoom,brightness:a},r,o,void 0,n),l=this.expression.evaluate({zoom:this.zoom+1,brightness:a},r,o,void 0,n);this._setPaintValue(e,t,s,l)}_setPaintValue(e,t,r,o){if("color"===this.type){const n=kc(r),i=kc(o);for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],i[0],i[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r,o);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,o,n){const i=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Yt(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(e,n,a)}getBinding(e,t){return new Sc(e)}}class Uc{constructor(e,t,r,o,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===r?yc:_c).members;for(let i=0;i<t.length;++i);this.paintVertexArray=new o}populatePaintArray(e,t,r){const o=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(o,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,o,n,i,a){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],i)}_setPaintValues(e,t,r,o){if(!o||!r)return;const n=o[r];if(!n)return;const{tl:i,br:a,pixelRatio:s}=n;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,i[0],i[1],a[0],a[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vc{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[];const o=[];for(const n in e.paint._values){const i=e.paint.get(n);if(!r(n))continue;if(!(i instanceof Js&&Ga(i.property.specification)))continue;const a=jc(n,e.type),s=i.value,l=i.property.specification.type,c=!!i.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),d="line-dasharray"===n&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||d)if("source"===s.kind||d||u){const t=Jc(n,l,"source");this.binders[n]=u?new Uc(s,a,l,t,e.id):new Fc(s,a,l,t),o.push(`/a_${n}`)}else{const e=Jc(n,l,"composite");this.binders[n]=new zc(s,a,l,c,t,e),o.push(`/z_${n}`)}else this.binders[n]=u?new Bc(s.value,a):new Nc(s.value,a,l),o.push(`/u_${n}`)}this.cacheKey=o.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Fc||t instanceof zc?t.maxValue:0}populatePaintArrays(e,t,r,o,n,i,a){for(const s in this.binders){const l=this.binders[s];(l instanceof Fc||l instanceof zc||l instanceof Uc)&&l.populatePaintArray(e,t,r,o,n,i,a)}}setConstantPatternPositions(e){for(const t in this.binders){const r=this.binders[t];r instanceof Bc&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,t,r,o,n,i,a,s){let l=!1;const c=Object.keys(e),u=0!==c.length,d=u?c:t.uniqueIds;for(const h in this.binders){const c=this.binders[h];if((c instanceof Fc||c instanceof zc||c instanceof Uc)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const f=n.paint.get(h);c.expression=f.value;for(const r of d){const n=e[r.toString()];t.eachPosition(r,((e,t,r)=>{const l=o.feature(e);c.updatePaintArray(t,r,l,n,i,a,s)}))}if(!u)for(const t of r.uniqueIds){const n=e[t.toString()];r.eachPosition(t,((e,t,r)=>{const l=o.feature(e);c.updatePaintArray(t,r,l,n,i,a,s)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Nc||r instanceof Bc)&&e.push(...r.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Fc||r instanceof zc||r instanceof Uc)for(let t=0;t<r.paintVertexAttributes.length;t++)e.push(r.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const r=this.binders[t];if(r instanceof Nc||r instanceof Bc||r instanceof zc)for(const t of r.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Nc||o instanceof Bc||o instanceof zc)for(const n of o.uniformNames)t.push({name:n,property:r,binding:o.getBinding(e,n)})}return t}setUniforms(e,t,r,o,n){for(const{name:i,property:a,binding:s}of r)this.binders[a].setUniform(e,s,n,o.get(a),i)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Fc||t instanceof zc||t instanceof Uc)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Fc||r instanceof zc||r instanceof Uc)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Fc||t instanceof zc||t instanceof Uc)&&t.destroy()}}}class Hc{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Vc(o,t,r);this.needsUpload=!1,this._featureMap=new vc,this._featureMapWithoutIds=new vc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,r,o,n,i,a,s){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,o,n,i,a,s);void 0!==t.id?this._featureMap.add(t.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,o,n,i){for(const a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,a,o,n,i||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Gc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function jc(e,t){return Gc[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Wc={"line-pattern":{source:Il,composite:Il},"fill-pattern":{source:Il,composite:Il},"fill-extrusion-pattern":{source:Il,composite:Il},"line-dasharray":{source:Ol,composite:Ol}},Kc={color:{source:Ml,composite:Rl},number:{source:Kl,composite:Ml}};function Jc(e,t,r){const o=Wc[e];return o&&o[r]||Kc[t][r]}ms(Nc,"ConstantBinder"),ms(Bc,"PatternConstantBinder"),ms(Fc,"SourceExpressionBinder"),ms(Uc,"PatternCompositeBinder"),ms(zc,"CompositeExpressionBinder"),ms(Vc,"ProgramConfiguration",{omit:["_buffers"]}),ms(Hc,"ProgramConfigurationSet");const Zc=ii/Math.PI/2,Yc=5,qc=6,$c=16383,Xc=64,Qc=[Xc,32,16],eu=-Zc,tu=Zc;function ru(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zc;return r=Gt(r),[e*Math.sin(r)*o,-t*o,e*Math.cos(r)*o]}function ou(e,t,r){return ru(Math.cos(Gt(e)),Math.sin(Gt(e)),t,r)}const nu=6371008.8,iu=2*Math.PI*nu;class au{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new au($t(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,r=this.lat*t,o=e.lat*t,n=Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos((e.lng-this.lng)*t);return nu*Math.acos(Math.min(n,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new su({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return ou(this.lat,this.lng,Zc+e*Zc/nu)}static convert(e){if(e instanceof au)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new au(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new au(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class su{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof au?new au(e.lng,e.lat):au.convert(e),this}setSouthWest(e){return this._sw=e instanceof au?new au(e.lng,e.lat):au.convert(e),this}extend(e){const t=this._sw,r=this._ne;let o,n;if(e instanceof au)o=e,n=e;else{if(!(e instanceof su))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(su.convert(e)):this.extend(au.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(au.convert(e)):this;if(o=e._sw,n=e._ne,!o||!n)return this}return t||r?(t.lng=Math.min(o.lng,t.lng),t.lat=Math.min(o.lat,t.lat),r.lng=Math.max(n.lng,r.lng),r.lat=Math.max(n.lat,r.lat)):(this._sw=new au(o.lng,o.lat),this._ne=new au(n.lng,n.lat)),this}getCenter(){return new au((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new au(this.getWest(),this.getNorth())}getSouthEast(){return new au(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=au.convert(e);let o=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&o}static convert(e){return!e||e instanceof su?e:new su(e)}}var lu={};!function(e,t){!function(e){function t(e,t,o){var n=r(256*e,256*(t=Math.pow(2,o)-t-1),o),i=r(256*(e+1),256*(t+1),o);return n[0]+","+n[1]+","+i[0]+","+i[1]}function r(e,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[e*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}e.getURL=function(e,r,o,n,i,a){return a=a||{},e+"?"+["bbox="+t(o,n,i),"format="+(a.format||"image/png"),"service="+(a.service||"WMS"),"version="+(a.version||"1.1.1"),"request="+(a.request||"GetMap"),"srs="+(a.srs||"EPSG:3857"),"width="+(a.width||256),"height="+(a.height||256),"layers="+r].join("&")},e.getTileBBox=t,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,lu);var cu=lu;class uu{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=fu(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const r=cu.getTileBBox(this.x,this.y,this.z),o=function(e,t,r){let o,n="";for(let i=e;i>0;i--)o=1<<i-1,n+=(t&o?1:0)+(r&o?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class du{constructor(e,t){this.wrap=e,this.canonical=t,this.key=fu(e,t.z,t.z,t.x,t.y)}}class hu{constructor(e,t,r,o,n){this.overscaledZ=e,this.wrap=t,this.canonical=new uu(r,+o,+n),this.key=0===t&&e===r?this.canonical.key:fu(t,e,r,o,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new hu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return fu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return fu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new hu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,o=2*this.canonical.y;return[new hu(t,this.wrap,t,r,o),new hu(t,this.wrap,t,r+1,o),new hu(t,this.wrap,t,r,o+1),new hu(t,this.wrap,t,r+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new du(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fu(e,t,r,o,n){const i=1<<Math.min(r,22);let a=i*(n%i)+o%i;return e&&r<22&&(a+=i*i*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*a+r)+(t-r)}const mu=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new hu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new hu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new hu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new hu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];ms(uu,"CanonicalTileID"),ms(hu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pu=0,gu=25.5;function _u(e){return iu*Math.cos(e*Math.PI/180)}function yu(e){return(180+e)/360}function vu(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function xu(e,t){return e/_u(t)}function bu(e){return 360*e-180}function Lu(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Au(e,t){return e*_u(Lu(t))}const wu=85.051129;function Su(e){return Math.cos(Gt(Yt(e,-wu,wu)))}function Eu(e,t){const r=Yt(t,pu,gu),o=Math.pow(2,r);return Su(e)*iu/(512*o)}function Tu(e){return 1/Math.cos(e*Math.PI/180)}function Pu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=Math.exp(Math.PI*(1-(e.y+t/ii)/(1<<e.z)*2));return 80150034*r/(r*r+1)/ii/(1<<e.z)}class Cu{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=au.convert(e);return new Cu(yu(r.lng),vu(r.lat),xu(t,r.lat))}toLngLat(){return new au(bu(this.x),Lu(this.y))}toAltitude(){return Au(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/iu*Tu(Lu(this.y))}}function Ru(e,t,r,o,n,i,a,s,l){const c=(t+o)/2,u=(r+n)/2,d=new Ut(c,u);s(d),function(e,t,r,o,n,i){const a=r-n,s=o-i;return Math.abs((o-t)*a-(r-e)*s)/Math.hypot(a,s)}(d.x,d.y,i.x,i.y,a.x,a.y)>=l?(Ru(e,t,r,c,u,i,d,s,l),Ru(e,c,u,o,n,d,a,s,l)):e.push(a)}function Mu(e,t,r){let o=e[0],n=o.x,i=o.y;t(o);const a=[o];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:u}=l;t(l),Ru(a,n,i,c,u,o,l,t,r),n=c,i=u,o=l}return a}function Iu(e,t,r,o){if(o(t,r)){const n=t.add(r)._mult(.5);Iu(e,t,n,o),Iu(e,n,r,o)}else e.push(r)}function Ou(e,t){let r=e[0];const o=[r];for(let n=1;n<e.length;n++){const i=e[n];Iu(o,r,i,t),r=i}return o}const Du=Math.pow(2,14)-1,ku=-Du-1;function Nu(e,t){const r=Math.round(e.x*t),o=Math.round(e.y*t);return e.x=Yt(r,ku,Du),e.y=Yt(o,ku,Du),(r<e.x||r>e.x+1||o<e.y||o>e.y+1)&&dr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Bu(e,t,r){const o=e.loadGeometry(),n=e.extent,i=ii/n;if(t&&r&&r.projection.isReprojectedInTileSpace){const i=1<<t.z,{scale:a,x:s,y:l,projection:c}=r,u=e=>{const r=bu((t.x+e.x/n)/i),o=Lu((t.y+e.y/n)/i),u=c.project(r,o);e.x=(u.x*a-s)*n,e.y=(u.y*a-l)*n};for(let t=0;t<o.length;t++)if(1!==e.type)o[t]=Mu(o[t],u,1);else{const e=[];for(const r of o[t])r.x<0||r.x>=n||r.y<0||r.y>=n||(u(r),e.push(r));o[t]=e}}for(const a of o)for(const e of a)Nu(e,i);return o}function Fu(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Bu(e):[]}}function zu(e,t,r,o,n){e.emplaceBack(2*t+(o+1)/2,2*r+(n+1)/2)}function Uu(e,t,r){const o=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*o,r[1]*o,r[2]*o)}class Vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Sl,this.indexArray=new Gl,this.segments=new pc,this.programConfigurations=new Hc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,o){const n=this.layers[0],i=[];let a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Fu(l,e);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom),t,r))continue;const n=a?a.evaluate(t,{},r):void 0,s={id:c,properties:l.properties,type:l.type,sourceLayerIndex:d,index:u,geometry:e?t.geometry:Bu(l,r,o),patterns:{},sortKey:n};i.push(s)}a&&i.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===o.projection.name&&(this.globeExtVertexArray=new Dl,s=o.projection);for(const l of i){const{geometry:o,index:n,sourceLayerIndex:i}=l,a=e[n].feature;this.addFeature(l,o,n,t.availableImages,r,s,t.brightness),t.featureIndex.insert(a,o,n,i,this.index)}}update(e,t,r,o,n){const i=0!==Object.keys(e).length;i&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,i?this.stateDependentLayers:this.layers,r,o,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mc.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,o,n,i,a){for(const s of t)for(const t of s){const r=t.x,o=t.y;if(r<0||r>=ii||o<0||o>=ii)continue;if(i){const e=i.projectTilePoint(r,o,n),t=i.upVector(n,r,o),a=this.globeExtVertexArray;Uu(a,e,t),Uu(a,e,t),Uu(a,e,t),Uu(a,e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;zu(this.layoutVertexArray,r,o,-1,-1),zu(this.layoutVertexArray,r,o,1,-1),zu(this.layoutVertexArray,r,o,1,1),zu(this.layoutVertexArray,r,o,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},o,n,a)}}function Hu(e,t){for(let r=0;r<e.length;r++)if($u(t,e[r]))return!0;for(let r=0;r<t.length;r++)if($u(e,t[r]))return!0;return!!Ku(e,t)}function Gu(e,t,r){return!!$u(e,t)||!!Zu(t,e,r)}function ju(e,t){if(1===e.length)return qu(t,e[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let t=0;t<o.length;t++)if($u(e,o[t]))return!0}for(let r=0;r<e.length;r++)if(qu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(Ku(e,t[r]))return!0;return!1}function Wu(e,t,r){if(e.length>1){if(Ku(e,t))return!0;for(let o=0;o<t.length;o++)if(Zu(t[o],e,r))return!0}for(let o=0;o<e.length;o++)if(Zu(e[o],t,r))return!0;return!1}function Ku(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const o=e[r],n=e[r+1];for(let e=0;e<t.length-1;e++)if(Ju(o,n,t[e],t[e+1]))return!0}return!1}function Ju(e,t,r,o){return hr(e,r,o)!==hr(t,r,o)&&hr(e,t,r)!==hr(e,t,o)}function Zu(e,t,r){const o=r*r;if(1===t.length)return e.distSqr(t[0])<o;for(let n=1;n<t.length;n++)if(Yu(e,t[n-1],t[n])<o)return!0;return!1}function Yu(e,t,r){const o=t.distSqr(r);if(0===o)return e.distSqr(t);const n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/o;return e.distSqr(n<0?t:n>1?r:r.sub(t)._mult(n)._add(t))}function qu(e,t){let r,o,n,i=!1;for(let a=0;a<e.length;a++){r=e[a];for(let e=0,a=r.length-1;e<r.length;a=e++)o=r[e],n=r[a],o.y>t.y!=n.y>t.y&&t.x<(n.x-o.x)*(t.y-o.y)/(n.y-o.y)+o.x&&(i=!i)}return i}function $u(e,t){let r=!1;for(let o=0,n=e.length-1;o<e.length;n=o++){const i=e[o],a=e[n];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(r=!r)}return r}function Xu(e,t,r,o,n){for(const a of e)if(t<=a.x&&r<=a.y&&o>=a.x&&n>=a.y)return!0;const i=[new Ut(t,r),new Ut(t,n),new Ut(o,n),new Ut(o,r)];if(e.length>2)for(const a of i)if($u(e,a))return!0;for(let a=0;a<e.length-1;a++)if(Qu(e[a],e[a+1],i))return!0;return!1}function Qu(e,t,r){const o=r[0],n=r[2];if(e.x<o.x&&t.x<o.x||e.x>n.x&&t.x>n.x||e.y<o.y&&t.y<o.y||e.y>n.y&&t.y>n.y)return!1;const i=hr(e,t,r[0]);return i!==hr(e,t,r[1])||i!==hr(e,t,r[2])||i!==hr(e,t,r[3])}function ed(e,t,r,o,n,i){let a=t.y-e.y,s=e.x-t.x;if(i=i||0){const e=a*a+s*s;if(0===e)return!0;const t=Math.sqrt(e);a/=t,s/=t}return!((r.x-e.x)*a+(r.y-e.y)*s-i<0||(o.x-e.x)*a+(o.y-e.y)*s-i<0||(n.x-e.x)*a+(n.y-e.y)*s-i<0)}function td(e,t,r,o,n,i,a){return!(ed(e,t,o,n,i,a)||ed(t,r,o,n,i,a)||ed(r,e,o,n,i,a)||ed(o,n,e,t,r,a)||ed(n,i,e,t,r,a)||ed(i,o,e,t,r,a))}function rd(e,t,r){const o=t.paint.get(e).value;return"constant"===o.kind?o.value:r.programConfigurations.get(t.id).getMaxValue(e)}function od(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function nd(e,t,r,o,n){if(!t[0]&&!t[1])return e;const i=Ut.convert(t)._mult(n);"viewport"===r&&i._rotate(-o);const a=[];for(let s=0;s<e.length;s++)a.push(e[s].sub(i));return a}function id(e,t,r,o){const n=Ut.convert(e)._mult(o);return"viewport"===t&&n._rotate(-r),n}ms(Vu,"CircleBucket",{omit:["layers"]});const ad=new Xs({"circle-sort-key":new qs(tl.layout_circle["circle-sort-key"]),visibility:new Ys(tl.layout_circle.visibility)});var sd={paint:new Xs({"circle-radius":new qs(tl.paint_circle["circle-radius"]),"circle-color":new qs(tl.paint_circle["circle-color"]),"circle-blur":new qs(tl.paint_circle["circle-blur"]),"circle-opacity":new qs(tl.paint_circle["circle-opacity"]),"circle-translate":new Ys(tl.paint_circle["circle-translate"]),"circle-translate-anchor":new Ys(tl.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ys(tl.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ys(tl.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qs(tl.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qs(tl.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qs(tl.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ys(tl.paint_circle["circle-emissive-strength"])}),layout:ad};class ld{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,r,o){const n=e.Q.dot(r,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((t[0]-this.pos[0])*r[0]+(t[1]-this.pos[1])*r[1]+(t[2]-this.pos[2])*r[2])/n;return o[0]=this.pos[0]+this.dir[0]*i,o[1]=this.pos[1]+this.dir[1]*i,o[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(t,r,o){if(e.Q.equals(this.pos,t)||0===r)return o[0]=o[1]=o[2]=0,!1;const[n,i,a]=this.dir,s=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],u=n*n+i*i+a*a,d=2*(s*n+l*i+c*a),h=d*d-4*u*(s*s+l*l+c*c-r*r);if(h<0){const e=Math.max(-d/2,0),t=s+n*e,u=l+i*e,h=c+a*e,f=Math.hypot(t,u,h);return o[0]=t*r/f,o[1]=u*r/f,o[2]=h*r/f,!1}{const e=(-d-Math.sqrt(h))/(2*u);if(e<0){const e=Math.hypot(s,l,c);return o[0]=s*r/e,o[1]=l*r/e,o[2]=c*r/e,!1}return o[0]=s+n*e,o[1]=l+i*e,o[2]=c+a*e,!0}}}class cd{constructor(e,t,r,o,n){this.TL=e,this.TR=t,this.BR=r,this.BL=o,this.horizon=n}static fromInvProjectionMatrix(t,r,o){const n=[-1,1,1],i=[1,1,1],a=[1,-1,1],s=[-1,-1,1],l=e.Q.transformMat4(n,n,t),c=e.Q.transformMat4(i,i,t),u=e.Q.transformMat4(a,a,t),d=e.Q.transformMat4(s,s,t);return new cd(l,c,u,d,r/o)}}function ud(t,r,o){let n=1/0,i=-1/0;const a=[];for(const s of t){e.Q.sub(a,s,r);const t=e.Q.dot(a,o);n=Math.min(n,t),i=Math.max(i,t)}return[n,i]}function dd(t,r){let o=!0;for(let n=0;n<t.planes.length;n++){const i=t.planes[n];let a=0;for(let t=0;t<r.length;t++)a+=e.Q.dot(i,r[t])+i[3]>=0;if(0===a)return 0;a!==r.length&&(o=!1)}return o?2:1}function hd(e,t){for(const r of e.projections){const o=ud(t,e.points[0],r.axis);if(r.projection[1]<o[0]||r.projection[0]>o[1])return 0}return 1}function fd(t,r){let o=0;const n=[0,0,0,0];for(let i=0;i<t.length;i++)n[0]=t[i][0],n[1]=t[i][1],n[2]=t[i][2],n[3]=1,e.aa.dot(n,r)>=0&&o++;return o}class md{constructor(t,r){this.points=t||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=pd.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.Q.sub([],this.points[2],this.points[3]),e.Q.sub([],this.points[0],this.points[3]),e.Q.sub([],this.points[4],this.points[0]),e.Q.sub([],this.points[5],this.points[1]),e.Q.sub([],this.points[6],this.points[2]),e.Q.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],r=[e[2],0,-e[0]];this.projections.push({axis:t,projection:ud(this.points,this.points[0],t)}),this.projections.push({axis:r,projection:ud(this.points,this.points[0],r)})}}static fromInvProjectionMatrix(t,r,o,n){const i=Math.pow(2,o),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((o=>{const a=e.aa.transformMat4([],o,t),s=1/a[3]/r*i;return e.aa.mul(a,a,[s,s,n?1/a[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const r=e.Q.sub([],a[t[0]],a[t[1]]),o=e.Q.sub([],a[t[2]],a[t[1]]),n=e.Q.normalize([],e.Q.cross([],r,o)),i=-e.Q.dot(n,a[t[1]]);return n.concat(i)})),l=[];for(let e=0;e<a.length;e++)l.push([a[e][0],a[e][1],a[e][2]]);return new md(l,s)}intersectsPrecise(t,r,o){for(let e=0;e<r.length;e++)if(!fd(t,r[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!fd(t,this.planes[e]))return 0;for(const n of o)for(const r of this.frustumEdges){const o=e.Q.cross([],n,r),i=e.Q.length(o);if(0===i)continue;e.Q.scale(o,o,1/i);const a=ud(this.points,this.points[0],o),s=ud(t,this.points[0],o);if(a[0]>s[1]||s[0]>a[1])return 0}return 1}}class pd{static fromPoints(t){const r=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const n of t)e.Q.min(r,r,n),e.Q.max(o,o,n);return new pd(r,o)}static fromTileIdAndHeight(e,t,r){const o=1<<e.canonical.z,n=e.canonical.x,i=e.canonical.y;return new pd([n/o,i/o,t],[(n+1)/o,(i+1)/o,r])}static applyTransform(t,r){const o=t.getCorners();for(let n=0;n<o.length;++n)e.Q.transformMat4(o[n],o[n],r);return pd.fromPoints(o)}static projectAabbCorners(t,r){const o=t.getCorners();for(let n=0;n<o.length;++n)e.Q.transformMat4(o[n],o[n],r);return o}constructor(t,r){this.min=t,this.max=r,this.center=e.Q.scale([],e.Q.add([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],o=e.Q.clone(this.min),n=e.Q.clone(this.max);for(let e=0;e<r.length;e++)o[e]=r[e]?this.min[e]:this.center[e],n[e]=r[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new pd(o,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?dd(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?dd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?hd(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?hd(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ms(pd,"Aabb");const gd=Al([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_d}=gd,yd=Al([{name:"a_pos_3",components:3,type:"Int16"}]);var vd=Al([{name:"a_pos",type:"Int16",components:2}]);function xd(e){return e*Zc/nu}const bd=[new pd([eu,eu,eu],[tu,tu,tu]),new pd([eu,eu,eu],[0,0,tu]),new pd([0,eu,eu],[tu,0,tu]),new pd([eu,0,eu],[0,tu,tu]),new pd([0,0,eu],[tu,tu,tu])];function Ld(t,r,o){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=e.Q.scale([],t._camera.position,t.worldSize),a=[r,o,1,1];e.aa.transformMat4(a,a,t.pixelMatrixInverse),e.aa.scale(a,a,1/a[3]);const s=e.Q.sub([],a,i),l=e.Q.normalize([],s),c=t.globeMatrix,u=[c[12],c[13],c[14]],d=e.Q.sub([],u,i),h=e.Q.length(d),f=e.Q.normalize([],d),m=t.worldSize/(2*Math.PI),p=e.Q.dot(f,l),g=Math.asin(m/h);if(g<Math.acos(p)){if(!n)return null;const t=[],r=[];e.Q.scale(t,l,h/p),e.Q.normalize(r,e.Q.sub(r,t,d)),e.Q.normalize(l,e.Q.add(l,d,e.Q.scale(l,r,Math.tan(g)*h)))}const _=[];new ld(i,l).closestPointOnSphere(u,m,_);const y=e.Q.normalize([],Sr(c,0)),v=e.Q.normalize([],Sr(c,1)),x=e.Q.normalize([],Sr(c,2)),b=e.Q.dot(y,_),L=e.Q.dot(v,_),A=e.Q.dot(x,_),w=jt(Math.asin(-L/m));let S=jt(Math.atan2(b,A));S=t.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(t.center.lng,S);const E=yu(S),T=Yt(vu(w),0,1);return new Cu(E,T)}class Ad{constructor(t,r,o){this.a=e.Q.sub([],t,o),this.b=e.Q.sub([],r,o),this.center=o;const n=e.Q.normalize([],this.a),i=e.Q.normalize([],this.b);this.angle=Math.acos(e.Q.dot(n,i))}}function wd(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,o){const n=Math.sin(r);return e*(Math.sin((1-o)*r)/n)+t*(Math.sin(o*r)/n)}(e.a[t],e.b[t],e.angle,Yt(r,0,1))+e.center[t]}function Sd(e){if(e.z<=1)return bd[e.z+2*e.y+e.x];const t=Rd(Cd(e));return pd.fromPoints(t)}function Ed(t,r,o){return e.Q.scale(t,t,1-o),e.Q.scaleAndAdd(t,t,r,o)}function Td(t,r,o){for(const n of t)e.Q.transformMat4(n,n,r),e.Q.scale(n,n,o)}function Pd(t,r,o,n){const i=r/t.worldSize,a=t.globeMatrix;if(o.z<=1){const e=Sd(o).getCorners();return Td(e,a,i),pd.fromPoints(e)}const s=Cd(o,n),l=Rd(s,Zc+xd(t._tileCoverLift));Td(l,a,i);const c=Number.MAX_VALUE,u=[-c,-c,-c],d=[c,c,c];if(s.contains(t.center)){for(const t of l)e.Q.min(d,d,t),e.Q.max(u,u,t);u[2]=0;const r=t.point,o=[r.x*i,r.y*i,0];return e.Q.min(d,d,o),e.Q.max(u,u,o),new pd(d,u)}if(t._tileCoverLift>0){for(const t of l)e.Q.min(d,d,t),e.Q.max(u,u,t);return new pd(d,u)}const h=[a[12]*i,a[13]*i,a[14]*i],f=s.getCenter(),m=Yt(t.center.lat,-wu,wu),p=Yt(f.lat,-wu,wu),g=yu(t.center.lng),_=vu(m);let y=g-yu(f.lng);const v=_-vu(p);y>.5?y-=1:y<-.5&&(y+=1);let x=0;if(Math.abs(y)>Math.abs(v))x=y>=0?1:3;else{x=v>=0?0:2;const t=[a[4]*i,a[5]*i,a[6]*i],r=-Math.sin(Gt(v>=0?s.getSouth():s.getNorth()))*Zc;e.Q.scaleAndAdd(h,h,t,r)}const b=l[x],L=l[(x+1)%4],A=new Ad(b,L,h),w=[wd(A,0)||b[0],wd(A,1)||b[1],wd(A,2)||b[2]],S=zd(t.zoom);if(S>0){const n=function(e,t,r,o,n){let{x:i,y:a,z:s}=e;const l=1/(1<<s);let c=i*l,u=c+l,d=a*l,h=d+l,f=0;const m=(c+u)/2-o;return m>.5?f=-1:m<-.5&&(f=1),c=((c+f)*t-(o*=t))*r+o,u=((u+f)*t-o)*r+o,d=(d*t-(n*=t))*r+n,h=(h*t-n)*r+n,[[c,h,0],[u,h,0],[u,d,0],[c,d,0]]}(o,r,t._pixelsPerMercatorPixel,g,_);for(let e=0;e<l.length;e++)Ed(l[e],n[e],S);const i=e.Q.add([],n[x],n[(x+1)%4]);e.Q.scale(i,i,.5),Ed(w,i,S)}for(const E of l)e.Q.min(d,d,E),e.Q.max(u,u,E);return d[2]=Math.min(b[2],L[2]),e.Q.min(d,d,w),e.Q.max(u,u,w),new pd(d,u)}function Cd(e){let{x:t,y:r,z:o}=e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=1/(1<<o),a=new au(bu(t*i),r===(1<<o)-1&&n?-90:Lu((r+1)*i)),s=new au(bu((t+1)*i),0===r&&n?90:Lu(r*i));return new su(a,s)}function Rd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zc;const r=Gt(e.getNorth()),o=Gt(e.getSouth()),n=Math.cos(r),i=Math.cos(o),a=Math.sin(r),s=Math.sin(o),l=e.getWest(),c=e.getEast();return[ru(i,s,l,t),ru(i,s,c,t),ru(n,a,c,t),ru(n,a,l,t)]}function Md(e,t,r,o){const n=1<<r.z,i=(e/ii+r.x)/n;return ou(Lu((t/ii+r.y)/n),bu(i),o)}function Id(e){let{min:t,max:r}=e;return $c/Math.max(r[0]-t[0],r[1]-t[1],r[2]-t[2])}const Od=new Float64Array(16);function Dd(t){const r=Id(t),o=e.a9.fromScaling(Od,[r,r,r]);return e.a9.translate(o,o,e.Q.negate([],t.min))}function kd(t){const r=e.a9.fromTranslation(Od,t.min),o=1/Id(t);return e.a9.scale(r,r,[o,o,o])}function Nd(e){const t=ii/(2*Math.PI);return e/(2*Math.PI)/t}function Bd(e,t){return ii/(512*Math.pow(2,e))*Id(Sd(t))}function Fd(t,r,o,n,i){const a=Nd(o),s=[t,r,-o/(2*Math.PI)],l=e.a9.identity(new Float64Array(16));return e.a9.translate(l,l,s),e.a9.scale(l,l,[a,a,a]),e.a9.rotateX(l,l,Gt(-i)),e.a9.rotateY(l,l,Gt(-n)),l}function zd(e){return qt(Yc,qc,e)}function Ud(t,r){const o=ou(r.lat,r.lng),n=function(t){const r=ou(t._center.lat,t._center.lng),o=e.Q.fromValues(0,1,0);let n=e.Q.cross([],o,r);const i=e.a9.fromRotation([],-t.angle,r);n=e.Q.transformMat4(n,n,i),e.a9.fromRotation(i,-t._pitch,n);const a=e.Q.normalize([],r);return e.Q.scale(a,a,xd(t.cameraToCenterDistance/t.pixelsPerMeter)),e.Q.transformMat4(a,a,i),e.Q.add([],r,a)}(t),i=e.Q.subtract([],n,o);return e.Q.angle(i,o)}function Vd(e,t){return Ud(e,t)>Math.PI/2*1.01}const Hd=Gt(85),Gd=Math.cos(Hd),jd=Math.sin(Hd),Wd=e.a9.create(),Kd=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Jd(t,r,o,n,i,a,s,l,c){if(a&&t.queryGeometry.isAboveHorizon)return!1;a&&(c*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,d=o.projection.upVectorScale(u,o.center.lat,o.worldSize).metersToTile;for(const h of r)for(const r of h){const h=r.add(l),f=i&&o.elevation?o.elevation.exaggeration()*i.getElevationAt(h.x,h.y,!0):0,m=o.projection.projectTilePoint(h.x,h.y,u);if(f>0){const e=o.projection.upVector(u,h.x,h.y);m.x+=e[0]*d*f,m.y+=e[1]*d*f,m.z+=e[2]*d*f}const p=a?h:Zd(m.x,m.y,m.z,n),g=a?t.tilespaceRays.map((e=>$d(e,f))):t.queryGeometry.screenGeometry,_=e.aa.transformMat4([],[m.x,m.y,m.z,1],n);if(!s&&a?c*=_[3]/o.cameraToCenterDistance:s&&!a&&(c*=o.cameraToCenterDistance/_[3]),a){const e=Lu((r.y/ii+u.y)/(1<<u.z));c/=o.projection.pixelsPerMeter(e,1)/xu(1,e)}if(Gu(g,p,c))return!0}return!1}function Zd(t,r,o,n){const i=e.aa.transformMat4([],[t,r,o,1],n);return new Ut(i[0]/i[3],i[1]/i[3])}const Yd=e.Q.fromValues(0,0,0),qd=e.Q.fromValues(0,0,1);function $d(t,r){const o=e.Q.create();return Yd[2]=r,t.intersectsPlane(Yd,qd,o),new Ut(o[0],o[1])}class Xd extends Vu{}function Qd(e,t,r,o){let{width:n,height:i}=t;if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==n*i*r)throw new RangeError("mismatched image size")}else o=new Uint8Array(n*i*r);return e.width=n,e.height=i,e.data=o,e}function eh(e,t,r){const{width:o,height:n}=t;o===e.width&&n===e.height||(th(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,o),height:Math.min(e.height,n)},r),e.width=o,e.height=n,e.data=t.data)}function th(e,t,r,o,n,i,a){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||o.x>t.width-n.width||o.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,l=t.data,c=4===i&&a;for(let u=0;u<n.height;u++){const a=((r.y+u)*e.width+r.x)*i,d=((o.y+u)*t.width+o.x)*i;if(c)for(let e=0;e<n.width;e++){const t=a+e*i+3,r=d+e*i;l[r+0]=255,l[r+1]=255,l[r+2]=255,l[r+3]=s[t]}else for(let e=0;e<n.width*i;e++)l[d+e]=s[a+e]}return t}ms(Xd,"HeatmapBucket",{omit:["layers"]});class rh{constructor(e,t){Qd(this,e,1,t)}resize(e){eh(this,new rh(e),1)}clone(){return new rh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,o,n){th(e,t,r,o,n,1)}}class oh{constructor(e,t){Qd(this,e,4,t)}resize(e){eh(this,new oh(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new oh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,o,n,i){th(e,t,r,o,n,4,i)}}class nh{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}ms(rh,"AlphaImage"),ms(oh,"RGBAImage");const ih=new Xs({visibility:new Ys(tl.layout_heatmap.visibility)});var ah={paint:new Xs({"heatmap-radius":new qs(tl.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qs(tl.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ys(tl.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(tl.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ys(tl.paint_heatmap["heatmap-opacity"])}),layout:ih};function sh(e){const t={},r=e.resolution||256,o=e.clips?e.clips.length:1,n=e.image||new oh({width:r,height:o}),i=(r,o,i)=>{t[e.evaluationKey]=i;const a=e.expression.evaluate(t);a&&(n.data[r+o+0]=Math.floor(255*a.r/a.a),n.data[r+o+1]=Math.floor(255*a.g/a.a),n.data[r+o+2]=Math.floor(255*a.b/a.a),n.data[r+o+3]=Math.floor(255*a.a))};if(e.clips)for(let a=0,s=0;a<o;++a,s+=4*r)for(let t=0,o=0;t<r;t++,o+=4){const n=t/(r-1),{start:l,end:c}=e.clips[a];i(s,o,l*(1-n)+c*n)}else for(let a=0,s=0;a<r;a++,s+=4)i(0,s,a/(r-1));return n}const lh=new Xs({visibility:new Ys(tl.layout_hillshade.visibility)});var ch={paint:new Xs({"hillshade-illumination-direction":new Ys(tl.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ys(tl.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ys(tl.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ys(tl.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ys(tl.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ys(tl.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ys(tl.paint_hillshade["hillshade-emissive-strength"])}),layout:lh};const uh=Al([{name:"a_pos",components:2,type:"Int16"}],4),{members:dh}=uh;var hh={exports:{}};function fh(e,t,r){r=r||2;var o,n,i,a,s,l,c,u=t&&t.length,d=u?t[0]*r:e.length,h=mh(e,0,d,r,!0),f=[];if(!h||h.next===h.prev)return f;if(u&&(h=function(e,t,r,o){var n,i,a,s=[];for(n=0,i=t.length;n<i;n++)(a=mh(e,t[n]*o,n<i-1?t[n+1]*o:e.length,o,!1))===a.next&&(a.steiner=!0),s.push(Sh(a));for(s.sort(bh),n=0;n<s.length;n++)r=Lh(s[n],r);return r}(e,t,h,r)),e.length>80*r){o=i=e[0],n=a=e[1];for(var m=r;m<d;m+=r)(s=e[m])<o&&(o=s),(l=e[m+1])<n&&(n=l),s>i&&(i=s),l>a&&(a=l);c=0!==(c=Math.max(i-o,a-n))?32767/c:0}return gh(h,f,r,o,n,c,0),f}function mh(e,t,r,o,n){var i,a;if(n===Fh(e,t,r,o)>0)for(i=t;i<r;i+=o)a=kh(i,e[i],e[i+1],a);else for(i=r-o;i>=t;i-=o)a=kh(i,e[i],e[i+1],a);return a&&Ch(a,a.next)&&(Nh(a),a=a.next),a}function ph(e,t){if(!e)return e;t||(t=e);var r,o=e;do{if(r=!1,o.steiner||!Ch(o,o.next)&&0!==Ph(o.prev,o,o.next))o=o.next;else{if(Nh(o),(o=t=o.prev)===o.next)break;r=!0}}while(r||o!==t);return t}function gh(e,t,r,o,n,i,a){if(e){!a&&i&&function(e,t,r,o){var n=e;do{0===n.z&&(n.z=wh(n.x,n.y,t,r,o)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,o,n,i,a,s,l,c=1;do{for(r=e,e=null,i=null,a=0;r;){for(a++,o=r,s=0,t=0;t<c&&(s++,o=o.nextZ);t++);for(l=c;s>0||l>0&&o;)0!==s&&(0===l||!o||r.z<=o.z)?(n=r,r=r.nextZ,s--):(n=o,o=o.nextZ,l--),i?i.nextZ=n:e=n,n.prevZ=i,i=n;r=o}i.nextZ=null,c*=2}while(a>1)}(n)}(e,o,n,i);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,i?yh(e,o,n,i):_h(e))t.push(s.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),Nh(e),e=l.next,c=l.next;else if((e=l)===c){a?1===a?gh(e=vh(ph(e),t,r),t,r,o,n,i,2):2===a&&xh(e,t,r,o,n,i):gh(ph(e),t,r,o,n,i,1);break}}}function _h(e){var t=e.prev,r=e,o=e.next;if(Ph(t,r,o)>=0)return!1;for(var n=t.x,i=r.x,a=o.x,s=t.y,l=r.y,c=o.y,u=n<i?n<a?n:a:i<a?i:a,d=s<l?s<c?s:c:l<c?l:c,h=n>i?n>a?n:a:i>a?i:a,f=s>l?s>c?s:c:l>c?l:c,m=o.next;m!==t;){if(m.x>=u&&m.x<=h&&m.y>=d&&m.y<=f&&Eh(n,s,i,l,a,c,m.x,m.y)&&Ph(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function yh(e,t,r,o){var n=e.prev,i=e,a=e.next;if(Ph(n,i,a)>=0)return!1;for(var s=n.x,l=i.x,c=a.x,u=n.y,d=i.y,h=a.y,f=s<l?s<c?s:c:l<c?l:c,m=u<d?u<h?u:h:d<h?d:h,p=s>l?s>c?s:c:l>c?l:c,g=u>d?u>h?u:h:d>h?d:h,_=wh(f,m,t,r,o),y=wh(p,g,t,r,o),v=e.prevZ,x=e.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=f&&v.x<=p&&v.y>=m&&v.y<=g&&v!==n&&v!==a&&Eh(s,u,l,d,c,h,v.x,v.y)&&Ph(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=f&&x.x<=p&&x.y>=m&&x.y<=g&&x!==n&&x!==a&&Eh(s,u,l,d,c,h,x.x,x.y)&&Ph(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=f&&v.x<=p&&v.y>=m&&v.y<=g&&v!==n&&v!==a&&Eh(s,u,l,d,c,h,v.x,v.y)&&Ph(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=p&&x.y>=m&&x.y<=g&&x!==n&&x!==a&&Eh(s,u,l,d,c,h,x.x,x.y)&&Ph(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function vh(e,t,r){var o=e;do{var n=o.prev,i=o.next.next;!Ch(n,i)&&Rh(n,o,o.next,i)&&Oh(n,i)&&Oh(i,n)&&(t.push(n.i/r|0),t.push(o.i/r|0),t.push(i.i/r|0),Nh(o),Nh(o.next),o=e=i),o=o.next}while(o!==e);return ph(o)}function xh(e,t,r,o,n,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Th(a,s)){var l=Dh(a,s);return a=ph(a,a.next),l=ph(l,l.next),gh(a,t,r,o,n,i,0),void gh(l,t,r,o,n,i,0)}s=s.next}a=a.next}while(a!==e)}function bh(e,t){return e.x-t.x}function Lh(e,t){var r=function(e,t){var r,o=t,n=e.x,i=e.y,a=-1/0;do{if(i<=o.y&&i>=o.next.y&&o.next.y!==o.y){var s=o.x+(i-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(s<=n&&s>a&&(a=s,r=o.x<o.next.x?o:o.next,s===n))return r}o=o.next}while(o!==t);if(!r)return null;var l,c=r,u=r.x,d=r.y,h=1/0;o=r;do{n>=o.x&&o.x>=u&&n!==o.x&&Eh(i<d?n:a,i,u,d,i<d?a:n,i,o.x,o.y)&&(l=Math.abs(i-o.y)/(n-o.x),Oh(o,e)&&(l<h||l===h&&(o.x>r.x||o.x===r.x&&Ah(r,o)))&&(r=o,h=l)),o=o.next}while(o!==c);return r}(e,t);if(!r)return t;var o=Dh(r,e);return ph(o,o.next),ph(r,r.next)}function Ah(e,t){return Ph(e.prev,e,t.prev)<0&&Ph(t.next,e,e.next)<0}function wh(e,t,r,o,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Sh(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Eh(e,t,r,o,n,i,a,s){return(n-a)*(t-s)>=(e-a)*(i-s)&&(e-a)*(o-s)>=(r-a)*(t-s)&&(r-a)*(i-s)>=(n-a)*(o-s)}function Th(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Rh(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Oh(e,t)&&Oh(t,e)&&function(e,t){var r=e,o=!1,n=(e.x+t.x)/2,i=(e.y+t.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&n<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(o=!o),r=r.next}while(r!==e);return o}(e,t)&&(Ph(e.prev,e,t.prev)||Ph(e,t.prev,t))||Ch(e,t)&&Ph(e.prev,e,e.next)>0&&Ph(t.prev,t,t.next)>0)}function Ph(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Ch(e,t){return e.x===t.x&&e.y===t.y}function Rh(e,t,r,o){var n=Ih(Ph(e,t,r)),i=Ih(Ph(e,t,o)),a=Ih(Ph(r,o,e)),s=Ih(Ph(r,o,t));return n!==i&&a!==s||!(0!==n||!Mh(e,r,t))||!(0!==i||!Mh(e,o,t))||!(0!==a||!Mh(r,e,o))||!(0!==s||!Mh(r,t,o))}function Mh(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Ih(e){return e>0?1:e<0?-1:0}function Oh(e,t){return Ph(e.prev,e,e.next)<0?Ph(e,t,e.next)>=0&&Ph(e,e.prev,t)>=0:Ph(e,t,e.prev)<0||Ph(e,e.next,t)<0}function Dh(e,t){var r=new Bh(e.i,e.x,e.y),o=new Bh(t.i,t.x,t.y),n=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,o.next=r,r.prev=o,i.next=o,o.prev=i,o}function kh(e,t,r,o){var n=new Bh(e,t,r);return o?(n.next=o.next,n.prev=o,o.next.prev=n,o.next=n):(n.prev=n,n.next=n),n}function Nh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Bh(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Fh(e,t,r,o){for(var n=0,i=t,a=r-o;i<r;i+=o)n+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return n}hh.exports=fh,hh.exports.default=fh,fh.deviation=function(e,t,r,o){var n=t&&t.length,i=Math.abs(Fh(e,0,n?t[0]*r:e.length,r));if(n)for(var a=0,s=t.length;a<s;a++)i-=Math.abs(Fh(e,t[a]*r,a<s-1?t[a+1]*r:e.length,r));var l=0;for(a=0;a<o.length;a+=3){var c=o[a]*r,u=o[a+1]*r,d=o[a+2]*r;l+=Math.abs((e[c]-e[d])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[d+1]-e[c+1]))}return 0===i&&0===l?0:Math.abs((l-i)/i)},fh.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},o=0,n=0;n<e.length;n++){for(var i=0;i<e[n].length;i++)for(var a=0;a<t;a++)r.vertices.push(e[n][i][a]);n>0&&r.holes.push(o+=e[n-1].length)}return r};var zh=d(hh.exports);function Uh(e,t){const r=e.length;if(r<=1)return[e];const o=[];let n,i;for(let a=0;a<r;a++){const t=fr(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(n&&o.push(n),n=[e[a]]):n.push(e[a]))}if(n&&o.push(n),t>1)for(let a=0;a<o.length;a++)o[a].length<=t||(kn(o[a],t,1,o[a].length-1,Vh),o[a]=o[a].slice(0,t));return o}function Vh(e,t){return t.area-e.area}function Hh(e,t,r){const o=r.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const r=t.constantOr(null);r&&(n=!0,o[r]=!0)}return n}function Gh(e,t,r,o,n){const i=n.patternDependencies;for(const a of t){const t=a.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:o},r,{},n.availableImages);e=e&&e.name?e.name:e,i[e]=!0,r.patterns[a.id]=e}}return r}class jh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Sl,this.indexArray=new Gl,this.indexArray2=new Fl,this.programConfigurations=new Hc(e.layers,e.zoom),this.segments=new pc,this.segments2=new pc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,r,o){this.hasPattern=Hh("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),i=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Fu(a,e);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom),u,r))continue;const d=n?n.evaluate(u,{},r,t.availableImages):void 0,h={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Bu(a,r,o),patterns:{},sortKey:d};i.push(h)}n&&i.sort(((e,t)=>e.sortKey-t.sortKey));for(const a of i){const{geometry:o,index:n,sourceLayerIndex:i}=a;if(this.hasPattern){const e=Gh("fill",this.layers,a,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(a,o,n,r,{},t.availableImages,t.brightness);t.featureIndex.insert(e[n].feature,o,n,i,this.index)}}update(e,t,r,o,n){const i=0!==Object.keys(e).length;i&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,i?this.stateDependentLayers:this.layers,r,o,n)}addFeatures(e,t,r,o,n,i){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,r,o,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,r,o,n){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0;for(const s of Uh(t,500)){let e=0;for(const a of s)e+=a.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=t.vertexLength,o=[],n=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&n.push(o.length/2);const e=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(t+a.length-1,t),o.push(a[0].x),o.push(a[0].y);for(let r=1;r<a.length;r++)this.layoutVertexArray.emplaceBack(a[r].x,a[r].y),this.indexArray2.emplaceBack(t+r-1,t+r),o.push(a[r].x),o.push(a[r].y);e.vertexLength+=a.length,e.primitiveLength+=a.length}const i=zh(o,n);for(let a=0;a<i.length;a+=3)this.indexArray.emplaceBack(r+i[a],r+i[a+1],r+i[a+2]);t.vertexLength+=e,t.primitiveLength+=i.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,i,o,a)}}ms(jh,"FillBucket",{omit:["layers","patternFeatures"]});const Wh=new Xs({"fill-sort-key":new qs(tl.layout_fill["fill-sort-key"]),visibility:new Ys(tl.layout_fill.visibility)});var Kh={paint:new Xs({"fill-antialias":new Ys(tl.paint_fill["fill-antialias"]),"fill-opacity":new qs(tl.paint_fill["fill-opacity"]),"fill-color":new qs(tl.paint_fill["fill-color"]),"fill-outline-color":new qs(tl.paint_fill["fill-outline-color"]),"fill-translate":new Ys(tl.paint_fill["fill-translate"]),"fill-translate-anchor":new Ys(tl.paint_fill["fill-translate-anchor"]),"fill-pattern":new qs(tl.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ys(tl.paint_fill["fill-emissive-strength"])}),layout:Wh};const Jh=Al([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Zh=Al([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Yh=Al([{name:"a_centroid_pos",components:2,type:"Uint16"}]),qh=Al([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$h=Al([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Xh}=Jh;var Qh={},ef=Ft,tf=rf;function rf(e,t,r,o,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=o,this._values=n,e.readFields(of,this,t)}function of(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var o=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[o]=n}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function nf(e){for(var t,r,o=0,n=0,i=e.length,a=i-1;n<i;a=n++)o+=((r=e[a]).x-(t=e[n]).x)*(t.y+r.y);return o}rf.types=["Unknown","Point","LineString","Polygon"],rf.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,o=1,n=0,i=0,a=0,s=[];e.pos<r;){if(n<=0){var l=e.readVarint();o=7&l,n=l>>3}if(n--,1===o||2===o)i+=e.readSVarint(),a+=e.readSVarint(),1===o&&(t&&s.push(t),t=[]),t.push(new ef(i,a));else{if(7!==o)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&s.push(t),s},rf.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,o=0,n=0,i=0,a=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(o<=0){var u=e.readVarint();r=7&u,o=u>>3}if(o--,1===r||2===r)(n+=e.readSVarint())<a&&(a=n),n>s&&(s=n),(i+=e.readSVarint())<l&&(l=i),i>c&&(c=i);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,c]},rf.prototype.toGeoJSON=function(e,t,r){var o,n,i=this.extent*Math.pow(2,r),a=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=rf.types[this.type];function u(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+a)/i-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/i)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(o=0;o<l.length;o++)d[o]=l[o][0];u(l=d);break;case 2:for(o=0;o<l.length;o++)u(l[o]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var r,o,n=[],i=0;i<t;i++){var a=nf(e[i]);0!==a&&(void 0===o&&(o=a<0),o===a<0?(r&&n.push(r),r=[e[i]]):r.push(e[i]))}return r&&n.push(r),n}(l),o=0;o<l.length;o++)for(n=0;n<l[o].length;n++)u(l[o][n])}1===l.length?l=l[0]:c="Multi"+c;var h={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h};var af=tf,sf=lf;function lf(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cf,this,t),this.length=this._features.length}function cf(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var o=e.readVarint()>>3;t=1===o?e.readString():2===o?e.readFloat():3===o?e.readDouble():4===o?e.readVarint64():5===o?e.readVarint():6===o?e.readSVarint():7===o?e.readBoolean():null}return t}(r))}lf.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new af(this._pbf,t,this.extent,this._keys,this._values)};var uf=sf;function df(e,t,r){if(3===e){var o=new uf(r,r.readVarint()+r.pos);o.length&&(t[o.name]=o)}}var hf=Qh.VectorTile=function(e,t){this.layers=e.readFields(df,{},t)},ff=Qh.VectorTileFeature=tf;function mf(e,t,r,o){const n=[],i=0===o?(e,t,r,o,n,i)=>{e.push(new Ut(i,r+(i-t)/(o-t)*(n-r)))}:(e,t,r,o,n,i)=>{e.push(new Ut(t+(i-r)/(n-r)*(o-t),i))};for(const a of e){const e=[];for(const n of a){if(n.length<=2)continue;const a=[];for(let e=0;e<n.length-1;e++){const s=n[e].x,l=n[e].y,c=n[e+1].x,u=n[e+1].y,d=0===o?s:l,h=0===o?c:u;d<t?h>t&&i(a,s,l,c,u,t):d>r?h<r&&i(a,s,l,c,u,r):a.push(n[e]),h<t&&d>=t&&i(a,s,l,c,u,t),h>r&&d<=r&&i(a,s,l,c,u,r)}let s=n[n.length-1];const l=0===o?s.x:s.y;l>=t&&l<=r&&a.push(s),a.length&&(s=a[a.length-1],a[0].x===s.x&&a[0].y===s.y||a.push(a[0]),e.push(a))}e.length&&n.push(e)}return n}function pf(e,t){return e.x-t.x||e.y-t.y}function gf(e,t){return 0===pf(e.min,t.min)&&0===pf(e.max,t.max)}function _f(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function yf(e,t,r){const o=1/ii,n=1/(1<<r.canonical.z),i=(t.x*o+r.canonical.x)*n+r.wrap,a=(t.y*o+r.canonical.y)*n;return{min:new Ut((e.x*o+r.canonical.x)*n+r.wrap,(e.y*o+r.canonical.y)*n),max:new Ut(i,a)}}function vf(e,t,r){const o=1<<r.canonical.z,n=((t.x-r.wrap)*o-r.canonical.x)*ii,i=(t.y*o-r.canonical.y)*ii;return{min:new Ut(((e.x-r.wrap)*o-r.canonical.x)*ii,(e.y*o-r.canonical.y)*ii),max:new Ut(n,i)}}function xf(e,t,r,o,n,i,a){const s=e.indices,l=e.vertices,c=[];for(let u=o;u<o+n;u+=3){const o=t[r[u+0]+i],n=t[r[u+1]+i],d=t[r[u+2]+i],h=Math.min(o.x,n.x,d.x),f=Math.max(o.x,n.x,d.x),m=Math.min(o.y,n.y,d.y),p=Math.max(o.y,n.y,d.y);c.length=0,e.grid.query(new Ut(h,m),new Ut(f,p),c);for(let e=0;e<c.length;e++){const t=c[e];if(td(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],o,n,d,a))return!0}}return!1}function bf(e,t,r,o){if(!e||!r)return!1;let n=e.vertices;if(!t.canonical.equals(o.canonical)||t.wrap!==o.wrap){if(r.vertices.length<e.vertices.length)return bf(r,o,e,t);const i=t.canonical,a=o.canonical,s=Math.pow(2,a.z-i.z);n=e.vertices.map((e=>new Ut((e.x+i.x*ii)*s-a.x*ii,(e.y+i.y*ii)*s-a.y*ii)))}return xf(r,n,e.indices,0,e.indices.length,0,0)}Qh.VectorTileLayer=sf;class Lf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Af(e,t,r,o){let n=0,i=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(o[a])<1e-15){if(r[a]<e[a]||r[a]>t[a])return null}else{const s=1/o[a];let l=(e[a]-r[a])*s,c=(t[a]-r[a])*s;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<i&&(i=c),n>i)return null}return n}function wf(e,t,r,o,n,i,a,s,l,c,u){const d=o-e,h=n-t,f=i-r,m=a-e,p=s-t,g=l-r,_=u[1]*g-u[2]*p,y=u[2]*m-u[0]*g,v=u[0]*p-u[1]*m,x=d*_+h*y+f*v;if(Math.abs(x)<1e-15)return null;const b=1/x,L=c[0]-e,A=c[1]-t,w=c[2]-r,S=(L*_+A*y+w*v)*b;if(S<0||S>1)return null;const E=A*f-w*h,T=w*d-L*f,P=L*h-A*d,C=(u[0]*E+u[1]*T+u[2]*P)*b;return C<0||S+C>1?null:(m*E+p*T+g*P)*b}function Sf(e,t,r){return(e-t)/(r-t)}function Ef(e,t,r,o,n,i,a,s,l){const c=1<<r,u=i-o,d=a-n,h=(e+1)/c*u+o,f=(t+0)/c*d+n,m=(t+1)/c*d+n;s[0]=(e+0)/c*u+o,s[1]=f,l[0]=h,l[1]=m}class Tf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let o=Math.ceil(Math.pow(2,t));const n=1/o,i=(e,t,r,o,n)=>{const i=o?1:0,a=(e+1)*r-i,s=t*r,l=(t+1)*r-i;n[0]=e*r,n[1]=s,n[2]=a,n[3]=l};let a=new Lf(o);const s=[];for(let l=0;l<o*o;l++){i(l%o,Math.floor(l/o),n,!1,s);const t=Cf(s[0],s[1],e),r=Cf(s[2],s[1],e),c=Cf(s[2],s[3],e),u=Cf(s[0],s[3],e);a.minimums.push(Math.min(t,r,c,u)),a.maximums.push(Math.max(t,r,c,u)),a.leaves.push(1)}for(r.push(a),o/=2;o>=1;o/=2){const e=r[r.length-1];a=new Lf(o);for(let t=0;t<o*o;t++){i(t%o,Math.floor(t/o),2,!0,s);const r=e.getElevation(s[0],s[1]),n=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),u=e.isLeaf(s[0],s[1]),d=e.isLeaf(s[2],s[1]),h=e.isLeaf(s[2],s[3]),f=e.isLeaf(s[0],s[3]),m=Math.min(r.min,n.min,l.min,c.min),p=Math.max(r.max,n.max,l.max,c.max),g=u&&d&&h&&f;a.maximums.push(p),a.minimums.push(m),a.leaves.push(p-m<=5&&g?1:0)}r.push(a)}return r}(this.dem),r=t.length-1,o=t[r];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,o,n,i){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Af([e,t,-100],[r,o,this.maximums[0]*a],n,i)}raycast(t,r,o,n,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const l=this.raycastRoot(t,r,o,n,i,a,s);if(null==l)return null;const c=[],u=[],d=[],h=[],f=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;f.length>0;){const{idx:l,t:m,nodex:p,nodey:g,depth:_}=f.pop();if(this.leaves[l]){Ef(p,g,_,t,r,o,n,d,h);const l=1<<_,c=(p+0)/l,u=(p+1)/l,f=(g+0)/l,y=(g+1)/l,v=Cf(c,f,this.dem)*s,x=Cf(u,f,this.dem)*s,b=Cf(u,y,this.dem)*s,L=Cf(c,y,this.dem)*s,A=wf(d[0],d[1],v,h[0],d[1],x,h[0],h[1],b,i,a),w=wf(h[0],h[1],b,d[0],h[1],L,d[0],d[1],v,i,a),S=Math.min(null!==A?A:Number.MAX_VALUE,null!==w?w:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=e.Q.scaleAndAdd([],i,a,m);if(Pf(v,x,L,b,Sf(t[0],d[0],h[0]),Sf(t[1],d[1],h[1]))>=t[2])return m}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){Ef((p<<1)+this._siblingOffset[e][0],(g<<1)+this._siblingOffset[e][1],_+1,t,r,o,n,d,h),d[2]=-100,h[2]=this.maximums[this.childOffsets[l]+e]*s;const f=Af(d,h,i,a);if(null!=f){const t=f;c[e]=t;let r=!1;for(let o=0;o<y&&!r;o++)t>=c[u[o]]&&(u.splice(o,0,e),r=!0);r||(u[y]=e),y++}}for(let e=0;e<y;e++){const t=u[e];f.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(p<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:_+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,o,n){if(1===e[o].isLeaf(t,r))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const i=o-1,a=e[i];let s=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],o=2*r+this._siblingOffset[c][1],n=a.getElevation(e,o),i=a.isLeaf(e,o),u=this._addNode(n.min,n.max,i);i&&(s|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*r+this._siblingOffset[c][1],i,l+c)}}function Pf(e,t,r,o,n,i){return Go(Go(e,r,i),Go(t,o,i),n)}function Cf(e,t,r){const o=r.dim,n=Yt(e*o-.5,0,o-1),i=Yt(t*o-.5,0,o-1),a=Math.floor(n),s=Math.floor(i),l=Math.min(a+1,o-1),c=Math.min(s+1,o-1);return Pf(r.get(a,s),r.get(l,s),r.get(a,c),r.get(l,c),n-a,i-s)}const Rf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Mf(e,t,r){return(256*e*256+256*t+r)/10-1e4}function If(e,t,r){return 256*e+t+r/256-32768}class Of{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return dr(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const n=this.dim=t.height-2,i=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=o,this._modifiedForSources={},!o){for(let e=0;e<n;e++)i[this._idx(-1,e)]=i[this._idx(0,e)],i[this._idx(n,e)]=i[this._idx(n-1,e)],i[this._idx(e,-1)]=i[this._idx(e,0)],i[this._idx(e,n)]=i[this._idx(e,n-1)];i[this._idx(-1,-1)]=i[this._idx(0,0)],i[this._idx(n,-1)]=i[this._idx(n-1,0)],i[this._idx(-1,n)]=i[this._idx(0,n-1)],i[this._idx(n,n)]=i[this._idx(n-1,n-1)]}const a="terrarium"===r?If:Mf;for(let s=0;s<i.length;++s){const e=4*s;this.floatView[s]=a(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=Mr.now()}_buildQuadTree(){this._tree=new Tf(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Yt(e,-1,this.dim),t=Yt(t,-1,this.dim));const r=this._idx(e,t);return this.floatView[r]}set(e,t,r){const o=this._idx(e,t),n=this.floatView[o];return this.floatView[o]=r,r-n}static getUnpackVector(e){return Rf[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const r=[0,0,0,0],o=Of.getUnpackVector(t);let n=Math.floor((e+o[3])/o[2]);return r[2]=n%256,n=Math.floor(n/256),r[1]=n%256,n=Math.floor(n/256),r[0]=n,r}getPixels(){return new nh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=t*this.dim,n=t*this.dim+this.dim,i=r*this.dim,a=r*this.dim+this.dim;switch(t){case-1:o=n-1;break;case 1:n=o+1}switch(r){case-1:i=a-1;break;case 1:a=i+1}const s=-t*this.dim,l=-r*this.dim;for(let c=i;c<a;c++)for(let t=o;t<n;t++){const r=4*this._idx(t,c),o=4*this._idx(t+s,c+l);this.pixels[r+0]=e.pixels[o+0],this.pixels[r+1]=e.pixels[o+1],this.pixels[r+2]=e.pixels[o+2],this.pixels[r+3]=e.pixels[o+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ms(Of,"DEMData"),ms(Tf,"DemMinMaxQuadTree",{omit:["dem"]});class Df{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const o=r||e.findDEMTileFor(t);if(!o||!o.dem)return;const n=o.dem,i=o.tileID,a=1<<t.canonical.z-i.canonical.z;return new Df(o,n.dim/ii/a,[(t.canonical.x/a-i.canonical.x)*n.dim,(t.canonical.y/a-i.canonical.y)*n.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1],o=Math.floor(e*this._scale+this._offset[0]),n=Math.floor(r);return new Ut(o,n)}getElevationAt(e,t,r,o){const n=e*this._scale+this._offset[0],i=t*this._scale+this._offset[1],a=Math.floor(n),s=Math.floor(i),l=this._dem;return o=!!o,r?Go(Go(l.get(a,s,o),l.get(a,s+1,o),i-s),Go(l.get(a+1,s,o),l.get(a+1,s+1,o),i-s),n-a):l.get(a,s,o)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*xu(1,e)*this._dem.stride}}const kf=ff.types,Nf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Bf=["fill-extrusion-flood-light-ground-radius"],Ff=Math.pow(2,13),zf=Math.pow(2,15)-1,Uf=new Ut(0,1),Vf=2147483648;function Hf(e,t,r,o,n,i,a,s){e.emplaceBack((t<<1)+a,(r<<1)+i,(Math.floor(o*Ff)<<1)+n,Math.round(s))}function Gf(e,t,r,o,n,i){e.emplaceBack(t.x,t.y,(r.x<<1)+o,(r.y<<1)+n,i)}function jf(e,t,r){const o=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*o,r[1]*o,r[2]*o)}class Wf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Kf{constructor(){this.centroidXY=new Ut(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ut(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ut(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ut(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jf{constructor(){this.acc=new Ut(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,r){this.accCount++,this.acc._add(t);let o=!!this.borders;t.x<e.min.x?(e.min.x=t.x,o=!0):t.x>e.max.x&&(e.max.x=t.x,o=!0),t.y<e.min.y?(e.min.y=t.y,o=!0):t.y>e.max.y&&(e.max.y=t.y,o=!0),((0===t.x||t.x===ii)&&t.x===r.x)!=((0===t.y||t.y===ii)&&t.y===r.y)&&this.processBorderOverlap(t,r),o&&this.checkBorderIntersection(t,r)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Go(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ii!=e.x>ii&&this.addBorderIntersection(1,Go(t.y,e.y,(ii-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Go(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ii!=e.y>ii&&this.addBorderIntersection(3,Go(t.x,e.x,(ii-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new Ut(0,0):new Ut(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function Zf(e,t){const r=e.add(t)._unit(),o=Yt(e.x*r.x+e.y*r.y,-1,1);var n,i,a;return n=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(n)))/4*zf*((i=e).x*(a=t).y-i.y*a.x<0?-1:1)}const Yf=[e=>e.x<0,e=>e.x>ii,e=>e.y<0,e=>e.y>ii];function qf(e,t,r,o){const n=[4];if(0===o)return n;r._mult(o);const i=e.sub(r),a=t.sub(r),s=[e,t,i,a];for(let l=0;l<4;l++)for(const e of s)if(Yf[l](e)){n.push(l);break}return n}class $f{constructor(e){this.vertexArray=new Pl,this.indexArray=new Gl,this.programConfigurations=new Hc(e.layers,e.zoom,(e=>Bf.includes(e))),this._segments=new pc,this.hiddenByLandmarkVertexArray=new tc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new pc}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=e.length;if(n>2){let i=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[i].length);let s;i!==this._segments.get().length-1&&(i++,this._segmentToGroundQuads[i]=[],this._segmentToRegionTriCounts[i]=[0,0,0,0,0]);{const t=e[0],r=e[1];s=Zf(t.sub(e[n-1])._perp()._unit(),r.sub(t)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=e[l],d=e[c],h=e[c===n-1?0:c+1],f=d.sub(u)._perp()._unit(),m=Zf(f,h.sub(d)._perp()._unit()),p=s,g=m;if(rm(u,d,t)||o&&om(u,t)&&om(d,t)){s=m;continue}const _=a.vertexLength;Gf(this.vertexArray,u,d,1,1,p),Gf(this.vertexArray,u,d,1,0,p),Gf(this.vertexArray,u,d,0,1,g),Gf(this.vertexArray,u,d,0,0,g),a.vertexLength+=4;const y=qf(u,d,f,r);for(const e of y)this._segmentToGroundQuads[i].push({id:_,region:e}),this._segmentToRegionTriCounts[i][e]+=2,a.primitiveLength+=2;s=m}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let r=0;r<t;r++)this._segmentToGroundQuads[r].sort(((e,t)=>e.region-t.region));for(let r=0;r<t;r++){const t=this._segmentToGroundQuads[r],o=e[r],n=this._segmentToRegionTriCounts[r];n.reduce(((e,t)=>e+t),0);let i=0;for(let e=0;e<=4;e++){const t=n[e];if(0!==t){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new pc);const n={vertexOffset:o.vertexOffset,primitiveOffset:o.primitiveOffset+i,vertexLength:o.vertexLength,primitiveLength:t};r.get().push(n)}i+=t}for(let e=0;e<t.length;e++){const r=t[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,r,o,n,i){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,r,o,n,i)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Zh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,r,o,n,i){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,r,o,n,i)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const r=e.flags&Vf?1:0;for(let o=e.groundVertexArrayOffset;o<t;++o)this.hiddenByLandmarkVertexArray.emplace(o,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,qh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class Xf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gl,this.footprintVertices=new Sl,this.footprintSegments=[],this.layoutVertexArray=new Tl,this.centroidVertexArray=new hc,this.indexArray=new Gl,this.programConfigurations=new Hc(e.layers,e.zoom,(e=>Nf.includes(e))),this.segments=new pc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new $f(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,r,o){this.features=[],this.hasPattern=Hh("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Pu(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:i,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Fu(n,e);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom),l,r))continue;const c={id:i,sourceLayerIndex:s,index:a,geometry:e?l.geometry:Bu(n,r,o),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Gh("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,a,r,{},t.availableImages,o,t.brightness),t.featureIndex.insert(n,c.geometry,a,s,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,r,o,n,i){for(const a of this.features){const{geometry:e}=a;this.addFeature(a,e,a.index,t,r,o,n,i)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,r,o,n){const i=0!==Object.keys(e).length;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,a,r,o,n),this.groundEffect.update(e,t,a,r,o,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,$h.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Yh.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,o,n,i,a,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new Ut(0,0),new Ut(ii,ii)],u=a.projection,d="globe"===u.name,h="Polygon"===kf[e.type],f=new Jf;f.centroidDataIndex=this.centroidData.length;const m=new Kf,p=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},o)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},o);m.height=g,m.vertexArrayOffset=this.layoutVertexArray.length,m.groundVertexArrayOffset=this.groundEffect.vertexArray.length,d&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Dl);const _=Uh(t,500);for(let A=_.length-1;A>=0;A--){const e=_[A];(0===e.length||(y=e[0]).every((e=>e.x<=0))||y.every((e=>e.x>=ii))||y.every((e=>e.y<=0))||y.every((e=>e.y>=ii)))&&_.splice(A,1)}var y;let v;if(d)v=sm(_,c,o);else{v=[];for(const e of _)v.push({polygon:e,bounds:c})}const x=h?this.edgeRadius:0,b=x>0&&this.zoom<17,L=(e,t)=>{if(0===e.length)return!1;const r=e[e.length-1];return t.x===r.x&&t.y===r.y};for(const{polygon:A,bounds:w}of v){let e=0,t=0;for(const o of A)h&&!o[0].equals(o[o.length-1])&&o.push(o[0]),t+=h?o.length-1:o.length;const r=this.segments.prepareSegment((h?5:4)*t,this.layoutVertexArray,this.indexArray);m.footprintSegIdx<0&&(m.footprintSegIdx=this.footprintSegments.length),m.polygonSegIdx<0&&(m.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},i=new Wf;if(i.vertexOffset=this.footprintVertices.length,i.indexOffset=3*this.footprintIndices.length,i.ringIndices=[],h){const t=[],n=[];e=r.vertexLength;for(let e=0;e<A.length;e++){const a=A[e];a.length&&0!==e&&n.push(t.length/2);const s=[];let c,h;c=a[1].sub(a[0])._perp()._unit(),i.ringIndices.push(a.length-1);for(let e=1;e<a.length;e++){const n=a[e],i=a[e===a.length-1?1:e+1],l=n.clone();if(x){h=i.sub(n)._perp()._unit();const e=c.add(h)._unit(),t=x*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=h}!p||0!==x&&!b||L(s,l)||s.push(l),Hf(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),r.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),d&&jf(this.layoutVertexExtArray,u.projectTilePoint(l.x,l.y,o),u.upVector(o,l.x,l.y))}p&&(0===x||b)&&(0!==s.length&&L(s,s[0])&&s.pop(),this.groundEffect.addData(s,w,l))}const a=zh(t,n);for(let o=0;o<a.length;o+=3)this.footprintIndices.emplaceBack(i.vertexOffset+a[o+0],i.vertexOffset+a[o+1],i.vertexOffset+a[o+2]),this.indexArray.emplaceBack(e+a[o],e+a[o+2],e+a[o+1]),r.primitiveLength++;i.indexCount+=a.length,i.vertexCount+=this.footprintVertices.length-i.vertexOffset}for(let a=0;a<A.length;a++){const t=A[a];f.startRing(m,t[0]);let n=t.length>4&&nm(t[t.length-2],t[0],t[1]),i=x?em(t[t.length-2],t[0],t[1],x):0;const s=[];let c,g,_;g=t[1].sub(t[0])._perp()._unit();let y=!0;for(let a=1,l=0;a<t.length;a++){let h=t[a-1],v=t[a];const b=t[a===t.length-1?1:a+1];if(f.appendEdge(m,v,h),rm(v,h,w)){x&&(g=b.sub(v)._perp()._unit(),y=!y);continue}const A=v.sub(h)._perp(),S=A.x/(Math.abs(A.x)+Math.abs(A.y)),E=A.y>0?1:0,T=h.dist(v);if(l+T>32768&&(l=0),x){_=b.sub(v)._perp()._unit();let e=tm(h,v,b,Qf(g,_),x);isNaN(e)&&(e=0);const t=v.sub(h)._unit();h=h.add(t.mult(i))._round(),v=v.add(t.mult(-e))._round(),i=e,g=_,p&&this.zoom>=17&&(L(s,h)||s.push(h),L(s,v)||s.push(v))}const P=r.vertexLength,C=t.length>4&&nm(h,v,b);let R=im(l,n,y);if(Hf(this.layoutVertexArray,h.x,h.y,S,E,0,0,R),Hf(this.layoutVertexArray,h.x,h.y,S,E,0,1,R),l+=T,R=im(l,C,!y),n=C,Hf(this.layoutVertexArray,v.x,v.y,S,E,0,0,R),Hf(this.layoutVertexArray,v.x,v.y,S,E,0,1,R),r.vertexLength+=4,this.indexArray.emplaceBack(P+0,P+1,P+2),this.indexArray.emplaceBack(P+1,P+3,P+2),r.primitiveLength+=2,x){const o=e+(1===a?t.length-2:a-2),n=1===a?e:o+1;if(this.indexArray.emplaceBack(P+1,o,P+3),this.indexArray.emplaceBack(o,n,P+3),r.primitiveLength+=2,void 0===c&&(c=P),!rm(b,t[a],w)){const e=a===t.length-1?c:r.vertexLength;this.indexArray.emplaceBack(P+2,P+3,e),this.indexArray.emplaceBack(P+3,e+1,e),this.indexArray.emplaceBack(P+3,n,e+1),r.primitiveLength+=3}y=!y}if(d){const e=this.layoutVertexExtArray,t=u.projectTilePoint(h.x,h.y,o),r=u.projectTilePoint(v.x,v.y,o),n=u.upVector(o,h.x,h.y),i=u.upVector(o,v.x,v.y);jf(e,t,n),jf(e,t,n),jf(e,r,i),jf(e,r,i)}}h&&(e+=t.length-1),p&&x&&this.zoom>=17&&(0!==s.length&&L(s,s[0])&&s.pop(),this.groundEffect.addData(s,w,l,x>0))}this.footprintSegments.push(i),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++m.footprintSegLen,++m.polygonSegLen}if(m.vertexCount=this.layoutVertexArray.length-m.vertexArrayOffset,m.groundVertexCount=this.groundEffect.vertexArray.length-m.groundVertexArrayOffset,0!==m.vertexCount){if(m.centroidXY=f.borders?Uf:this.encodeCentroid(f,m),this.centroidData.push(m),f.borders){this.featuresOnBorder.push(f);const e=this.featuresOnBorder.length-1;for(let t=0;t<f.borders.length;t++)f.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,i,o,s),this.groundEffect.addPaintPropertiesData(e,r,n,i,o,s),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0]))}splitToSubtiles(){const e=[];for(let a=0;a<this.centroidData.length;a++){const t=this.centroidData[a],r=+(t.min.y+t.max.y>ii),o=2*r+(+(t.min.x+t.max.x>ii)^r);for(let n=0;n<t.polygonSegLen;n++){const r=t.polygonSegIdx+n;e.push({centroidIdx:a,subtile:o,polygonSegmentIdx:r,triangleSegmentIdx:this.polygonSegments[r].triangleSegIdx})}}const t=new Gl;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let r=0,o=0,n=0;for(const a of e){if(a.triangleSegmentIdx!==r)break;n++}const i=e.length;for(;o!==e.length;){r=e[o].triangleSegmentIdx;let a=0,s=o,l=o;for(let t=s;t<n&&e[t].subtile===a;t++)l++;for(;s!==n;){const o=e[s];a=o.subtile;const i=this.centroidData[o.centroidIdx].min.clone(),c=this.centroidData[o.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=s;r<l;r++){const o=e[r],n=this.polygonSegments[o.polygonSegmentIdx],a=this.centroidData[o.centroidIdx].min,s=this.centroidData[o.centroidIdx].max,l=this.indexArray.uint16;for(let e=n.triangleArrayOffset;e<n.triangleArrayOffset+n.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=n.triangleCount,i.x=Math.min(i.x,a.x),i.y=Math.min(i.y,a.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:i,max:c}),s=l;for(let t=s;t<n&&e[t].subtile===e[s].subtile;t++)l++}o=n;for(let t=o;t<i&&e[t].triangleSegmentIdx===e[o].triangleSegmentIdx;t++)n++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,r){let o=0,n=0;const i=1<<e.canonical.z;if(t){const r=t.getMinMaxForTile(e);r&&(o=r.min,n=r.max)}n+=this.maxHeight;const a=e.toUnwrapped();let s;const l=[a.canonical.x/i+a.wrap,a.canonical.y/i],c=[(a.canonical.x+1)/i+a.wrap,(a.canonical.y+1)/i],u=new pc,d=(e,t,r)=>[e[0]*(1-r[0])+t[0]*r[0],e[1]*(1-r[1])+t[1]*r[1]],h=[],f=[];for(const m of this.triangleSubSegments){h[0]=m.min.x/ii,h[1]=m.min.y/ii,f[0]=m.max.x/ii,f[1]=m.max.y/ii;const e=d(l,c,h),t=d(l,c,f);if(0===new pd([e[0],e[1],o],[t[0],t[1],n]).intersectsPrecise(r)){s&&(u.segments.push(s),s=void 0);continue}const i=m.segment;s&&s.vertexOffset!==i.vertexOffset&&(u.segments.push(s),s=void 0),s?(s.vertexLength+=i.vertexLength,s.primitiveLength+=i.primitiveLength):s={vertexOffset:i.vertexOffset,primitiveLength:i.primitiveLength,vertexLength:i.vertexLength,primitiveOffset:i.primitiveOffset,sortKey:void 0,vaos:{}}}return s&&u.segments.push(s),u}encodeCentroid(e,t){const r=e.centroid(),o=t.span(),n=Math.min(7,Math.round(o.x*this.tileToMeter/10)),i=Math.min(7,Math.round(o.y*this.tileToMeter/10));return new Ut(Yt(r.x,1,ii-1)<<3|n,Yt(r.y,1,ii-1)<<3|i)}encodeBorderCentroid(e){if(!e.borders)return new Ut(0,0);const t=e.borders,r=Number.MAX_VALUE;if(t[0][0]!==r||t[1][0]!==r){const e=t[0][0]!==r?0:1;return new Ut(6|(t[0][0]!==r?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==r?2:3;return new Ut((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==r?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=Vf,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,o=e.flags&Vf?Uf:e.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==o.y||n!==o.x){for(let e=t;e<r;++e)this.centroidVertexArray.emplace(e,o.x,o.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==t[r].sourceId||!gf(e[r],t[r]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const n of this.centroidData)n.flags&=2147483647;const o=[];for(const n of this.activeReplacements){const t=Math.pow(2,n.footprintTileId.canonical.z-e.canonical.z);for(const r of this.centroidData)if(!(r.flags&Vf||n.min.x>r.max.x||r.min.x>n.max.x||n.min.y>r.max.y||r.min.y>n.max.y))for(let i=0;i<r.footprintSegLen;i++){const a=this.footprintSegments[r.footprintSegIdx+i];if(o.length=0,lm(this.footprintVertices,a.vertexOffset,a.vertexCount,n.footprintTileId.canonical,e.canonical,o),xf(n.footprint,o,this.footprintIndices.uint16,a.indexOffset,a.indexCount,-a.vertexOffset,-t)){r.flags|=Vf;break}}}for(const n of this.centroidData)this.writeCentroidToBuffer(n);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,r){let o=!1;for(let n=0;n<r.footprintSegLen;n++){const i=this.footprintSegments[r.footprintSegIdx+n];let a=0;for(const r of i.ringIndices){for(let n=a,s=r+a-1;n<r+a;s=n++){const r=this.footprintVertices.int16[2*(n+i.vertexOffset)+0],a=this.footprintVertices.int16[2*(n+i.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+i.vertexOffset)+1];a>t!=l>t&&e<(this.footprintVertices.int16[2*(s+i.vertexOffset)+0]-r)*(t-a)/(l-a)+r&&(o=!o)}a=r}}return o}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,o=!0;const n=4*(e+ii)*ii+(t+ii);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&Vf)}:void 0}for(const i of this.centroidData)e>i.max.x||i.min.x>e||t>i.max.y||i.min.y>t||this.footprintContainsPoint(e,t,i)&&i&&i.height>r&&(r=i.height,this.partLookup[n]=i,o=!!(i.flags&Vf));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:o};this.partLookup[n]=void 0}}function Qf(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function em(e,t,r,o){const n=t.sub(e)._perp()._unit(),i=r.sub(t)._perp()._unit();return tm(e,t,r,Qf(n,i),o)}function tm(e,t,r,o,n){const i=Math.sqrt(1-o*o);return Math.min(e.dist(t)/3,t.dist(r)/3,n*i/o)}function rm(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function om(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function nm(e,t,r){if(e.x<0||e.x>=ii||t.x<0||t.x>=ii||r.x<0||r.x>=ii)return!1;const o=r.sub(t),n=o.perp(),i=e.sub(t);return(o.x*i.x+o.y*i.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(i.x*i.x+i.y*i.y))>-.866&&n.x*i.x+n.y*i.y<0}function im(e,t,r){const o=t?2|e:-3&e;return r?1|o:-2&o}function am(){const e=Math.PI/32,t=Math.tan(e),r=nu;return r*Math.sqrt(1+2*t*t)-r}function sm(e,t,r){const o=1<<r.z,n=bu(r.x/o),i=bu((r.x+1)/o),a=Lu(r.y/o),s=Lu((r.y+1)/o);return function(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0;const a=[];if(!e.length||!r||!o)return a;const s=(e,t)=>{for(const r of e)a.push({polygon:r,bounds:t})},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(o)),u=l-c,d=[];for(let m=0;m<Math.abs(u);m++)d.push(u>0?0:1);for(let m=0;m<Math.min(l,c);m++)d.push(0),d.push(1);let h=e;if(h=mf(h,t[0].y-n,t[1].y+n,1),h=mf(h,t[0].x-n,t[1].x+n,0),!h.length)return a;const f=[];for(d.length?f.push({polygons:h,bounds:t,depth:0}):s(h,t);f.length;){const e=f.pop(),t=e.depth,r=d[t],o=e.bounds[0],a=e.bounds[1],l=0===r?o.x:o.y,c=0===r?a.x:a.y,u=i?i(r,l,c):.5*(l+c),h=mf(e.polygons,l-n,u+n,r),m=mf(e.polygons,u-n,c+n,r);if(h.length){const e=[o,new Ut(0===r?u:a.x,1===r?u:a.y)];d.length>t+1?f.push({polygons:h,bounds:e,depth:t+1}):s(h,e)}if(m.length){const e=[new Ut(0===r?u:o.x,1===r?u:o.y),a];d.length>t+1?f.push({polygons:m,bounds:e,depth:t+1}):s(m,e)}}return a}(e,t,Math.ceil((i-n)/11.25),Math.ceil((a-s)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=Lu((r.y+t/ii)/o);return(vu(.5*(Lu((r.y+n/ii)/o)+e))*o-r.y)*ii}}))}function lm(e,t,r,o,n,i){const a=Math.pow(2,o.z-n.z);for(let s=0;s<r;s++){let r=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];r=(r+n.x*ii)*a-o.x*ii,l=(l+n.y*ii)*a-o.y*ii,i.push(new Ut(r,l))}}ms(Xf,"FillExtrusionBucket",{omit:["layers","features"]}),ms(Kf,"PartData"),ms(Wf,"FootprintSegment"),ms(Jf,"BorderCentroidData"),ms($f,"GroundEffect");const cm=new Xs({visibility:new Ys(tl["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ys(tl["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var um={paint:new Xs({"fill-extrusion-opacity":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qs(tl["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qs(tl["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qs(tl["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qs(tl["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new qs(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new qs(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:cm};class dm extends Ut{constructor(e,t,r){super(e,t),this.z=r}}function hm(e,t){return e.x*t.x+e.y*t.y}function fm(e,t){if(1===e.length){let r=0;const o=t[r++];let n;for(;!n||o.equals(n);)if(n=t[r++],!n)return 1/0;for(;r<t.length;r++){const i=t[r],a=e[0],s=n.sub(o),l=i.sub(o),c=a.sub(o),u=hm(s,s),d=hm(s,l),h=hm(l,l),f=hm(c,s),m=hm(c,l),p=u*h-d*d,g=(h*f-d*m)/p,_=(u*m-d*f)/p,y=o.z*(1-g-_)+n.z*g+i.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function mm(e,t,r,o,n,i,a,s){const l=a*n.getElevationAt(e,t,!0,!0),c=0!==i[0],u=c?0===i[1]?a*(i[0]/7-450):a*function(e,t,r){const o=Math.floor(t[0]/8),n=Math.floor(t[1]/8),i=10*(t[0]-8*o),a=10*(t[1]-8*n),s=e.getElevationAt(o,n,!0,!0),l=e.getMeterToDEM(r),c=Math.floor(.5*(i*l-1)),u=Math.floor(.5*(a*l-1)),d=e.tileCoordToPixel(o,n),h=2*c+1,f=2*u+1,m=function(e,t,r,o,n){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+n,r,!0),e.getElevationAtPixel(t,r+n,!0),e.getElevationAtPixel(t+o,r+n,!0)]}(e,d.x-c,d.y-u,h,f),p=Math.abs(m[0]-m[1]),g=Math.abs(m[2]-m[3]),_=Math.abs(m[0]-m[2])+Math.abs(m[1]-m[3]),y=Math.min(.25,.5*l*(p+g)/h),v=Math.min(.25,.5*l*_/f);return s+Math.max(y*i,v*a)}(n,i,s):l;return{base:l+(0===r)?-1:r,top:c?Math.max(u+o,l+r+2):l+o}}const pm=Al([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:gm}=pm,_m=Al([{name:"a_packed",components:4,type:"Float32"}]),{members:ym}=_m,vm=Al([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:xm}=vm;class bm{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new rh({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=or(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const o=[];let n=e.length%2==1?-e[e.length-1]*r:0,i=e[0]*r,a=!0;o.push({left:n,right:i,isDash:a,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){a=!a;const t=e[l];n=s*r,s+=t,i=s*r,o.push({left:n,right:i,isDash:a,zeroLength:0===t})}return o}addRoundDash(e,t,r){const o=t/2;for(let n=-r;n<=r;n++){const t=this.width*(this.nextRow+r+n);let i=0,a=e[i];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++i]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let d;const h=n/r*(o+1);if(a.isDash){const e=o-Math.abs(h);d=Math.sqrt(u*u+e*e)}else d=o-Math.sqrt(u*u+h*h);this.image.data[t+s]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],r=e[s+1];t.zeroLength?e.splice(s,1):r&&r.isDash===t.isDash&&(r.left=t.left,e.splice(s,1))}const r=e[0],o=e[e.length-1];r.isDash===o.isDash&&(r.left=o.left-this.width,o.right=r.right+this.width);const n=this.width*this.nextRow;let i=0,a=e[i];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++i]);const r=Math.abs(s-a.left),o=Math.abs(s-a.right),l=Math.min(r,o);this.image.data[n+s]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const o="round"===t,n=o?7:0,i=2*n+1;if(this.nextRow+i>this.height)return dr("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let c=0;c<e.length;c++)e[c]<0&&(dr("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),a+=e[c];if(0!==a){const r=this.width/a,i=this.getDashRanges(e,this.width,r);o?this.addRoundDash(i,r,n):this.addRegularDash(i,"square"===t?.5*r:0)}const s=this.nextRow+n;this.nextRow+=i;const l={tl:[s,n],br:[a,0]};return this.positions[r]=l,l}}ms(bm,"LineAtlas");const Lm=ff.types,Am=Math.cos(Math.PI/180*37.5),wm=Math.cos(Math.PI/180*5);class Sm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Cl,this.layoutVertexArray2=new Rl,this.patternVertexArray=new Ml,this.indexArray=new Gl,this.programConfigurations=new Hc(e.layers,e.zoom),this.segments=new pc,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,r,o){this.hasPattern=Hh("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),i=[];for(const{feature:c,id:u,index:d,sourceLayerIndex:h}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Fu(c,e);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom),t,r))continue;const a=n?n.evaluate(t,{},r):void 0,s={id:u,properties:c.properties,type:c.type,sourceLayerIndex:h,index:d,geometry:e?t.geometry:Bu(c,r,o),patterns:{},sortKey:a};i.push(s)}n&&i.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:a,featureIndex:s}=t,l=this.addConstantDashes(a);for(const c of i){const{geometry:o,index:n,sourceLayerIndex:i}=c;if(l&&this.addFeatureDashes(c,a),this.hasPattern){const e=Gh("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,o,n,r,a.positions,t.availableImages,t.brightness);s.insert(e[n].feature,o,n,i,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const o=r.paint.get("line-dasharray").value,n=r.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==n.kind)t=!0;else{const t=n.value,r=o.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const o of this.layers){const n=o.paint.get("line-dasharray").value,i=o.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===i.kind)continue;let a,s;if("constant"===n.kind){if(a=n.value,!a)continue}else a=n.evaluate({zoom:r},e);s="constant"===i.kind?i.value:i.evaluate({zoom:r},e),t.addDash(a,s),e.patterns[o.id]=t.getKey(a,s)}}update(e,t,r,o,n){const i=0!==Object.keys(e).length;i&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,i?this.stateDependentLayers:this.layers,r,o,n)}addFeatures(e,t,r,o,n,i){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,r,o,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ym)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,xm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,o,n,i,a){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap").evaluate(e,{}),u=s.get("line-miter-limit"),d=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const h of t)this.addLine(h,e,l,c,u,d);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,n,i,o,a)}addLine(e,t,r,o,n,i){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;const a="none"===r;if(this.patternJoinNone=this.hasPattern&&a,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Lm[t.type];let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l--;let c=0;for(;c<l-1&&e[c].equals(e[c+1]);)c++;if(l<(s?3:2))return;"bevel"===r&&(n=1.05);const u=this.overscaling<=16?15*ii/(512*this.overscaling):0,d=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let h,f,m,p,g;this.e1=this.e2=-1,s&&(h=e[l-2],g=e[c].sub(h)._unit()._perp());for(let _=c;_<l;_++){if(m=_===l-1?s?e[c+1]:void 0:e[_+1],m&&e[_].equals(m))continue;g&&(p=g),h&&(f=h),h=e[_],g=m?m.sub(h)._unit()._perp():p,p=p||g;const t=f&&m;let y=t?r:s||a?"butt":o;const v=p.x*g.x+p.y*g.y;if(a){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,r=e.lineSoFar-e.segmentStart;for(let o=0;o<t;++o){const t=e.segmentPoints[2*o+1],n=Math.round(e.segmentPoints[2*o])+.5+.25*t;e.patternVertexArray.emplaceBack(n,r),e.patternVertexArray.emplaceBack(n,r)}e.segmentPoints=[],e.segmentStart=e.lineSoFar}e.e1=e.e2=-1};if(t&&v<wm){this.updateDistance(f,h),this.addCurrentVertex(h,p,1,1,d),e(this),this.addCurrentVertex(h,g,-1,-1,d);continue}if(f){if(!m){this.updateDistance(f,h),this.addCurrentVertex(h,p,1,1,d),e(this);continue}y="miter"}}let x=p.add(g);0===x.x&&0===x.y||x._unit();const b=x.x*g.x+x.y*g.y,L=0!==b?1/b:1/0,A=2*Math.sqrt(2-2*b),w=b<Am&&f&&m,S=p.x*g.y-p.y*g.x>0;if(w&&_>c){const e=h.dist(f);if(e>2*u){const t=h.sub(h.sub(f)._mult(u/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,p,0,0,d),f=t}}if(t&&"round"===y&&(L<i?y="miter":L<=2&&(y="fakeround")),"miter"===y&&L>n&&(y="bevel"),"bevel"===y&&(L>2&&(y="flipbevel"),L<n&&(y="miter")),f&&this.updateDistance(f,h),"miter"===y)x._mult(L),this.addCurrentVertex(h,x,0,0,d);else if("flipbevel"===y){if(L>100)x=g.mult(-1);else{const e=L*p.add(g).mag()/p.sub(g).mag();x._perp()._mult(e*(S?-1:1))}this.addCurrentVertex(h,x,0,0,d),this.addCurrentVertex(h,x.mult(-1),0,0,d)}else if("bevel"===y||"fakeround"===y){const e=-Math.sqrt(L*L-1),t=S?e:0,r=S?0:e;if(f&&this.addCurrentVertex(h,p,t,r,d),"fakeround"===y){const e=Math.round(180*A/Math.PI/20);for(let t=1;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*e*e+(.848013+v*(.215638*v-1.06021)))}const o=g.sub(p)._mult(r)._add(p)._unit()._mult(S?-1:1);this.addHalfVertex(h,o.x,o.y,!1,S,0,d)}}m&&this.addCurrentVertex(h,g,-t,-r,d)}else"butt"===y?this.addCurrentVertex(h,x,0,0,d):"square"===y?(f||this.addCurrentVertex(h,x,-1,-1,d),this.addCurrentVertex(h,x,0,0,d),f&&this.addCurrentVertex(h,x,1,1,d)):"round"===y&&(f&&(this.addCurrentVertex(h,p,0,0,d),this.addCurrentVertex(h,p,1,1,d,!0)),m&&(this.addCurrentVertex(h,g,-1,-1,d,!0),this.addCurrentVertex(h,g,0,0,d)));if(w&&_<l-1){const e=h.dist(m);if(e>2*u){const t=h.add(m.sub(h)._mult(u/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,g,0,0,d),h=t}}}}addCurrentVertex(e,t,r,o,n){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const a=t.y*o-t.x,s=-t.y-t.x*o;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,i,!1,r,n),this.addHalfVertex(e,a,s,i,!0,-o,n),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,r)}addHalfVertex(e,t,r,o,n,i,a){let{x:s,y:l}=e;this.layoutVertexArray.emplaceBack((s<<1)+(o?1:0),(l<<1)+(n?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(0===i?0:i<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),n?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}ms(Sm,"LineBucket",{omit:["layers","patternFeatures"]});const Em=new Xs({"line-cap":new qs(tl.layout_line["line-cap"]),"line-join":new qs(tl.layout_line["line-join"]),"line-miter-limit":new Ys(tl.layout_line["line-miter-limit"]),"line-round-limit":new Ys(tl.layout_line["line-round-limit"]),"line-sort-key":new qs(tl.layout_line["line-sort-key"]),visibility:new Ys(tl.layout_line.visibility)});var Tm={paint:new Xs({"line-opacity":new qs(tl.paint_line["line-opacity"]),"line-color":new qs(tl.paint_line["line-color"]),"line-translate":new Ys(tl.paint_line["line-translate"]),"line-translate-anchor":new Ys(tl.paint_line["line-translate-anchor"]),"line-width":new qs(tl.paint_line["line-width"]),"line-gap-width":new qs(tl.paint_line["line-gap-width"]),"line-offset":new qs(tl.paint_line["line-offset"]),"line-blur":new qs(tl.paint_line["line-blur"]),"line-dasharray":new qs(tl.paint_line["line-dasharray"]),"line-pattern":new qs(tl.paint_line["line-pattern"]),"line-gradient":new $s(tl.paint_line["line-gradient"]),"line-trim-offset":new Ys(tl.paint_line["line-trim-offset"]),"line-emissive-strength":new Ys(tl.paint_line["line-emissive-strength"]),"line-border-width":new qs(tl.paint_line["line-border-width"]),"line-border-color":new qs(tl.paint_line["line-border-color"])}),layout:Em};function Pm(e,t,r){return t*(ii/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}function Cm(e,t){return 1/Pm(e,1,t.tileZoom)}function Rm(e,t,r,o){return e.translatePosMatrix(o||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Mm=e=>{const t=[];Im(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const o="none"===e.layout.get("line-join").constantOr("miter"),n=!!e.paint.get("line-pattern").constantOr(1);return o&&n&&t.push("LINE_JOIN_NONE"),t};function Im(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Om=new class extends qs{possiblyEvaluate(e,t){return t=new Us(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,o){return t=Qt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,o)}}(Tm.paint.properties["line-width"].specification);function Dm(e,t){return t>0?t+2*e:e}Om.useIntegerZoom=!0;const km=Al([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nm=Al([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Bm=Al([{name:"a_projected_pos",components:4,type:"Float32"}],4);Al([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fm=Al([{name:"a_z_offset",components:1,type:"Float32"}],4),zm=Al([{name:"a_texb",components:2,type:"Uint16"}]),Um=Al([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Vm=Al([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Al([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hm=Al([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gm=Al([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Al([{name:"triangle",components:3,type:"Uint16"}]),Al([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Al([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Al([{type:"Float32",name:"offsetX"}]),Al([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var jm=24;const Wm=128;function Km(e,t){const{expression:r}=t;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Us(e+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:o}=r;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let i=n;for(;i<t.length&&t[i]<e+1;)i++;i=Math.min(t.length-1,i);const a=t[n],s=t[i];return"composite"===r.kind?{kind:"composite",minZoom:a,maxZoom:s,interpolationType:o}:{kind:"camera",minZoom:a,maxZoom:s,minSize:r.evaluate(new Us(a)),maxSize:r.evaluate(new Us(s)),interpolationType:o}}}function Jm(e,t,r){let{uSize:o,uSizeT:n}=t,{lowerSize:i,upperSize:a}=r;return"source"===e.kind?i/Wm:"composite"===e.kind?Go(i/Wm,a/Wm,n):o}function Zm(e,t){let r=0,o=0;if("constant"===e.kind)o=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:i,maxZoom:a}=e,s=n?Yt(ha.interpolationFactor(n,t,i,a),0,1):0;"camera"===e.kind?o=Go(e.minSize,e.maxSize,s):r=s}return{uSizeT:r,uSize:o}}var Ym=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Wm,evaluateSizeForFeature:Jm,evaluateSizeForZoom:Zm,getSizeData:Km});function qm(e,t,r){return e.sections.forEach((e=>{e.text=function(e,t,r){const o=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===o?e=e.toLocaleUpperCase():"lowercase"===o&&(e=e.toLocaleLowerCase()),zs.applyArabicShaping&&(e=zs.applyArabicShaping(e)),e}(e.text,t,r)})),e}const $m={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Xm(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Qm(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var ep={read:function(e,t,r,o,n){var i,a,s=8*n-o-1,l=(1<<s)-1,c=l>>1,u=-7,d=r?n-1:0,h=r?-1:1,f=e[t+d];for(d+=h,i=f&(1<<-u)-1,f>>=-u,u+=s;u>0;i=256*i+e[t+d],d+=h,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=o;u>0;a=256*a+e[t+d],d+=h,u-=8);if(0===i)i=1-c;else{if(i===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,o),i-=c}return(f?-1:1)*a*Math.pow(2,i-o)},write:function(e,t,r,o,n,i){var a,s,l,c=8*i-n-1,u=(1<<c)-1,d=u>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=o?0:i-1,m=o?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(t*l-1)*Math.pow(2,n),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,n),a=0));n>=8;e[r+f]=255&s,f+=m,s/=256,n-=8);for(a=a<<n|s,c+=n;c>0;e[r+f]=255&a,f+=m,a/=256,c-=8);e[r+f-m]|=128*p}},tp=op,rp=ep;function op(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}op.Varint=0,op.Fixed64=1,op.Bytes=2,op.Fixed32=5;var np=4294967296,ip=1/np,ap="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sp(e){return e.type===op.Bytes?e.readVarint()+e.pos:e.pos+1}function lp(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function cp(e,t,r){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(o);for(var n=r.pos-1;n>=e;n--)r.buf[n+o]=r.buf[n]}function up(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function dp(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function hp(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function fp(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function mp(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function pp(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function gp(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function _p(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function yp(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function vp(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function xp(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function bp(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}op.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),n=o>>3,i=this.pos;this.type=7&o,e(n,t,this),this.pos===i&&this.skip(o)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=vp(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=bp(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=vp(this.buf,this.pos)+vp(this.buf,this.pos+4)*np;return this.pos+=8,e},readSFixed64:function(){var e=vp(this.buf,this.pos)+bp(this.buf,this.pos+4)*np;return this.pos+=8,e},readFloat:function(){var e=rp.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=rp.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,o=this.buf;return t=127&(r=o[this.pos++]),r<128?t:(t|=(127&(r=o[this.pos++]))<<7,r<128?t:(t|=(127&(r=o[this.pos++]))<<14,r<128?t:(t|=(127&(r=o[this.pos++]))<<21,r<128?t:function(e,t,r){var o,n,i=r.buf;if(o=(112&(n=i[r.pos++]))>>4,n<128)return lp(e,o,t);if(o|=(127&(n=i[r.pos++]))<<3,n<128)return lp(e,o,t);if(o|=(127&(n=i[r.pos++]))<<10,n<128)return lp(e,o,t);if(o|=(127&(n=i[r.pos++]))<<17,n<128)return lp(e,o,t);if(o|=(127&(n=i[r.pos++]))<<24,n<128)return lp(e,o,t);if(o|=(1&(n=i[r.pos++]))<<31,n<128)return lp(e,o,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=o[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&ap?function(e,t,r){return ap.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var o="",n=t;n<r;){var i,a,s,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>r)break;1===u?l<128&&(c=l):2===u?128==(192&(i=e[n+1]))&&(c=(31&l)<<6|63&i)<=127&&(c=null):3===u?(a=e[n+2],128==(192&(i=e[n+1]))&&128==(192&a)&&((c=(15&l)<<12|(63&i)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(a=e[n+2],s=e[n+3],128==(192&(i=e[n+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,o+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),o+=String.fromCharCode(c),n+=u}return o}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==op.Bytes)return e.push(this.readVarint(t));var r=sp(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==op.Bytes)return e.push(this.readSVarint());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==op.Bytes)return e.push(this.readBoolean());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==op.Bytes)return e.push(this.readFloat());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==op.Bytes)return e.push(this.readDouble());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==op.Bytes)return e.push(this.readFixed32());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==op.Bytes)return e.push(this.readSFixed32());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==op.Bytes)return e.push(this.readFixed64());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==op.Bytes)return e.push(this.readSFixed64());var t=sp(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===op.Varint)for(;this.buf[this.pos++]>127;);else if(t===op.Bytes)this.pos=this.readVarint()+this.pos;else if(t===op.Fixed32)this.pos+=4;else{if(t!==op.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),xp(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),xp(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),xp(this.buf,-1&e,this.pos),xp(this.buf,Math.floor(e*ip),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),xp(this.buf,-1&e,this.pos),xp(this.buf,Math.floor(e*ip),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,o;if(e>=0?(r=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,o=o+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(o,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var o,n,i=0;i<t.length;i++){if((o=t.charCodeAt(i))>55295&&o<57344){if(!n){o>56319||i+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):n=o;continue}if(o<56320){e[r++]=239,e[r++]=191,e[r++]=189,n=o;continue}o=n-55296<<10|o-56320|65536,n=null}else n&&(e[r++]=239,e[r++]=191,e[r++]=189,n=null);o<128?e[r++]=o:(o<2048?e[r++]=o>>6|192:(o<65536?e[r++]=o>>12|224:(e[r++]=o>>18|240,e[r++]=o>>12&63|128),e[r++]=o>>6&63|128),e[r++]=63&o|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&cp(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),rp.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),rp.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var o=this.pos-r;o>=128&&cp(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(e,t,r){this.writeTag(e,op.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,up,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,dp,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,mp,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,hp,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,fp,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,pp,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,gp,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,_p,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,yp,t)},writeBytesField:function(e,t){this.writeTag(e,op.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,op.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,op.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,op.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,op.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,op.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,op.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,op.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,op.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,op.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Lp=d(tp);const Ap=3;function wp(e,t,r){t.glyphs=[],1===e&&r.readMessage(Sp,t)}function Sp(e,t,r){if(3===e){const{id:e,bitmap:o,width:n,height:i,left:a,top:s,advance:l}=r.readMessage(Ep,{});t.glyphs.push({id:e,bitmap:new rh({width:n+2*Ap,height:i+2*Ap},o),metrics:{width:n,height:i,left:a,top:s,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function Ep(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const Tp=Ap,Pp={horizontal:1,vertical:2,horizontalOnly:3};class Cp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const r=new Cp;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Cp;return t.imageName=e,t}}class Rp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const r=new Rp;for(let o=0;o<e.sections.length;o++){const n=e.sections[o];n.image?r.addImageSection(n):r.addTextSection(n,t)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let o=0;o<e.length;o++){const n=e.charCodeAt(o+1)||null,i=e.charCodeAt(o-1)||null;r+=!t&&(n&&ws(n)&&!$m[e[o+1]]||i&&ws(i)&&!$m[e[o-1]])||!$m[e[o]]?e[o]:$m[e[o]]}return r}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Ip[this.text.charCodeAt(r)];r++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Ip[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Rp;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Cp.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(r)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void dr("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(Cp.forImage(t)),this.sectionIndex.push(this.sections.length-1)):dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mp(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m){const p=Rp.fromFeature(e,n);d===Pp.vertical&&p.verticalizePunctuation(h);let g=[];const _=function(e,t,r,o,n,i){if(!e)return[];const a=[],s=function(e,t,r,o,n,i){let a=0;for(let s=0;s<e.length();s++){const r=e.getSection(s);a+=Dp(e.getCodePoint(s),r,o,n,t,i)}return a/Math.max(1,Math.ceil(a/r))}(e,t,r,o,n,i),l=e.text.indexOf("\u200b")>=0;let c=0;for(let d=0;d<e.length();d++){const r=e.getSection(d),h=e.getCodePoint(d);if(Ip[h]||(c+=Dp(h,r,o,n,t,i)),d<e.length()-1){const t=!((u=h)<11904||!(vs["Bopomofo Extended"](u)||vs.Bopomofo(u)||vs["CJK Compatibility Forms"](u)||vs["CJK Compatibility Ideographs"](u)||vs["CJK Compatibility"](u)||vs["CJK Radicals Supplement"](u)||vs["CJK Strokes"](u)||vs["CJK Symbols and Punctuation"](u)||vs["CJK Unified Ideographs Extension A"](u)||vs["CJK Unified Ideographs"](u)||vs["Enclosed CJK Letters and Months"](u)||vs["Halfwidth and Fullwidth Forms"](u)||vs.Hiragana(u)||vs["Ideographic Description Characters"](u)||vs["Kangxi Radicals"](u)||vs["Katakana Phonetic Extensions"](u)||vs.Katakana(u)||vs["Vertical Forms"](u)||vs["Yi Radicals"](u)||vs["Yi Syllables"](u)));(Op[h]||t||r.imageName)&&a.push(Bp(d+1,c,s,a,Np(h,e.getCodePoint(d+1),t&&l),!1))}}var u;return Fp(Bp(e.length(),c,s,a,0,!0))}(p,c,i,t,o,f),{processBidirectionalText:y,processStyledBidirectionalText:v}=zs;if(y&&1===p.sections.length){const e=y(p.toString(),_);for(const t of e){const e=new Rp;e.text=t,e.sections=p.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(p.text,p.sectionIndex,_);for(const t of e){const e=new Rp;e.text=t[0],e.sectionIndex=t[1],e.sections=p.sections,g.push(e)}}else g=function(e,t){const r=[],o=e.text;let n=0;for(const i of t)r.push(e.substring(n,i)),n=i;return n<o.length&&r.push(e.substring(n,o.length)),r}(p,_);const x=[],b={positionedLines:x,text:p.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,o,n,i,a,s,l,c,u,d){let h=0,f=0,m=0;const p="right"===s?1:"left"===s?0:.5;let g=!1;for(const L of n){const e=L.getSections();for(const r of e){if(r.imageName)continue;const e=t[r.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let _=0;for(const L of n){L.trim();const n=L.getMaxScale(),a=(n-1)*jm,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=s;const v=s.positionedGlyphs;let x=0;if(!L.length()){f+=i,++_;continue}let b=0,A=0;for(let i=0;i<L.length();i++){const a=L.getSection(i),s=L.getSectionIndex(i),m=L.getCodePoint(i);let p=a.scale,_=null,w=null,S=null,E=jm,T=0;const P=!(l===Pp.horizontal||!u&&!As(m)||u&&(Ip[m]||(y=m,vs.Arabic(y)||vs["Arabic Supplement"](y)||vs["Arabic Extended-A"](y)||vs["Arabic Presentation Forms-A"](y)||vs["Arabic Presentation Forms-B"](y))));if(a.imageName){const t=o[a.imageName];if(!t)continue;S=a.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const r=t.displaySize;p=p*jm/d,_={width:r[0],height:r[1],left:0,top:-Tp,advance:P?r[1]:r[0],localGlyph:!1},T=g?-_.height*p:n*jm-17-r[1]*p,E=_.advance;const i=(P?r[0]:r[1])*p-jm*n;i>0&&i>x&&(x=i)}else{const e=r[a.fontStack];if(!e)continue;e[m]&&(w=e[m]);const o=t[a.fontStack];if(!o)continue;const i=o.glyphs[m];if(!i)continue;if(_=i.metrics,E=8203!==m?jm:0,g){const e=void 0!==o.ascender?Math.abs(o.ascender):0,t=void 0!==o.descender?Math.abs(o.descender):0,r=(e+t)*p;b<r&&(b=r,A=(e-t)/2*p),T=-e*p}else T=(n-p)*jm-17}P?(e.verticalizable=!0,v.push({glyph:m,imageName:S,x:h,y:f+T,vertical:P,scale:p,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:_,rect:w}),h+=E*p+c):(v.push({glyph:m,imageName:S,x:h,y:f+T,vertical:P,scale:p,localGlyph:_.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:_,rect:w}),h+=_.advance*p+c)}0!==v.length&&(m=Math.max(h-c,m),g?Up(v,p,x,A,i*n/2):Up(v,p,x,0,i/2)),h=0;const w=i*n+x;s.lineOffset=Math.max(x,a),f+=w,++_}var y;const v=f,{horizontalAlign:x,verticalAlign:b}=zp(a);(function(e,t,r,o,n,i){const a=(t-r)*n,s=-i*o;for(const l of e)for(const e of l.positionedGlyphs)e.x+=a,e.y+=s})(e.positionedLines,p,x,b,m,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*m,e.right=e.left+m,e.hasBaseline=g}(b,t,r,o,g,a,s,l,d,c,h,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Ip={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Op={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Dp(e,t,r,o,n,i){if(t.imageName){const e=o[t.imageName];return e?e.displaySize[0]*t.scale*jm/i+n:0}{const o=r[t.fontStack],i=o&&o.glyphs[e];return i?i.metrics.advance*t.scale+n:0}}function kp(e,t,r,o){const n=Math.pow(e-t,2);return o?e<t?n/2:2*n:n+Math.abs(r)*r}function Np(e,t,r){let o=0;return 10===e&&(o-=1e4),r&&(o+=150),40!==e&&65288!==e||(o+=50),41!==t&&65289!==t||(o+=50),o}function Bp(e,t,r,o,n,i){let a=null,s=kp(t,r,n,i);for(const l of o){const e=kp(t-l.x,r,n,i)+l.badness;e<=s&&(a=l,s=e)}return{index:e,x:t,priorBreak:a,badness:s}}function Fp(e){return e?Fp(e.priorBreak).concat(e.index):[]}function zp(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Up(e,t,r,o,n){if(!(t||r||o||n))return;const i=e.length-1,a=e[i],s=(a.x+a.metrics.advance*a.scale)*t;for(let l=0;l<=i;l++)e[l].x-=s,e[l].y+=r+o+n}function Vp(e,t,r,o){const{horizontalAlign:n,verticalAlign:i}=zp(o),a=r[0]-e.displaySize[0]*n,s=r[1]-e.displaySize[1]*i;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function Hp(e,t,r,o,n,i){const a=e.imagePrimary;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*i,c=t.right*i;let u,d,h,f;"width"===r||"both"===r?(f=n[0]+l-o[3],d=n[0]+c+o[1]):(f=n[0]+(l+c-a.displaySize[0])/2,d=f+a.displaySize[0]);const m=t.top*i,p=t.bottom*i;return"height"===r||"both"===r?(u=n[1]+m-o[0],h=n[1]+p+o[2]):(u=n[1]+(m+p-a.displaySize[1])/2,h=u+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:u,right:d,bottom:h,left:f,collisionPadding:s}}class Gp extends Ut{constructor(e,t,r,o,n){super(e,t),this.angle=o,this.z=r,void 0!==n&&(this.segment=n)}clone(){return new Gp(this.x,this.y,this.z,this.angle,this.segment)}}function jp(e,t,r,o,n){if(void 0===t.segment)return!0;let i=t,a=t.segment+1,s=0;for(;s>-r/2;){if(a--,a<0)return!1;s-=e[a].dist(i),i=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;s<r/2;){const t=e[a],r=e[a+1];if(!r)return!1;let i=e[a-1].angleTo(t)-t.angleTo(r);for(i=Math.abs((i+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:i}),c+=i;s-l[0].distance>o;)c-=l.shift().angleDelta;if(c>n)return!1;a++,s+=t.dist(r)}return!0}function Wp(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Kp(e,t,r){return e?.6*t*r:0}function Jp(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Zp(e,t,r,o,n,i){const a=Kp(r,n,i),s=Jp(r,o)*i;let l=0;const c=Wp(e)/2;for(let u=0;u<e.length-1;u++){const r=e[u],o=e[u+1],n=r.dist(o);if(l+n>c){const i=(c-l)/n,d=Go(r.x,o.x,i),h=Go(r.y,o.y,i),f=new Gp(d,h,0,o.angleTo(r),u);return!a||jp(e,f,s,a,t)?f:void 0}l+=n}}function Yp(e,t,r,o,n,i,a,s,l){const c=Kp(o,i,a),u=Jp(o,n),d=u*a,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-d<t/4&&(t=d+t/4),qp(e,h?t/2*s%t:(u/2+2*i)*a*s%t,t,c,r,d,h,!1,l)}function qp(e,t,r,o,n,i,a,s,l){const c=i/2,u=Wp(e);let d=0,h=t-r,f=[];for(let m=0;m<e.length-1;m++){const t=e[m],a=e[m+1],s=t.dist(a),p=a.angleTo(t);for(;h+r<d+s;){h+=r;const g=(h-d)/s,_=Go(t.x,a.x,g),y=Go(t.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&h-c>=0&&h+c<=u){const t=new Gp(_,y,0,p,m);o&&!jp(e,t,i,o,n)||f.push(t)}}d+=s}return s||f.length||a||(f=qp(e,d/2,r,o,n,i,a,!0,l)),f}function $p(e,t,r,o,n){const i=[];for(let a=0;a<e.length;a++){const s=e[a];let l;for(let e=0;e<s.length-1;e++){let a=s[e],c=s[e+1];a.x<t&&c.x<t||(a.x<t?a=new Ut(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x<t&&(c=new Ut(t,a.y+(t-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y<r&&c.y<r||(a.y<r?a=new Ut(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round():c.y<r&&(c=new Ut(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r)._round()),a.x>=o&&c.x>=o||(a.x>=o?a=new Ut(o,a.y+(o-a.x)/(c.x-a.x)*(c.y-a.y))._round():c.x>=o&&(c=new Ut(o,a.y+(o-a.x)/(c.x-a.x)*(c.y-a.y))._round()),a.y>=n&&c.y>=n||(a.y>=n?a=new Ut(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round():c.y>=n&&(c=new Ut(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n)._round()),l&&a.equals(l[l.length-1])||(l=[a],i.push(l)),l.push(c)))))}}return i}function Xp(e){let t=0,r=0;for(const a of e)t+=a.w*a.h,r=Math.max(r,a.w);e.sort(((e,t)=>t.h-e.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let n=0,i=0;for(const a of e)for(let e=o.length-1;e>=0;e--){const t=o[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,i=Math.max(i,a.y+a.h),n=Math.max(n,a.x+a.w),a.w===t.w&&a.h===t.h){const t=o.pop();e<o.length&&(o[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(o.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:n,h:i,fill:t/(n*i)||0}}ms(Gp,"Anchor");const Qp=1;class eg{constructor(e,t){let{pixelRatio:r,version:o,stretchX:n,stretchY:i,content:a}=t;this.paddedRect=e,this.pixelRatio=r,this.stretchX=n,this.stretchY=i,this.content=a,this.version=o}get tl(){return[this.paddedRect.x+Qp,this.paddedRect.y+Qp]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qp,this.paddedRect.y+this.paddedRect.h-Qp]}get displaySize(){return[(this.paddedRect.w-2*Qp)/this.pixelRatio,(this.paddedRect.h-2*Qp)/this.pixelRatio]}}class tg{constructor(e,t){const r={},o={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,r,n),this.addImages(t,o,n);const{w:i,h:a}=Xp(n),s=new oh({width:i||1,height:a||1});for(const l in e){const t=e[l],o=r[l].paddedRect;oh.copy(t.data,s,{x:0,y:0},{x:o.x+Qp,y:o.y+Qp},t.data,t.sdf)}for(const l in t){const e=t[l],r=o[l].paddedRect,n=r.x+Qp,i=r.y+Qp,a=e.data.width,c=e.data.height;oh.copy(e.data,s,{x:0,y:0},{x:n,y:i},e.data),oh.copy(e.data,s,{x:0,y:c-1},{x:n,y:i-1},{width:a,height:1}),oh.copy(e.data,s,{x:0,y:0},{x:n,y:i+c},{width:a,height:1}),oh.copy(e.data,s,{x:a-1,y:0},{x:n-1,y:i},{width:1,height:c}),oh.copy(e.data,s,{x:0,y:0},{x:n+a,y:i},{width:1,height:c})}this.image=s,this.iconPositions=r,this.patternPositions=o}addImages(e,t,r){for(const o in e){const n=e[o],i={x:0,y:0,w:n.data.width+2*Qp,h:n.data.height+2*Qp};r.push(i),t[o]=new eg(i,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(e,t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,r))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const o in e.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[o],e.getImage(o,r),t),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o,r),t)}patchUpdatedImage(e,t,r){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[o,n]=e.tl,i=!!Object.keys(this.patternPositions).length;r.update(t.data,{useMipmap:i},{x:o,y:n})}}ms(eg,"ImagePosition"),ms(tg,"ImageAtlas");const rg=1e20;function og(e,t,r,o,n,i,a,s,l){for(let c=t;c<t+o;c++)ng(e,r*i+c,i,n,a,s,l);for(let c=r;c<r+n;c++)ng(e,c*i+t,1,o,a,s,l)}function ng(e,t,r,o,n,i,a){i[0]=0,a[0]=-rg,a[1]=rg,n[0]=e[t];for(let s=1,l=0,c=0;s<o;s++){n[s]=e[t+s*r];const o=s*s;do{const e=i[l];c=(n[s]-n[e]+o-e*e)/(s-e)/2}while(c<=a[l]&&--l>-1);l++,i[l]=s,a[l]=c,a[l+1]=rg}for(let s=0,l=0;s<o;s++){for(;a[l+1]<s;)l++;const o=i[l],c=s-o;e[t+s*r]=n[o]+c*c}}const ig=2,ag={none:0,ideographs:1,all:2};class sg{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,r){const n=[],i=this.urls[t]||o.GLYPHS_URL;for(const o in e)for(const t of e[o])n.push({stack:o,id:t});Xt(n,((e,t)=>{let{stack:r,id:o}=e,n=this.entries[r];n||(n=this.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let a=n.glyphs[o];if(void 0!==a)return void t(null,{stack:r,id:o,glyph:a});if(a=this._tinySDF(n,r,o),a)return n.glyphs[o]=a,void t(null,{stack:r,id:o,glyph:a});const s=Math.floor(o/256);if(256*s>65535)return void t(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void t(null,{stack:r,id:o,glyph:a});let l=n.requests[s];l||(l=n.requests[s]=[],sg.loadGlyphRange(r,s,i,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[s]=!0}for(const r of l)r(e,t);delete n.requests[s]}))),l.push(((e,n)=>{e?t(e):n&&t(null,{stack:r,id:o,glyph:n.glyphs[o]||null})}))}),((e,t)=>{if(e)r(e);else if(t){const e={};for(const{stack:r,id:o,glyph:n}of t)void 0===e[r]&&(e[r]={}),void 0===e[r].glyphs&&(e[r].glyphs={}),e[r].glyphs[o]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[r].ascender=this.entries[r].ascender,e[r].descender=this.entries[r].descender;r(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ag.none&&(this.localGlyphMode===ag.all?!!this.localFontFamily:!!this.localFontFamily&&(vs["CJK Unified Ideographs"](e)||vs["Hangul Syllables"](e)||vs.Hiragana(e)||vs.Katakana(e)||vs["CJK Symbols and Punctuation"](e)||vs["CJK Unified Ideographs Extension A"](e)||vs["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,r){const o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(r))return;let n=e.tinySDF;if(!n){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),n=e.tinySDF=new sg.TinySDF({fontFamily:o,fontWeight:r,fontSize:24*ig,buffer:3*ig,radius:8*ig}),n.fontWeight=r}if(this.localGlyphs[n.fontWeight][r])return this.localGlyphs[n.fontWeight][r];const i=String.fromCodePoint(r),{data:a,width:s,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:d,glyphTop:h,glyphAdvance:f}=n.draw(i);return this.localGlyphs[n.fontWeight][r]={id:r,bitmap:new rh({width:s,height:l},a),metrics:{width:c/ig,height:u/ig,left:d/ig,top:h/ig-27,advance:f/ig,localGlyph:!0}}}}sg.loadGlyphRange=function(e,t,r,o,n){const i=256*t,a=i+255,s=o.transformRequest(o.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",`${i}-${a}`),Yr.Glyphs);Qr(s,((e,t)=>{if(e)n(e);else if(t){const e={},r=function(e){return new Lp(e).readFields(wp,{})}(t);for(const t of r.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}}))},sg.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:r=8,cutoff:o=.25,fontFamily:n="sans-serif",fontWeight:i="normal",fontStyle:a="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=o,this.radius=r;const s=this.size=e+4*t,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${a} ${i} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:n,actualBoundingBoxRight:i}=this.ctx.measureText(e),a=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(i-n))),l=Math.min(this.size-this.buffer,a+Math.ceil(o)),c=s+2*this.buffer,u=l+2*this.buffer,d=Math.max(c*u,0),h=new Uint8ClampedArray(d),f={data:h,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return f;const{ctx:m,buffer:p,gridInner:g,gridOuter:_}=this;m.clearRect(p,p,s,l),m.fillText(e,p,p+a);const y=m.getImageData(p,p,s,l);_.fill(rg,0,d),g.fill(0,0,d);for(let v=0;v<l;v++)for(let e=0;e<s;e++){const t=y.data[4*(v*s+e)+3]/255;if(0===t)continue;const r=(v+p)*c+e+p;if(1===t)_[r]=0,g[r]=rg;else{const e=.5-t;_[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}og(_,0,0,c,u,c,this.f,this.v,this.z),og(g,p,p,s,l,c,this.f,this.v,this.z);for(let v=0;v<d;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);h[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return f}};const lg=Qp;function cg(e,t,r,o){const n=[],i=e.imagePrimary,a=i.pixelRatio,s=i.paddedRect.w-2*lg,l=i.paddedRect.h-2*lg,c=e.right-e.left,u=e.bottom-e.top,d=i.stretchX||[[0,s]],h=i.stretchY||[[0,l]],f=(e,t)=>e+t[1]-t[0],m=d.reduce(f,0),p=h.reduce(f,0),g=s-m,_=l-p;let y=0,v=m,x=0,b=p,L=0,A=g,w=0,S=_;if(i.content&&o){const e=i.content;y=ug(d,0,e[0]),x=ug(h,0,e[1]),v=ug(d,e[0],e[2]),b=ug(h,e[1],e[3]),L=e[0]-y,w=e[1]-x,A=e[2]-e[0]-v,S=e[3]-e[1]-b}const E=(o,n,s,l)=>{const d=hg(o.stretch-y,v,c,e.left),h=fg(o.fixed-L,A,o.stretch,m),f=hg(n.stretch-x,b,u,e.top),g=fg(n.fixed-w,S,n.stretch,p),_=hg(s.stretch-y,v,c,e.left),E=fg(s.fixed-L,A,s.stretch,m),T=hg(l.stretch-x,b,u,e.top),P=fg(l.fixed-w,S,l.stretch,p),C=new Ut(d,f),R=new Ut(_,f),M=new Ut(_,T),I=new Ut(d,T),O=new Ut(h/a,g/a),D=new Ut(E/a,P/a),k=t*Math.PI/180;if(k){const e=Math.sin(k),t=Math.cos(k),r=[t,-e,e,t];C._matMult(r),R._matMult(r),I._matMult(r),M._matMult(r)}const N=o.stretch+o.fixed,B=s.stretch+s.fixed,F=n.stretch+n.fixed,z=l.stretch+l.fixed,U=e.imageSecondary;return{tl:C,tr:R,bl:I,br:M,texPrimary:{x:i.paddedRect.x+lg+N,y:i.paddedRect.y+lg+F,w:B-N,h:z-F},texSecondary:U?{x:U.paddedRect.x+lg+N,y:U.paddedRect.y+lg+F,w:B-N,h:z-F}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:D,minFontScaleX:A/a/c,minFontScaleY:S/a/u,isSDF:r}};if(o&&(i.stretchX||i.stretchY)){const e=dg(d,g,m),t=dg(h,_,p);for(let r=0;r<e.length-1;r++){const o=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)n.push(E(o,t[e],i,t[e+1]))}}else n.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return n}function ug(e,t,r){let o=0;for(const n of e)o+=Math.max(t,Math.min(r,n[1]))-Math.max(t,Math.min(r,n[0]));return o}function dg(e,t,r){const o=[{fixed:-lg,stretch:0}];for(const[n,i]of e){const e=o[o.length-1];o.push({fixed:n-e.stretch,stretch:e.stretch}),o.push({fixed:n-e.stretch,stretch:e.stretch+(i-n)})}return o.push({fixed:t+lg,stretch:r}),o}function hg(e,t,r,o){return e/t*r+o}function fg(e,t,r,o){return e-t*r/o}function mg(e,t,r,o){const n=t+e.positionedLines[o].lineOffset;return 0===o?r+n/2:r+(n+(t+e.positionedLines[o-1].lineOffset))/2}function pg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=1/0,n=1/0,i=-1/0,a=-1/0;const s=e[0];for(let f=0;f<s.length;f++){const e=s[f];(!f||e.x<o)&&(o=e.x),(!f||e.y<n)&&(n=e.y),(!f||e.x>i)&&(i=e.x),(!f||e.y>a)&&(a=e.y)}const l=Math.min(i-o,a-n);let c=l/2;const u=new ni([],gg);if(0===l)return new Ut(o,n);for(let f=o;f<i;f+=l)for(let t=n;t<a;t+=l)u.push(new _g(f+c,t+c,c,e));let d=function(e){let t=0,r=0,o=0;const n=e[0];for(let i=0,a=n.length,s=a-1;i<a;s=i++){const e=n[i],a=n[s],l=e.x*a.y-a.x*e.y;r+=(e.x+a.x)*l,o+=(e.y+a.y)*l,t+=3*l}return new _g(r/t,o/t,0,e)}(e),h=u.length;for(;u.length;){const o=u.pop();(o.d>d.d||!d.d)&&(d=o,r&&console.log("found best %d after %d probes",Math.round(1e4*o.d)/1e4,h)),o.max-d.d<=t||(c=o.h/2,u.push(new _g(o.p.x-c,o.p.y-c,c,e)),u.push(new _g(o.p.x+c,o.p.y-c,c,e)),u.push(new _g(o.p.x-c,o.p.y+c,c,e)),u.push(new _g(o.p.x+c,o.p.y+c,c,e)),h+=4)}return r&&(console.log(`num probes: ${h}`),console.log(`best distance: ${d.d}`)),d.p}function gg(e,t){return t.max-e.max}class _g{constructor(e,t,r,o){this.p=new Ut(e,t),this.h=r,this.d=function(e,t){let r=!1,o=1/0;for(let n=0;n<t.length;n++){const i=t[n];for(let t=0,n=i.length,a=n-1;t<n;a=t++){const n=i[t],s=i[a];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(r=!r),o=Math.min(o,Yu(e,n,s))}}return(r?1:-1)*Math.sqrt(o)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}}const yg=Number.POSITIVE_INFINITY,vg=Math.sqrt(2);function xg(e,t){let[r,o]=t,n=0,i=0;if(o===yg){r<0&&(r=0);const t=r/vg;switch(e){case"top-right":case"top-left":i=t-7;break;case"bottom-right":case"bottom-left":i=7-t;break;case"bottom":i=7-r;break;case"top":i=r-7}switch(e){case"top-right":case"bottom-right":n=-t;break;case"top-left":case"bottom-left":n=t;break;case"left":n=r;break;case"right":n=-r}}else{switch(r=Math.abs(r),o=Math.abs(o),e){case"top-right":case"top-left":case"top":i=o-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-o}switch(e){case"top-right":case"bottom-right":case"right":n=-r;break;case"top-left":case"bottom-left":case"left":n=r}}return[n,i]}function bg(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lg(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m){let p=i.textMaxSize.evaluate(t,{},d);void 0===p&&(p=a);const g=e.layers[0].layout,_=g.get("icon-offset").evaluate(t,{},d),y=Eg(r.horizontal)||r.vertical,v="globe"===h.name,x=jm,b=a/x,L=e.tilePixelRatio*p/x,A=(M=e.overscaling,e.zoom>18&&M>2&&(M>>=1),Math.max(ii/(512*M),1)*g.get("symbol-spacing")),w=g.get("text-padding")*e.tilePixelRatio,S=g.get("icon-padding")*e.tilePixelRatio,E=Gt(g.get("text-max-angle")),T="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),P="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),C=g.get("symbol-placement"),R=A/2;var M;const I=g.get("icon-text-fit").evaluate(t,{},d),O=g.get("icon-text-fit-padding").evaluate(t,{},d),D="none"!==I;let k;!1===e.hasAnyIconTextFit&&D&&(e.hasAnyIconTextFit=!0),o&&D&&(e.allowVerticalPlacement&&r.vertical&&(k=Hp(o,r.vertical,I,O,_,b)),y&&(o=Hp(o,y,I,O,_,b)));const N=(a,s,p)=>{if(s.x<0||s.x>=ii||s.y<0||s.y>=ii)return;let g=null;if(v){const{x:e,y:t,z:r}=h.projectTilePoint(s.x,s.y,p);g={anchor:new Gp(e,t,r,0,void 0),up:h.upVector(p,s.x,s.y)}}!function(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b,L,A,w,S,E){const T=e.addToLineVertexArray(t,o);let P,C,R,M,I,O,D,k=0,N=0,B=0,F=0,z=-1,U=-1;const V={};let H=Mo("");const G=r?r.anchor:t,j="none"!==l.layout.get("icon-text-fit").evaluate(x,{},w);let W=0,K=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[W,K]=l.layout.get("text-offset").evaluate(x,{},w).map((e=>e*jm)):(W=l.layout.get("text-radial-offset").evaluate(x,{},w)*jm,K=yg),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(m)O=Pg(e),s&&(D=Pg(s));else{const r=l.layout.get("text-rotate").evaluate(x,{},w)+90;R=Tg(c,G,t,u,d,h,e,f,r,p),s&&(M=Tg(c,G,t,u,d,h,s,_,r))}}if(i){const o=l.layout.get("icon-rotate").evaluate(x,{},w),n=cg(i,o,L,j),a=s?cg(s,o,L,j):void 0;C=Tg(c,G,t,u,d,h,i,_,o),k=4*n.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Wm*l.layout.get("icon-size").evaluate(x,{},w)],m[0]>wg&&dr(`${e.layerIds[0]}: Value for "icon-size" is >= ${Ag}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Wm*b.compositeIconSizes[0].evaluate(x,{},w),Wm*b.compositeIconSizes[1].evaluate(x,{},w)],(m[0]>wg||m[1]>wg)&&dr(`${e.layerIds[0]}: Value for "icon-size" is >= ${Ag}. Reduce your "icon-size".`)),e.addSymbols(e.icon,n,m,v,y,x,!1,r,t,T.lineStartIndex,T.lineLength,-1,A,w,S,E),z=e.icon.placedSymbolArray.length-1,a&&(N=4*a.length,e.addSymbols(e.icon,a,m,v,y,x,Pp.vertical,r,t,T.lineStartIndex,T.lineLength,-1,A,w,S,E),U=e.icon.placedSymbolArray.length-1)}for(const q in n.horizontal){const o=n.horizontal[q];P||(H=Mo(o.text),m?I=Pg(o):P=Tg(c,G,t,u,d,h,o,f,l.layout.get("text-rotate").evaluate(x,{},w),p));const i=1===o.positionedLines.length;if(B+=Sg(e,r,t,o,a,l,m,x,p,T,n.vertical?Pp.horizontal:Pp.horizontalOnly,i?Object.keys(n.horizontal):[q],V,z,b,A,w,S),i)break}n.vertical&&(F+=Sg(e,r,t,n.vertical,a,l,m,x,p,T,Pp.vertical,["vertical"],V,U,b,A,w,S));let J=-1;const Z=(e,t)=>e?Math.max(e,t):t;J=Z(I,J),J=Z(O,J),J=Z(D,J);const Y=J>-1?1:0;e.glyphOffsetArray.length>=65535&&dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,z,U,H,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==R?R:e.collisionBoxArray.length,void 0!==R?R+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,M||e.collisionBoxArray.length,M?M+1:e.collisionBoxArray.length,u,B,F,k,N,Y,0,W,K,J,0,j?1:0)}(e,s,g,a,r,o,n,k,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,w,T,l,0,S,P,_,t,i,c,u,d,f,m)};if("line"===C)for(const B of $p(t.geometry,0,0,ii,ii)){const t=Yp(B,A,E,r.vertical||y,o,x,L,e.overscaling,ii);for(const r of t)y&&Cg(e,y.text,R,r)||N(B,r,d)}else if("line-center"===C){for(const B of t.geometry)if(B.length>1){const e=Zp(B,E,r.vertical||y,o,x,L);e&&N(B,e,d)}}else if("Polygon"===t.type)for(const B of Uh(t.geometry,0)){const e=pg(B,16);N(B[0],new Gp(e.x,e.y,0,0,void 0),d)}else if("LineString"===t.type)for(const B of t.geometry)N(B,new Gp(B[0].x,B[0].y,0,0,void 0),d);else if("Point"===t.type)for(const B of t.geometry)for(const e of B)N([e],new Gp(e.x,e.y,0,0,void 0),d)}const Ag=255,wg=Ag*Wm;function Sg(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_){const y=function(e,t,r,o,n,i,a,s){const l=[];if(0===t.positionedLines.length)return l;const c=o.layout.get("text-rotate").evaluate(i,{})*Math.PI/180,u=function(e){const t=e[0],r=e[1],o=t*r;return o>0?[t,-r]:o<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let d=Math.abs(t.top-t.bottom);for(const p of t.positionedLines)d-=p.lineOffset;const h=t.positionedLines.length,f=d/h;let m=t.top-r[1];for(let p=0;p<h;++p){const e=t.positionedLines[p];m=mg(t,f,m,p);for(const o of e.positionedGlyphs){if(!o.rect)continue;const e=o.rect||{};let i=Tp+1,d=!0,h=1,f=0;if(o.imageName){const e=a[o.imageName];if(!e)continue;if(e.sdf){dr("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,h=e.pixelRatio,i=Qp/h}const p=(n||s)&&o.vertical,g=o.metrics.advance*o.scale/2,_=o.metrics,y=o.rect;if(null===y)continue;s&&t.verticalizable&&(f=o.imageName?g-o.metrics.width*o.scale/2:0);const v=n?[o.x+g,o.y]:[0,0];let x=[0,0],b=[0,0],L=!1;n||(p?(b=[o.x+g+u[0],o.y+u[1]-f],L=!0):x=[o.x+g+r[0],o.y+r[1]-f]);const A=y.w*o.scale/(h*(o.localGlyph?ig:1)),w=y.h*o.scale/(h*(o.localGlyph?ig:1));let S,E,T,P;if(p){const e=o.y-m,t=new Ut(-g,g-e),r=-Math.PI/2,n=new Ut(...b);S=new Ut(-g+x[0],x[1]),S._rotateAround(r,t)._add(n),S.x+=-e+g,S.y-=(_.left-i)*o.scale;const a=o.imageName?_.advance*o.scale:jm*o.scale,s=String.fromCodePoint(o.glyph);Xm(s)?S.x+=(1-i)*o.scale:Qm(s)?S.x+=a-_.height*o.scale+(-i-1)*o.scale:S.x+=o.imageName||_.width+2*i===y.w&&_.height+2*i===y.h?(a-w)/2:(a-(_.height+2*i)*o.scale)/2,E=new Ut(S.x,S.y-A),T=new Ut(S.x+w,S.y),P=new Ut(S.x+w,S.y-A)}else{const e=(_.left-i)*o.scale-g+x[0],t=(-_.top-i)*o.scale+x[1],r=e+A,n=t+w;S=new Ut(e,t),E=new Ut(r,t),T=new Ut(e,n),P=new Ut(r,n)}if(c){let e;e=n?new Ut(0,0):L?new Ut(u[0],u[1]):new Ut(r[0],r[1]),S._rotateAround(c,e),E._rotateAround(c,e),T._rotateAround(c,e),P._rotateAround(c,e)}const C=new Ut(0,0),R=new Ut(0,0);l.push({tl:S,tr:E,bl:T,br:P,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:o.sectionIndex,isSDF:d,pixelOffsetTL:C,pixelOffsetBR:R,minFontScaleX:0,minFontScaleY:0})}}return l}(0,o,l,i,a,s,n,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Wm*i.layout.get("text-size").evaluate(s,{},g)],x[0]>wg&&dr(`${e.layerIds[0]}: Value for "text-size" is >= ${Ag}. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Wm*m.compositeTextSizes[0].evaluate(s,{},g),Wm*m.compositeTextSizes[1].evaluate(s,{},g)],(x[0]>wg||x[1]>wg)&&dr(`${e.layerIds[0]}: Value for "text-size" is >= ${Ag}. Reduce your "text-size".`)),e.addSymbols(e.text,y,x,l,a,s,u,t,r,c.lineStartIndex,c.lineLength,f,p,g,_,!1);for(const b of d)h[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function Eg(e){for(const t in e)return e[t];return null}function Tg(e,t,r,o,n,i,a,s,l,c){let u=a.top,d=a.bottom,h=a.left,f=a.right;const m=a.collisionPadding;if(m&&(h-=m[0],u-=m[1],f+=m[2],d+=m[3]),l){const e=new Ut(h,u),t=new Ut(f,u),r=new Ut(h,d),o=new Ut(f,d),n=Gt(l);let i=new Ut(0,0);c&&(i=new Ut(c[0],c[1])),e._rotateAround(n,i),t._rotateAround(n,i),r._rotateAround(n,i),o._rotateAround(n,i),h=Math.min(e.x,t.x,r.x,o.x),f=Math.max(e.x,t.x,r.x,o.x),u=Math.min(e.y,t.y,r.y,o.y),d=Math.max(e.y,t.y,r.y,o.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,h,u,f,d,s,o,n,i),e.length-1}function Pg(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Cg(e,t,r,o){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(o.dist(e[t])<r)return!0}else n[t]=[];return n[t].push(o),!1}function Rg(e,t){const r=e.fovAboveCenter,o=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-o)/Math.cos(e._pitch),i=Math.sin(r)*n/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),a=Math.sin(e._pitch)*i+n;return Math.min(1.01*a,n*(1/e._horizonShift))}function Mg(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),o=e.x*r,n=(e.x+1)*r,i=e.y*r,a=(e.y+1)*r,s=bu(o),l=bu(n),c=Lu(i),u=Lu(a),d=t.project(s,c),h=t.project(l,c),f=t.project(l,u),m=t.project(s,u);let p=Math.min(d.x,h.x,f.x,m.x),g=Math.min(d.y,h.y,f.y,m.y),_=Math.max(d.x,h.x,f.x,m.x),y=Math.max(d.y,h.y,f.y,m.y);const v=r/16;function x(e,r,o,n,i,a){const s=(o+i)/2,l=(n+a)/2,c=t.project(bu(s),Lu(l)),u=Math.max(0,p-c.x,g-c.y,c.x-_,c.y-y);p=Math.min(p,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>v&&(x(e,c,o,n,s,l),x(c,r,s,l,i,a))}x(d,h,o,i,n,i),x(h,f,n,i,n,a),x(f,m,n,a,o,a),x(m,d,o,a,o,i),p-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-p,y-g);return{scale:b,x:p*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function Ig(e,t){let{x:r,y:o}=t;return new Ut(((r-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*ii,(o*e.scale-e.y)*ii)}const Og=e.a9.identity(new Float32Array(16));class Dg{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new au(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return xu(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return Rg(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,o){const n=e.horizonLineFromTop(!1),i=new Ut(t,Math.max(n,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(i,o))}pointCoordinate3D(e,t,r){const o=new Ut(t,r);if(e.elevation)return e.elevation.pointCoordinate(o);{const t=this.pointCoordinate(e,o.x,o.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return Og}createTileMatrix(t,r,o){let n,i,a;const s=o.canonical,l=e.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Mg(s,this);n=1,i=c.x+o.wrap*c.scale,a=c.y,e.a9.scale(l,l,[n/c.scale,n/c.scale,t.pixelsPerMeter/r])}else n=r/t.zoomScale(s.z),i=(s.x+Math.pow(2,s.z)*o.wrap)*n,a=s.y*n;return e.a9.translate(l,l,[i,a,0]),e.a9.scale(l,l,[n/ii,n/ii,1]),l}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class kg extends Dg{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],o=Math.sin(Gt(t));this.n=(o+Math.sin(Gt(r)))/2,this.c=1+o*(2*this.n-o),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:o,r0:n}=this,i=Gt(e-this.center[0]),a=Gt(t),s=Math.sqrt(o-2*r*Math.sin(a))/r;return{x:s*Math.sin(i*r),y:s*Math.cos(i*r)-n,z:0}}unproject(e,t){const{n:r,c:o,r0:n}=this,i=n+t;let a=Math.atan2(e,Math.abs(i))*Math.sign(i);i*r<0&&(a-=Math.PI*Math.sign(e)*Math.sign(i));const s=Gt(this.center[0])*r;a=$t(a,-Math.PI-s,Math.PI-s);const l=Yt(jt(a/r)+this.center[0],-180,180),c=Math.asin(Yt((o-(e*e+i*i)*r*r)/(2*r),-1,1)),u=Yt(jt(c),-wu,wu);return new au(l,u)}}const Ng=1.340264,Bg=-.081106,Fg=893e-6,zg=.003796,Ug=Math.sqrt(3)/2;class Vg extends Dg{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Ug*Math.sin(t)),o=r*r,n=o*o*o;return{x:.5*(e*Math.cos(r)/(Ug*(Ng+3*Bg*o+n*(7*Fg+9*zg*o)))/Math.PI+.5),y:1-.5*(r*(Ng+Bg*o+n*(Fg+zg*o))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,o=r*r,n=o*o*o;for(let c,u,d,h=0;h<12&&(u=r*(Ng+Bg*o+n*(Fg+zg*o))-t,d=Ng+3*Bg*o+n*(7*Fg+9*zg*o),c=u/d,r=Yt(r-c,-Math.PI/3,Math.PI/3),o=r*r,n=o*o*o,!(Math.abs(c)<1e-12));++h);const i=Ug*e*(Ng+3*Bg*o+n*(7*Fg+9*zg*o))/Math.cos(r),a=Math.asin(Math.sin(r)/Ug),s=Yt(180*i/Math.PI,-180,180),l=Yt(180*a/Math.PI,-wu,wu);return new au(s,l)}}class Hg extends Dg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),o=Yt(360*(.5-t),-wu,wu);return new au(r,o)}}const Gg=Math.PI/2;function jg(e){return Math.tan((Gg+e)/2)}class Wg extends Dg{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let o=Gt(t),n=Gt(r);this.southernCenter=o+n<0,this.southernCenter&&(o=-o,n=-n);const i=Math.cos(o),a=jg(o);this.n=o===n?Math.sin(o):Math.log(i/Math.cos(n))/Math.log(jg(n)/a),this.f=i*Math.pow(jg(o),this.n)/this.n}project(e,t){t=Gt(t),this.southernCenter&&(t=-t),e=Gt(e-this.center[0]);const r=1e-6,{n:o,f:n}=this;n>0?t<-Gg+r&&(t=-Gg+r):t>Gg-r&&(t=Gg-r);const i=n/Math.pow(jg(t),o);let a=i*Math.sin(o*e),s=n-i*Math.cos(o*e);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:o}=this,n=o-t,i=Math.sign(n),a=Math.sign(r)*Math.sqrt(e*e+n*n);let s=Math.atan2(e,Math.abs(n))*i;n*r<0&&(s-=Math.PI*Math.sign(e)*i);const l=Yt(jt(s/r)+this.center[0],-180,180),c=Yt(jt(2*Math.atan(Math.pow(o/a,1/r))-Gg),-wu,wu);return new au(l,this.southernCenter?-c:c)}}class Kg extends Dg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:yu(e),y:vu(t),z:0}}unproject(e,t){const r=bu(e),o=Lu(t);return new au(r,o)}}const Jg=Gt(wu);class Zg extends Dg{project(e,t){const r=(t=Gt(t))*t,o=r*r;return{x:.5*((e=Gt(e))*(.8707-.131979*r+o*(o*(.003971*r-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+o*(.028874*r-.044475-.005916*o)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,o=25,n=0,i=r*r;do{i=r*r;const e=i*i;n=(r*(1.007226+i*(.015085+e*(.028874*i-.044475-.005916*e)))-t)/(1.007226+i*(.045255+e*(.259866*i-.311325-.005916*11*e))),r=Yt(r-n,-Jg,Jg)}while(Math.abs(n)>1e-6&&--o>0);i=r*r;const a=Yt(jt(e/(.8707+i*(i*(i*i*i*(.003971-.001529*i)-.013791)-.131979))),-180,180),s=jt(r);return new au(a,s)}}const Yg=Gt(wu);class qg extends Dg{project(e,t){t=Gt(t),e=Gt(e);const r=Math.cos(t),o=2/Math.PI,n=Math.acos(r*Math.cos(e/2)),i=Math.sin(n)/n,a=.5*(e*o+2*r*Math.sin(e/2)/i)||0,s=.5*(t+Math.sin(t)/i)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,o=t=(2*(1-t)-1)*Math.PI,n=25;const i=1e-6;let a=0,s=0;do{const n=Math.cos(o),i=Math.sin(o),l=2*i*n,c=i*i,u=n*n,d=Math.cos(r/2),h=Math.sin(r/2),f=2*d*h,m=h*h,p=1-u*d*d,g=p?1/p:0,_=p?Math.acos(n*d)*Math.sqrt(1/p):0,y=.5*(2*_*n*h+2*r/Math.PI)-e,v=.5*(_*i+o)-t,x=.5*g*(u*m+_*n*d*c)+1/Math.PI,b=g*(f*l/4-_*i*h),L=.125*g*(l*h-_*i*u*f),A=.5*g*(c*d+_*m*n)+.5,w=b*L-A*x;a=(v*b-y*A)/w,s=(y*L-v*x)/w,r=Yt(r-a,-Math.PI,Math.PI),o=Yt(o-s,-Yg,Yg)}while((Math.abs(a)>i||Math.abs(s)>i)&&--n>0);return new au(jt(r),jt(o))}}class $g extends Dg{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:o}=this;return{x:Gt(e)*o*r+.5,y:-Math.sin(Gt(t))/o*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:o}=this,n=-(t-.5)/r,i=Yt(jt((e-.5)/r)/o,-180,180),a=Math.asin(Yt(n*o,-1,1)),s=Yt(jt(a),-wu,wu);return new au(i,s)}}class Xg extends Kg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,r,o){const n=Md(t,r,o),i=Dd(Sd(o));return e.Q.transformMat4(n,n,i),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,r){const o=ou(r.lat,r.lng),n=e.Q.normalize([],o),i=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(r),t._centerAltitude):t._centerAltitude,a=xu(1,0)*ii*i;e.Q.scaleAndAdd(o,o,n,a);const s=e.a9.identity(new Float64Array(16));return e.a9.multiply(s,t.pixelMatrix,t.globeMatrix),e.Q.transformMat4(o,o,s),new Ut(o[0],o[1])}pixelsPerMeter(e,t){return xu(1,0)*t}pixelSpaceConversion(e,t,r){const o=xu(1,e)*t,n=Go(xu(1,45)*t,o,r);return this.pixelsPerMeter(e,t)/n}createTileMatrix(t,r,o){const n=kd(Sd(o.canonical));return e.a9.multiply(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,r){const{center:o}=t,n=Dd(Sd(r));return e.a9.rotateY(n,n,Gt(o.lng)),e.a9.rotateX(n,n,Gt(o.lat)),e.a9.scale(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,r,o){return Ld(e,t,r,!0)||new Cu(0,0)}pointCoordinate3D(e,t,r){const o=this.pointCoordinate(e,t,r,0);return[o.x,o.y,o.z]}isPointAboveHorizon(e,t){return!Ld(e,t.x,t.y,!1)}farthestPixelDistance(t){const r=function(t,r){const o=t.cameraToCenterDistance,n=t._centerAltitude*r,i=t._camera,a=t._camera.forward(),s=e.Q.add([],e.Q.scale([],a,-o),[0,0,n]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],u=t.width/t.height,d=Math.tan(t.fovAboveCenter),h=e.Q.scale([],i.up(),d),f=e.Q.scale([],i.right(),d*u),m=e.Q.normalize([],e.Q.add([],e.Q.add([],a,h),f)),p=[];let g;if(new ld(s,m).closestPointOnSphere(c,l,p)){const r=e.Q.add([],p,c),o=e.Q.sub([],r,s);g=Math.cos(t.fovAboveCenter)*e.Q.length(o)}else{const t=e.Q.sub([],s,c),r=e.Q.sub([],c,s);e.Q.normalize(r,r);const o=e.Q.length(t)-l;g=Math.sqrt(o*(o+2*l));const n=Math.acos(g/(l+o))-Math.acos(e.Q.dot(a,r));g*=Math.cos(n)}return 1.01*g}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),o=zd(t.zoom);if(o>0){const e=Rg(t,xu(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),i=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Go(r,e+n*(1-Math.cos(i)),Math.pow(o,10))}return r}upVector(e,t,r){return Md(t,r,e,1)}upVectorScale(e){return{metersToTile:xd(Id(Sd(e)))}}}function Qg(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Kg(e);case"equirectangular":return new Hg(e);case"naturalEarth":return new Zg(e);case"equalEarth":return new Vg(e);case"winkelTripel":return new qg(e);case"albers":return r?new $g(e):new kg(e);case"lambertConformalConic":return r?new $g(e):new Wg(e);case"globe":return new Xg(e)}throw new Error(`Invalid projection name: ${e.name}`)}const e_=ff.types,t_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function r_(e,t,r,o,n,i,a,s,l,c,u,d,h){const f=s?Math.min(wg,Math.round(s[0])):0,m=s?Math.min(wg,Math.round(s[1])):0;e.emplaceBack(t,r,Math.round(32*o),Math.round(32*n),i,a,(f<<1)+(l?1:0),m,16*c,16*u,256*d,256*h)}function o_(e,t,r){e.emplaceBack(t,r)}function n_(e,t,r,o,n,i,a){e.emplaceBack(t,r,o,n,i,a)}function i_(e,t,r,o,n){e.emplaceBack(t,r,o,n),e.emplaceBack(t,r,o,n),e.emplaceBack(t,r,o,n),e.emplaceBack(t,r,o,n)}function a_(e){for(const t of e.sections)if(Ts(t.text))return!0;return!1}class s_{constructor(e){this.layoutVertexArray=new kl,this.indexArray=new Gl,this.programConfigurations=e,this.segments=new pc,this.dynamicLayoutVertexArray=new Rl,this.opacityVertexArray=new Bl,this.placedSymbolArray=new ic,this.iconTransitioningVertexArray=new Fl,this.globeExtVertexArray=new Nl,this.zOffsetVertexArray=new Kl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,r,o,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,km.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,t_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,zm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Nm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Fm.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ms(s_,"SymbolBuffers");class l_{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new pc,this.collisionVertexArray=new Hl,this.collisionVertexArrayExt=new Rl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Um.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ms(l_,"CollisionBuffers");class c_{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.a9.identity([]),this.placementViewportMatrix=e.a9.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Km(this.zoom,r["text-size"]),this.iconSizeData=Km(this.zoom,r["icon-size"]);const o=this.layers[0].layout,n=o.get("symbol-sort-key"),i=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map((e=>Pp[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new s_(new Hc(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new s_(new Hc(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new lc,this.lineVertexArray=new cc,this.symbolInstances=new sc}calculateGlyphDependencies(e,t,r,o,n){for(let i=0;i<e.length;i++){const r=e.codePointAt(i);if(void 0===r)break;if(t[r]=!0,o&&n&&r<=65535){const r=$m[e.charAt(i)];r&&(t[r.charCodeAt(0)]=!0)}}}populate(t,r,o,n){const i=this.layers[0],a=i.layout,s="globe"===this.projection.name,l=a.get("text-font"),c=a.get("text-field"),u=a.get("icon-image"),d=("constant"!==c.value.kind||c.value.value instanceof mn&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),h="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,f=a.get("symbol-sort-key");if(this.features=[],!d&&!h)return;const m=r.iconDependencies,p=r.glyphDependencies,g=r.availableImages,_=new Us(this.zoom);for(const{feature:y,id:v,index:x,sourceLayerIndex:b}of t){const t=i._featureFilter.needGeometry,r=Fu(y,t);if(!i._featureFilter.filter(_,r,o))continue;if(t||(r.geometry=Bu(y,o,n)),s&&1!==y.type&&o.z<=5){const t=r.geometry,n=.98078528056,i=(t,r)=>{const i=Md(t.x,t.y,o,1),a=Md(r.x,r.y,o,1);return e.Q.dot(i,a)<n};for(let e=0;e<t.length;e++)t[e]=Ou(t[e],i)}let c,u;if(d){const e=i.getValueAndResolveTokens("text-field",r,o,g),t=mn.factory(e);a_(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Bs()||this.hasRTLText&&zs.isParsed())&&(c=qm(t,i,r))}if(h){const e=i.getValueAndResolveTokens("icon-image",r,o,g);u=e instanceof pn?e:pn.fromString(e)}if(!c&&!u)continue;const L=this.sortFeaturesByKey?f.evaluate(r,{},o):void 0;if(this.features.push({id:v,text:c,icon:u,index:x,sourceLayerIndex:b,geometry:r.geometry,properties:y.properties,type:e_[y.type],sortKey:L}),u&&(m[u.namePrimary]=!0,u.nameSecondary&&(m[u.nameSecondary]=!0)),c){const e=l.evaluate(r,{},o).join(","),t="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pp.vertical)>=0;for(const r of c.sections)if(r.image)m[r.image.namePrimary]=!0;else{const o=xs(c.toString()),n=r.fontStack||e,i=p[n]=p[n]||{};this.calculateGlyphDependencies(r.text,i,t,this.allowVerticalPlacement,o)}}}"line"===a.get("symbol-placement")&&(this.features=function(e){const t={},r={},o=[];let n=0;function i(t){o.push(e[t]),n++}function a(e,t,n){const i=r[e];return delete r[e],r[t]=i,o[i].geometry[0].pop(),o[i].geometry[0]=o[i].geometry[0].concat(n[0]),i}function s(e,r,n){const i=t[r];return delete t[r],t[e]=i,o[i].geometry[0].shift(),o[i].geometry[0]=n[0].concat(o[i].geometry[0]),i}function l(e,t,r){const o=r?t[0][t[0].length-1]:t[0][0];return`${e}:${o.x}:${o.y}`}for(let c=0;c<e.length;c++){const u=e[c],d=u.geometry,h=u.text?u.text.toString():null;if(!h){i(c);continue}const f=l(h,d),m=l(h,d,!0);if(f in r&&m in t&&r[f]!==t[m]){const e=s(f,m,d),n=a(f,m,o[e].geometry);delete t[f],delete r[m],r[l(h,o[n].geometry,!0)]=n,o[e].geometry=null}else f in r?a(f,m,d):m in t?s(f,m,d):(i(c),t[f]=n-1,r[m]=n-1)}return o.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,r,o,n){const i=0!==Object.keys(e).length;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,a,r,o,n),this.icon.programConfigurations.updatePaintArrays(e,t,a,r,o,n)}updateZOffset(){const e=(e,t,o)=>{r+=t,r>e.length&&e.resize(r);for(let n=-t;n<0;n++)e.emplace(n+r,o)},t=(e,t,r)=>{o+=t,o>e.length&&e.resize(o);for(let n=-t;n<0;n++)e.emplace(n+o,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,o=0;for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:i,numIconVertices:a}=r,s=r.zOffset,l=a>0;if((o>0||i>0)&&(e(this.text.zOffsetVertexArray,o,s),e(this.text.zOffsetVertexArray,i,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:o}=r;e>=0&&t(this.icon.zOffsetVertexArray,a,s),o>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Qg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:o,y:n}of t)this.lineVertexArray.emplaceBack(o,n);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?i.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,L=this.allowVerticalPlacement&&a===Pp.vertical?Math.PI/2:0,A=i.text&&i.text.sections;for(let S=0;S<t.length;S++){const{tl:o,tr:n,bl:a,br:c,texPrimary:u,texSecondary:d,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:w,minFontScaleY:E,glyphOffset:T,isSDF:P,sectionIndex:C}=t[S],R=v.vertexLength,M=T[1];if(r_(_,l.x,l.y,o.x,M+o.y,u.x,u.y,r,P,x.x,x.y,w,E),r_(_,l.x,l.y,n.x,M+n.y,u.x+u.w,u.y,r,P,b.x,x.y,w,E),r_(_,l.x,l.y,a.x,M+a.y,u.x,u.y+u.h,r,P,x.x,b.y,w,E),r_(_,l.x,l.y,c.x,M+c.y,u.x+u.w,u.y+u.h,r,P,b.x,b.y,w,E),s){const{x:t,y:r,z:o}=s.anchor,[n,i,a]=s.up;n_(y,t,r,o,n,i,a),n_(y,t,r,o,n,i,a),n_(y,t,r,o,n,i,a),n_(y,t,r,o,n,i,a),i_(e.dynamicLayoutVertexArray,t,r,o,L)}else i_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,L);if(p){const t=d||u;o_(e.iconTransitioningVertexArray,t.x,t.y),o_(e.iconTransitioningVertexArray,t.x+t.w,t.y),o_(e.iconTransitioningVertexArray,t.x,t.y+t.h),o_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(R,R+1,R+2),g.emplaceBack(R+1,R+2,R+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),S!==t.length-1&&C===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,i,i.index,{},h,f,m,A&&A[C])}const w=s?s.anchor:l;e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,u,l.segment,r?r[0]:0,r?r[1]:0,o[0],o[1],a,0,!1,0,d,0)}_commitLayoutVertex(e,t,r,o,n,i,a){e.emplaceBack(t,r,o,n,i,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,r,o,n,i,a){const s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=s.vertexLength,c=a.tileAnchorX,u=a.tileAnchorY;for(let h=0;h<4;h++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,t,e.padding,a.zOffset),this._commitLayoutVertex(r.layoutVertexArray,o,n,i,c,u,new Ut(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,n,i,c,u,new Ut(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,n,i,c,u,new Ut(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,o,n,i,c,u,new Ut(e.x1,e.y2)),s.vertexLength+=4;const d=r.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,o,n,i){for(let a=o;a<n;a++){const o=r.get(a),n=this.getSymbolInstanceTextSize(e,i,t,a);this._addCollisionDebugVertices(o,n,this.textCollisionBox,o.projectedAnchorX,o.projectedAnchorY,o.projectedAnchorZ,i)}}_addIconDebugCollisionBoxes(e,t,r,o,n,i){for(let a=o;a<n;a++){const o=r.get(a),n=this.getSymbolInstanceIconSize(e,t,i.placedIconSymbolIndex);this._addCollisionDebugVertices(o,n,this.iconCollisionBox,o.projectedAnchorX,o.projectedAnchorY,o.projectedAnchorZ,i)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new l_(Ul,Hm.members,Fl),this.iconCollisionBox=new l_(Ul,Hm.members,Fl);const r=Zm(this.iconSizeData,e),o=Zm(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(o,e,t,i.textBoxStartIndex,i.textBoxEndIndex,i),this._addTextDebugCollisionBoxes(o,e,t,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i),this._addIconDebugCollisionBoxes(r,e,t,i.iconBoxStartIndex,i.iconBoxEndIndex,i),this._addIconDebugCollisionBoxes(r,e,t,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i)}}getSymbolInstanceTextSize(e,t,r,o){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:o),i=Jm(this.textSizeData,e,n)/jm;return this.tilePixelRatio*i}getSymbolInstanceIconSize(e,t,r){const o=this.icon.placedSymbolArray.get(r),n=Jm(this.iconSizeData,e,o);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,r,o){e.emplaceBack(t,-r,-r,o),e.emplaceBack(t,r,-r,o),e.emplaceBack(t,r,r,o),e.emplaceBack(t,-r,r,o)}_updateTextDebugCollisionBoxes(e,t,r,o,n,i){for(let a=o;a<n;a++){const o=r.get(a),n=this.getSymbolInstanceTextSize(e,i,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,o.padding,i.zOffset)}}_updateIconDebugCollisionBoxes(e,t,r,o,n,i){for(let a=o;a<n;a++){const o=r.get(a),n=this.getSymbolInstanceIconSize(e,t,i.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,o.padding,i.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Zm(this.iconSizeData,e),o=Zm(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(o,e,t,i.textBoxStartIndex,i.textBoxEndIndex,i),this._updateTextDebugCollisionBoxes(o,e,t,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i),this._updateIconDebugCollisionBoxes(r,e,t,i.iconBoxStartIndex,i.iconBoxEndIndex,i),this._updateIconDebugCollisionBoxes(r,e,t,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,o,n,i,a,s,l){const c={};if(t<r){const{x1:r,y1:o,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(t);c.textBox={x1:r,y1:o,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.textFeatureIndex=f}if(o<n){const{x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(o);c.verticalTextBox={x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalTextFeatureIndex=f}if(i<a){const{x1:t,y1:r,x2:o,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(i);c.iconBox={x1:t,y1:r,x2:o,y2:n,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.iconFeatureIndex=f}if(s<l){const{x1:t,y1:r,x2:o,y2:n,padding:i,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:f}=e.get(s);c.verticalIconBox={x1:t,y1:r,x2:o,y2:n,padding:i,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalIconFeatureIndex=f}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),o=r.vertexStartIndex+4*r.numGlyphs;for(let n=r.vertexStartIndex;n<o;n+=4)e.indexArray.emplaceBack(n,n+1,n+2),e.indexArray.emplaceBack(n+1,n+2,n+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),o=[],n=[],i=[];for(let a=0;a<this.symbolInstances.length;++a){i.push(a);const e=this.symbolInstances.get(a);o.push(0|Math.round(t*e.tileAnchorX+r*e.tileAnchorY)),n.push(e.featureIndex)}return i.sort(((e,t)=>o[e]-o[t]||n[t]-n[e])),i}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:i,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:s}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&o!==r&&this.addIndicesForPlacedSymbol(this.text,o),n>=0&&n!==o&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&this.addIndicesForPlacedSymbol(this.text,i),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ms(c_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),c_.addDynamicAttributes=i_;const u_=new Xs({"symbol-placement":new Ys(tl.layout_symbol["symbol-placement"]),"symbol-spacing":new Ys(tl.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ys(tl.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qs(tl.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ys(tl.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ys(tl.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Ys(tl.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ys(tl.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ys(tl.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ys(tl.layout_symbol["icon-rotation-alignment"]),"icon-size":new qs(tl.layout_symbol["icon-size"]),"icon-text-fit":new qs(tl.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qs(tl.layout_symbol["icon-text-fit-padding"]),"icon-image":new qs(tl.layout_symbol["icon-image"]),"icon-rotate":new qs(tl.layout_symbol["icon-rotate"]),"icon-padding":new Ys(tl.layout_symbol["icon-padding"]),"icon-keep-upright":new Ys(tl.layout_symbol["icon-keep-upright"]),"icon-offset":new qs(tl.layout_symbol["icon-offset"]),"icon-anchor":new qs(tl.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ys(tl.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ys(tl.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ys(tl.layout_symbol["text-rotation-alignment"]),"text-field":new qs(tl.layout_symbol["text-field"]),"text-font":new qs(tl.layout_symbol["text-font"]),"text-size":new qs(tl.layout_symbol["text-size"]),"text-max-width":new qs(tl.layout_symbol["text-max-width"]),"text-line-height":new qs(tl.layout_symbol["text-line-height"]),"text-letter-spacing":new qs(tl.layout_symbol["text-letter-spacing"]),"text-justify":new qs(tl.layout_symbol["text-justify"]),"text-radial-offset":new qs(tl.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ys(tl.layout_symbol["text-variable-anchor"]),"text-anchor":new qs(tl.layout_symbol["text-anchor"]),"text-max-angle":new Ys(tl.layout_symbol["text-max-angle"]),"text-writing-mode":new Ys(tl.layout_symbol["text-writing-mode"]),"text-rotate":new qs(tl.layout_symbol["text-rotate"]),"text-padding":new Ys(tl.layout_symbol["text-padding"]),"text-keep-upright":new Ys(tl.layout_symbol["text-keep-upright"]),"text-transform":new qs(tl.layout_symbol["text-transform"]),"text-offset":new qs(tl.layout_symbol["text-offset"]),"text-allow-overlap":new Ys(tl.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ys(tl.layout_symbol["text-ignore-placement"]),"text-optional":new Ys(tl.layout_symbol["text-optional"]),visibility:new Ys(tl.layout_symbol.visibility)});var d_={paint:new Xs({"icon-opacity":new qs(tl.paint_symbol["icon-opacity"]),"icon-emissive-strength":new qs(tl.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new qs(tl.paint_symbol["text-emissive-strength"]),"icon-color":new qs(tl.paint_symbol["icon-color"]),"icon-halo-color":new qs(tl.paint_symbol["icon-halo-color"]),"icon-halo-width":new qs(tl.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qs(tl.paint_symbol["icon-halo-blur"]),"icon-translate":new Ys(tl.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ys(tl.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new qs(tl.paint_symbol["icon-image-cross-fade"]),"text-opacity":new qs(tl.paint_symbol["text-opacity"]),"text-color":new qs(tl.paint_symbol["text-color"],{runtimeType:Qo,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new qs(tl.paint_symbol["text-halo-color"]),"text-halo-width":new qs(tl.paint_symbol["text-halo-width"]),"text-halo-blur":new qs(tl.paint_symbol["text-halo-blur"]),"text-translate":new Ys(tl.paint_symbol["text-translate"]),"text-translate-anchor":new Ys(tl.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ys(tl.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ys(tl.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ys(tl.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ys(tl.paint_symbol["icon-color-brightness-max"])}),layout:u_};class h_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Yo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ms(h_,"FormatSectionOverride",{omit:["defaultValue"]});class f_ extends vl{constructor(t,r,o){super(t,d_,r,o),this._colorAdjustmentMatrix=e.a9.identity([])}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,r,o,n){return this._saturation===t&&this._contrast===r&&this._brightnessMin===o&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(t,r,o,n){t=Cr(t),r=Pr(r);const i=e.a9.create(),a=t/3,s=1-2*a,l=[s,a,a,0,a,s,a,0,a,a,s,0,0,0,0,1],c=.5-.5*r,u=n-o;return e.a9.multiply(i,[u,0,0,0,0,u,0,0,0,0,u,0,o,o,o,1],[r,0,0,0,0,r,0,0,0,0,r,0,c,c,c,1]),e.a9.multiply(i,i,l),i}(t,r,o,n),this._saturation=t,this._contrast=r,this._brightnessMin=o,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,r,o){const n=this.layout.get(e).evaluate(t,{},r,o),i=this._unevaluatedLayout._values[e];return i.isDataDriven()||rs(i.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,r)=>r in e?String(e[r]):""))}(t.properties,n)}createBucket(e){return new c_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of d_.paint.overridableProperties){if(!f_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new h_(t),o=new ts(r,t.property.specification,this.scope,this.options);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new ns("source",o):new is("composite",o,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Js(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&f_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),o=d_.paint.properties[t];let n=!1;const i=e=>{for(const t of e)if(o.overrides&&o.overrides.hasOverride(t))return void(n=!0)};if("constant"===r.value.kind&&r.value.value instanceof mn)i(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{n||(t instanceof xn&&yn(t.value)===on?i(t.value.sections):t instanceof wn?i(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),r=[];return e&&r.push("symbolIcon"),t&&r.push("symbolSDF"),r}getDefaultProgramParams(e,t){return{config:new Vc(this,t),overrideFog:!1}}}const m_=new Xs({visibility:new Ys(tl.layout_background.visibility)});var p_={paint:new Xs({"background-color":new Ys(tl.paint_background["background-color"]),"background-pattern":new Ys(tl.paint_background["background-pattern"]),"background-opacity":new Ys(tl.paint_background["background-opacity"]),"background-emissive-strength":new Ys(tl.paint_background["background-emissive-strength"])}),layout:m_};const g_=new Xs({visibility:new Ys(tl.layout_raster.visibility)});var __={paint:new Xs({"raster-opacity":new Ys(tl.paint_raster["raster-opacity"]),"raster-color":new $s(tl.paint_raster["raster-color"]),"raster-color-mix":new Ys(tl.paint_raster["raster-color-mix"]),"raster-color-range":new Ys(tl.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ys(tl.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ys(tl.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ys(tl.paint_raster["raster-brightness-max"]),"raster-saturation":new Ys(tl.paint_raster["raster-saturation"]),"raster-contrast":new Ys(tl.paint_raster["raster-contrast"]),"raster-resampling":new Ys(tl.paint_raster["raster-resampling"]),"raster-fade-duration":new Ys(tl.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ys(tl.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ys(tl.paint_raster["raster-array-band"]),"raster-elevation":new Ys(tl.paint_raster["raster-elevation"])}),layout:g_},y_=Al([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class v_{constructor(e,t,r,o){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,o)}update(e,t,r){const{width:o,height:n}=e,{context:i}=this,{gl:a}=i;if(a.bindTexture(a.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),r||this.size&&this.size[0]===o&&this.size[1]===n){const{x:t,y:i}=r||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)a.texSubImage2D(a.TEXTURE_2D,0,t,i,a.RGBA,a.UNSIGNED_BYTE,e);else{let r=this.format,s=a.UNSIGNED_BYTE;this.format===a.R32F&&(r=a.RED,s=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,t,i,o,n,r,s,e.data)}}else if(this.size=[o,n],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===a.R8&&(t=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,t,a.UNSIGNED_BYTE,e)}else{let t=this.format,r=this.format,i=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(t=a.DEPTH_COMPONENT16,i=a.UNSIGNED_SHORT),this.format===a.R8&&(r=a.RED),this.format===a.R32F&&(i=a.FLOAT,r=a.RED),a.texImage2D(a.TEXTURE_2D,0,t,o,n,0,r,i,e.data)}this.useMipmap=Boolean(t&&t.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:o}=this,{gl:n}=o;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,r,o){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.magFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,r),this.wrapS=r),o!==this.wrapT&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,o),this.wrapT=o)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class x_{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,t),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,t),this.wrapS=t)}}function b_(t,r,o,n,i,a,s,l){const c=[t,r,1,o,n,1,i,a,1],u=[s,l,1],d=e.ct.adjoint([],c),[h,f,m]=e.Q.transformMat3(u,u,d);return e.ct.multiply(c,c,[h,0,0,0,f,0,0,0,m])}function L_(t,r,o,n,i,a,s,l){const c=function(t,r,o,n,i,a,s,l){const c=b_(0,0,1,0,1,1,0,1),u=b_(t,r,o,n,i,a,s,l),d=e.ct.adjoint([],c);return e.ct.multiply(u,u,d)}(t,r,o,n,i,a,s,l);return[c[2]/c[8]/ii,c[5]/c[8]/ii]}function A_(e){return[e[0],Math.min(Math.max(e[1],-wu),wu)]}class w_ extends No{constructor(e,t,r,o){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(o),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Do("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=no(this.map._requestManager.transformRequest(this.url,Yr.Image),((t,r)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new ko(t)):r&&(this.image=r instanceof HTMLImageElement?Mr.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new x_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Do("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof x_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],r=e[0][1];for(const n of e)n[1]>r&&(r=n[1]),n[1]<t&&(t=n[1]);const o=(r+t)/2;if(o>wu?this.onNorthPole=!0:o<-wu&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Cu.fromLngLat);this.tileID=function(e){let t=1/0,r=1/0,o=-1/0,n=-1/0;for(const c of e)t=Math.min(t,c.x),r=Math.min(r,c.y),o=Math.max(o,c.x),n=Math.max(n,c.y);const i=Math.max(o-t,n-r),a=Math.max(0,Math.floor(-Math.log(i)/Math.LN2)),s=Math.pow(2,a);let l=Math.floor((t+o)/2*s);return l>1&&(l-=1),new uu(a,l,Math.floor((r+n)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Do("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Mg(new uu(0,0,0),this.map.transform.projection),o=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,r=e[1].y-e[0].y,o=e[2].x-e[1].x,n=e[2].y-e[1].y,i=e[3].x-e[2].x,a=e[3].y-e[2].y,s=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*n-o*r,u=o*a-i*n,d=i*l-s*a,h=s*r-t*l;return c>0&&u>0&&d>0&&h>0||c<0&&u<0&&d<0&&h<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=Mg(this.tileID,this.map.transform.projection),[i,a,s,l]=this.coordinates.map((e=>{const t=n.projection.project(e[0],e[1]);return Ig(n,t)._round()}));this.perspectiveTransform=L_(i.x,i.y,a.x,a.y,s.x,s.y,l.x,l.y);const c=this._boundsArray=new Tl;c.emplaceBack(i.x,i.y,0,0),c.emplaceBack(a.x,a.y,ii,0),c.emplaceBack(l.x,l.y,0,ii),c.emplaceBack(s.x,s.y,ii,ii),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,y_.members),this.boundsSegments=pc.simpleSegment(0,0,4,2);const u=[],d=[A_((h=this.coordinates)[0]),A_(h[1]),A_(h[2]),A_(h[3])];var h;const[f,m,p,g]=function(e){let t=e[0][0],r=t,o=e[0][1],n=o;for(let i=1;i<e.length;i++)e[i][0]<t?t=e[i][0]:e[i][0]>r&&(r=e[i][0]),e[i][1]<o?o=e[i][1]:e[i][1]>n&&(n=e[i][1]);return[t,o,r-t,n-o]}(d);{const n=new Tl,[i,a,s,l]=function(e){let t=e[0].x,r=t,o=e[0].y,n=o;for(let i=1;i<e.length;i++)e[i].x<t?t=e[i].x:e[i].x>r&&(r=e[i].x),e[i].y<o?o=e[i].y:e[i].y>n&&(n=e[i].y);return[t,o,r-t,n-o]}(o),c=e=>[(e.x-i)/s,(e.y-a)/l],[d,h,_,y]=o.map(c),v=function(t,r,o,n,i,a,s,l){const c=b_(0,0,1,0,1,1,0,1),u=b_(t,r,o,n,i,a,s,l),d=e.ct.adjoint([],u);return e.ct.multiply(c,c,d)}(d[0],d[1],h[0],h[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=L_(d[0],d[1],h[0],h[1],_[0],_[1],y[0],y[1]);const x=(t,r)=>{u.push(t.lng);const o=Math.round((t.lng-f)/p*ii),i=Math.round((t.lat-m)/g*ii),a=c(r),s=e.Q.transformMat3([],[a[0],a[1],1],v),l=Math.round(s[0]/s[2]*ii),d=Math.round(s[1]/s[2]*ii);n.emplaceBack(o,i,l,d)},b=o[3].x-o[0].x,L=o[3].y-o[0].y,A=o[2].x-o[1].x,w=o[2].y-o[1].y;for(let e=0;e<65;e++){const t=e/64,n=[o[0].x+t*b,o[0].y+t*L],i=[o[1].x+t*A,o[1].y+t*w],a=i[0]-n[0],s=i[1]-n[1];for(let e=0;e<65;e++){const t=e/64,o={x:n[0]+a*t,y:n[1]+s*t,z:0};x(r.projection.unproject(o.x,o.y),o)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,y_.members)}{this.maxLongitudeTriangleSize=0;let e=[],r=new Gl;const o=(t,o,n)=>{r.emplaceBack(t,o,n);const i=u[t],a=u[o],s=u[n],l=Math.min(Math.min(i,a),s),c=Math.max(Math.max(i,a),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const r=65*t+e,n=r+1,i=r+65,a=i+1;o(r,i,n),o(n,i,a)}[e,r]=function(e,t){const r=Array.from({length:e.length},((e,t)=>t));r.sort(((t,r)=>e[t]-e[r]));const o=[],n=new Gl;for(let i=0;i<r.length;i++){const a=r[i];o.push(e[a]);const s=3*a,l=s+1;n.emplaceBack(t.uint16[s],t.uint16[l],t.uint16[l+1])}return[o,n]}(e,r),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(r)}this.elevatedGlobeSegments=pc.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,p/ii,0,g/ii,0,0,m,f,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,r=t.gl;!this._dirty||this.texture instanceof x_||(this.texture?this.texture.update(this.image):(this.texture=new v_(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let o=((e,t)=>e+360*Math.round((t-e)/360))(e+180,r[0]);const n=new pc,i=(e,r)=>{n.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-o)<=a){const e=Tr(r,0,r.length,o+a);return e===r.length||i(e,Er(r,e+1,r.length,o+360-a)-e),n}o<r[0]&&(o+=360);const s=Er(r,0,r.length,o-a);if(s===r.length)return i(0,r.length),n;i(0,s-0);const l=Tr(r,s+1,r.length,o+a);return l!==r.length&&i(l,r.length-l),n}}const S_=(Math.pow(256,2)-1)/16907520;class E_ extends vl{constructor(e,t,r){super(e,__,t,r),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof w_&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[r,o]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(o)||r===this._curRampRange[0]&&o===this._curRampRange[1]||(this.colorRamp=sh({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:o}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,o])}}const T_=new Xs({visibility:new Ys(tl["layout_raster-particle"].visibility)});var P_={paint:new Xs({"raster-particle-array-band":new Ys(tl["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ys(tl["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new $s(tl["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ys(tl["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ys(tl["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ys(tl["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ys(tl["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:T_};class C_ extends vl{constructor(e,t,r){super(e,P_,t,r),this._updateColorRamp(),this.lastInvalidatedAt=Mr.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=sh({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Mr.now()}}class R_ extends vl{constructor(e,t){super(e,{},t),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const M_=new Xs({visibility:new Ys(tl.layout_sky.visibility)});var I_={paint:new Xs({"sky-type":new Ys(tl.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ys(tl.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ys(tl.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ys(tl.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ys(tl.paint_sky["sky-gradient-radius"]),"sky-gradient":new $s(tl.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ys(tl.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ys(tl.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ys(tl.paint_sky["sky-opacity"])}),layout:M_};function O_(t,r,o){const n=[0,0,1],i=e.bl.identity([]);return e.bl.rotateY(i,i,o?-Gt(t)+Math.PI:Gt(t)),e.bl.rotateX(i,i,-Gt(r)),e.Q.transformQuat(n,n,i),e.Q.normalize(n,n)}var D_={paint:new Xs({})};function k_(t,r){const o=B_(t.projection,t.zoom,t.width,t.height),n=function(t,r,o,n,i){const a=new au(o.lng-180*F_,o.lat),s=new au(o.lng+180*F_,o.lat),l=t.project(a.lng,a.lat),c=t.project(s.lng,s.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),d=Cu.fromLngLat(o);d.y=Yt(d.y,-1+F_,1-F_);const h=d.toLngLat(),f=t.project(h.lng,h.lat),m=Cu.fromLngLat(h);m.x+=F_;const p=m.toLngLat(),g=t.project(p.lng,p.lat),_=U_(g.x-f.x,g.y-f.y,u),y=Cu.fromLngLat(h);y.y+=F_;const v=y.toLngLat(),x=t.project(v.lng,v.lat),b=U_(x.x-f.x,x.y-f.y,u),L=Math.abs(_.x)/Math.abs(b.y),A=e.a9.identity([]);e.a9.rotateZ(A,A,-u*(1-(i?0:n)));const w=e.a9.identity([]);return e.a9.scale(w,w,[1,1-(1-L)*n,1]),w[4]=-b.x/b.y*n,e.a9.rotateZ(w,w,u),e.a9.multiply(w,A,w),w}(t.projection,0,t.center,o,r),i=N_(t);return e.a9.scale(n,n,[i,i,1]),n}function N_(e){const t=e.projection,r=B_(e.projection,e.zoom,e.width,e.height),o=z_(t,e.center),n=z_(t,au.convert(t.center));return Math.pow(2,o*r+(1-r)*n)}function B_(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const i=e.range;if(!i)return 0;const a=Math.min(n,Math.max(r,o)),s=Math.log(a/1024)/Math.LN2;return qt(i[0]+s,i[1]+s,t)}const F_=1/4e4;function z_(e,t){const r=Yt(t.lat,-wu,wu),o=new au(t.lng-180*F_,r),n=new au(t.lng+180*F_,r),i=e.project(o.lng,r),a=e.project(n.lng,r),s=Cu.fromLngLat(o),l=Cu.fromLngLat(n),c=a.x-i.x,u=a.y-i.y,d=l.x-s.x,h=l.y-s.y,f=Math.sqrt((d*d+h*h)/(c*c+u*u));return Math.log(f)/Math.LN2}function U_(e,t,r){const o=Math.cos(r),n=Math.sin(r);return{x:e*o-t*n,y:e*n+t*o}}function V_(t,r,o){e.a9.identity(t),e.a9.rotateZ(t,t,Gt(r[2])),e.a9.rotateX(t,t,Gt(r[0])),e.a9.rotateY(t,t,Gt(r[1])),e.a9.scale(t,t,o),e.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function H_(t,r,o,n,i,a,s,l){const c=[o[0]-r[0],o[1]-r[1],0],u=[n[0]-r[0],n[1]-r[1],0];if(e.Q.length(c)<1e-12||e.Q.length(u)<1e-12)return e.bl.identity(t);const d=e.Q.cross([],c,u);e.Q.normalize(d,d),e.Q.subtract(u,n,r),c[2]=(a-i)*l,u[2]=(s-i)*l;const h=c;return e.Q.cross(h,c,u),e.Q.normalize(h,h),e.bl.rotationTo(t,d,h)}function G_(t,r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=zd(r.zoom),i=function(t,r,o){const n=r.worldSize,i=[t[12],t[13],t[14]],a=Lu(i[1]/n),s=bu(i[0]/n),l=e.a9.identity([]),c=xu(1,a)*n,u=xu(1,0)*n*Eu(a,r.zoom),d=1/Nd(n);let h=u*d;if(o){const e=B_(r.projection,r.zoom,r.width,r.height,1024);h=d*r.projection.pixelSpaceConversion(r.center.lat,n,e)}const f=ou(a,s);e.Q.add(f,f,e.Q.scale([],e.Q.normalize([],f),c*h*i[2]));const m=function(t){const r=[t[0],t[1],t[2]];let o=[0,1,0];const n=e.Q.cross([],o,r);return e.Q.cross(o,r,n),0===e.Q.squaredLength(o)&&(o=[0,1,0],e.Q.cross(n,r,o)),e.Q.normalize(n,n),e.Q.normalize(o,o),e.Q.normalize(r,r),[n[0],n[1],n[2],0,o[0],o[1],o[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],1]}(f);e.a9.scale(l,l,[h,h,h*c]),e.a9.translate(l,l,[-i[0],-i[1],-i[2]]);const p=e.a9.multiply([],r.globeMatrix,m);return e.a9.multiply(p,p,l),e.a9.multiply(p,p,t),p}(t,r,o);if(n>0){const o=function(t,r){const o=r.worldSize,n=xu(1,0)*o*Eu(r.center.lat,r.zoom)/Nd(o),i=xu(1,r.center.lat)*o,a=e.a9.identity([]);return e.a9.rotateY(a,a,Gt(r.center.lng)),e.a9.rotateX(a,a,Gt(r.center.lat)),e.a9.translate(a,a,[0,0,Zc]),e.a9.scale(a,a,[n,n,n*i]),e.a9.translate(a,a,[r.point.x-.5*o,r.point.y-.5*o,0]),e.a9.multiply(a,a,t),e.a9.multiply(a,r.globeMatrix,a)}(t,r);return function(t,r,o){const n=(t,r,o)=>{const n=e.Q.length(t),i=e.Q.length(r),a=Ed(t,r,o);return e.Q.scale(a,a,1/e.Q.length(a)*Go(n,i,o))},i=n([t[0],t[1],t[2]],[r[0],r[1],r[2]],o),a=n([t[4],t[5],t[6]],[r[4],r[5],r[6]],o),s=n([t[8],t[9],t[10]],[r[8],r[9],r[10]],o),l=Ed([t[12],t[13],t[14]],[r[12],r[13],r[14]],o);return[i[0],i[1],i[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(i,o,n)}return i}function j_(e,t,r,o){const n=pd.projectAabbCorners(o,r);let i=Number.MAX_VALUE,a=-1;for(let c=0;c<n.length;++c){const e=n[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<i&&(a=c,i=e[2])}const s=e=>new Ut(n[e][0],n[e][1]);let l;switch(a){case 0:case 6:l=[s(1),s(5),s(4),s(7),s(3),s(2),s(1)];break;case 1:case 7:l=[s(0),s(4),s(5),s(6),s(2),s(3),s(0)];break;case 3:case 5:l=[s(1),s(0),s(4),s(7),s(6),s(2),s(1)];break;default:l=[s(1),s(5),s(6),s(7),s(3),s(0),s(1)]}if(Hu(e,l))return i}const W_=Al([{name:"a_pos_3f",components:3,type:"Float32"}]),K_=Al([{name:"a_color_3f",components:3,type:"Float32"}]),J_=Al([{name:"a_color_4f",components:4,type:"Float32"}]),Z_=Al([{name:"a_uv_2f",components:2,type:"Float32"}]),Y_=Al([{name:"a_normal_3f",components:3,type:"Float32"}]),q_=Al([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),$_=Al([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class X_{constructor(e,t,r,o){this.message=(e?`${e}: `:"")+r,o&&(this.identifier=o),null!=t&&t.__line__&&(this.line=t.__line__)}}function Q_(e,t){const r=-1===e.indexOf("://");try{return new URL(e,r&&t?"http://example.com":void 0),!0}catch(e){return!1}}class ey{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ty{constructor(){this.instancedDataArray=new Xl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ry{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,t,r,o){this.tileToMeter=Pu(r);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:i,id:a,index:s,sourceLayerIndex:l}of e){const e=null!=a?a:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0,c=Fu(i,n);if(!this.layers[0]._featureFilter.filter(new Us(this.zoom),c,r))continue;const u={id:e,sourceLayerIndex:l,index:s,geometry:n?c.geometry:Bu(i,r,o),properties:i.properties,type:i.type,patterns:{}},d=this.addFeature(u,u.geometry,c);d&&t.featureIndex.insert(i,u.geometry,s,l,this.index,this.instancesPerModel[d].instancedDataArray.length,ii/32)}this.lookup=null}update(e,t,r,o){for(const n in this.instancesPerModel){const t=this.instancesPerModel[n];for(const r in e)t.idToFeaturesIndex.hasOwnProperty(r)&&(this.evaluate(t.features[t.idToFeaturesIndex[r]],e[r],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];for(const r of o.features){const n=this.layers[0],i=r.feature,a=this.canonical,s=n.paint.get("model-rotation").evaluate(i,{},a),l=n.paint.get("model-scale").evaluate(i,{},a),c=n.paint.get("model-translation").evaluate(i,{},a);e.Q.exactEquals(r.rotation,s)&&e.Q.exactEquals(r.scale,l)&&e.Q.exactEquals(r.translation,c)||(this.evaluate(r,r.featureStates,o,!0),t=!0)}}return t}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,q_.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const t of this.modelUris)e.removeModel(t,"")}addFeature(e,t,r){const o=this.layers[0],n=o.layout.get("model-id").evaluate(r,{},this.canonical);if(!n)return dr(`modelId is not evaluated for layer ${o.id} and it is not going to get rendered.`),n;Q_(n,!1)&&(this.modelUris.includes(n)||this.modelUris.push(n)),this.instancesPerModel[n]||(this.instancesPerModel[n]=new ty);const i=this.instancesPerModel[n],a=i.instancedDataArray,s=new ey(r,a.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=ii||e.y<0||e.y>=ii)continue;const t=(this.lookupDim-1)/ii,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}this.instanceCount++;const o=a.length;a.resize(o+1),i.instancesEvaluatedElevation.push(0),a.float32[16*o]=e.x,a.float32[16*o+1]=e.y}return s.instancedDataCount=i.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(i.idToFeaturesIndex[e.id]=i.features.length),i.features.push(s),this.evaluate(s,{},i,!1)),n}getModelUris(){return this.modelUris}evaluate(e,t,r,o){const n=this.layers[0],i=e.feature,a=this.canonical,s=e.rotation=n.paint.get("model-rotation").evaluate(i,t,a),l=e.scale=n.paint.get("model-scale").evaluate(i,t,a),c=e.translation=n.paint.get("model-translation").evaluate(i,t,a),u=n.paint.get("model-color").evaluate(i,t,a);u.a=n.paint.get("model-color-mix-intensity").evaluate(i,t,a);const d=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),V_(d,s,l);const h=Math.round(100*u.a)+u.b/1.05;for(let f=0;f<e.instancedDataCount;++f){const t=e.instancedDataOffset+f,n=16*t,i=r.instancedDataArray.float32;let s=0;o&&(s=i[n+6]-r.instancesEvaluatedElevation[t]);const l=0|i[n+1];i[n]=(0|i[n])+u.r/1.05,i[n+1]=l+u.g/1.05,i[n+2]=h,i[n+3]=1/(a.z>10?this.tileToMeter:Pu(a,l)),i[n+4]=c[0],i[n+5]=c[1],i[n+6]=c[2]+s,i[n+7]=d[0],i[n+8]=d[1],i[n+9]=d[2],i[n+10]=d[4],i[n+11]=d[5],i[n+12]=d[6],i[n+13]=d[8],i[n+14]=d[9],i[n+15]=d[10],r.instancesEvaluatedElevation[t]=c[2]}}}ms(ry,"ModelBucket",{omit:["layers"]}),ms(ty,"PerModelAttributes"),ms(ey,"ModelFeature");const oy=new Xs({visibility:new Ys(tl.layout_model.visibility),"model-id":new qs(tl.layout_model["model-id"])});var ny={paint:new Xs({"model-opacity":new Ys(tl.paint_model["model-opacity"]),"model-rotation":new qs(tl.paint_model["model-rotation"]),"model-scale":new qs(tl.paint_model["model-scale"]),"model-translation":new qs(tl.paint_model["model-translation"]),"model-color":new qs(tl.paint_model["model-color"]),"model-color-mix-intensity":new qs(tl.paint_model["model-color-mix-intensity"]),"model-type":new Ys(tl.paint_model["model-type"]),"model-cast-shadows":new Ys(tl.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ys(tl.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ys(tl.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new qs(tl.paint_model["model-emissive-strength"]),"model-roughness":new qs(tl.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new qs(tl.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ys(tl.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ys(tl.paint_model["model-front-cutoff"])}),layout:oy};const iy=64,ay={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function sy(t,r,o,n,i,a,s,l,c){let u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const d=o.zoom,h=o.project(n),f=Eu(n.lat,d),m=1/f;e.a9.identity(t),e.a9.translate(t,t,[h.x+s[0]*m,h.y+s[1]*m,s[2]]);let p=1,g=1;const _=o.worldSize;if(u){if("mercator"===o.projection.name){let t=0;o.elevation&&(t=o.elevation.getAtPointOrZero(new Cu(h.x/_,h.y/_),0));const r=e.aa.transformMat4([],[h.x,h.y,t,1],o.projMatrix)[3]/o.cameraToCenterDistance;p=r,g=r*Eu(o.center.lat,d)}else if("globe"===o.projection.name){const r=G_(t,o),i=e.a9.multiply([],o.projMatrix,r),a=[0,0,0,1];e.aa.transformMat4(a,a,i);const s=a[3]/o.cameraToCenterDistance,l=zd(d),c=o.projection.pixelsPerMeter(n.lat,_)*Eu(n.lat,d),u=o.projection.pixelsPerMeter(o.center.lat,_)*Eu(o.center.lat,d);p=s/Go(c,Su(o.center.lat),l),g=s*f/c,p*=u,g*=u}}else p=m;e.a9.scale(t,t,[p,p,g]);const y=[...t],v=r.orientation,x=[];if(V_(x,[v[0]+i[0],v[1]+i[1],v[2]+i[2]],a),e.a9.multiply(t,y,x),l&&o.elevation){let i=0;const a=[];if(c&&o.elevation){i=function(t,r,o,n,i){const a=r.elevation;if(!a)return 0;const s=pd.projectAabbCorners(o,n),l=xu(1,i.lat)*r.worldSize,c=function(t,r){const o=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of n){const n=t[i.corners[0]],a=t[i.corners[1]],s=t[i.corners[2]],l=[a[0]-n[0],a[1]-n[1],r*(a[2]-n[2])],c=e.Q.cross(l,l,[s[0]-n[0],s[1]-n[1],r*(s[2]-n[2])]);e.Q.normalize(c,c),i.dotProductWithUp=e.Q.dot(c,o)}return n.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),n[0].corners}(s,l),u=s[c[0]],d=s[c[1]],h=s[c[2]],f=s[c[3]],m=a.getAtPointOrZero(new Cu(u[0]/r.worldSize,u[1]/r.worldSize),0),p=a.getAtPointOrZero(new Cu(d[0]/r.worldSize,d[1]/r.worldSize),0),g=a.getAtPointOrZero(new Cu(h[0]/r.worldSize,h[1]/r.worldSize),0),_=a.getAtPointOrZero(new Cu(f[0]/r.worldSize,f[1]/r.worldSize),0),y=(m+_)/2,v=(p+g)/2;return y>v?p<g?H_(t,d,f,u,p,_,m,l):H_(t,h,u,f,g,m,_,l):m<_?H_(t,u,d,h,m,p,g,l):H_(t,f,h,d,_,g,p,l),Math.max(y,v)}(a,o,r.aabb,t,n);const s=e.a9.fromQuat([],a),l=e.a9.multiply([],s,x);e.a9.multiply(t,y,l)}else i=o.elevation.getAtPointOrZero(new Cu(h.x/_,h.y/_),0);0!==i&&(t[14]+=i)}}function ly(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new v_(t,e.image,r?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function cy(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,W_.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Y_.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Z_.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?K_:J_).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,$_.members,!0)),e.segments=pc.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const o=e.material;o.pbrMetallicRoughness.baseColorTexture&&ly(o.pbrMetallicRoughness.baseColorTexture,t),o.pbrMetallicRoughness.metallicRoughnessTexture&&ly(o.pbrMetallicRoughness.metallicRoughnessTexture,t),o.normalTexture&&ly(o.normalTexture,t),o.occlusionTexture&&ly(o.occlusionTexture,t,r),o.emissionTexture&&ly(o.emissionTexture,t)}function uy(e,t,r){if(e.meshes)for(const o of e.meshes)cy(o,t,r);if(e.children)for(const o of e.children)uy(o,t,r)}function dy(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)dy(t)}function hy(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)hy(r)}class fy{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class my{constructor(){this.tasks={},this.taskQueue=[],ir(["process"],this),this.invoker=new fy(this.process),this.nextId=0}add(e,t){const r=this.nextId++,o=function(e){let{type:t,isSymbolTile:r,zoom:o}=e;return o=o||0,"message"===t?0:"maybePrepare"!==t||r?"parseTile"!==t||r?"parseTile"===t&&r?300-o:"maybePrepare"===t&&r?400-o:500:200-o:100-o}(t);if(0===o){pr();try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:t,priority:o,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){pr();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let o=0;o<this.taskQueue.length;o++){const r=this.tasks[this.taskQueue[o]];r.priority<t&&(t=r.priority,e=o)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class py{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ir(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new my}send(e,t,r,o){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=i,this.callbacks[a]=r);const s=new Set;return this.target.postMessage({id:a,type:e,hasCallback:!!r,targetMapId:o,mustQueue:n,sourceMapId:this.mapId,data:_s(t,s)},s),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||pr()){const e=this.callbacks[r],o=this.scheduler.add((()=>this.processTask(r,t)),e&&e.metadata||{type:"message"});o&&(this.cancelCallbacks[r]=o)}else this.processTask(r,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(ys(t.error)):r(null,ys(t.data)))}else{const r=new Set,o=t.hasCallback?(t,o)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?_s(t):null,data:_s(o,r)},r)}:e=>{},n=ys(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,o);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source,n.scope)[e[1]](n,o)}else o(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class gy{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=tr();const r=this.workerPool.acquire(this.id);for(let o=0;o<r.length;o++){const e=new gy.Actor(r[o],t,this.id);e.name=`Worker ${o}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,r){Xt(this.actors,((r,o)=>{r.send(e,t,o)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}gy.Actor=py;var _y={workerUrl:"",workerClass:null,workerParams:void 0};function yy(){return null!=_y.workerClass?new _y.workerClass:new self.Worker(_y.workerUrl,_y.workerParams)}const vy="mapboxgl_preloaded_worker_pool";class xy{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<xy.workerCount;)this.workers.push(new yy);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vy]}numActive(){return Object.keys(this.active).length}}let by;function Ly(){return by||(by=new xy),by}xy.workerCount=2;let Ay,wy,Sy,Ey,Ty,Py=null;function Cy(){return pr()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:wy||o.DRACO_URL}function Ry(){if(pr()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ey)return Ey;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ey=WebAssembly.validate(e)?o.MESHOPT_SIMD_URL:o.MESHOPT_URL,Ey}const My={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Iy={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Oy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Dy(e,t,r){const o=r.json.bufferViews.length,n=r.buffers.length;t.bufferView=o,r.json.bufferViews[o]={buffer:n,byteLength:e.byteLength},r.buffers[n]=e}const ky="KHR_draco_mesh_compression";function Ny(e,t){const r=e.extensions&&e.extensions[ky];if(!r)return;const o=new Sy.Decoder,n=Gy(t,r.bufferView),i=new Sy.Mesh;if(!o.DecodeArrayToMesh(n,n.byteLength,i))throw new Error("Failed to decode Draco mesh");const a=t.json.accessors[e.indices],s=My[a.componentType],l=a.count*s.BYTES_PER_ELEMENT,c=Sy._malloc(l);s===Uint16Array?o.GetTrianglesUInt16Array(i,l,c):o.GetTrianglesUInt32Array(i,l,c),Dy(Sy.memory.buffer.slice(c,c+l),a,t),Sy._free(c);for(const u of Object.keys(r.attributes)){const n=o.GetAttributeByUniqueId(i,r.attributes[u]),a=t.json.accessors[e.attributes[u]],s=Iy[a.componentType],l=a.count*Oy[a.type]*My[a.componentType].BYTES_PER_ELEMENT,c=Sy._malloc(l);o.GetAttributeDataArrayForAllPoints(i,n,Sy[s],l,c),Dy(Sy.memory.buffer.slice(c,c+l),a,t),Sy._free(c)}o.destroy(),i.destroy(),delete e.extensions[ky]}const By="EXT_meshopt_compression";function Fy(e,t){if(!e.extensions||!e.extensions[By])return;const r=e.extensions[By],o=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),n=new Uint8Array(r.count*r.byteStride);Ty.decodeGltfBuffer(n,r.count,r.byteStride,o,r.mode,r.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=n.buffer,delete e.extensions[By]}const zy=1179937895,Uy=new TextDecoder("utf8");function Vy(e,t){return new URL(e,t).href}function Hy(e,t,r,o){return fetch(Vy(e.uri,o)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[r]=e}))}function Gy(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function jy(e,t,r,o){if(e.uri){const n=Vy(e.uri,o);return fetch(n).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[r]=e}))}if(void 0!==e.bufferView){const o=Gy(t,e.bufferView),n=new Blob([o],{type:e.mimeType});return createImageBitmap(n).then((e=>{t.images[r]=e}))}}function Wy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const o={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===zy){const r=new Uint32Array(e,t);let n=2;const i=(r[n++]>>2)-3,a=r[n++]>>2;if(n++,o.json=JSON.parse(Uy.decode(r.subarray(n,n+a))),n+=a,n<i){const i=r[n++];n++;const a=t+(n<<2);o.buffers[0]=e.slice(a,a+i)}}else o.json=JSON.parse(Uy.decode(new Uint8Array(e,t)));const{buffers:n,images:i,meshes:a,extensionsUsed:s,bufferViews:l}=o.json;let c=Promise.resolve();if(n){const e=[];for(let t=0;t<n.length;t++){const i=n[t];i.uri?e.push(Hy(i,o,t,r)):o.buffers[t]||(o.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=s&&s.includes(ky),n=s&&s.includes(By);if(t&&e.push(function(){if(!Sy)return Ay||(Ay=function(e){let t,r=null;function o(){t=new Uint8Array(r.buffer)}function n(){throw new Error("Unexpected Draco error.")}const i={a:{a:n,d:function(e,r,o){return t.copyWithin(e,r,r+o)},c:function(e){const n=t.length,i=Math.max(e>>>0,Math.ceil(1.2*n)),a=Math.ceil((i-n)/65536);try{return r.grow(a),o(),!0}catch(e){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,i):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,i)))).then((e=>{const{Rb:n,Qb:i,P:a,T:s,X:l,Ja:c,La:u,Qa:d,Va:h,Wa:f,eb:m,jb:p,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:L,Gb:A}=e.instance.exports;r=_;const w=(()=>{let e=0,r=0,o=0,a=0;return s=>{o&&(n(a),n(e),r+=o,o=e=0),e||(r+=128,e=i(r));const l=s.length+7&-8;let c=e;l>=r&&(o=l,c=a=i(l));for(let e=0;e<s.length;e++)t[c+e]=s[e];return c}})();return o(),g(),{memory:_,_free:n,_malloc:i,Mesh:class{constructor(){this.ptr=a()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){p(this.ptr)}DecodeArrayToMesh(e,t,r){const o=w(e),n=u(this.ptr,o,t,r.ptr);return!!l(n)}GetAttributeByUniqueId(e,t){return{ptr:d(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,r){h(this.ptr,e.ptr,t,r)}GetTrianglesUInt32Array(e,t,r){f(this.ptr,e.ptr,t,r)}GetAttributeDataArrayForAllPoints(e,t,r,o,n){m(this.ptr,e.ptr,t.ptr,r,o,n)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:L(),DT_FLOAT32:A()}}))}(fetch(Cy())),Ay.then((e=>{Sy=e,Ay=void 0})))}()),n&&e.push(function(){if(Ty)return;const e=function(e){let t;const r=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),o={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(e,r,i,a,s,l){!function(e,t,r,o,n,i,a){const s=e.exports.sbrk,l=o+3&-4,c=s(l*n),u=s(i.length),d=new Uint8Array(e.exports.memory.buffer);d.set(i,u);const h=t(c,o,n,u,i.length);if(0===h&&a&&a(c,l,n),r.set(d.subarray(c,c+o*n)),s(c-s(0)),0!==h)throw new Error(`Malformed buffer data: ${h}`)}(t,t.exports[n[s]],e,r,i,a,t.exports[o[l]])}}}(fetch(Ry()));return e.ready.then((()=>{Ty=e}))}()),i)for(let a=0;a<i.length;a++)e.push(jy(i[a],o,a,r));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&a)for(const{primitives:e}of a)for(const t of e)Ny(t,o);if(n&&a&&l)for(const e of l)Fy(e,o);return o}))}))}class Ky{constructor(e,t,r,o){if(this.triangleCount=t.length/3,this.min=new Ut(0,0),this.max=new Ut(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[n,i]=[e[0].clone(),e[0].clone()];for(let u=1;u<e.length;++u){const t=e[u];n.x=Math.min(n.x,t.x),n.y=Math.min(n.y,t.y),i.x=Math.max(i.x,t.x),i.y=Math.max(i.y,t.y)}if(o){const e=Math.ceil(Math.max(i.x-n.x,i.y-n.y)/o);r=Math.max(r,e)}if(0===r)return;this.min=n,this.max=i;const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const s=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/s)),this.cellsY=Math.max(1,Math.ceil(a.y/s)),this.xScale=1/s,this.yScale=1/s;const l=[];for(let u=0;u<this.triangleCount;u++){const r=e[t[3*u+0]].sub(this.min),o=e[t[3*u+1]].sub(this.min),n=e[t[3*u+2]].sub(this.min),i=Jy(Math.floor(Math.min(r.x,o.x,n.x)),this.xScale,this.cellsX),a=Jy(Math.floor(Math.max(r.x,o.x,n.x)),this.xScale,this.cellsX),c=Jy(Math.floor(Math.min(r.y,o.y,n.y)),this.yScale,this.cellsY),d=Jy(Math.floor(Math.max(r.y,o.y,n.y)),this.yScale,this.cellsY),h=new Ut(0,0),f=new Ut(0,0),m=new Ut(0,0),p=new Ut(0,0);for(let e=c;e<=d;++e){h.y=f.y=e*s,m.y=p.y=(e+1)*s;for(let t=i;t<=a;++t)h.x=m.x=t*s,f.x=p.x=(t+1)*s,(td(r,o,n,h,f,p)||td(r,o,n,h,p,m))&&l.push({cellIdx:e*this.cellsX+t,triIdx:u})}}if(0===l.length)return;l.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}query(e,t,r){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let s=0;s<this.lookup.length;s++)this.lookup[s]=0;const o=Jy(e.x-this.min.x,this.xScale,this.cellsX),n=Jy(t.x-this.min.x,this.xScale,this.cellsX),i=Jy(e.y-this.min.y,this.yScale,this.cellsY),a=Jy(t.y-this.min.y,this.yScale,this.cellsY);for(let s=i;s<=a;s++)for(let e=o;e<=n;e++){const t=this.cells[s*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const o=this.payload[t.start+e],n=Math.floor(o/8),i=1<<o%8;if(!(this.lookup[n]&i)&&(this.lookup[n]|=i,r.push(o),r.length===this.triangleCount))return}}}}function Jy(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}function Zy(e,t){const r=e.json.bufferViews[t.bufferView],o=My[t.componentType];return new o(e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==Oy[t.type]*o.BYTES_PER_ELEMENT?r.byteStride/o.BYTES_PER_ELEMENT:Oy[t.type]))}function Yy(e,t,r,o){const n=My[t.componentType],i=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),a=e.json.bufferViews[t.bufferView],s=a.byteStride?a.byteStride/n.BYTES_PER_ELEMENT:Oy[t.type],l=r.float32,c=l.length/r.capacity;for(let u=0,d=0;u<t.count*s;u+=s,d+=c)for(let e=0;e<c;e++)l[d+e]=o[u+e]*i;r._trim()}function qy(e,t,r){const o=e.indices,n=e.attributes,i={};i.indexArray=new Gl;const a=t.json.accessors[o],s=a.count/3;i.indexArray.reserve(s);const l=Zy(t,a);for(let h=0;h<s;h++)i.indexArray.emplaceBack(l[3*h],l[3*h+1],l[3*h+2]);i.indexArray._trim(),i.vertexArray=new $l;const c=t.json.accessors[n.POSITION];i.vertexArray.reserve(c.count);const u=Zy(t,c);for(let h=0;h<c.count;h++)i.vertexArray.emplaceBack(u[3*h],u[3*h+1],u[3*h+2]);if(i.vertexArray._trim(),i.aabb=new pd(c.min,c.max),i.centroid=function(e,t){const r=[0,0,0],o=e.length;if(o>0){for(let n=0;n<o;n++){const o=3*e[n];r[0]+=t[o],r[1]+=t[o+1],r[2]+=t[o+2]}r[0]/=o,r[1]/=o,r[2]/=o}return r}(l,u),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],r=Oy[e.type],o=Zy(t,e);i.colorArray=3===r?new $l:new Rl,i.colorArray.resize(e.count),Yy(t,e,i.colorArray,o)}if(void 0!==n.NORMAL){i.normalArray=new $l;const e=t.json.accessors[n.NORMAL];i.normalArray.resize(e.count);const r=Zy(t,e);Yy(t,e,i.normalArray,r)}if(void 0!==n.TEXCOORD_0&&r.length>0){i.texcoordArray=new Ml;const e=t.json.accessors[n.TEXCOORD_0];i.texcoordArray.resize(e.count);const r=Zy(t,e);Yy(t,e,i.texcoordArray,r)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(i.featureData=Zy(t,e))}void 0!==n._FEATURE_RGBA4444&&(i.featureData=new Uint32Array(Zy(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer));const d=e.material;return i.material=function(e,t){const{emissiveFactor:r=[0,0,0],alphaMode:o="OPAQUE",alphaCutoff:n=.5,normalTexture:i,occlusionTexture:a,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:d=1,baseColorTexture:h,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{},m=a?t[a.index]:void 0;if(a&&a.extensions&&a.extensions.KHR_texture_transform&&m){const e=a.extensions.KHR_texture_transform;m.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ho(...c),metallicFactor:u,roughnessFactor:d,baseColorTexture:h?t[h.index]:void 0,metallicRoughnessTexture:f?t[f.index]:void 0},doubleSided:l,emissiveFactor:r,alphaMode:o,alphaCutoff:n,normalTexture:i?t[i.index]:void 0,occlusionTexture:m,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==d?t.json.materials[d]:{defined:!1},r),i}function $y(t,r,o){const{matrix:n,rotation:i,translation:a,scale:s,mesh:l,extras:c,children:u}=t,d={};if(d.matrix=n||e.a9.fromRotationTranslationScale([],i||[0,0,0,1],a||[0,0,0],s||[1,1,1]),void 0!==l){d.meshes=o[l];const e=d.anchor=[0,0];for(const t of d.meshes){const{min:r,max:o}=t.aabb;e[0]+=r[0]+o[0],e[1]+=r[1]+o[1]}e[0]=Math.floor(e[0]/d.meshes.length/2),e[1]=Math.floor(e[1]/d.meshes.length/2)}if(c&&(c.id&&(d.id=c.id),c.lights&&(d.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),r=new Uint8Array(t.length);for(let o=0;o<t.length;o++)r[o]=t.codePointAt(o);return r}(e),r=[],o=t.length/24,n=new Uint16Array(t.buffer),i=new Float32Array(t.buffer);for(let a=0;a<o;a++){const e=n[2*a*6]/30,t=n[2*a*6+1]/30,o=n[2*a*6+10]/100,s=i[6*a+1],l=i[6*a+2],c=i[6*a+3],u=i[6*a+4],d=c-s,h=u-l,f=Math.hypot(d,h);r.push({pos:[s+.5*d,l+.5*h,t],normal:[h/f,-d/f,0],width:f,height:e,depth:o,points:[s,l,c,u]})}return r}(c.lights))),u){const e=[];for(const t of u)e.push($y(r.json.nodes[t],r,o));d.children=e}return d}function Xy(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new Ky(e.vertices,e.indices,8,256),[r,o]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:r,max:o}}function Qy(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const o=[];for(const a of r){if(!Array.isArray(a)||2!==a.length)continue;const e=a[0],t=a[1];"number"==typeof e&&"number"==typeof t&&o.push(new Ut(e,t))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let n=0;for(let a=0;a<o.length;a++){const e=o[a],t=o[(a+1)%o.length],r=o[(a+2)%o.length];n+=(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)}n>0&&o.reverse();const i=zh(o.flatMap((e=>[e.x,e.y])),[]);return 0===i.length?null:{vertices:o,indices:i}}function ev(t,r){const o=[],n=[];let i=0;const a=[];for(const s of t){i=o.length;const t=s.vertexArray.float32,l=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)a[0]=t[3*n+0],a[1]=t[3*n+1],a[2]=t[3*n+2],e.Q.transformMat4(a,a,r),o.push(new Ut(a[0],a[1]));for(let e=0;e<3*s.indexArray.length;e++)n.push(l[e]+i)}if(n.length%3!=0)return null;for(let e=0;e<n.length;e+=3){const t=o[n[e+0]],r=o[n[e+1]],i=o[n[e+2]];(t.x-r.x)*(i.y-r.y)-(i.x-r.x)*(t.y-r.y)>0&&([n[e+1],n[e+2]]=[n[e+2],n[e+1]])}return{vertices:o,indices:n}}function tv(e){const t=function(e,t){const r=[],o=WebGL2RenderingContext;if(e.json.textures)for(const n of e.json.textures){const i={magFilter:o.LINEAR,minFilter:o.NEAREST,wrapS:o.REPEAT,wrapT:o.REPEAT};void 0!==n.sampler&&Object.assign(i,e.json.samplers[n.sampler]),r.push({image:t[n.source],sampler:i,uploaded:!1})}return r}(e,e.images),r=function(e,t){const r=[];for(const o of e.json.meshes){const n=[];for(const r of o.primitives)n.push(qy(r,e,t));r.push(n)}return r}(e,t),{scenes:o,scene:n,nodes:i}=e.json,a=o?o[n||0].nodes:i,s=[];for(const l of a)s.push($y(i[l],e,r));return function(e,t,r){const o={},n=new Set;for(let i=0;i<e.length;i++){const e=r[t[i]];if(!e.extras)continue;const a=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(a||s)&&n.add(i),"1.0.0"===a&&s&&(o[s]=i)}for(let i=0;i<e.length;i++){if(n.has(i))continue;const a=e[i],s=r[t[i]];if(!s.extras)continue;let l=null;a.id in o&&(l=ev(e[o[a.id]].meshes,a.matrix)),l||(l=Qy(s)),l&&(a.footprint=Xy(l))}if(n.size>0){const t=Array.from(n.values()).sort(((e,t)=>e-t));for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)}}(s,a,e.json.nodes),s}function rv(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,o=e.aabb.min[1]-1,n=iy/(e.aabb.max[0]-r+2),i=iy/(e.aabb.max[1]-o+2);for(let a=0;a<t.length;a+=3){const s=t[a+2],l=(t[a+0]-r)*n|0,c=(t[a+1]-o)*i|0;s>e.heightmap[c*iy+l]&&(e.heightmap[c*iy+l]=s)}}function ov(t,r){const o={};o.indexArray=new Gl,o.indexArray.reserve(4*t.length),o.vertexArray=new $l,o.vertexArray.reserve(10*t.length),o.colorArray=new Rl,o.vertexArray.reserve(10*t.length);let n=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*r,i=[-s.normal[1],s.normal[0],0],a=Math.min(.29,.1*s.width/s.depth),l=s.width-2*s.depth*r*(a+.01),c=e.Q.scaleAndAdd([],s.pos,i,l/2),u=e.Q.scaleAndAdd([],s.pos,i,-l/2),d=[c[0],c[1],c[2]+s.height],h=[u[0],u[1],u[2]+s.height],f=e.Q.scaleAndAdd([],s.normal,i,a);e.Q.scale(f,f,t);const m=e.Q.scaleAndAdd([],s.normal,i,-a);e.Q.scale(m,m,t),e.Q.add(f,c,f),e.Q.add(m,u,m),c[2]+=.1,u[2]+=.1,o.vertexArray.emplaceBack(f[0],f[1],f[2]),o.vertexArray.emplaceBack(m[0],m[1],m[2]),o.vertexArray.emplaceBack(c[0],c[1],c[2]),o.vertexArray.emplaceBack(u[0],u[1],u[2]),o.vertexArray.emplaceBack(d[0],d[1],d[2]),o.vertexArray.emplaceBack(h[0],h[1],h[2]),o.vertexArray.emplaceBack(c[0],c[1],c[2]),o.vertexArray.emplaceBack(u[0],u[1],u[2]),o.vertexArray.emplaceBack(f[0],f[1],f[2]),o.vertexArray.emplaceBack(m[0],m[1],m[2]);const p=l/t/2;o.colorArray.emplaceBack(-p-a,-1,p,.8),o.colorArray.emplaceBack(p+a,-1,p,.8),o.colorArray.emplaceBack(-p,0,p,1.3),o.colorArray.emplaceBack(p,0,p,1.3),o.colorArray.emplaceBack(p+a,-.8,p,.7),o.colorArray.emplaceBack(p+a,-.8,p,.7),o.colorArray.emplaceBack(0,0,p,1.3),o.colorArray.emplaceBack(0,0,p,1.3),o.colorArray.emplaceBack(p+a,-1.2,p,.8),o.colorArray.emplaceBack(p+a,-1.2,p,.8),o.indexArray.emplaceBack(6+n,4+n,8+n),o.indexArray.emplaceBack(7+n,9+n,5+n),o.indexArray.emplaceBack(0+n,1+n,2+n),o.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const i={defined:!0,emissiveFactor:[0,0,0]},a={};return a.baseColorFactor=Ho.white,i.pbrMetallicRoughness=a,o.material=i,o.aabb=new pd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}ms(Ky,"TriangleGridIndex");class nv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const iv=["tile","layer","source","sourceLayer","state"];class av{constructor(e,t,r,o,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=o,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of iv)void 0!==this[t]&&(e[t]=this[t]);return e}}class sv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new hs(ii,16,0),this.featureIndexArray=new dc,this.promoteId=t,this.is3DTile=!1}insert(e,t,r,o,n){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,o,n,i);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const o=e[t];r[0]=Math.min(r[0],o.x),r[1]=Math.min(r[1],o.y),r[2]=Math.max(r[2],o.x),r[3]=Math.max(r[3],o.y)}0!==a&&(r[0]-=a,r[1]-=a,r[2]+=a,r[3]+=a),r[0]<ii&&r[1]<ii&&r[2]>=0&&r[3]>=0&&l.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hf(new Lp(this.rawTileData)).layers,this.sourceLayerCoder=new nv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,r,o){var n=this;this.loadVTLayers();const i=e.params||{},a=ol(i.filter),s=e.tileResult,l=e.transform,c=s.bufferedTilespaceBounds,u=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,((e,t,r,o)=>Xu(s.bufferedTilespaceGeometry,e,t,r,o)));u.sort(cv);let d=null;l.elevation&&u.length>0&&(d=Df.create(l.elevation,this.tileID));const h={};let f;for(let m=0;m<u.length;m++){const c=u[m];if(c===f)continue;f=c;const p=this.featureIndexArray.get(c);let g=null;if(this.is3DTile){const e=this.bucketLayerIDs[0][0],r=t[e];if("model"!==r.type)continue;const{queryFeature:o,intersectionZ:n}=r.queryIntersectsMatchingFeature(s,p.featureIndex,a,l);o&&this.appendToResult(h,e,p.featureIndex,o,n)}else this.loadMatchingFeature(h,p,a,i.layers,i.availableImages,t,r,o,(function(t,r,o){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return g||(g=Bu(t,n.tileID.canonical,e.tileTransform)),r.queryIntersectsFeature(s,t,o,g,n.z,e.transform,e.pixelPosMatrix,d,i)}))}return h}loadMatchingFeature(e,t,r,o,n,i,a,s,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:d,layoutVertexArrayOffset:h}=t,f=this.bucketLayerIDs[u];if(o&&!function(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(o,f))return;const m=this.sourceLayerCoder.decode(d),p=this.vtLayers[m].feature(c);if(r.needGeometry){const e=Fu(p,!0);if(!r.filter(new Us(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Us(this.tileID.overscaledZ),p))return;const g=this.getId(p,m);for(let _=0;_<f.length;_++){const t=f[_];if(o&&o.indexOf(t)<0)continue;const r=i[t];if(!r)continue;let u={};void 0!==g&&s&&(u=s.getState(r.sourceLayer||"_geojsonTileLayer",g));const d=!l||l(p,r,u,h);if(!d)continue;const m=new av(p,this.z,this.x,this.y,g),y=Qt({},a[t]);y.paint=lv(y.paint,r.paint,p,u,n),y.layout=lv(y.layout,r.layout,p,u,n),m.layer=y,this.appendToResult(e,t,c,m,d)}}appendToResult(e,t,r,o,n){let i=e[t];void 0===i&&(i=e[t]=[]),i.push({featureIndex:r,feature:o,intersectionZ:n})}lookupSymbolFeatures(e,t,r,o,n,i,a,s){const l={};this.loadVTLayers();const c=ol(n);for(const u of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:o,featureIndex:u,layoutVertexArrayOffset:0},c,i,a,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const o=this.sourceLayerCoder.decode(r),n=this.vtFeatures[o];if(n[t])return n[t];const i=this.vtLayers[o].feature(t);return n[t]=i,i}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const o="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=o&&(r=e.properties[o]),"boolean"==typeof r&&(r=Number(r))}return r}}function lv(e,t,r,o,n){return sr(e,((e,i)=>{const a=t instanceof Zs?t.get(i):null;return a&&a.evaluate?a.evaluate(r,o,n):a}))}function cv(e,t){return t-e}ms(sv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const uv=new Float32Array(262144),dv=new Uint8Array(262144);function hv(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,hv(r));return t}function fv(e,t,r){if(e.meshes)for(const o of e.meshes)o.aabb.min[0]!==1/0&&r.insert(t,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(e.children)for(const o of e.children)fv(o,t,r)}const mv=["","wall","door","roof","window","lamp","logo"];class pv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:hv(e)}}}getLocalBounds(){if(!this.node.meshes)return new pd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new pd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&t.encapsulate(r.aabb),e++;this.aabb=pd.applyTransform(t,this.node.matrix)}return this.aabb}}class gv{constructor(e,t,r,o,n,i){this.id=t,this.modelTraits|=ay.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=ay.HasMapboxMeshFeatures),o&&(this.modelTraits|=ay.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const a of e)this.nodesInfo.push(new pv(a)),fv(a,i.featureIndexArray.length,i.grid),i.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,i.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const r of t){const t=r.node;this.uploaded?this.updatePbrBuffer(t):uy(t,e,!0)}for(const r of t)dy(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),t=!0);return t}needsReEvaluation(e,t,r){const o=e.transform.projectionOptions,n=e.style.getBrightness(),i=this.brightness!==n;return!!(!this.uploaded||this.dirty||o.name!==this.projection.name||_v(r.paint.get("model-color").value,i)||_v(r.paint.get("model-color-mix-intensity").value,i)||_v(r.paint.get("model-roughness").value,i)||_v(r.paint.get("model-emissive-strength").value,i)||_v(r.paint.get("model-height-based-emissive-strength-multiplier").value,i))&&(this.projection=o,this.brightness=n,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),o=this.id.canonical;for(const n of r){const e=n.feature;n.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},o)}}evaluate(e){const t=this.getNodesInfo();for(const r of t){if(!r.node.meshes)continue;const t=r.feature,o=r.node.meshes&&r.node.meshes[0].featureData,n=r.evaluatedColor[2],i=r.evaluatedRMEA[2],a=this.id.canonical;if(r.hasTranslucentParts=!1,o){for(let o=0;o<mv.length;o++){const n=mv[o];n.length&&(t.properties.part=n);const i=e.paint.get("model-color").evaluate(t,{},a),s=e.paint.get("model-color-mix-intensity").evaluate(t,{},a);r.evaluatedColor[o]=[i.r,i.g,i.b,s],r.evaluatedRMEA[o][0]=e.paint.get("model-roughness").evaluate(t,{},a),r.evaluatedRMEA[o][2]=e.paint.get("model-emissive-strength").evaluate(t,{},a),r.evaluatedRMEA[o][3]=i.a,r.emissionHeightBasedParams[o]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},a),!r.hasTranslucentParts&&i.a<1&&(r.hasTranslucentParts=!0)}delete t.properties.part,vv(r,n!==r.evaluatedColor[2]||i!==r.evaluatedRMEA[2],this.modelTraits)}else r.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},a);r.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},a),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,r,o){const n=e.findDEMTileFor(r);if(n&&(n.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const t=Df.create(e,r,n);if(!t)return;this.modelTraits&ay.HasMapboxMeshFeatures&&this.updateDEM(e,t,r,o);for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const o=r.footprint.vertices;let n=t.getElevationAt(o[0].x,o[0].y,!0,!0);for(let e=1;e<o.length;e++)n=Math.min(n,t.getElevationAt(o[e].x,o[e].y,!0,!0));r.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,r,o){let n=t._dem._modifiedForSources[o];if(void 0===n&&(t._dem._modifiedForSources[o]=[],n=t._dem._modifiedForSources[o]),n.includes(r.canonical))return;const i=t._dem.dim;n.push(r.canonical);let a=!1;for(const s of this.getNodesInfo()){const e=s.node;if(!e.footprint||!e.footprint.grid)continue;const r=e.footprint.grid,o=t.tileCoordToPixel(r.min.x,r.min.y),n=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(i-n.y,o.x),Math.min(o.y,i-n.x));if(l<0)continue;const c=Yt(l,2,5);let u=Math.max(0,o.x-c),d=Math.max(0,o.y-c),h=Math.min(n.x+c,i-1),f=Math.min(n.y+c,i-1);for(let t=d;t<=f;++t)for(let e=u;e<=h;++e)dv[t*i+e]=255;let m=0,p=0;for(let a=0;a<r.cellsY;++a)for(let e=0;e<r.cellsX;++e){if(!r.cells[a*r.cellsX+e])continue;const o=t.tileCoordToPixel(r.min.x+e/r.xScale,r.min.y+a/r.yScale),n=t.tileCoordToPixel(r.min.x+(e+1)/r.xScale,r.min.y+(a+1)/r.yScale);for(let e=o.y;e<=Math.min(n.y+1,i-1);++e)for(let r=o.x;r<=Math.min(n.x+1,i-1);++r)255===dv[e*i+r]&&(dv[e*i+r]=0,m+=t.getElevationAtPixel(r,e),p++)}const g=m/p;u=Math.max(1,o.x-c),d=Math.max(1,o.y-c),h=Math.min(n.x+c,i-2),f=Math.min(n.y+c,i-2),a=!0;for(let a=d;a<=f;++a)for(let e=u;e<=h;++e)0===dv[a*i+e]&&(uv[a*i+e]=t._dem.set(e,a,g));for(let a=1;a<c;++a){u=Math.max(1,o.x-a),d=Math.max(1,o.y-a),h=Math.min(n.x+a,i-2),f=Math.min(n.y+a,i-2);for(let e=d;e<=f;++e)for(let r=u;r<=h;++r){const o=e*i+r;if(255===dv[o]){let n=0,s=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let o=-1;o<=1;++o){const c=(e+t)*i+r+o;if(dv[c]>=a)continue;const d=uv[c],h=Math.abs(d);h>s&&(n=d,s=h,l=o,u=t)}if(s>.1){const i=1-(a+.5*Math.abs(l*u))/c;let s=t._dem.get(r,e)+n*i;const d=t._dem.get(r+l,e+u),h=t._dem.get(r-l,e-u,!0);(s-d)*(s-h)>0&&(s=(d+h)/2),uv[o]=t._dem.set(r,e,s),dv[o]=a}}}}}a&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=Mr.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)dy(t.node),hy(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped()),o=this.getNodesInfo();for(let n=0;n<this.nodesInfo.length;n++){const e=o[n].node;o[n].hiddenByReplacement=!!e.footprint&&!r.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(t,r){const o=this.getNodesInfo(),n=[],i=[0,0,0];for(let a=0;a<this.nodesInfo.length;a++){const s=o[a],l=s.node.meshes[0],c=pd.applyTransform(l.aabb,s.node.matrix);if(t<c.min[0]||r<c.min[1]||t>c.max[0]||r>c.max[1])continue;const u=(t-l.aabb.min[0])/(l.aabb.max[0]-l.aabb.min[0])*iy|0,d=Math.min(63,(r-l.aabb.min[1])/(l.aabb.max[1]-l.aabb.min[1])*iy|0)*iy+Math.min(63,u);if(i[2]=l.heightmap[d],e.Q.transformMat4(i,i,s.node.matrix),!(l.heightmap[d]<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return{height:i[2],maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new Ut(t,r),new Ut(t,r),n),n.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function _v(e,t){return!e.isLightConstant&&t}function yv(e,t,r,o,n,i,a,s){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;r[3]>0&&(l=Go(l,255*r[0],r[3]),c=Go(c,255*r[1],r[3]),u=Go(u,255*r[2],r[3]));const d=l<<8|c,h=u<<8|Math.floor(255*o[3]),f=function(e){const t=Yt(e,0,2);return Math.min(Math.round(.5*t*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],m=Yt(n[0],0,1),p=Yt(n[1],0,1),g=Yt(n[2],0,1),_=Yt(n[3],0,1);let y,v,x,b;if(m!==p&&a!==i&&p!==m){const e=a-i;v=1/(e*(p-m)),x=-(i+e*m)/(e*(p-m));const t=Yt(n[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(d,h,f,y,v,x,b),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(d,h,f,y,v,x,b)}}function vv(e,t,r){const o=e.node;let n=0;const i=r&ay.HasMeshoptCompression;for(const a of o.meshes){if(o.lights&&o.lightMeshIndex===n)continue;if(!a.featureData)continue;a.featureArray=new Ql,a.featureArray.reserve(a.featureData.length);let r=t;for(const t of a.featureData){const n=i?65535&t:t>>16&65535,s=i?t>>16&65535:65535&t,l=(15&s)<8?15&s:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],d=e.emissionHeightBasedParams[l];let h;if(r&&2===l&&o.lights&&(h=new Ql,h.resize(10*o.lights.length)),yv(a.featureArray,n,u,c,d,a.aabb.min[2],a.aabb.max[2],h),h&&r){r=!1;const e=o.meshes[o.lightMeshIndex];e.featureArray=h,e.featureArray._trim()}}a.featureArray._trim(),n++}}function xv(e,t,r,o){const n=1<<e.z;t.lat=Lu((o/ii+e.y)/n),t.lng=bu((r/ii+e.x)/n)}ms(gv,"Tiled3dModelBucket",{omit:["layers"]}),ms(pv,"Tiled3dModelFeature");const bv={circle:class extends vl{constructor(e,t,r){super(e,sd,t,r)}createBucket(e){return new Vu(e)}queryRadius(e){const t=e;return rd("circle-radius",this,t)+rd("circle-stroke-width",this,t)+od(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,o,n,i,a,s){const l=id(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),i.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Jd(e,o,i,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const r=Kd(this);return{config:new Vc(this,t),defines:r,overrideFog:!1}}},heatmap:class extends vl{createBucket(e){return new Xd(e)}constructor(e,t,r){super(e,ah,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return rd("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,o,n,i,a,s){const l=this.paint.get("heatmap-radius").evaluate(t,r);return Jd(e,o,i,a,s,!0,!0,new Ut(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new Vc(this,t),overrideFog:!1}:{}}},hillshade:class extends vl{constructor(e,t,r){super(e,ch,t,r)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends vl{constructor(e,t,r){super(e,Kh,t,r)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t){return{config:new Vc(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new jh(e)}queryRadius(){return od(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,o,n,i){return!e.queryGeometry.isAboveHorizon&&ju(nd(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),i.angle,e.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends vl{constructor(e,t,r){super(e,um,t,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Xf(e)}queryRadius(){return od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,r,o,n,i,a,s,l,c){const u=id(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,t.pixelToTileUnitsFactor),d=this.paint.get("fill-extrusion-height").evaluate(r,o),h=this.paint.get("fill-extrusion-base").evaluate(r,o),f=[0,0],m=l&&a.elevation,p=a.elevation?a.elevation.exaggeration():1,g=t.tile.getBucket(this);if(m&&g instanceof Xf){const e=g.centroidVertexArray,t=c+1;t<e.length&&(f[0]=e.geta_centroid_pos0(t),f[1]=e.geta_centroid_pos1(t))}if(0===f[0]&&1===f[1])return!1;"globe"===a.projection.name&&(n=sm([n],[new Ut(0,0),new Ut(ii,ii)],t.tileID.canonical).map((e=>e.polygon)).flat());const _=m?l:null,[y,v]=function(t,r,o,n,i,a,s,l,c,u,d){return"globe"===t.projection.name?function(t,r,o,n,i,a,s,l,c,u,d){const h=[],f=[],m=t.projection.upVectorScale(d,t.center.lat,t.worldSize).metersToTile,p=[0,0,0,1],g=[0,0,0,1],_=(e,t,r,o)=>{e[0]=t,e[1]=r,e[2]=o,e[3]=1},y=am();o>0&&(o+=y),n+=y;for(const v of r){const r=[],y=[];for(const h of v){const f=h.x+i.x,v=h.y+i.y,x=t.projection.projectTilePoint(f,v,d),b=t.projection.upVector(d,h.x,h.y);let L=o,A=n;if(s){const e=mm(f,v,o,n,s,l,c,u);L+=e.base,A+=e.top}0!==o?_(p,x.x+b[0]*m*L,x.y+b[1]*m*L,x.z+b[2]*m*L):_(p,x.x,x.y,x.z),_(g,x.x+b[0]*m*A,x.y+b[1]*m*A,x.z+b[2]*m*A),e.Q.transformMat4(p,p,a),e.Q.transformMat4(g,g,a),r.push(new dm(p[0],p[1],p[2])),y.push(new dm(g[0],g[1],g[2]))}h.push(r),f.push(y)}return[h,f]}(t,r,o,n,i,a,s,l,c,u,d):s?function(t,r,o,n,i,a,s,l,c){const u=[],d=[],h=[0,0,0,1];for(const f of t){const t=[],m=[];for(const u of f){const d=u.x+n.x,f=u.y+n.y,p=mm(d,f,r,o,a,s,l,c);h[0]=d,h[1]=f,h[2]=p.base,h[3]=1,e.aa.transformMat4(h,h,i),h[3]=Math.max(h[3],1e-5);const g=new dm(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=d,h[1]=f,h[2]=p.top,h[3]=1,e.aa.transformMat4(h,h,i),h[3]=Math.max(h[3],1e-5);const _=new dm(h[0]/h[3],h[1]/h[3],h[2]/h[3]);t.push(g),m.push(_)}u.push(t),d.push(m)}return[u,d]}(r,o,n,i,a,s,l,c,u):function(e,t,r,o,n){const i=[],a=[],s=n[8]*t,l=n[9]*t,c=n[10]*t,u=n[11]*t,d=n[8]*r,h=n[9]*r,f=n[10]*r,m=n[11]*r;for(const p of e){const e=[],t=[];for(const r of p){const i=r.x+o.x,a=r.y+o.y,p=n[0]*i+n[4]*a+n[12],g=n[1]*i+n[5]*a+n[13],_=n[2]*i+n[6]*a+n[14],y=n[3]*i+n[7]*a+n[15],v=p+s,x=g+l,b=_+c,L=Math.max(y+u,1e-5),A=p+d,w=g+h,S=_+f,E=Math.max(y+m,1e-5);e.push(new dm(v/L,x/L,b/L)),t.push(new dm(A/E,w/E,S/E))}i.push(e),a.push(t)}return[i,a]}(r,o,n,i,a)}(a,n,h,d,u,s,_,f,p,a.center.lat,t.tileID.canonical),x=t.queryGeometry;return function(e,t,r){let o=1/0;ju(r,t)&&(o=fm(r,t[0]));for(let n=0;n<t.length;n++){const i=t[n],a=e[n];for(let e=0;e<i.length-1;e++){const t=i[e],n=[t,i[e+1],a[e+1],a[e],t];Hu(r,n)&&(o=Math.min(o,fm(r,n)))}}return o!==1/0&&o}(y,v,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends vl{constructor(e,t,r){super(e,Tm,t,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ji,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Om.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Sm(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const r=Mm(this);return{config:new Vc(this,t),defines:r,overrideFog:!1}}queryRadius(e){const t=e,r=Dm(rd("line-width",this,t),rd("line-gap-width",this,t)),o=rd("line-offset",this,t);return r/2+Math.abs(o)+od(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,o,n,i){if(e.queryGeometry.isAboveHorizon)return!1;const a=nd(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),i.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*Dm(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),l=this.paint.get("line-offset").evaluate(t,r);return l&&(o=function(e,t){const r=[],o=new Ut(0,0);for(let n=0;n<e.length;n++){const i=e[n],a=[];for(let e=0;e<i.length;e++){const r=i[e],n=i[e+1],s=0===e?o:r.sub(i[e-1])._unit()._perp(),l=e===i.length-1?o:n.sub(r)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(r))}r.push(a)}return r}(o,l*e.pixelToTileUnitsFactor)),function(e,t,r){for(let o=0;o<t.length;o++){const n=t[o];if(e.length>=3)for(let t=0;t<n.length;t++)if($u(e,n[t]))return!0;if(Wu(e,n,r))return!0}return!1}(a,o,s)}isTileClipped(){return!0}},symbol:f_,background:class extends vl{constructor(e,t,r){super(e,p_,t,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:E_,"raster-particle":C_,sky:class extends vl{constructor(e,t,r){super(e,I_,t,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),o=!r,n=e.style.light,i=n.properties.get("position");return o&&"viewport"===n.properties.get("anchor")&&dr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?O_(i.azimuthal,90-i.polar,t):O_(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return O_(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends vl{constructor(e,t,r){super(e,D_,t)}},model:class extends vl{constructor(e,t,r){super(e,ny,t,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new ry(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof gv?ii-1:0}queryIntersectsFeature(t,r,o,n,i,a){if(!this.modelManager)return!1;const s=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof ry))return!1;const c=l;for(const u in c.instancesPerModel){const o=c.instancesPerModel[u],n=void 0!==r.id?r.id:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0;if(o.idToFeaturesIndex.hasOwnProperty(n)){const r=o.features[o.idToFeaturesIndex[n]],i=s.getModel(u,this.scope);if(!i)return!1;let l=e.a9.create();const d=new au(0,0),h=c.canonical;let f=Number.MAX_VALUE;for(let n=0;n<r.instancedDataCount;++n){const s=16*(r.instancedDataOffset+n),c=o.instancedDataArray.float32,u=[c[s+4],c[s+5],c[s+6]];xv(h,d,c[s],0|c[s+1]),sy(l,i,a,d,r.rotation,r.scale,u,!1,!1,!1),"globe"===a.projection.name&&(l=G_(l,a));const m=e.a9.multiply([],a.projMatrix,l),p=t.queryGeometry,g=j_(p.isPointQuery()?p.screenBounds:p.screenGeometry,a,m,i.aabb);null!=g&&(f=Math.min(g,f))}return f!==Number.MAX_VALUE&&f}}return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof is}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,r,o,n){const i=t.tile,a=i.getBucket(this);let s=null,l=Number.MAX_VALUE;if(!(a&&a instanceof gv))return{queryFeature:s,intersectionZ:l};const c=a.getNodesInfo()[r];if(c.hiddenByReplacement||!c.node.meshes||!o.filter(new Us(i.tileID.overscaledZ),c.feature,i.tileID.canonical))return{queryFeature:s,intersectionZ:l};const u=c.node,d=n.calculatePosMatrix(i.tileID.toUnwrapped(),n.worldSize),h=c.evaluatedScale;let f=0;n.elevation&&u.elevation&&(f=u.elevation*n.elevation.exaggeration()),e.a9.translate(d,d,[(u.anchor?u.anchor[0]:0)*(h[0]-1),(u.anchor?u.anchor[1]:0)*(h[1]-1),f]),e.a9.scale(d,d,h),e.a9.multiply(d,d,u.matrix);const m=t.queryGeometry,p=m.isPointQuery()?m.screenBounds:m.screenGeometry,g=function(t){const r=e.a9.multiply([],d,t.matrix),o=e.a9.multiply(r,n.expandedFarZProjMatrix,r);for(let e=0;e<t.meshes.length;++e){const r=t.meshes[e];if(e===t.lightMeshIndex)continue;const i=j_(p,n,o,r.aabb);null!=i&&(l=Math.min(i,l))}if(t.children)for(const e of t.children)g(e)};if(g(u),l===Number.MAX_VALUE)return{queryFeature:s,intersectionZ:l};const _=new au(0,0);return xv(i.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),s={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:s,intersectionZ:l}}}},Lv={read:function(e,t){return e.readFields(Lv._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,r){1===e?t.header_length=r.readFixed32():2===e?t.x=r.readVarint():3===e?t.y=r.readVarint():4===e?t.z=r.readVarint():5===e&&t.layers.push(Lv.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Lv.Filter.read=function(e,t){return e.readFields(Lv.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},Lv.Filter._readField=function(e,t,r){1===e?(t.delta_filter=Lv.Filter.Delta.read(r,r.readVarint()+r.pos),t.filter="delta_filter"):2===e?(t.zigzag_filter=Lv.Filter.Zigzag.read(r,r.readVarint()+r.pos),t.filter="zigzag_filter"):3===e?(t.bitshuffle_filter=Lv.Filter.BitShuffle.read(r,r.readVarint()+r.pos),t.filter="bitshuffle_filter"):4===e&&(t.byteshuffle_filter=Lv.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),t.filter="byteshuffle_filter")},Lv.Filter.Delta={},Lv.Filter.Delta.read=function(e,t){return e.readFields(Lv.Filter.Delta._readField,{block_size:0},t)},Lv.Filter.Delta._readField=function(e,t,r){1===e&&(t.block_size=r.readVarint())},Lv.Filter.Zigzag={},Lv.Filter.Zigzag.read=function(e,t){return e.readFields(Lv.Filter.Zigzag._readField,{},t)},Lv.Filter.Zigzag._readField=function(e,t,r){},Lv.Filter.BitShuffle={},Lv.Filter.BitShuffle.read=function(e,t){return e.readFields(Lv.Filter.BitShuffle._readField,{},t)},Lv.Filter.BitShuffle._readField=function(e,t,r){},Lv.Filter.ByteShuffle={},Lv.Filter.ByteShuffle.read=function(e,t){return e.readFields(Lv.Filter.ByteShuffle._readField,{},t)},Lv.Filter.ByteShuffle._readField=function(e,t,r){},Lv.Codec={},Lv.Codec.read=function(e,t){return e.readFields(Lv.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},Lv.Codec._readField=function(e,t,r){1===e?(t.gzip_data=Lv.Codec.GzipData.read(r,r.readVarint()+r.pos),t.codec="gzip_data"):2===e?(t.jpeg_image=Lv.Codec.JpegImage.read(r,r.readVarint()+r.pos),t.codec="jpeg_image"):3===e?(t.webp_image=Lv.Codec.WebpImage.read(r,r.readVarint()+r.pos),t.codec="webp_image"):4===e&&(t.png_image=Lv.Codec.PngImage.read(r,r.readVarint()+r.pos),t.codec="png_image")},Lv.Codec.GzipData={},Lv.Codec.GzipData.read=function(e,t){return e.readFields(Lv.Codec.GzipData._readField,{},t)},Lv.Codec.GzipData._readField=function(e,t,r){},Lv.Codec.JpegImage={},Lv.Codec.JpegImage.read=function(e,t){return e.readFields(Lv.Codec.JpegImage._readField,{},t)},Lv.Codec.JpegImage._readField=function(e,t,r){},Lv.Codec.WebpImage={},Lv.Codec.WebpImage.read=function(e,t){return e.readFields(Lv.Codec.WebpImage._readField,{},t)},Lv.Codec.WebpImage._readField=function(e,t,r){},Lv.Codec.PngImage={},Lv.Codec.PngImage.read=function(e,t){return e.readFields(Lv.Codec.PngImage._readField,{},t)},Lv.Codec.PngImage._readField=function(e,t,r){},Lv.DataIndexEntry={},Lv.DataIndexEntry.read=function(e,t){return e.readFields(Lv.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},Lv.DataIndexEntry._readField=function(e,t,r){1===e?t.first_byte=r.readFixed64():2===e?t.last_byte=r.readFixed64():3===e?t.filters.push(Lv.Filter.read(r,r.readVarint()+r.pos)):4===e?t.codec=Lv.Codec.read(r,r.readVarint()+r.pos):5===e?t.offset=r.readFloat():6===e?t.scale=r.readFloat():7===e&&t.bands.push(r.readString())},Lv.Layer={},Lv.Layer.read=function(e,t){return e.readFields(Lv.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},Lv.Layer._readField=function(e,t,r){1===e?t.version=r.readVarint():2===e?t.name=r.readString():3===e?t.units=r.readString():4===e?t.tilesize=r.readVarint():5===e?t.buffer=r.readVarint():6===e?t.pixel_format=r.readVarint():7===e&&t.data_index.push(Lv.DataIndexEntry.read(r,r.readVarint()+r.pos))};const Av={read:function(e,t){return e.readFields(Av._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,r){2===e?(t.uint32_values=Av.Uint32Values.read(r,r.readVarint()+r.pos),t.values="uint32_values"):3===e&&(t.fixed32_values=Av.Fixed32Values.read(r,r.readVarint()+r.pos),t.values="fixed32_values")},Uint32Values:{}};Av.Uint32Values.read=function(e,t){return e.readFields(Av.Uint32Values._readField,{values:[]},t)},Av.Uint32Values._readField=function(e,t,r){1===e&&(t.readValuesInto=function(e){if(2!==e.type)throw new Error(`Unsupported pbf type "${e.type}"`);const t=function(e){return 2===e.type?e.readVarint()+e.pos:e.pos+1}(e),r=e.pos;return e.pos=t,function(o){e.pos=r;let n=0;for(;e.pos<t;){const t=e.readVarint();o[n++]=t}return o}}(r))},Av.Fixed32Values={},Av.Fixed32Values.read=function(e,t){return e.readFields(Av.Fixed32Values._readField,{values:[]},t)},Av.Fixed32Values._readField=function(e,t,r){throw new Error("Not implemented")};class wv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=r,this.size=0,this.ttl=t}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const t=this.items[e];delete this.items[e],this.size--,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t&&(this.last=t.prev)}return this}entries(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.keys()).map((e=>[e,this.get(e)]))}evict(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.size>0){const e=this.first;delete this.items[e.key],0==--this.size?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(e){let t;return this.has(e)&&(t=this.items[e].expiry),t}get(e){let t;if(this.has(e)){const r=this.items[e];this.ttl>0&&r.expiry<=Date.now()?this.delete(e):(t=r.value,this.set(e,t,!0))}return t}has(e){return e in this.items}keys(){const e=[];let t=this.first;for(;null!==t;)e.push(t.key),t=t.next;return e}set(e,t){let r,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.resetTtl;if(o||this.has(e)){if(r=this.items[e],r.value=t,!1===o&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==r){const e=this.last,t=r.next,o=r.prev;this.first===r&&(this.first=r.next),r.next=null,r.prev=this.last,e.next=r,null!==o&&(o.next=t),null!==t&&(t.prev=o)}}else this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},1==++this.size?this.first=r:this.last.next=r;return this.last=r,this}values(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.keys()).map((e=>this.get(e)))}}function Sv(e,t){if(4!==t.length)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let r=t[3];for(let o=2;o>=1;o--){const n=1===o?1:0,i=2===o?1:0;for(let o=0;o<t[0];o++){const a=t[1]*o;for(let o=n;o<t[1];o++){const n=t[2]*(o+a);for(let o=i;o<t[2];o++){const i=t[3]*(o+n);for(let o=0;o<t[3];o++){const t=i+o;e[t]+=e[t-r]}}}}r*=t[o]}return e}function Ev(e){for(let t=0,r=e.length;t<r;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Tv(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const r=e[t],o=e[t+1];e[t]=(240&r)>>4|(61440&r)>>8|(240&o)<<4|61440&o,e[t+1]=15&r|(3840&r)>>4|(15&o)<<8|(3840&o)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const r=e[t],o=e[t+1],n=e[t+2],i=e[t+3];e[t+0]=(192&r)>>6|(192&o)>>4|(192&n)>>2|192&i,e[t+1]=(48&r)>>4|(48&o)>>2|48&n|(48&i)<<2,e[t+2]=(12&r)>>2|12&o|(12&n)<<2|(12&i)<<4,e[t+3]=3&r|(3&o)<<2|(3&n)<<4|(3&i)<<6}return e;default:throw new Error(`Invalid pixel format, "${t}"`)}}class Pv extends Error{constructor(e){super(e),this.name="MRTError"}}var Cv=Uint8Array,Rv=Uint16Array,Mv=Int32Array,Iv=new Cv([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ov=new Cv([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Dv=new Cv([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kv=function(e,t){for(var r=new Rv(31),o=0;o<31;++o)r[o]=t+=1<<e[o-1];var n=new Mv(r[30]);for(o=1;o<30;++o)for(var i=r[o];i<r[o+1];++i)n[i]=i-r[o]<<5|o;return{b:r,r:n}},Nv=kv(Iv,2),Bv=Nv.b,Fv=Nv.r;Bv[28]=258,Fv[258]=28;for(var zv=kv(Ov,0).b,Uv=new Rv(32768),Vv=0;Vv<32768;++Vv){var Hv=(43690&Vv)>>1|(21845&Vv)<<1;Uv[Vv]=((65280&(Hv=(61680&(Hv=(52428&Hv)>>2|(13107&Hv)<<2))>>4|(3855&Hv)<<4))>>8|(255&Hv)<<8)>>1}var Gv=function(e,t,r){for(var o=e.length,n=0,i=new Rv(t);n<o;++n)e[n]&&++i[e[n]-1];var a,s=new Rv(t);for(n=1;n<t;++n)s[n]=s[n-1]+i[n-1]<<1;if(r){a=new Rv(1<<t);var l=15-t;for(n=0;n<o;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],d=s[e[n]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[Uv[d]>>l]=c}else for(a=new Rv(o),n=0;n<o;++n)e[n]&&(a[n]=Uv[s[e[n]-1]++]>>15-e[n]);return a},jv=new Cv(288);for(Vv=0;Vv<144;++Vv)jv[Vv]=8;for(Vv=144;Vv<256;++Vv)jv[Vv]=9;for(Vv=256;Vv<280;++Vv)jv[Vv]=7;for(Vv=280;Vv<288;++Vv)jv[Vv]=8;var Wv=new Cv(32);for(Vv=0;Vv<32;++Vv)Wv[Vv]=5;var Kv=Gv(jv,9,1),Jv=Gv(Wv,5,1),Zv=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Yv=function(e,t,r){var o=t/8|0;return(e[o]|e[o+1]<<8)>>(7&t)&r},qv=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},$v=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Xv=function(e,t,r){var o=new Error(t||$v[e]);if(o.code=e,Error.captureStackTrace&&Error.captureStackTrace(o,Xv),!r)throw o;return o},Qv=new Cv(0),ex="undefined"!=typeof TextDecoder&&new TextDecoder;try{ex.decode(Qv,{stream:!0})}catch(e){}const tx={gzip_data:"gzip"},rx={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ox={uint32:1,uint16:2,uint8:4},nx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class ix{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const t=new Uint8Array(e),r=new DataView(e);if(13!==t[0])throw new Pv("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),r=this.getHeaderLength(e);if(t.length<r)throw new Pv(`Expected header with length >= ${r} but got buffer of length ${t.length}`);const o=new Lp(t.subarray(0,r)),n=Lv.read(o);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new Pv(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const i of n.layers)this.layers[i.name]=new ax(i,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],r=this.getLayer(e.layerName);for(let o=0;o<r.dataIndex.length;o++){const n=r.dataIndex[o],i=n.first_byte-e.firstByte,a=n.last_byte+1-e.firstByte;if(o<e.firstBlock||o>e.lastBlock)continue;if(r._blocksInProgress.has(o))continue;const s={layerName:r.name,firstByte:i,lastByte:a,pixelFormat:r.pixelFormat,blockIndex:o,blockShape:[n.bands.length].concat(r.bandShape),buffer:r.buffer,codec:n.codec.codec,filters:n.filters.map((e=>e.filter))};r._blocksInProgress.add(o),t.push(s)}return new sx(t,(()=>{t.forEach((e=>r._blocksInProgress.delete(e.blockIndex)))}),((e,o)=>{if(t.forEach((e=>r._blocksInProgress.delete(e.blockIndex))),e)throw e;o.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class ax{constructor(e,t){let{version:r,name:o,units:n,tilesize:i,pixel_format:a,buffer:s,data_index:l}=e;if(this.version=r,1!==this.version)throw new Pv(`Cannot parse raster layer encoded with MRT version ${r}`);this.name=o,this.units=n,this.tileSize=i,this.buffer=s,this.pixelFormat=rx[a],this.dataIndex=l,this.bandShape=[i+2*s,i+2*s,ox[this.pixelFormat]],this._decodedBlocks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof r)throw new TypeError("Invalid resetTtl value");return new wv(e,t,r)}(t?t.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.set(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[r,o]of this.dataIndex.entries()){for(const[n,i]of o.bands.entries())if(i===e)return{bandIndex:t+n,blockIndex:r,blockBandIndex:n};t+=o.bands.length}break;case"number":for(const[r,o]of this.dataIndex.entries()){if(e>=t&&e<t+o.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-t};t+=o.bands.length}break;default:throw new Pv(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Pv(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let t=1/0,r=-1/0,o=1/0,n=-1/0;for(const i of e){const{blockIndex:e}=this.getBlockForBand(i);if(e<0)throw new Pv(`Invalid band: ${JSON.stringify(i)}`);const a=this.dataIndex[e];o=Math.min(o,e),n=Math.max(n,e),t=Math.min(t,a.first_byte),r=Math.max(r,a.last_byte)}return{layerName:this.name,firstByte:t,lastByte:r,firstBlock:o,lastBlock:n}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:r}=this.getBlockForBand(e),o=this._decodedBlocks.get(t.toString());if(!o)throw new Pv(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[t],i=this.bandShape.reduce(((e,t)=>e*t),1),a=r*i,s=o.subarray(a,a+i);return{data:s,bytes:new Uint8Array(s.buffer).subarray(s.byteOffset,s.byteOffset+s.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:n.offset,scale:n.scale}}}class sx{constructor(e,t,r){this.tasks=e,this._onCancel=t,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}ix.performDecoding=function(e,t){return Promise.all(t.tasks.map((t=>{const{layerName:r,firstByte:o,lastByte:n,pixelFormat:i,blockShape:a,blockIndex:s,filters:l,codec:c}=t,u=new Uint8Array(e).subarray(o,n+1),d=new Uint32Array(a[0]*a[1]*a[2]);let h;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return h=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((i=function(e){31==e[0]&&139==e[1]&&8==e[2]||Xv(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var o=(t>>3&1)+(t>>4&1);o>0;o-=!e[r++]);return r+(2&t)}(n=e))+8>n.length&&Xv(6,"invalid gzip data"),function(e,t,r){var o=e.length;if(!o||t.f&&!t.l)return r||new Cv(0);var n=!r,i=n||2!=t.i,a=t.i;n&&(r=new Cv(3*o));var s,l,c=function(e){var t=r.length;if(e>t){var o=new Cv(Math.max(2*t,e));o.set(r),r=o}},u=t.f||0,d=t.p||0,h=t.b||0,f=t.l,m=t.d,p=t.m,g=t.n,_=8*o;do{if(!f){u=Yv(e,d,1);var y=Yv(e,d+1,3);if(d+=3,!y){var v=e[(R=4+((d+7)/8|0))-4]|e[R-3]<<8,x=R+v;if(x>o){a&&Xv(0);break}i&&c(h+v),r.set(e.subarray(R,x),h),t.b=h+=v,t.p=d=8*x,t.f=u;continue}if(1==y)f=Kv,m=Jv,p=9,g=5;else if(2==y){var b=Yv(e,d,31)+257,L=Yv(e,d+10,15)+4,A=b+Yv(e,d+5,31)+1;d+=14;for(var w=new Cv(A),S=new Cv(19),E=0;E<L;++E)S[Dv[E]]=Yv(e,d+3*E,7);d+=3*L;var T=Zv(S),P=(1<<T)-1,C=Gv(S,T,1);for(E=0;E<A;){var R,M=C[Yv(e,d,P)];if(d+=15&M,(R=M>>4)<16)w[E++]=R;else{var I=0,O=0;for(16==R?(O=3+Yv(e,d,3),d+=2,I=w[E-1]):17==R?(O=3+Yv(e,d,7),d+=3):18==R&&(O=11+Yv(e,d,127),d+=7);O--;)w[E++]=I}}var D=w.subarray(0,b),k=w.subarray(b);p=Zv(D),g=Zv(k),f=Gv(D,p,1),m=Gv(k,g,1)}else Xv(1);if(d>_){a&&Xv(0);break}}i&&c(h+131072);for(var N=(1<<p)-1,B=(1<<g)-1,F=d;;F=d){var z=(I=f[qv(e,d)&N])>>4;if((d+=15&I)>_){a&&Xv(0);break}if(I||Xv(2),z<256)r[h++]=z;else{if(256==z){F=d,f=null;break}var U=z-254;z>264&&(U=Yv(e,d,(1<<(G=Iv[E=z-257]))-1)+Bv[E],d+=G);var V=m[qv(e,d)&B],H=V>>4;if(V||Xv(3),d+=15&V,k=zv[H],H>3){var G=Ov[H];k+=qv(e,d)&(1<<G)-1,d+=G}if(d>_){a&&Xv(0);break}i&&c(h+131072);var j=h+U;if(h<k){var W=0-k,K=Math.min(k,j);for(W+h<0&&Xv(3);h<K;++h)r[h]=(void 0)[W+h]}for(;h<j;++h)r[h]=r[h-k]}}t.l=f,t.p=F,t.b=h,t.f=u,f&&(u=1,t.m=p,t.d=m,t.n=g)}while(!u);return h!=r.length&&n?(s=r,(null==(l=h)||l>s.length)&&(l=s.length),new Cv(s.subarray(0,l))):r.subarray(0,h)}(n.subarray(i,-8),{i:2},new Cv(((r=n)[(o=r.length)-4]|r[o-3]<<8|r[o-2]<<16|r[o-1]<<24)>>>0))));var r,o,n,i;const a=tx[t];if(!a)throw new Error(`Unhandled codec: ${t}`);const s=new globalThis.DecompressionStream(a);return new Response(new Blob([e]).stream().pipeThrough(s)).arrayBuffer().then((e=>new Uint8Array(e)))}(u,c).then((e=>{const t=Av.read(new Lp(e));if("uint32_values"===t.values)return t.uint32_values.readValuesInto(d),new(0,nx[i])(d.buffer);throw new Error(`Unhandled numeric data "${t.values}"`)})),h.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":Sv(e,a);break;case"zigzag_filter":Ev(e);break;case"bitshuffle_filter":Tv(e,i);break;default:throw new Error(`Unhandled filter "${l[t]}"`)}return{layerName:r,blockIndex:s,data:e}})).catch((e=>{throw e}))})))},ms(sx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const lx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const o=r>>4;if(1!==o)throw new Error(`Got v${o} data when expected v1.`);const n=lx[15&r];if(!n)throw new Error("Unrecognized array type.");const[i]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new cx(a,i,n,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,o=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=lx.indexOf(this.ArrayType),i=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${r}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+i+a+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ux(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:a}=this,s=[0,n.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,d=s.pop()||0;if(u-d<=a){for(let a=d;a<=u;a++){const s=i[2*a],c=i[2*a+1];s>=e&&s<=r&&c>=t&&c<=o&&l.push(n[a])}continue}const h=d+u>>1,f=i[2*h],m=i[2*h+1];f>=e&&f<=r&&m>=t&&m<=o&&l.push(n[h]),(0===c?e<=f:t<=m)&&(s.push(d),s.push(h-1),s.push(1-c)),(0===c?r>=f:o>=m)&&(s.push(h+1),s.push(u),s.push(1-c))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:n,nodeSize:i}=this,a=[0,o.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop()||0,u=a.pop()||0,d=a.pop()||0;if(u-d<=i){for(let r=d;r<=u;r++)mx(n[2*r],n[2*r+1],e,t)<=l&&s.push(o[r]);continue}const h=d+u>>1,f=n[2*h],m=n[2*h+1];mx(f,m,e,t)<=l&&s.push(o[h]),(0===c?e-r<=f:t-r<=m)&&(a.push(d),a.push(h-1),a.push(1-c)),(0===c?e+r>=f:t+r>=m)&&(a.push(h+1),a.push(u),a.push(1-c))}return s}}function ux(e,t,r,o,n,i){if(n-o<=r)return;const a=o+n>>1;dx(e,t,a,o,n,i),ux(e,t,r,o,a-1,1-i),ux(e,t,r,a+1,n,1-i)}function dx(e,t,r,o,n,i){for(;n>o;){if(n-o>600){const a=n-o+1,s=r-o+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);dx(e,t,r,Math.max(o,Math.floor(r-s*c/a+u)),Math.min(n,Math.floor(r+(a-s)*c/a+u)),i)}const a=t[2*r+i];let s=o,l=n;for(hx(e,t,o,r),t[2*n+i]>a&&hx(e,t,o,n);s<l;){for(hx(e,t,s,l),s++,l--;t[2*s+i]<a;)s++;for(;t[2*l+i]>a;)l--}t[2*o+i]===a?hx(e,t,o,l):(l++,hx(e,t,l,n)),l<=r&&(o=l+1),r<=l&&(n=l-1)}}function hx(e,t,r,o){fx(e,r,o),fx(t,2*r,2*o),fx(t,2*r+1,2*o+1)}function fx(e,t,r){const o=e[t];e[t]=e[r],e[r]=o}function mx(e,t,r,o){const n=e-r,i=t-o;return n*n+i*i}e.$=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,r]=e;const o=mr([1,t,r]);return{x:o.x,y:o.y,z:o.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:Go(e.x,t.x,r),y:Go(e.y,t.y,r),z:Go(e.z,t.z,r)}}},e.A=rl,e.B=Ja,e.C=Mn,e.D=ja,e.E=No,e.F=function(e){const t=e.value;let r=[];if(!t)return r;const o=En(t);return"string"!==o?(r=r.concat([new X_(e.key,t,`string expected, "${o}" found`)]),r):(Q_(t,!0)||(r=r.concat([new X_(e.key,t,`invalid url "${t}"`)])),r)},e.G=tl,e.H=Xs,e.I=eg,e.J=Ys,e.K=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return mr(e.expression.evaluate(t))}interpolate(e,t,r){return{x:Go(e.x,t.x,r),y:Go(e.y,t.y,r),z:Go(e.z,t.z,r),azimuthal:Go(e.azimuthal,t.azimuthal,r),polar:Go(e.polar,t.polar,r)}}},e.L=Gs,e.M=class{constructor(e,t,r,o){this.id=e,this.position=null!=t?new au(t[0],t[1]):new au(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new pd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,r){if(e.a9.multiply(t.matrix,r,t.matrix),t.meshes)for(const e of t.meshes){const r=pd.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(r)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.a9.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(e,t,r,o,n,i){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];sy(this.matrix,this,e.transform,this.position,t,r,o,n,i,a)}upload(e){if(!this.uploaded){for(const t of this.nodes)uy(t,e);for(const e of this.nodes)dy(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)hy(e)}},e.N=Us,e.O=Cu,e.P=Ut,e.R=Yr,e.S=qt,e.T=v_,e.U=Zs,e.V=X_,e.W=zd,e.X=Go,e.Y=ii,e.Z=is,e._=jo,e.a=ko,e.a$=ir,e.a0=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=new Ut(r,r),i=e.sub(n),a=t.add(n),s=[i,new Ut(a.x,i.y),a,new Ut(i.x,a.y)];return o&&s.push(i.clone()),s},e.a1=function(e,t){const r=[];for(let o=0;o<e.length;o++){const n=$t(o-1,-1,e.length-1),i=$t(o+1,-1,e.length-1),a=e[o],s=e[i],l=e[n].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),d=l.add(c).unit().mult(-1*t/Math.sin(u/2));r.push(a.add(d))}return r},e.a2=Ig,e.a3=Xu,e.a4=function(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.Q.fromValues(((r.x-o)*t.scale-t.x)*ii,(r.y*t.scale-t.y)*ii,Au(r.z,r.y))},e.a5=ld,e.a6=Pm,e.a7=function(e){let t=1/0,r=1/0,o=-1/0,n=-1/0;for(const i of e)t=Math.min(t,i.x),r=Math.min(r,i.y),o=Math.max(o,i.x),n=Math.max(n,i.y);return{min:new Ut(t,r),max:new Ut(o,n)}},e.a8=yu,e.aA=Ho,e.aB=Al,e.aC=Oa,e.aD=ec,e.aE=pc,e.aF=tr,e.aG=oc,e.aH=c_,e.aI=function(){zs.isLoading()||zs.isLoaded()||"deferred"!==Bs()||Fs()},e.aJ=ol,e.aK=Fu,e.aL=av,e.aM=gr,e.aN=Sm,e.aO=jh,e.aP=Bu,e.aQ=Sl,e.aR=ql,e.aS=vd,e.aT=zh,e.aU=y_,e.aV=function(t,r){const o=zd(r.zoom);if(0===o)return Sd(t);const n=Cd(t),i=Rd(n),a=yu(n.getWest())*r.worldSize,s=yu(n.getEast())*r.worldSize,l=vu(n.getNorth())*r.worldSize,c=vu(n.getSouth())*r.worldSize,u=[a,l,0],d=[s,l,0],h=[a,c,0],f=[s,c,0],m=e.a9.invert([],r.globeMatrix);return e.Q.transformMat4(u,u,m),e.Q.transformMat4(d,d,m),e.Q.transformMat4(h,h,m),e.Q.transformMat4(f,f,m),i[0]=Ed(i[0],h,o),i[1]=Ed(i[1],f,o),i[2]=Ed(i[2],d,o),i[3]=Ed(i[3],u,o),pd.fromPoints(i)},e.aW=Dd,e.aX=Md,e.aY=Ed,e.aZ=El,e.a_=yd,e.ab=$u,e.ac=Mu,e.ad=Yt,e.ae=Zc,e.af=function(e,t){const r={};for(let o=0;o<t.length;o++){const n=t[o];n in e&&(r[n]=e[n])}return r},e.ag=su,e.ah=vu,e.ai=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,o){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,r]=n.result;return this.scheduler?this.scheduler.add((()=>{o(e,r)}),t):o(e,r),()=>{}}return n.callbacks.push(o),n.cancel||(n.cancel=r(((r,o)=>{n.result=[r,o];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(r,o)}),t):e(r,o);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==o)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}},e.aj=gl,e.ak=function(e,t,r){const o=JSON.stringify(e.request);return e.data&&(this.deduped.entries[o]={result:[null,e.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const o=Qr(e.request,((e,o,n,i)=>{e?t(e):o&&t(null,{vectorTile:r?void 0:new hf(new Lp(o)),rawData:o,cacheControl:n,expires:i})}));return()=>{o.cancel(),t()}}),t)},e.al=function(e){Vr++,Vr>Fr&&(e.getActor().send("enforceCacheSizeLimit",Br),Vr=0)},e.am=po,e.an=Rr,e.ao=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.ap=hu,e.aq=E_,e.ar=C_,e.as=w_,e.at=function(e,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let o=0;o<e.length;o++){const t=document.createElement("source");eo(e[o])||(r.crossOrigin="Anonymous"),t.src=e[o],r.appendChild(t)}return{cancel:()=>{}}},e.au=x_,e.av=Mg,e.aw=bu,e.ax=Lu,e.ay=Tl,e.az=Gl,e.b=Do,e.b$=sg,e.b0=ix,e.b1=Qr,e.b2=function(e){const t=[];for(const r in e)t.push(e[r]);return t},e.b3=function(e,t){const r=[];for(const o in e)o in t||r.push(o);return r},e.b4=Xt,e.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.b6=function(t,r){const{x:o,y:n}=t.point,i=Fd(o,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.a9.multiply(i,i,kd(Sd(r)))},e.b8=Zm,e.b9=Pp,e.bA=qc,e.bB=function(t){const r=e.a9.identity(new Float64Array(16));e.a9.multiply(r,t.pixelMatrix,t.globeMatrix);const o=[0,eu,0],n=[0,tu,0];return e.Q.transformMat4(o,o,r),e.Q.transformMat4(n,n,r),[o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!Vd(t,new au(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Vd(t,new au(t.center.lat,-90))]},e.bC=function(t,r){const{scale:o}=t.tileTransform,n=o*ii/(t.tileSize*Math.pow(2,r.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.b7.scale(new Float32Array(4),r.inverseAdjustmentMatrix,[n,n])},e.bD=B_,e.bE=k_,e.bF=function(t){const r=k_(t,!0);return e.b7.invert([],[r[0],r[1],r[4],r[5]])},e.bG=cd,e.bH=function(e){const{x:t,y:r}=e.point,{lng:o,lat:n}=e._center;return Fd(t,r,e.worldSize,o,n)},e.bI=jt,e.bJ=Yc,e.bK=function(e){const t=Math.round((e+45+360)%360/90)%4;return Wt[t]},e.bL=45,e.bM=_u,e.bN=Mc,e.bO=Ec,e.bP=Tc,e.bQ=Sc,e.bR=wc,e.bS=Pc,e.bT=function(e,t,r){const o=Math.sqrt(e*e+t*t+r*r),n=o>0?Math.acos(r/o)*Ht:0;let i=0!==e||0!==t?Math.atan2(-t,-e)*Ht+90:0;return i<0&&(i+=360),[o,i,n]},e.bU=Pu,e.bV=pd,e.bW=mr,e.bX=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.bY=function(e){return e({pluginStatus:Is,pluginURL:Os}),Ns.on("pluginStateChange",e),e},e.bZ=gy,e.b_=Ly,e.ba=Jm,e.bb=function(e,t,r,o,n){const i=5*t+2;e.float32[i+0]=r,e.float32[i+1]=o,e.float32[i+2]=n},e.bc=i_,e.bd=$p,e.be=Hu,e.bf=jm,e.bg=bg,e.bh=xg,e.bi=zp,e.bj=cx,e.bk=$t,e.bm=Gt,e.bn=Sr,e.bo=xu,e.bp=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},e.bq=au,e.br=Qg,e.bs=du,e.bt=md,e.bu=N_,e.bv=uu,e.bw=Pd,e.bx=function(e,t,r,o,n,i,a,s,l){if("globe"===l.name)return Pd(e,t,new uu(r,o,n),!1);const c=Mg({z:r,x:o,y:n},l);return new pd([(i+c.x/c.scale)*t,t*(c.y/c.scale),a],[(i+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.by=function(e,t,r){let o=0;for(let n=0;n<2;++n){const r=0;e[n]>r&&(o+=(e[n]-r)*(e[n]-r)),t[n]<r&&(o+=(r-t[n])*(r-t[n]))}return o},e.bz=wu,e.c=tv,e.c$=[1,1,1],e.c0=ag,e.c1=$r,e.c2=Ds,e.c3=i,e.c4=Or,e.c5=Mo,e.c6=cr,e.c7=function(e,t,r){return"custom"===e.type?new R_(e,t):new bv[e.type](e,t,r)},e.c8=function(e){const t=e.indexOf(pl);return t>=0?e.slice(0,t):e},e.c9=function(e){return e.indexOf(pl)>=0},e.cA=e=>({u_matrix:new Mc(e),u_pixels_to_tile_units:new Dc(e),u_device_pixel_ratio:new Sc(e),u_units_to_pixels:new Ec(e),u_dash_image:new wc(e),u_gradient_image:new wc(e),u_image_height:new Sc(e),u_texsize:new Ec(e),u_tile_units_to_pixels:new Sc(e),u_alpha_discard_threshold:new Sc(e),u_trim_offset:new Ec(e),u_emissive_strength:new Sc(e)}),e.cB=e=>({u_matrix:new Mc(e),u_texsize:new Ec(e),u_pixels_to_tile_units:new Dc(e),u_device_pixel_ratio:new Sc(e),u_image:new wc(e),u_units_to_pixels:new Ec(e),u_tile_units_to_pixels:new Sc(e),u_alpha_discard_threshold:new Sc(e),u_trim_offset:new Ec(e)}),e.cC=Vl,e.cD=Gm,e.cE=Ym,e.cF=Kd,e.cG=(e,t,r,o,n,i)=>{const a=e.transform,s="globe"===a.projection.name;let l;if("map"===i.paint.get("circle-pitch-alignment"))if(s){const e=Bd(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(a.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Mr.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Wd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:i.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=o,c.u_merc_center=n,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=zd(a.zoom);const e=n[0]*ii,r=n[1]*ii;c.u_up_dir=a.projection.upVector(new uu(0,0,0),e,r)}return c},e.cH=Mm,e.cI=(e,t,r,o,n,i)=>{const a=e.transform;return{u_matrix:Rm(e,t,r,o),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:a.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Cm(t,a),u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:i}},e.cJ=(e,t,r,o,n,i,a)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Rm(e,t,r,o),u_pixels_to_tile_units:l,u_device_pixel_ratio:i,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Im(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cm(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:a,u_emissive_strength:r.paint.get("line-emissive-strength")}},e.cK=or,e.cL=sh,e.cM=am,e.cN=mu,e.cO=Xf,e.cP=Vf,e.cQ=450,e.cR=7,e.cS=S_,e.cT=256,e.cU=kd,e.cV=$l,e.cW=Jl,e.cX=Zl,e.cY=function(e,t,r,o,n){return Yt((e-t)/(r-t)*(n-o)+o,o,n)},e.cZ=Eu,e.c_=G_,e.ca=function(e){const t=e.indexOf(pl);return t>=0?e.slice(t+1):""},e.cb=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},e.cc=lr,e.cd=Ns,e.ce=Xr,e.cf=Cc,e.cg=class extends Ac{constructor(e){super(e),this.current=Ic}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let o=0;o<9;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},e.ch=Kt,e.ci=function(e,t,r){const o=zd(r.zoom),n=e.style.map._antialias,i=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===o&&!n&&!i},e.cj=function(t){const r=t.pixelsPerMeter,o=r/xu(1,t.center.lat),n=e.a9.identity(new Float64Array(16));return e.a9.translate(n,n,[t.point.x,t.point.y,0]),e.a9.scale(n,n,[o,o,r]),Float32Array.from(n)},e.ck=Cd,e.cl=function(e){const t=wu-5;e=Yt(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Gt(e))),3);return Math.round(r*(Qc.length-1))},e.cm=function(t,r,o,n){const i=r.getNorth(),a=r.getSouth(),s=r.getWest(),l=r.getEast(),c=1<<t.z,u=l-s,d=i-a,h=u/Xc,f=-d/Qc[o],m=[0,h,0,f,0,0,i,s,0];if(t.z>0){const t=180/n;e.ct.multiply(m,m,[t/u+1,0,0,0,t/d+1,0,-.5*t/h,.5*t/f,1])}return m[2]=c,m[5]=t.x,m[8]=t.y,m},e.cn=Sd,e.co=function(t,r,o){const n=e.a9.identity(new Float64Array(16)),i=(r/(1<<t)-.5)*Math.PI*2;return e.a9.rotateY(n,o.globeMatrix,i),Float32Array.from(n)},e.cp=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,o=1<<r,n=Math.floor(e.x),i=Math.floor((e.x-n)*o),a=Math.floor(e.y*o),s=this.findDEMTileFor(new hu(r,n,r,i,a));return!(!s||!s.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const o=this._source();if(!o)return t;if(e.y<0||e.y>1)return t;const n=o.getSource().maxzoom,i=1<<n,a=Math.floor(e.x),s=e.x-a,l=new hu(n,a,n,Math.floor(s*i),Math.floor(e.y*i)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,d=1<<c.tileID.canonical.z,h=(s*d-c.tileID.canonical.x)*u.dim,f=(e.y*d-c.tileID.canonical.y)*u.dim,m=Math.floor(h),p=Math.floor(f);return(r?this.exaggeration():1)*Go(Go(u.get(m,p),u.get(m,p+1),f-p),Go(u.get(m+1,p),u.get(m+1,p+1),f-p),h-m)}getAtTileOffset(e,t,r){const o=1<<e.canonical.z;return this.getAtPointOrZero(new Cu(e.wrap+(e.canonical.x+t/ii)/o,(e.canonical.y+r/ii)/o))}getAtTileOffsetFunc(t,r,o,n){return i=>{const a=this.getAtTileOffset(t,i.x,i.y),s=n.upVector(t.canonical,i.x,i.y),l=n.upVectorScale(t.canonical,r,o).metersToTile;return e.Q.scale(s,s,a*l),s}}getForTilePoints(e,t,r,o){if(this.isUsingMockSource())return!1;const n=Df.create(this,e,o);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],r)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,o=t.tileID,n=1<<e.canonical.z-o.canonical.z;let i=e.canonical.x/n-o.canonical.x,a=e.canonical.y/n-o.canonical.y,s=0;for(let l=0;l<e.canonical.z-o.canonical.z&&!r.leaves[s];l++){i*=2,a*=2;const e=2*Math.floor(a)+Math.floor(i);s=r.childOffsets[s]+e,i%=1,a%=1}return{min:this.exaggeration()*r.minimums[s],max:this.exaggeration()*r.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(r=Math.min(r,e.min),o=Math.max(o,e.max),t=!0)}return t?{min:r,max:o}:null}},e.cq=xd,e.cr=nh,e.cs=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.cu=Bd,e.cv=Cr,e.cw=Pr,e.cx=256,e.cy=function(t,r){const o=[0,0,0],n=Dd(Sd(r.canonical));return e.Q.transformMat4(o,o,n),e.Q.transformMat4(o,o,t),o},e.cz=e=>({u_camera_to_center_distance:new Sc(e),u_extrude_scale:new Dc(e),u_device_pixel_ratio:new Sc(e),u_matrix:new Mc(e),u_inv_rot_matrix:new Mc(e),u_merc_center:new Ec(e),u_tile_id:new Tc(e),u_zoom_transition:new Sc(e),u_up_dir:new Tc(e),u_emissive_strength:new Sc(e)}),e.d=no,e.d$=py,e.d0=Df,e.d1=ay,e.d2=Fl,e.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=yf(new Ut(0,0),new Ut(ii,ii),e),r=[];for(const o of this._activeRegions){if(o.hiddenByOverlap)continue;if(!_f(t,o))continue;const n=vf(o.min,o.max,e);r.push({min:n.min,max:n.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return r}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const r of e.cache.getVisibleCoordinates()){const o=e.cache.getTile(r).buckets[e.layer];if(o)for(const e of o.getNodesInfo()){const o=e.node;o.footprint&&t.push({footprint:o.footprint,id:r.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=yf(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||pf(e.min,t.min)||pf(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,r=0;for(;!e&&t!==this._activeRegions.length;){const o=this._activeRegions[t],n=this._prevRegions[r];e=o.priority!==n.priority||!gf(o,n),++t,++r}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const r=t[e].priority;for(;e<t.length&&t[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let t=0,r=e(t);for(;t!==r;){let o=t;const n=t;for(;o!==r;){const e=this._activeRegions[o];e.hiddenByOverlap=!1;for(let t=0;t<n;t++){const r=this._activeRegions[t];if(!r.hiddenByOverlap&&_f(e,r)&&(e.hiddenByOverlap=bf(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++o}t=r,r=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.d4=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new Sl,o=new Gl,n=[],i=e+1+2,a=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,r)=>{let o=e===i-1?e-2:0===e?e:e-1;return o+=r?24575:0,[o,t]};for(let c=0;c<i;++c)r.emplaceBack(...l(c,0,!0));for(let c=0;c<a;++c)for(let e=0;e<i;++e)r.emplaceBack(...l(e,c,(0===e||e===i-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<i;++t)r.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=o.length,a=t[c]+1+2,l=new Gl;for(let r=0;r<a-1;r++){const e=r===a-2,n=e?i*(s-t.length+c-r):i;for(let t=0;t<i-1;t++){const a=r*i+t;0===r||e||0===t||t===i-2?(l.emplaceBack(a+1,a,a+n),l.emplaceBack(a+n,a+n+1,a+1)):(o.emplaceBack(a+1,a,a+n),o.emplaceBack(a+n,a+n+1,a+1))}}const u=pc.simpleSegment(0,e,r.length,o.length-e);for(let t=0;t<l.uint16.length;t+=3)o.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const d=pc.simpleSegment(0,e,r.length,o.length-e);n.push({withoutSkirts:u,withSkirts:d})}return{vertices:r,indices:o,segments:n}}_createGrid(e){const t=this._fillGridMeshWithLods(Xc,Qc);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,vd.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Gl;for(let a=0;a<=Xc;a++)t.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new Jl,o=new Jl,n=new Jl,i=new Jl;this._poleSegments=[];for(let a=0,s=0;a<Yc;a++){const e=360/(1<<a);r.emplaceBack(0,-Zc,0,.5,0),o.emplaceBack(0,-Zc,0,.5,1),n.emplaceBack(0,-Zc,0,.5,.5),i.emplaceBack(0,-Zc,0,.5,.5);for(let t=0;t<=Xc;t++){let a=t/Xc,s=0;const l=Go(0,e,a),[c,u,d]=ru(Gd,jd,l,Zc);r.emplaceBack(c,u,d,a,s),o.emplaceBack(c,u,d,a,1-s);const h=Gt(l);a=.5+.5*Math.sin(h),s=.5+.5*Math.cos(h),n.emplaceBack(c,u,d,a,s),i.emplaceBack(c,u,d,a,1-s)}this._poleSegments.push(pc.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,_d,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(o,_d,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,_d,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(i,_d,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.d5=function(e){return wo.has(e)},e.d6=Jt,e.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.d8=Zt,e.d9=Tu,e.dA=xy,e.dB=function(e){const t=zr();if(!t)return;const r=t.delete(Dr);e&&r.catch(e).then((()=>e()))},e.dC=_y,e.dD=Cy,e.dE=function(e){wy=Mr.resolveURL(e),Py||(Py=new gy(Ly(),new No)),Py.broadcast("setDracoUrl",wy)},e.dF=Ry,e.dG=function(e){Ey=Mr.resolveURL(e),Py||(Py=new gy(Ly(),new No)),Py.broadcast("setMeshoptUrl",Ey)},e.dH=ms,e.dI=rh,e.dJ=ig,e.dK=nv,e.dL=sv,e.dM=bm,e.dN=sr,e.dO=tg,e.dP=function(e,t,r,o,n,i,a,s,l,c,u){e.createArrays(),e.tilePixelRatio=ii/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const d=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,f={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;f.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Us(t),s),h["text-size"].possiblyEvaluate(new Us(r),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;f.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Us(t),s),h["icon-size"].possiblyEvaluate(new Us(r),s)]}f.layoutTextSize=h["text-size"].possiblyEvaluate(new Us(l+1),s),f.layoutIconSize=h["icon-size"].possiblyEvaluate(new Us(l+1),s),f.textMaxSize=h["text-size"].possiblyEvaluate(new Us(18),s);const m="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),p=d.get("text-size");let g=!1;for(const _ of e.features)if(_.icon&&_.icon.nameSecondary){g=!0;break}for(const _ of e.features){const i=d.get("text-font").evaluate(_,{},s).join(","),l=p.evaluate(_,{},s),h=f.layoutTextSize.evaluate(_,{},s),y=(f.layoutIconSize.evaluate(_,{},s),{horizontal:{},vertical:void 0}),v=_.text;let x,b=[0,0];if(v){const o=v.toString(),a=d.get("text-letter-spacing").evaluate(_,{},s)*jm,c=d.get("text-line-height").evaluate(_,{},s)*jm,u=bs(o)?a:0,f=d.get("text-anchor").evaluate(_,{},s),p=d.get("text-variable-anchor");if(!p){const e=d.get("text-radial-offset").evaluate(_,{},s);b=e?xg(f,[e*jm,yg]):d.get("text-offset").evaluate(_,{},s).map((e=>e*jm))}let g=m?"center":d.get("text-justify").evaluate(_,{},s);const x="point"===d.get("symbol-placement"),L=x?d.get("text-max-width").evaluate(_,{},s)*jm:1/0,A=a=>{e.allowVerticalPlacement&&xs(o)&&(y.vertical=Mp(v,t,r,n,i,L,c,f,a,u,b,Pp.vertical,!0,h,l))};if(!m&&p){const e="auto"===g?p.map((e=>bg(e))):[g];let o=!1;for(let a=0;a<e.length;a++){const s=e[a];if(!y.horizontal[s])if(o)y.horizontal[s]=y.horizontal[0];else{const e=Mp(v,t,r,n,i,L,c,"center",s,u,b,Pp.horizontal,!1,h,l);e&&(y.horizontal[s]=e,o=1===e.positionedLines.length)}}A("left")}else{if("auto"===g&&(g=bg(f)),x||d.get("text-writing-mode").indexOf("horizontal")>=0||!xs(o)){const e=Mp(v,t,r,n,i,L,c,f,g,u,b,Pp.horizontal,!1,h,l);e&&(y.horizontal[g]=e)}A(x?"left":g)}}let L=!1;if(_.icon&&_.icon.namePrimary){const t=o[_.icon.namePrimary];t&&(x=Vp(n[_.icon.namePrimary],_.icon.nameSecondary?n[_.icon.nameSecondary]:void 0,d.get("icon-offset").evaluate(_,{},s),d.get("icon-anchor").evaluate(_,{},s)),L=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==d.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const A=Eg(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!A&&A.iconsInText),(A||x)&&Lg(e,_,y,x,o,f,h,0,b,L,a,s,c,u,g)}i&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)},e.dQ=hf,e.dR=Lp,e.dS=Of,e.dT=ff,e.dU=Qh,e.dV=Ft,e.dW=tp,e.dX=d,e.dY=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==zy){const r=new Uint32Array(e,0,7),[,,o,n,i,a]=r;t=r.byteLength+n+i+a+i,(o!==e.byteLength||t>=e.byteLength)&&dr("Invalid b3dm header information.")}return Wy(e,t)},e.dZ=function(e,t){const r=tv(e);for(const o of r){for(const e of o.meshes)rv(e);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(ov(o.lights,t)))}return r},e.d_=gv,e.da=ou,e.db=function(e){let[t,r,o]=e;const n=Math.hypot(t,r,o),i=Math.atan2(t,o),a=.5*Math.PI-Math.acos(-r/n);return new au(jt(i),jt(a))},e.dc=nu,e.dd=o,e.de=Vd,e.df=Ud,e.dg=function(t){const r=[0,0,0],o=e.a9.identity(new Float64Array(16));return e.a9.multiply(o,t.pixelMatrix,t.globeMatrix),e.Q.transformMat4(r,r,o),new Ut(r[0],r[1])},e.dh=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Ar){const t=e.navigator?e.navigator.userAgent:null;Ar=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ar}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.di=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",io,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,r){if(!i(e))return e;const o=lo(e);return o.params.push(`sdk=js-${t}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||r)}normalizeGlyphsURL(e,t){if(!i(e))return e;const r=lo(e);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeModelURL(e,t){if(!i(e))return e;const r=lo(e);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||t)}normalizeSourceURL(e,t,r,o){if(!i(e))return e;const n=lo(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),r&&n.params.push(`language=${r}`),o&&n.params.push(`worldview=${o}`),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,r,o){const n=lo(e);return i(e)?(n.path=`/styles/v1${n.path}/sprite${t}${r}`,this._makeAPIURL(n,this._customAccessToken||o)):(n.path+=`${t}${r}`,co(n))}normalizeTileURL(e,t,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!i(e))return e;const n=lo(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||r&&"raster"!==n.authority&&512===r?"@2x":""}${Hr.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${o.RASTER_URL_PREFIX}${n.path}`:"rasterarrays"===n.authority?n.path=`/${o.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${o.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||o.ACCESS_TOKEN;return o.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(e,t){const r=lo(e);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${o.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${o.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${o.TILE_URL_VERSION}/`,"")}`;let i=r.params;return t&&(i=i.filter((e=>!e.match(/^access_token=/)))),i.length&&(n+=`?${i.join("&")}`),n}canonicalizeTileset(e,t){const r=!!t&&i(t),o=[];for(const i of e.tiles||[])n(i)?o.push(this.canonicalizeTileURL(i,r)):o.push(i);return o}_makeAPIURL(e,t){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=lo(o.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!o.REQUIRE_ACCESS_TOKEN)return co(e);if(t=t||o.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),co(e)}},e.dj=function(e,t){t?wo.add(e):wo.delete(e)},e.dk=Hr,e.dl=bo,e.dm=Ao,e.dn=ao,e.dp=_o,e.dq=vo,e.dr=function(e){wo.delete(e)},e.ds=Lo,e.dt=go,e.du=t,e.dv=function(e,t){Br=e,Fr=t},e.dw=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Is===Ps||Is===Cs||Is===Rs)throw new Error("setRTLTextPlugin cannot be called multiple times.");Os=Mr.resolveURL(e),Is=Ps,Ms=t,ks(),r||Fs()},e.dx=Bs,e.dy=function(){Ly().acquire(vy)},e.dz=function(){const e=by;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(vy),by=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.e=Qt,e.e0=zs,e.e1=function(e){Ur(),kr&&kr.then((t=>{t.keys().then((r=>{for(let o=0;o<r.length-e;o++)t.delete(r[o])}))}))},e.f=Mr,e.g=function(e,t){return Xr(Qt(e,{type:"json"}),t)},e.h=oh,e.i=class extends X_{},e.j=En,e.k=Ko,e.l=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>Wy(t,0,e)))},e.m=Ga,e.n=Wa,e.o=rs,e.p=Xp,e.q=el,e.r=as,e.s=Ka,e.t=os,e.u=Qs,e.v=Ui,e.w=dr,e.x=Hi,e.y=zi})),o(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function r(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const o of e)t+=`${r(o)},`;return`${t}]`}let t="{";for(const o of Object.keys(e).sort())t+=`${o}:${r(e[o])},`;return`${t}}`}function o(t){let o="";for(const n of e.b5)o+=`/${r(t[n])}`;return o}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,r,n){this._options=n;for(const o of t)this._layerConfigs[o.id]=o,(this._layers[o.id]=e.c7(o,this.scope,this._options)).compileFilter(),this.keyCache[o.id]&&delete this.keyCache[o.id];for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const i=function(e,t){const r={};for(let i=0;i<e.length;i++){const n=t&&t[e[i].id]||o(e[i]);t&&(t[e[i].id]=n);let a=r[n];a||(a=r[n]=[]),a.push(e[i])}const n=[];for(const o in r)n.push(r[o]);return n}(e.b2(this._layerConfigs),this.keyCache);for(const e of i){const t=e.map((e=>this._layers[e.id])),r=t[0];if("none"===r.visibility)continue;const o=r.source||"";let n=this.familiesBySource[o];n||(n=this.familiesBySource[o]={});const i=r.sourceLayer||"_geojsonTileLayer";let a=n[i];a||(a=n[i]=[]),a.push(t)}}}const i=1*e.dJ;class a{constructor(t){const r={},o=[];for(const e in t){const n=t[e],a=r[e]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?i:1,s={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};o.push(s),a[e]=s}}const{w:n,h:a}=e.p(o),s=new e.dI({width:n||1,height:a||1});for(const l in t){const o=t[l];for(const t in o.glyphs){const n=o.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const a=r[l][t],c=n.metrics.localGlyph?i:1;e.dI.copy(n.bitmap,s,{x:0,y:0},{x:a.x+c,y:a.y+c},n.bitmap)}}this.image=s,this.positions=r}}e.dH(a,"GlyphAtlas");class s{constructor(t){this.tileID=new e.ap(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.av(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,r,o,n,i){this.status="parsing",this.data=t,this.collisionBoxArray=new e.aG;const s=new e.dK(Object.keys(t.layers).sort()),c=new e.dL(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},d=new e.dM(256,256),h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:d,availableImages:o,brightness:this.brightness},f=r.familiesBySource[this.source];for(const a in f){const r=t.layers[a];if(!r)continue;let n=!1,i=!1,d=!1;for(const e of f[a])"symbol"===e[0].type?n=!0:i=!0,e[0].is3D()&&"model"!==e[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!i)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${a}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const m=s.encode(a),p=[];for(let e=0;e<r.length;e++){const t=r.feature(e),o=c.getId(t,a);p.push({feature:t,id:o,index:e,sourceLayerIndex:m})}for(const e of f[a]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(l(e,this.zoom,h.brightness,o),(u[t.id]=t.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:m,sourceID:this.source,projection:this.projection.spec})).populate(p,h,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>e.id)))))}}let m,p,g,_;d.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(m)return this.status="done",i(m);if(this.extraShadowCaster)this.status="done",i(null,{buckets:e.b2(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:h.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(p&&g&&_){const t=new a(p),r=new e.dO(g,_);for(const n in u){const i=u[n];i instanceof e.aH?(l(i.layers,this.zoom,h.brightness,o),e.dP(i,p,t.positions,g,r.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):i.hasPattern&&(i instanceof e.aN||i instanceof e.aO||i instanceof e.cO)&&(l(i.layers,this.zoom,h.brightness,o),i.addFeatures(h,this.tileID.canonical,r.patternPositions,o,this.tileTransform,this.brightness))}this.status="done",i(null,{buckets:e.b2(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:d,imageAtlas:r,brightness:h.brightness})}};if(!this.extraShadowCaster){const t=e.dN(h.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{m||(m=e,p=t,v())}),void 0,!1,y):p={};const r=Object.keys(h.iconDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{m||(m=e,g=t,v())}),void 0,!1,y):g={};const o=Object.keys(h.patternDependencies);o.length?n.send("getImages",{icons:o,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{m||(m=e,_=t,v())}),void 0,!1,y):_={}}v()}}function l(t,r,o,n){const i=new e.N(r,{brightness:o});for(const e of t)e.recalculate(i,n)}class c extends e.E{constructor(t,r,o,n,i,a){super(),this.actor=t,this.layerIndex=r,this.availableImages=o,this.loadVectorData=i||e.ak,this.loading={},this.loaded={},this.deduped=new e.ai(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=a}loadTile(r,o){const n=r.uid,i=r&&r.request,a=i&&i.collectResourceTiming,l=this.loading[n]=new s(r);l.abort=this.loadVectorData(r,((s,c)=>{const u=!this.loading[n];if(delete this.loading[n],u||s||!c)return l.status="done",u||(this.loaded[n]=l),o(s);const d=c.rawData,h={};c.expires&&(h.expires=c.expires),c.cacheControl&&(h.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.dQ(new e.dR(d));const f=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((r,n)=>{if(r||!n)return o(r);const s={};if(a){const e=t(i);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}o(null,e.e({rawTileData:d.slice(0)},n,h,s))}))};this.isSpriteLoaded?f():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):f()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(t,r){const o=this.loaded,n=t.uid,i=this;if(o&&o[n]){const a=o[n];a.showCollisionBoxes=t.showCollisionBoxes,a.projection=t.projection,a.brightness=t.brightness,a.tileTransform=e.av(t.tileID.canonical,t.projection),a.extraShadowCaster=t.extraShadowCaster;const s=(e,t)=>{const o=a.reloadCallback;o&&(delete a.reloadCallback,a.parse(a.vectorTile,i.layerIndex,this.availableImages,i.actor,o)),r(e,t)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else r(null,void 0)}abortTile(e,t){const r=e.uid,o=this.loading[r];o&&(o.abort&&o.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,o=e.uid;r&&r[o]&&delete r[o],t()}}class u{loadTile(t,r){const{uid:o,encoding:n,rawImageData:i,padding:a}=t,s=ImageBitmap&&i instanceof ImageBitmap?this.getImageData(i,a):i;r(null,new e.dS(o,s,n,a<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}class d{decodeRasterArray(t,r){let{task:o,buffer:n}=t;e.b0.performDecoding(n,o).then((e=>{r(null,e)}),(e=>{r(e)}))}}const h=e.dT.prototype.toGeoJSON;let f=class{constructor(t){this._feature=t,this.extent=e.Y,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const o=[];for(const t of r)o.push(new e.P(t[0],t[1]));t.push(o)}return t}}toGeoJSON(e,t,r){return h.call(this,e,t,r)}},m=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.Y,this.length=t.length,this._features=t}feature(e){return new f(this._features[e])}};var p={exports:{}},g=e.dV,_=e.dU.VectorTileFeature,y=v;function v(e,t){this.options=t||{},this.features=e,this.length=e.length}function x(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}v.prototype.feature=function(e){return new x(this.features[e],this.options.extent)},x.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],n=0;n<r.length;n++)o.push(new g(r[n][0],r[n][1]));this.geometry.push(o)}return this.geometry},x.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,n=-1/0,i=0;i<e.length;i++)for(var a=e[i],s=0;s<a.length;s++){var l=a[s];t=Math.min(t,l.x),r=Math.max(r,l.x),o=Math.min(o,l.y),n=Math.max(n,l.y)}return[t,o,r,n]},x.prototype.toGeoJSON=_.prototype.toGeoJSON;var b=e.dW,L=y;function A(e){var t=new b;return function(e,t){for(var r in e.layers)t.writeMessage(3,w,e.layers[r])}(e,t),t.finish()}function w(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var o={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)o.feature=e.feature(r),t.writeMessage(2,S,o);var n=o.keys;for(r=0;r<n.length;r++)t.writeStringField(3,n[r]);var i=o.values;for(r=0;r<i.length;r++)t.writeMessage(4,R,i[r])}function S(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,E,e),t.writeVarintField(3,r.type),t.writeMessage(4,C,r)}function E(e,t){var r=e.feature,o=e.keys,n=e.values,i=e.keycache,a=e.valuecache;for(var s in r.properties){var l=r.properties[s],c=i[s];if(null!==l){void 0===c&&(o.push(s),i[s]=c=o.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var d=u+":"+l,h=a[d];void 0===h&&(n.push(l),a[d]=h=n.length-1),t.writeVarint(h)}}}function T(e,t){return(t<<3)+(7&e)}function P(e){return e<<1^e>>31}function C(e,t){for(var r=e.loadGeometry(),o=e.type,n=0,i=0,a=r.length,s=0;s<a;s++){var l=r[s],c=1;1===o&&(c=l.length),t.writeVarint(T(1,c));for(var u=3===o?l.length-1:l.length,d=0;d<u;d++){1===d&&1!==o&&t.writeVarint(T(2,u-1));var h=l[d].x-n,f=l[d].y-i;t.writeVarint(P(h)),t.writeVarint(P(f)),n+=h,i+=f}3===o&&t.writeVarint(T(7,1))}}function R(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}p.exports=A,p.exports.fromVectorTileJs=A,p.exports.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var o in e)r[o]=new L(e[o].features,t),r[o].name=o,r[o].version=t.version,r[o].extent=t.extent;return A({layers:r})},p.exports.GeoJSONWrapper=L;var M=e.dX(p.exports);const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},O=Math.fround||(D=new Float32Array(1),e=>(D[0]=+e,D[0]));var D;const k=3,N=5,B=6;class F{constructor(e){this.options=Object.assign(Object.create(I),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:o}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const i=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[r,o]=t.geometry.coordinates,n=O(V(r)),a=O(H(o));i.push(n,a,1/0,s,-1,1),this.options.reduce&&i.push(0)}let a=this.trees[o+1]=this._createTree(i);t&&console.timeEnd(n);for(let s=o;s>=r;s--){const e=+Date.now();a=this.trees[s]=this._createTree(this._cluster(a,s)),t&&console.log("z%d: %d clusters in %dms",s,a.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,n=180;else if(r>n){const e=this.getClusters([r,o,180,i],t),a=this.getClusters([-180,o,n,i],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(V(r),H(i),V(n),H(o)),l=a.data,c=[];for(const u of s){const e=this.stride*u;c.push(l[e+N]>1?z(l,e,this.clusterProps):this.points[l[e+k]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),o="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(o);const i=n.data;if(t*this.stride>=i.length)throw new Error(o);const a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=n.within(i[t*this.stride],i[t*this.stride+1],a),l=[];for(const c of s){const t=c*this.stride;i[t+4]===e&&l.push(i[t+N]>1?z(i,t,this.clusterProps):this.points[i[t+k]])}if(0===l.length)throw new Error(o);return l}getLeaves(e,t,r){const o=[];return this._appendLeaves(o,e,t=t||10,r=r||0,0),o}getTile(e,t,r){const o=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:i,radius:a}=this.options,s=a/i,l=(r-s)/n,c=(r+1+s)/n,u={features:[]};return this._addTileFeatures(o.range((t-s)/n,l,(t+1+s)/n,c),o.data,t,r,n,u),0===t&&this._addTileFeatures(o.range(1-s/n,l,1,c),o.data,n,r,n,u),t===n-1&&this._addTileFeatures(o.range(0,l,s/n,c),o.data,-1,r,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,o,n){const i=this.getChildren(t);for(const a of i){const t=a.properties;if(t&&t.cluster?n+t.point_count<=o?n+=t.point_count:n=this._appendLeaves(e,t.cluster_id,r,o,n):n<o?n++:e.push(a),e.length===r)break}return n}_createTree(t){const r=new e.bj(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,o,n,i){for(const a of e){const e=a*this.stride,s=t[e+N]>1;let l,c,u;if(s)l=U(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const r=this.points[t[e+k]];l=r.properties;const[o,n]=r.geometry.coordinates;c=V(o),u=H(n)}const d={type:1,geometry:[[Math.round(this.options.extent*(c*n-r)),Math.round(this.options.extent*(u*n-o))]],tags:l};let h;h=s||this.options.generateId?t[e+k]:this.points[t[e+k]].id,void 0!==h&&(d.id=h),i.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:o,reduce:n,minPoints:i}=this.options,a=r/(o*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=t)continue;s[u+2]=t;const r=s[u],o=s[u+1],d=e.within(s[u],s[u+1],a),h=s[u+N];let f=h;for(const e of d){const r=e*c;s[r+2]>t&&(f+=s[r+N])}if(f>h&&f>=i){let e,i=r*h,a=o*h,m=-1;const p=(u/c<<5)+(t+1)+this.points.length;for(const r of d){const o=r*c;if(s[o+2]<=t)continue;s[o+2]=t;const l=s[o+N];i+=s[o]*l,a+=s[o+1]*l,s[o+4]=p,n&&(e||(e=this._map(s,u,!0),m=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(s,o)))}s[u+4]=p,l.push(i/f,a/f,1/0,p,-1,f),n&&l.push(m)}else{for(let e=0;e<c;e++)l.push(s[u+e]);if(f>1)for(const e of d){const r=e*c;if(!(s[r+2]<=t)){s[r+2]=t;for(let e=0;e<c;e++)l.push(s[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+N]>1){const o=this.clusterProps[e[t+B]];return r?Object.assign({},o):o}const o=this.points[e[t+k]].properties,n=this.options.map(o);return r&&n===o?Object.assign({},n):n}}function z(e,t,r){return{type:"Feature",id:e[t+k],properties:U(e,t,r),geometry:{type:"Point",coordinates:[(o=e[t],360*(o-.5)),G(e[t+1])]}};var o}function U(e,t,r){const o=e[t+N],n=o>=1e4?`${Math.round(o/1e3)}k`:o>=1e3?Math.round(o/100)/10+"k":o,i=e[t+B],a=-1===i?{}:Object.assign({},r[i]);return Object.assign(a,{cluster:!0,cluster_id:e[t+k],point_count:o,point_count_abbreviated:n})}function V(e){return e/360+.5}function H(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function G(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var j={exports:{}};j.exports=function(){function e(r,o,n,i){for(var a,s=i,l=n-o>>1,c=n-o,u=r[o],d=r[o+1],h=r[n],f=r[n+1],m=o+3;m<n;m+=3){var p=t(r[m],r[m+1],u,d,h,f);if(p>s)a=m,s=p;else if(p===s){var g=Math.abs(m-l);g<c&&(a=m,c=g)}}s>i&&(a-o>3&&e(r,o,a,i),r[a+2]=s,n-a>3&&e(r,a,n,i))}function t(e,t,r,o,n,i){var a=n-r,s=i-o;if(0!==a||0!==s){var l=((e-r)*a+(t-o)*s)/(a*a+s*s);l>1?(r=n,o=i):l>0&&(r+=a*l,o+=s*l)}return(a=e-r)*a+(s=t-o)*s}function r(e,t,r,n){var i={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)o(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)o(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)o(e,t[n][i])}(i),i}function o(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function n(e,t,o,l){if(t.geometry){var c=t.geometry.coordinates,u=t.geometry.type,d=Math.pow(o.tolerance/((1<<o.maxZoom)*o.extent),2),h=[],f=t.id;if(o.promoteId?f=t.properties[o.promoteId]:o.generateId&&(f=l||0),"Point"===u)i(c,h);else if("MultiPoint"===u)for(var m=0;m<c.length;m++)i(c[m],h);else if("LineString"===u)a(c,h,d,!1);else if("MultiLineString"===u){if(o.lineMetrics){for(m=0;m<c.length;m++)a(c[m],h=[],d,!1),e.push(r(f,"LineString",h,t.properties));return}s(c,h,d,!1)}else if("Polygon"===u)s(c,h,d,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(m=0;m<t.geometry.geometries.length;m++)n(e,{id:f,geometry:t.geometry.geometries[m],properties:t.properties},o,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(m=0;m<c.length;m++){var p=[];s(c[m],p,d,!0),h.push(p)}}e.push(r(f,u,h,t.properties))}}function i(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function a(t,r,o,n){for(var i,a,s=0,u=0;u<t.length;u++){var d=l(t[u][0]),h=c(t[u][1]);r.push(d),r.push(h),r.push(0),u>0&&(s+=n?(i*h-d*a)/2:Math.sqrt(Math.pow(d-i,2)+Math.pow(h-a,2))),i=d,a=h}var f=r.length-3;r[2]=1,e(r,0,f,o),r[f+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function s(e,t,r,o){for(var n=0;n<e.length;n++){var i=[];a(e[n],i,r,o),t.push(i)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function u(e,t,o,n,i,a,s,l){if(n/=t,a>=(o/=t)&&s<n)return e;if(s<o||a>=n)return null;for(var c=[],u=0;u<e.length;u++){var f=e[u],p=f.geometry,g=f.type,_=0===i?f.minX:f.minY,y=0===i?f.maxX:f.maxY;if(_>=o&&y<n)c.push(f);else if(!(y<o||_>=n)){var v=[];if("Point"===g||"MultiPoint"===g)d(p,v,o,n,i);else if("LineString"===g)h(p,v,o,n,i,!1,l.lineMetrics);else if("MultiLineString"===g)m(p,v,o,n,i,!1);else if("Polygon"===g)m(p,v,o,n,i,!0);else if("MultiPolygon"===g)for(var x=0;x<p.length;x++){var b=[];m(p[x],b,o,n,i,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(r(f.id,g,v[x],f.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(r(f.id,g,v,f.tags))}}}return c.length?c:null}function d(e,t,r,o,n){for(var i=0;i<e.length;i+=3){var a=e[i+n];a>=r&&a<=o&&(t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]))}}function h(e,t,r,o,n,i,a){for(var s,l,c=f(e),u=0===n?g:_,d=e.start,h=0;h<e.length-3;h+=3){var m=e[h],y=e[h+1],v=e[h+2],x=e[h+3],b=e[h+4],L=0===n?m:y,A=0===n?x:b,w=!1;a&&(s=Math.sqrt(Math.pow(m-x,2)+Math.pow(y-b,2))),L<r?A>r&&(l=u(c,m,y,x,b,r),a&&(c.start=d+s*l)):L>o?A<o&&(l=u(c,m,y,x,b,o),a&&(c.start=d+s*l)):p(c,m,y,v),A<r&&L>=r&&(l=u(c,m,y,x,b,r),w=!0),A>o&&L<=o&&(l=u(c,m,y,x,b,o),w=!0),!i&&w&&(a&&(c.end=d+s*l),t.push(c),c=f(e)),a&&(d+=s)}var S=e.length-3;m=e[S],y=e[S+1],v=e[S+2],(L=0===n?m:y)>=r&&L<=o&&p(c,m,y,v),S=c.length-3,i&&S>=3&&(c[S]!==c[0]||c[S+1]!==c[1])&&p(c,c[0],c[1],c[2]),c.length&&t.push(c)}function f(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function m(e,t,r,o,n,i){for(var a=0;a<e.length;a++)h(e[a],t,r,o,n,i,!1)}function p(e,t,r,o){e.push(t),e.push(r),e.push(o)}function g(e,t,r,o,n,i){var a=(i-t)/(o-t);return e.push(i),e.push(r+(n-r)*a),e.push(1),a}function _(e,t,r,o,n,i){var a=(i-r)/(n-r);return e.push(t+(o-t)*a),e.push(i),e.push(1),a}function y(e,t){for(var o=[],n=0;n<e.length;n++){var i,a=e[n],s=a.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=v(a.geometry,t);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var l=0;l<a.geometry.length;l++)i.push(v(a.geometry[l],t))}else if("MultiPolygon"===s)for(i=[],l=0;l<a.geometry.length;l++){for(var c=[],u=0;u<a.geometry[l].length;u++)c.push(v(a.geometry[l][u],t));i.push(c)}o.push(r(a.id,s,i,a.tags))}return o}function v(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var o=0;o<e.length;o+=3)r.push(e[o]+t,e[o+1],e[o+2]);return r}function x(e,t){if(e.transformed)return e;var r,o,n,i=1<<e.z,a=e.x,s=e.y;for(r=0;r<e.features.length;r++){var l=e.features[r],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(o=0;o<c.length;o+=2)l.geometry.push(b(c[o],c[o+1],t,i,a,s));else for(o=0;o<c.length;o++){var d=[];for(n=0;n<c[o].length;n+=2)d.push(b(c[o][n],c[o][n+1],t,i,a,s));l.geometry.push(d)}}return e.transformed=!0,e}function b(e,t,r,o,n,i){return[Math.round(r*(e*o-n)),Math.round(r*(t*o-i))]}function L(e,t,r,o,n){for(var i=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:o,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,A(a,e[s],i,n);var l=e[s].minX,c=e[s].minY,u=e[s].maxX,d=e[s].maxY;l<a.minX&&(a.minX=l),c<a.minY&&(a.minY=c),u>a.maxX&&(a.maxX=u),d>a.maxY&&(a.maxY=d)}return a}function A(e,t,r,o){var n=t.geometry,i=t.type,a=[];if("Point"===i||"MultiPoint"===i)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===i)w(a,n,e,r,!1,!1);else if("MultiLineString"===i||"Polygon"===i)for(s=0;s<n.length;s++)w(a,n[s],e,r,"Polygon"===i,0===s);else if("MultiPolygon"===i)for(var l=0;l<n.length;l++){var c=n[l];for(s=0;s<c.length;s++)w(a,c[s],e,r,!0,0===s)}if(a.length){var u=t.tags||null;if("LineString"===i&&o.lineMetrics){for(var d in u={},t.tags)u[d]=t.tags[d];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var h={geometry:a,type:"Polygon"===i||"MultiPolygon"===i?3:"LineString"===i||"MultiLineString"===i?2:1,tags:u};null!==t.id&&(h.id=t.id),e.features.push(h)}}function w(e,t,r,o,n,i){var a=o*o;if(o>0&&t.size<(n?a:o))r.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===o||t[l+2]>a)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;n&&function(e,t){for(var r=0,o=0,n=e.length,i=n-2;o<n;i=o,o+=2)r+=(e[o]-e[i])*(e[o+1]+e[i+1]);if(r>0===t)for(o=0,n=e.length;o<n/2;o+=2){var a=e[o],s=e[o+1];e[o]=e[n-2-o],e[o+1]=e[n-1-o],e[n-2-o]=a,e[n-1-o]=s}}(s,i),e.push(s)}}function S(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var o=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)n(r,e.features[o],t,o);else n(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=function(e,t){var r=t.buffer/t.extent,o=e,n=u(e,1,-1-r,r,0,-1,2,t),i=u(e,1,1-r,2+r,0,-1,2,t);return(n||i)&&(o=u(e,1,-r,1+r,0,-1,2,t)||[],n&&(o=y(n,1).concat(o)),i&&(o=o.concat(y(i,-1)))),o}(o,t)).length&&this.splitTile(o,0,0,0),r&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function E(e,t,r){return 32*((1<<e)*r+t)+e}return S.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},S.prototype.splitTile=function(e,t,r,o,n,i,a){for(var s=[e,t,r,o],l=this.options,c=l.debug;s.length;){o=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var d=1<<t,h=E(t,r,o),f=this.tiles[h];if(!f&&(c>1&&console.time("creation"),f=this.tiles[h]=L(e,t,r,o,l),this.tileCoords.push({z:t,x:r,y:o}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,o,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var m="z"+t;this.stats[m]=(this.stats[m]||0)+1,this.total++}if(f.source=e,n){if(t===l.maxZoom||t===n)continue;var p=1<<n-t;if(r!==Math.floor(i/p)||o!==Math.floor(a/p))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){c>1&&console.time("clipping");var g,_,y,v,x,b,A=.5*l.buffer/l.extent,w=.5-A,S=.5+A,T=1+A;g=_=y=v=null,x=u(e,d,r-A,r+S,0,f.minX,f.maxX,l),b=u(e,d,r+w,r+T,0,f.minX,f.maxX,l),e=null,x&&(g=u(x,d,o-A,o+S,1,f.minY,f.maxY,l),_=u(x,d,o+w,o+T,1,f.minY,f.maxY,l),x=null),b&&(y=u(b,d,o-A,o+S,1,f.minY,f.maxY,l),v=u(b,d,o+w,o+T,1,f.minY,f.maxY,l),b=null),c>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*r,2*o),s.push(_||[],t+1,2*r,2*o+1),s.push(y||[],t+1,2*r+1,2*o),s.push(v||[],t+1,2*r+1,2*o+1)}}},S.prototype.getTile=function(e,t,r){var o=this.options,n=o.extent,i=o.debug;if(e<0||e>24)return null;var a=1<<e,s=E(e,t=(t%a+a)%a,r);if(this.tiles[s])return x(this.tiles[s],n);i>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l,c=e,u=t,d=r;!l&&c>0;)c--,u=Math.floor(u/2),d=Math.floor(d/2),l=this.tiles[E(c,u,d)];return l&&l.source?(i>1&&console.log("found parent tile z%d-%d-%d",c,u,d),i>1&&console.time("drilling down"),this.splitTile(l.source,c,u,d,e,t,r),i>1&&console.timeEnd("drilling down"),this.tiles[s]?x(this.tiles[s],n):null):null},function(e,t){return new S(e,t)}}();var W=e.dX(j.exports);function K(e,t){const r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const o=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!o)return t(null,null);const n=new m(o.features);let i=M(n);0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),t(null,{vectorTile:n,rawData:i.buffer})}class J extends c{constructor(e,t,r,o,n,i){super(e,t,r,o,K,i),n&&(this.loadGeoJSON=n),this._featureMap=new Map}loadData(r,o){const n=r&&r.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(r,((a,s)=>{if(a||!s)return o(a);if("object"!=typeof s)return o(new Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));{try{if(r.filter){const t=e.t(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s.features=s.features.filter((e=>t.value.evaluate({zoom:0},e)))}if(r.dynamic){"Feature"===s.type&&(s={type:"FeatureCollection",features:[s]}),r.append||this._featureMap.clear();for(const e of s.features||[]){const t=e.id;void 0!==t&&(e.geometry?this._featureMap.set(t,e):this._featureMap.delete(t))}s.features=[...this._featureMap.values()]}this._geoJSONIndex=r.cluster?new F(function(t){let{superclusterOptions:r,clusterProperties:o}=t;if(!o||!r)return r;const n={},i={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(o);for(const c of l){const[t,r]=o[c],a=e.t(r),s=e.t("string"==typeof t?[t,["accumulated"],["get",c]]:t);n[c]=a.value,i[c]=s.value}return r.map=e=>{s.properties=e;const t={};for(const r of l)t[r]=n[r].evaluate(a,s);return t},r.reduce=(e,t)=>{s.properties=t;for(const r of l)a.accumulated=e[r],e[r]=i[r].evaluate(a,s)},r}(r)).load(s.features):W(s,r.geojsonVtOptions)}catch(a){return o(a)}this.loaded={};const l={};if(i){const e=t(n);e&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(e)))}o(null,l)}}))}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.g(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Z{constructor(t,r){this.tileID=new e.ap(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=r}parse(t,r,o,n){this.status="parsing";const i=new e.ap(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),a={},s=r.familiesBySource[o.source],l=new e.dL(i,o.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.dY(t).then((t=>{if(!t)return n(new Error("Could not parse tile"));const r=e.dZ(t,1/e.bU(o.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,u=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),d=new e.N(this.zoom,{brightness:this.brightness});for(const o in s)for(const t of s[o]){const o=t[0];l.bucketLayerIDs.push(t.map((e=>e.id))),o.recalculate(d,[]);const n=new e.d_(r,i,c,u,this.brightness,l);c||(n.needsUpload=!0),a[o.fqid]=n,n.evaluate(o)}this.status="done",n(null,{buckets:a,featureIndex:l})})).catch((e=>n(new Error(e.message))))}}class Y{constructor(e,t,r,o,n,i){this.actor=e,this.layerIndex=t,this.brightness=i,this.loading={},this.loaded={}}loadTile(t,r){const o=t.uid,n=this.loading[o]=new Z(t,this.brightness);e.b1(t.request,((e,i)=>{const a=!this.loading[o];return delete this.loading[o],a||e?(n.status="done",a||(this.loaded[o]=n),r(e)):i&&0!==i.byteLength?void n.parse(i,this.layerIndex,t,((e,t)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[o]=n,e||!t?r(e):r(null,t)})):(n.status="done",this.loaded[o]=n,r())}))}reloadTile(e,t){const r=this.loaded,o=e.uid;if(r&&r[o]){const n=r[o];n.projection=e.projection,n.brightness=e.brightness;const i=(r,o)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(e,t)),t(r,o)};"parsing"===n.status?n.reloadCallback=i:"done"===n.status&&this.loadTile(e,t)}}abortTile(e,t){const r=e.uid;this.loading[r]&&delete this.loading[r],t()}removeTile(e,t){const r=this.loaded,o=e.uid;r&&r[o]&&delete r[o],t()}}class q{constructor(t){this.self=t,this.actor=new e.d$(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.br({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:J,"batched-model":Y},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.e0.isParsed())throw new Error("RTL text plugin already registered.");e.e0.applyArabicShaping=t.applyArabicShaping,e.e0.processBidirectionalText=t.processBidirectionalText,e.e0.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,r){let{scope:o,isLoaded:n}=r;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][o]=n,this.workerSources[t]&&this.workerSources[t][o])for(const i in this.workerSources[t][o]){const r=this.workerSources[t][o][i];for(const t in r)r[t]instanceof c&&(r[t].isSpriteLoaded=n,r[t].fire(new e.b("isSpriteLoaded")))}}setImages(e,t,r){let{scope:o,images:n}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][o]=n,this.workerSources[e]&&this.workerSources[e][o]){for(const t in this.workerSources[e][o]){const r=this.workerSources[e][o][t];for(const e in r)r[e].availableImages=n}r()}else r()}setProjection(t,r){this.projections[t]=e.br(r)}setBrightness(e,t,r){this.brightness=t,r()}setLayers(e,t,r){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),r()}updateLayers(e,t,r){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),r()}loadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,r)}loadDEMTile(e,t,r){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,r)}decodeRasterArray(e,t,r){this.getRasterArrayWorkerSource().decodeRasterArray(t,r)}reloadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,r)}removeSource(e,t,r){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const o=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==o.removeSource?o.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(t,r,o){try{e.e0.setState(r);const t=e.e0.getPluginURL();if(e.e0.isLoaded()&&!e.e0.isParsed()&&null!=t){this.self.importScripts(t);const r=e.e0.isParsed();o(r?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),r)}}catch(e){o(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][t];return r||(r=[]),r}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][t];return r||(r=this.layerIndexes[e][t]=new n,r.scope=t),r}getWorkerSource(e,t,r,o){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][o]||(this.workerSources[e][o]={}),this.workerSources[e][o][t]||(this.workerSources[e][o][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][o][t][r]){const n={send:(t,r,o,n,i,a)=>{this.actor.send(t,r,o,e,i,a)},scheduler:this.actor.scheduler};this.workerSources[e][o][t][r]=new this.workerSourceTypes[t](n,this.getLayerIndex(e,o),this.getAvailableImages(e,o),this.isSpriteLoaded[e][o],void 0,this.brightness)}return this.workerSources[e][o][t][r]}getDEMWorkerSource(e,t,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]={}),this.demWorkerSources[e][r][t]||(this.demWorkerSources[e][r][t]=new u),this.demWorkerSources[e][r][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new d),this.rasterArrayWorkerSource}enforceCacheSizeLimit(t,r){e.e1(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new q(self)),q})),o(["./shared"],(function(e){function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!t(e[o],r[o]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const o in e)if(!t(e[o],r[o]))return!1;return!0}return e===r}var r=o;function o(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(r);try{t=new Worker(o),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(o),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var r=t.getImageData(0,0,1,1);return r&&r.width===e.width}()?(void 0===n[t=e&&e.failIfMajorPerformanceCaveat]&&(n[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(o.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),n[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var n={};function i(e,t,r){const o=document.createElement(e);return null!=t&&(o.className=t),r&&r.appendChild(o),o}function a(e,t,r){const o=document.createElementNS("http://www.w3.org/2000/svg",e);for(const n of Object.keys(t))o.setAttributeNS(null,n,String(t[n]));return r&&r.appendChild(o),o}o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){s&&l&&(c=s[l],s[l]="none")}function d(){s&&l&&(s[l]=c)}function h(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",h,!0)}function f(){window.addEventListener("click",h,!0),window.setTimeout((()=>{window.removeEventListener("click",h,!0)}),0)}function m(e,t){const r=e.getBoundingClientRect();return _(e,r,t)}function p(e,t){const r=e.getBoundingClientRect(),o=[];for(let n=0;n<t.length;n++)o.push(_(e,r,t[n]));return o}function g(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function _(t,r,o){const n=t.offsetWidth===r.width?1:t.offsetWidth/r.width;return new e.P((o.clientX-r.left)*n,(o.clientY-r.top)*n)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class v extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,r){return e.l(this.requestManager.transformRequest(r,e.R.Model).url).then((r=>{if(!r)return;const o=e.c(r),n=new e.M(t,void 0,void 0,o);return n.computeBoundsAndApplyParent(),n})).catch((o=>{if(o&&404===o.status)return null;this.fire(new e.a(new Error(`Could not load model ${t} from ${r}: ${o.message}`)))}))}load(t,r){this.models[r]||(this.models[r]={});const o=Object.keys(t);this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+o.length;const n=[];for(const e of o)n.push(this.loadModel(e,t[e]));Promise.allSettled(n).then((t=>{for(let e=0;e<t.length;e++){const{status:n,value:i}=t[e];"fulfilled"===n&&i&&(this.models[r][o[e]]={model:i,numReferences:1})}this.numModelsLoading[r]-=o.length,this.fire(new e.b("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}addModel(e,t,r){this.models[r]||(this.models[r]={}),this.hasModel(e,r)&&this.models[r][e].numReferences++,this.load({[e]:this.requestManager.normalizeModelURL(t)},r)}addModels(e,t){this.models[t]||(this.models[t]={});const r={};for(const o in e)this.models[t][o]={},r[o]=this.requestManager.normalizeModelURL(e[o]);this.load(r,t)}addModelsFromBucket(e,t){this.models[t]||(this.models[t]={});const r={};for(const o of e)this.hasModel(o,t)?this.models[t][o].numReferences++:r[o]=this.requestManager.normalizeModelURL(o);this.load(r,t)}removeModel(e,t){if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences)){const r=this.models[t][e].model;delete this.models[t][e],r.destroy()}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const r in this.models[t])this.models[t][r].model&&this.models[t][r].model.upload(e.context)}}class x{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,o){const n=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},e.e(this.stateChanges[t][n],o),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])o[e]||(this.deletedStates[t][n][e]=null)}else for(const e in o)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const o=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][o]&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][o])for(r in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][r]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(t,r){const o=String(r),n=e.e({},(this.state[t]||{})[o],(this.stateChanges[t]||{})[o]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][r];if(null===e)return{};for(const t in e)delete n[t]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,r){const o={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const t={};for(const r in this.stateChanges[n])this.state[n][r]||(this.state[n][r]={}),e.e(this.state[n][r],this.stateChanges[n][r]),t[r]=this.state[n][r];o[n]=t}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const t={};if(null===this.deletedStates[n])for(const e in this.state[n])t[e]={},this.state[n][e]={};else for(const e in this.deletedStates[n]){if(null===this.deletedStates[n][e])this.state[n][e]={};else if(this.state[n][e])for(const t of Object.keys(this.deletedStates[n][e]))delete this.state[n][e][t];t[e]=this.state[n][e]}o[n]=o[n]||{},e.e(o[n],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(o).length)for(const e in t)t[e].setFeatureState(o,r)}}function b(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class L extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.h({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:r}of this.requestors)this._notify(e,t,r);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,r){this._validate(e,r)&&(this.images[t][e]=r)}_validate(t,r){let o=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchX" value`))),o=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "stretchY" value`))),o=!1),this._validateContent(r.content,r)||(this.fire(new e.a(new Error(`Image "${t}" has invalid "content" value`))),o=!1),o}_validateStretch(e,t){if(!e)return!0;let r=0;for(const o of e){if(o[0]<r||o[1]<o[0]||t<o[1])return!1;r=o[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,r){r.version=this.images[t][e].version+1,this.images[t][e]=r,this.updatedImages[t][e]=!0}removeImage(e,t){const r=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,r){let o=!0;const n=!!this.loaded[t];if(!n)for(const i of e)this.images[t][i]||(o=!1);n||o?this._notify(e,t,r):this.requestors.push({ids:e,scope:t,callback:r})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,r,o){const n={};for(const i of t){this.images[r][i]||this.fire(new e.b("styleimagemissing",{id:i}));const t=this.images[r][i];t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,n)}getPixelSize(e){const{width:t,height:r}=this.atlasImage[e];return{width:t,height:r}}getPattern(t,r){const o=this.patterns[r][t],n=this.getImage(t,r);if(!n)return null;if(o&&o.position.version===n.version)return o.position;if(o)o.position.version=n.version;else{const o={w:n.data.width+2,h:n.data.height+2,x:0,y:0},i=new e.I(o,n);this.patterns[r][t]={bin:o,position:i}}return this._updatePatternAtlas(r),this.patterns[r][t].position}bind(t,r){const o=t.gl;let n=this.atlasTexture[r];n?this.dirty&&(n.update(this.atlasImage[r]),this.dirty=!1):(n=new e.T(t,this.atlasImage[r],o.RGBA),this.atlasTexture[r]=n),n.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const r=[];for(const e in this.patterns[t])r.push(this.patterns[t][e].bin);const{w:o,h:n}=e.p(r),i=this.atlasImage[t];i.resize({width:o||1,height:n||1});for(const a in this.patterns[t]){const{bin:r}=this.patterns[t][a],o=r.x+1,n=r.y+1,s=this.images[t][a].data,l=s.width,c=s.height;e.h.copy(s,i,{x:0,y:0},{x:o,y:n},{width:l,height:c}),e.h.copy(s,i,{x:0,y:c-1},{x:o,y:n-1},{width:l,height:1}),e.h.copy(s,i,{x:0,y:0},{x:o,y:n+c},{width:l,height:1}),e.h.copy(s,i,{x:l-1,y:0},{x:o-1,y:n},{width:1,height:c}),e.h.copy(s,i,{x:0,y:0},{x:o+l,y:n},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const r of e){if(this.callbackDispatchedThisFrame[t][r])continue;this.callbackDispatchedThisFrame[t][r]=!0;const e=this.images[t][r];b(e)&&this.updateImage(r,t,e)}}}function A(t){const r=t.key,o=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},a=t.style,s=t.styleSpec;let l=[];const c=e.j(o);if("object"!==c)return[new e.V(r,o,`object expected, ${c} found`)];for(const u in o){const t=u.split(".")[0];let c;i[t]?c=i[t]:n[t]?c=W:i["*"]?c=i["*"]:n["*"]&&(c=W),c?l=l.concat(c({key:(r?`${r}.`:r)+u,value:o[u],valueSpec:n[t]||n["*"],style:a,styleSpec:s,object:o,objectKey:u},o)):l.push(new e.i(r,o[u],`unknown property "${u}"`))}for(const u in n)i[u]||n[u].required&&void 0===n[u].default&&void 0===o[u]&&l.push(new e.V(r,o,`missing required property "${u}"`));return l}function w(t){const r=t.value,o=t.valueSpec,n=t.style,i=t.styleSpec,a=t.key,s=t.arrayElementValidator||W;if("array"!==e.j(r))return[new e.V(a,r,`array expected, ${e.j(r)} found`)];if(o.length&&r.length!==o.length)return[new e.V(a,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new e.V(a,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let l={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};i.$version<7&&(l.function=o.function),"object"===e.j(o.value)&&(l=o.value);let c=[];for(let e=0;e<r.length;e++)c=c.concat(s({array:r,arrayIndex:e,value:r[e],valueSpec:l,style:n,styleSpec:i,key:`${a}[${e}]`},!0));return c}function S(t){const r=t.key,o=t.value,n=t.valueSpec;let i=e.j(o);if("number"===i&&o!=o&&(i="NaN"),"number"!==i)return[new e.V(r,o,`number expected, ${i} found`)];if("minimum"in n){let i=n.minimum;if("array"===e.j(n.minimum)&&(i=n.minimum[t.arrayIndex]),o<i)return[new e.V(r,o,`${o} is less than the minimum value ${i}`)]}if("maximum"in n){let i=n.maximum;if("array"===e.j(n.maximum)&&(i=n.maximum[t.arrayIndex]),o>i)return[new e.V(r,o,`${o} is greater than the maximum value ${i}`)]}return[]}function E(t){const r=t.valueSpec,o=e.u(t.value.type);let n,i,a,s={};const l="categorical"!==o&&void 0===t.value.property,c=!l,u="array"===e.j(t.value.stops)&&"array"===e.j(t.value.stops[0])&&"object"===e.j(t.value.stops[0][0]),d=A({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let r=[];const n=t.value;return r=r.concat(w({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===e.j(n)&&0===n.length&&r.push(new e.V(t.key,n,"array must have at least one stop")),r},default:function(e){return W({key:e.key,value:e.value,valueSpec:r,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===o&&l&&d.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||d.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!e.s(t.valueSpec)&&d.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.m(t.valueSpec)?d.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.n(t.valueSpec)&&d.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!u||void 0!==t.value.property||d.push(new e.V(t.key,t.value,'"property" property is required')),d;function h(t){let o=[];const n=t.value,l=t.key;if("array"!==e.j(n))return[new e.V(l,n,`array expected, ${e.j(n)} found`)];if(2!==n.length)return[new e.V(l,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==e.j(n[0]))return[new e.V(l,n,`object expected, ${e.j(n[0])} found`)];if(void 0===n[0].zoom)return[new e.V(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new e.V(l,n,"object stop key must have value")];const r=e.u(n[0].zoom);if("number"!=typeof r)return[new e.V(l,n[0].zoom,"stop zoom values must be numbers")];if(a&&a>r)return[new e.V(l,n[0].zoom,"stop zoom values must appear in ascending order")];r!==a&&(a=r,i=void 0,s={}),o=o.concat(A({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:S,value:f}}))}else o=o.concat(f({key:`${l}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.o(e.q(n[1]))?o.concat([new e.V(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):o.concat(W({key:`${l}[1]`,value:n[1],valueSpec:r,style:t.style,styleSpec:t.styleSpec}))}function f(t,a){const l=e.j(t.value),c=e.u(t.value),u=null!==t.value?t.value:a;if(n){if(l!==n)return[new e.V(t.key,u,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==o){let n=`number expected, ${l} found`;return e.m(r)&&void 0===o&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,n)]}return"categorical"!==o||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==o&&"number"===l&&"number"==typeof c&&"number"==typeof i&&void 0!==i&&c<i?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(i=c,"categorical"===o&&c in s?[new e.V(t.key,u,"stop domain values must be unique")]:(s[c]=!0,[])):[new e.V(t.key,u,`integer expected, found ${String(c)}`)]}}function T(t){const r=("property"===t.expressionContext?e.r:e.t)(e.q(t.value),t.valueSpec);if("error"===r.result)return r.value.map((r=>new e.V(`${t.key}${r.key}`,t.value,r.message)));const o=r.value.expression||r.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!o.outputDefined())return[new e.V(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.v(o))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return P(o,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.x(o,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.y(o))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P(t,r){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)o.delete(e);if(0===o.size)return[];const n=[];return t instanceof e.C&&o.has(t.name)?[new e.V(r.key,r.value,`["${t.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(t.eachChild((e=>{n.push(...P(e,r))})),n)}function C(t){const r=t.key,o=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(e.u(o))&&i.push(new e.V(r,o,`expected one of [${n.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(n.values).indexOf(e.u(o))&&i.push(new e.V(r,o,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(o)} found`)),i}function R(t){return e.A(e.q(t.value))?T(e.k({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):M(t)}function M(t){const r=t.value,o=t.key;if("array"!==e.j(r))return[new e.V(o,r,`array expected, ${e.j(r)} found`)];const n=t.styleSpec;let i,a=[];if(r.length<1)return[new e.V(o,r,"filter array must have at least 1 element")];switch(a=a.concat(C({key:`${o}[0]`,value:r[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===e.u(r[1])&&a.push(new e.V(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&a.push(new e.V(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(i=e.j(r[1]),"string"!==i&&a.push(new e.V(`${o}[1]`,r[1],`string expected, ${i} found`)));for(let s=2;s<r.length;s++)i=e.j(r[s]),"$type"===e.u(r[1])?a=a.concat(C({key:`${o}[${s}]`,value:r[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new e.V(`${o}[${s}]`,r[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let e=1;e<r.length;e++)a=a.concat(M({key:`${o}[${e}]`,value:r[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=e.j(r[1]),2!==r.length?a.push(new e.V(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==i&&a.push(new e.V(`${o}[1]`,r[1],`string expected, ${i} found`))}return a}function I(t,r){const o=t.key,n=t.style,i=t.layer,a=t.styleSpec,s=t.value,l=t.objectKey,c=a[`${r}_${t.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===r&&u&&c[u[1]]&&c[u[1]].transition)return W({key:o,value:s,valueSpec:a.transition,style:n,styleSpec:a});const d=t.valueSpec||c[l];if(!d)return[new e.i(o,s,`unknown property "${l}"`)];let h;if("string"===e.j(s)&&e.m(d)&&!d.tokens&&(h=/^{([^}]+)}$/.exec(s))){const t=`\`{ "type": "identity", "property": ${h?JSON.stringify(h[1]):'"_"'} }\``;return[new e.V(o,s,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const f=[];if("symbol"===t.layerType)"text-field"!==l||!n||n.glyphs||n.imports||f.push(new e.V(o,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.B(e.q(s))&&"identity"===e.u(s.type)&&f.push(new e.V(o,s,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===r&&i&&i.layout&&i.layout.hasOwnProperty("model-id")&&e.m(d)&&(e.D(d)||e.n(d))){const t=e.r(e.q(s),d),r=t.value.expression||t.value._styleExpression.expression;r&&!e.x(r,["measure-light"])&&("model-emissive-strength"===l&&e.y(r)&&e.v(r)||f.push(new e.V(o,s,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return f.concat(W({key:t.key,value:s,valueSpec:d,style:n,styleSpec:a,expressionContext:"property",propertyType:r,propertyKey:l}))}function O(e){return I(e,"paint")}function D(e){return I(e,"layout")}function k(t){let r=[];const o=t.value,n=t.key,i=t.style,a=t.styleSpec;o.type||o.ref||r.push(new e.V(n,o,'either "type" or "ref" is required'));let s=e.u(o.type);const l=e.u(o.ref);if(o.id){const a=e.u(o.id);for(let s=0;s<t.arrayIndex;s++){const t=i.layers[s];e.u(t.id)===a&&r.push(new e.V(n,o.id,`duplicate layer id "${o.id}", previously used at line ${t.id.__line__}`))}}if("ref"in o){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in o&&r.push(new e.V(n,o[t],`"${t}" is prohibited for ref layers`))})),i.layers.forEach((r=>{e.u(r.id)===l&&(t=r)})),t?t.ref?r.push(new e.V(n,o.ref,"ref cannot reference another ref layer")):s=e.u(t.type):"string"==typeof l&&r.push(new e.V(n,o.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(o.source){const t=i.sources&&i.sources[o.source],a=t&&e.u(t.type);t?"vector"===a&&"raster"===s?r.push(new e.V(n,o.source,`layer "${o.id}" requires a raster source`)):"raster"===a&&"raster"!==s?r.push(new e.V(n,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==a||o["source-layer"]?"raster-dem"===a&&"hillshade"!==s?r.push(new e.V(n,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==a||["raster","raster-particle"].includes(s)?"line"!==s||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||"geojson"===a&&t.lineMetrics?"raster-particle"===s&&"raster-array"!==a&&r.push(new e.V(n,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):r.push(new e.V(n,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new e.V(n,o.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new e.V(n,o,`layer "${o.id}" must specify a "source-layer"`)):r.push(new e.V(n,o.source,`source "${o.source}" not found`))}else r.push(new e.V(n,o,'missing required property "source"'));return r=r.concat(A({key:n,value:o,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>W({key:`${n}.type`,value:o.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:o,objectKey:"type"}),filter:t=>R(e.k({layerType:s},t)),layout:t=>A({layer:o,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>D(e.k({layerType:s},t))}}),paint:t=>A({layer:o,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>O(e.k({layerType:s,layer:o},t))}})}})),r}function N(t){const r=t.value,o=t.key,n=e.j(r);return"string"!==n?[new e.V(o,r,`string expected, ${n} found`)]:[]}const B={promoteId:function(t){let{key:r,value:o}=t;if("string"===e.j(o))return N({key:r,value:o});{const e=[];for(const t in o)e.push(...N({key:`${r}.${t}`,value:o[t]}));return e}}};function F(t){const r=t.value,o=t.key,n=t.styleSpec,i=t.style;if(!r.type)return[new e.V(o,r,'"type" is required')];const a=e.u(r.type);let s=[];switch(["vector","raster","raster-dem","raster-array"].includes(a)&&(r.url||r.tiles||s.push(new e.i(o,r,'Either "url" or "tiles" is required.'))),a){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(A({key:o,value:r,valueSpec:n[`source_${a.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:B})),s;case"geojson":if(s=A({key:o,value:r,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:B}),r.cluster)for(const e in r.clusterProperties){const[t,n]=r.clusterProperties[e],i="string"==typeof t?[t,["accumulated"],["get",e]]:t;s.push(...T({key:`${o}.${e}.map`,value:n,expressionContext:"cluster-map"})),s.push(...T({key:`${o}.${e}.reduce`,value:i,expressionContext:"cluster-reduce"}))}return s;case"video":return A({key:o,value:r,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return A({key:o,value:r,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new e.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return C({key:`${o}.type`,value:r.type,valueSpec:{values:z(n)},style:i,styleSpec:n})}}function z(e){return e.source.reduce(((t,r)=>{const o=e[r];return"enum"===o.type.type&&(t=t.concat(Object.keys(o.type.values))),t}),[])}function U(t){const r=t.value,o=t.styleSpec,n=o.light,i=t.style;let a=[];const s=e.j(r);if(void 0===r)return a;if("object"!==s)return a=a.concat([new e.V("light",r,`object expected, ${s} found`)]),a;for(const l in r){const t=l.match(/^(.*)-transition$/);a=a.concat(t&&n[t[1]]&&n[t[1]].transition?W({key:l,value:r[l],valueSpec:o.transition,style:i,styleSpec:o}):n[l]?W({key:l,value:r[l],valueSpec:n[l],style:i,styleSpec:o}):[new e.V(l,r[l],`unknown property "${l}"`)])}return a}function V(t){const r=t.value;let o=[];if(!r)return o;const n=e.j(r);if("object"!==n)return o=o.concat([new e.V("light-3d",r,`object expected, ${n} found`)]),o;const i=t.styleSpec,a=i["light-3d"],s=t.key,l=t.style,c=t.style.lights;for(const h of["type","id"])if(!(h in r))return o=o.concat([new e.V("light-3d",r,`missing property ${h} on light`)]),o;if(r.type&&c)for(let h=0;h<t.arrayIndex;h++){const t=e.u(r.type),n=c[h];e.u(n.type)===t&&o.push(new e.V(s,r.id,`duplicate light type "${r.type}", previously defined at line ${n.id.__line__}`))}const u=`properties_light_${r.type}`;if(!(u in i))return o=o.concat([new e.V("light-3d",r,`Invalid light type ${r.type}`)]),o;const d=i[u];for(const h in r)if("properties"===h){const n=r[h],a=e.j(n);if("object"!==a)return o=o.concat([new e.V("properties",n,`object expected, ${a} found`)]),o;for(const r in n)o=o.concat(d[r]?W({key:r,value:n[r],valueSpec:d[r],style:l,styleSpec:i}):[new e.i(t.key,n[r],`unknown property "${r}"`)])}else{const t=h.match(/^(.*)-transition$/);o=o.concat(t&&a[t[1]]&&a[t[1]].transition?W({key:h,value:r[h],valueSpec:i.transition,style:l,styleSpec:i}):a[h]?W({key:h,value:r[h],valueSpec:a[h],style:l,styleSpec:i}):[new e.i(h,r[h],`unknown property "${h}"`)])}return o}function H(t){const r=t.value,o=t.key,n=t.style,i=t.styleSpec,a=i.terrain;let s=[];const l=e.j(r);if(void 0===r)return s;if("null"===l)return s;if("object"!==l)return s=s.concat([new e.V("terrain",r,`object expected, ${l} found`)]),s;for(const c in r){const t=c.match(/^(.*)-transition$/);s=s.concat(t&&a[t[1]]&&a[t[1]].transition?W({key:c,value:r[c],valueSpec:i.transition,style:n,styleSpec:i}):a[c]?W({key:c,value:r[c],valueSpec:a[c],style:n,styleSpec:i}):[new e.i(c,r[c],`unknown property "${c}"`)])}if(r.source){const t=n.sources&&n.sources[r.source],i=t&&e.u(t.type);t?"raster-dem"!==i&&s.push(new e.V(o,r.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):s.push(new e.V(o,r.source,`source "${r.source}" not found`))}else s.push(new e.V(o,r,'terrain is missing required property "source"'));return s}function G(t){const r=t.value,o=t.style,n=t.styleSpec,i=n.fog;let a=[];const s=e.j(r);if(void 0===r)return a;if("object"!==s)return a=a.concat([new e.V("fog",r,`object expected, ${s} found`)]),a;for(const l in r){const t=l.match(/^(.*)-transition$/);a=a.concat(t&&i[t[1]]&&i[t[1]].transition?W({key:l,value:r[l],valueSpec:n.transition,style:o,styleSpec:n}):i[l]?W({key:l,value:r[l],valueSpec:i[l],style:o,styleSpec:n}):[new e.i(l,r[l],`unknown property "${l}"`)])}return a}const j={"*":()=>[],array:w,boolean:function(t){const r=t.value,o=t.key,n=e.j(r);return"boolean"!==n?[new e.V(o,r,`boolean expected, ${n} found`)]:[]},number:S,color:function(t){const r=t.key,o=t.value,n=e.j(o);return"string"!==n?[new e.V(r,o,`color expected, ${n} found`)]:null===e.z(o)?[new e.V(r,o,`color expected, "${o}" found`)]:[]},enum:C,filter:R,function:E,layer:k,object:A,source:F,model:e.F,light:U,"light-3d":V,terrain:H,fog:G,string:N,formatted:function(e){return 0===N(e).length?[]:T(e)},resolvedImage:function(e){return 0===N(e).length?[]:T(e)},projection:function(t){const r=t.value,o=t.styleSpec,n=o.projection,i=t.style;let a=[];const s=e.j(r);if("object"===s)for(const e in r)a=a.concat(W({key:e,value:r[e],valueSpec:n[e],style:i,styleSpec:o}));else"string"!==s&&(a=a.concat([new e.V("projection",r,`object or string expected, ${s} found`)]));return a},import:function(t){const{value:r,styleSpec:o}=t,{data:n,...i}=r;Object.defineProperty(i,"__line__",{value:r.__line__,enumerable:!1});let a=A(e.k({},t,{value:i,valueSpec:o.import}));return""===e.u(i.id)&&a.push(new e.V(`${t.key}.id`,i,"import id can't be an empty string")),n&&(a=a.concat(J(n,o,{key:`${t.key}.data`}))),a}};function W(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=t.value,n=t.valueSpec,i=t.styleSpec;if(n.expression&&e.B(e.u(o)))return E(t);if(n.expression&&e.o(e.q(o)))return T(t);if(n.type&&j[n.type]){const o=j[n.type](t);return!0===r&&o.length>0&&"array"===e.j(t.value)?T(t):o}return A(e.k({},t,{valueSpec:n.type?i[n.type]:n}))}function K(t){const r=t.value,o=t.key,n=N(t);return n.length||(-1===r.indexOf("{fontstack}")&&n.push(new e.V(o,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&n.push(new e.V(o,r,'"glyphs" url must include a "{range}" token'))),n}function J(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.G;return W({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:r.$root,styleSpec:r,style:t,objectElementValidators:{glyphs:K,"*":()=>[]}})}function Z(t){return ie(J(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.G))}const Y=e=>ie(F(e)),q=e=>ie(U(e)),$=e=>ie(V(e)),X=e=>ie(H(e)),Q=e=>ie(G(e)),ee=e=>ie(k(e)),te=e=>ie(R(e)),re=e=>ie(O(e)),oe=e=>ie(D(e)),ne=t=>ie(e.F(t));function ie(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function ae(t,r){let o=!1;if(r&&r.length)for(const n of r)n instanceof e.i?e.w(n.message):(t.fire(new e.a(new Error(n.message))),o=!0);return o}const se=new e.H({anchor:new e.J(e.G.light.anchor),position:new e.K(e.G.light.position),color:new e.J(e.G.light.color),intensity:new e.J(e.G.light.intensity)});class le extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.L(se),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(q,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,o){return(!o||!1!==o.validate)&&ae(this,t.call(Z,e.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.G})))}}const ce=new e.H({source:new e.J(e.G.terrain.source),exaggeration:new e.J(e.G.terrain.exaggeration)});let ue=class extends e.E{constructor(t,r,o,n){super(),this.scope=o,this._transitionable=new e.L(ce,o,n),this._transitionable.setTransitionOrValue(t,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.N(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.Z}};const de=45,he=65,fe=.05;function me(t,r,o,n){const i=e.S(de,he,o),[a,s]=pe(t,n);let l=1-Math.min(1,Math.exp((r-a)/(s-a)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*i*t.alpha}function pe(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function ge(t,r,o,n,i){const a=e.Q.transformMat4([],[r,o,n],i.mercatorFogMatrix);return me(t,e.Q.length(a),i.pitch,i._fov)}function _e(t,r,o,n,i,a,s){const l=[[o,n,0],[i,n,0],[i,a,0],[o,a,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const d of l){const t=e.Q.transformMat4([],d,r),o=e.Q.length(t);c=Math.min(c,o),u=Math.max(u,o)}return[me(t,c,s.pitch,s._fov),me(t,u,s.pitch,s._fov)]}const ye=new e.H({range:new e.J(e.G.fog.range),color:new e.J(e.G.fog.color),"high-color":new e.J(e.G.fog["high-color"]),"space-color":new e.J(e.G.fog["space-color"]),"horizon-blend":new e.J(e.G.fog["horizon-blend"]),"star-intensity":new e.J(e.G.fog["star-intensity"]),"vertical-range":new e.J(e.G.fog["vertical-range"])});class ve extends e.E{constructor(t,r,o,n){super(),this._transitionable=new e.L(ye,o,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new e.U(ye)}get state(){const t=this._transform,r="globe"===t.projection.name,o=e.W(t.zoom),n=this.properties.get("range"),i=[.5,3];return{range:r?[e.X(i[0],n[0],o),e.X(i[1],n[1],o)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Q,t,o))return;const n=e.e({},t);for(const i of Object.keys(e.G.fog))void 0===n[i]&&(n[i]=e.G.fog[i].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.S(de,he,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(t,r,o){const n=e.O.fromLngLat(r),i=o.elevation?o.elevation.getAtPointOrZero(n):0;return ge(t,n.x,n.y,i,o)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return _e(this.state,r,0,0,e.Y,e.Y,this._transform)}getOpacityForBounds(e,t,r,o,n){return this._transform.projection.supportsFog?_e(this.state,e,t,r,o,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?pe(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const o of r){const r=t.points[o];let n;if(r[2]>=0)n=r;else{const i=t.points[o-4];n=e._(i,r,i[2]/(i[2]-r[2]))}if(ge(this.state,n[0],n[1],0,this._transform)>=fe)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,o){return(!o||!1!==o.validate)&&ae(this,t.call(Z,e.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.G})))}}class xe extends e.E{constructor(t,r,o,n){super(),this.scope=o,this._options=t,this.properties=new e.U(r),this._transitionable=new e.L(r,o,new Map(n)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const be=new e.H({color:new e.J(e.G.properties_light_ambient.color),intensity:new e.J(e.G.properties_light_ambient.intensity)}),Le=new e.H({direction:new e.$(e.G.properties_light_directional.direction),color:new e.J(e.G.properties_light_directional.color),intensity:new e.J(e.G.properties_light_directional.intensity),"cast-shadows":new e.J(e.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.J(e.G.properties_light_directional["shadow-intensity"])});class Ae{constructor(e,t,r,o){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,o)}static createFromScreenPoints(t,r){let o,n;if(t instanceof e.P||"number"==typeof t[0]){const i=e.P.convert(t);o=[i],n=r.isPointAboveHorizon(i)}else{const i=e.P.convert(t[0]),a=e.P.convert(t[1]);o=[i,a],n=e.a0(i,a).every((e=>r.isPointAboveHorizon(e)))}return new Ae(o,r.getCameraPoint(),n,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.a0(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],o=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.a0(r,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<o.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?n[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(n[3]=this.cameraPoint)),e.a1(n,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],o=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.a0(r,o,t),i=this.cameraPoint.clone();switch(3*((i.y>r.y)+(i.y>o.y))+((i.x>r.x)+(i.x>o.x))){case 0:n[0]=i,n[4]=i.clone();break;case 1:n.splice(1,0,i);break;case 2:n[1]=i;break;case 3:n.splice(4,0,i);break;case 5:n.splice(2,0,i);break;case 6:n[3]=i;break;case 7:n.splice(3,0,i);break;case 8:n[2]=i}return n}containsTile(t,r,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=t.queryPadding/r._pixelsPerMercatorPixel+1,a=o?this._bufferedCameraMercator(i,r):this._bufferedScreenMercator(i,r);let s=t.tileID.wrap+(a.unwrapped?n:0);const l=a.polygon.map((r=>e.a2(t.tileTransform,r,s)));if(!e.a3(l,0,0,e.Y,e.Y))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((r=>e.a4(t.tileTransform,r,s))),u=c.map((t=>new e.P(t[0],t[1]))),d=r.getFreeCameraOptions().position||new e.O(0,0,0),h=e.a4(t.tileTransform,d,s),f=c.map((t=>{const r=e.Q.sub(t,t,h);return e.Q.normalize(r,r),new e.a5(h,r)})),m=e.a6(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:f,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(p=e.a7(l),p.min.x=e.ad(p.min.x,0,e.Y),p.min.y=e.ad(p.min.y,0,e.Y),p.max.x=e.ad(p.max.x,0,e.Y),p.max.y=e.ad(p.max.y,0,e.Y),p),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:m};var p}_bufferedScreenMercator(e,t){const r=Ee(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let o;return o="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[r]=o,o}}_bufferedCameraMercator(e,t){const r=Ee(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let o;return o="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[r]=o,o}}_projectAndResample(t,r){const o=function(t,r){const o=e.a9.multiply([],r.pixelMatrix,r.globeMatrix),n=[0,-e.ae,0,1],i=[0,e.ae,0,1],a=[0,0,0,1];e.aa.transformMat4(n,n,o),e.aa.transformMat4(i,i,o),e.aa.transformMat4(a,a,o);const s=new e.P(n[0]/n[3],n[1]/n[3]),l=new e.P(i[0]/i[3],i[1]/i[3]),c=e.ab(t,s)&&n[3]<a[3],u=e.ab(t,l)&&i[3]<a[3];if(!c&&!u)return null;const d=function(e,t,r){for(let o=1;o<e.length;o++){const n=Se(t.pointCoordinate3D(e[o-1]).x),i=Se(t.pointCoordinate3D(e[o]).x);if(r<0){if(n<i)return{idx:o,t:-n/(i-1-n)}}else if(i<n)return{idx:o,t:(1-n)/(i+1-n)}}return null}(t,r,c?-1:1);if(!d)return null;const{idx:h,t:f}=d;let m=h>1?we(t.slice(0,h),r):[],p=h<t.length?we(t.slice(h),r):[];m=m.map((t=>new e.P(Se(t.x),t.y))),p=p.map((t=>new e.P(Se(t.x),t.y)));const g=[...m];0===g.length&&g.push(p[p.length-1]);const _=e.X(g[g.length-1].y,(0===p.length?m[0]:p[0]).y,f);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===p.length?g.push(m[0]):g.push(...p),{polygon:g.map((t=>new e.O(t.x,t.y))),unwrapped:!1}}(t,r);if(o)return o;const n=function(t,r){let o=!1,n=-1/0,i=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,i=e);for(let e=0;e<t.length-1;e++){const r=(i+e)%(t.length-1),n=t[r],a=t[r+1];Math.abs(n.x-a.x)>.5&&(n.x<a.x?(n.x+=1,0===r&&(t[t.length-1].x+=1)):(a.x+=1,r+1===t.length-1&&(t[0].x+=1)),o=!0)}const a=e.a8(r.center.lng);return o&&a<Math.abs(a-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:o}}(we(t,r).map((t=>new e.P(Se(t.x),t.y))),r);return{polygon:n.polygon.map((t=>new e.O(t.x,t.y))),unwrapped:n.unwrapped}}}function we(t,r){return e.ac(t,(e=>{const t=r.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Se(e){return e<0?1+e%1:e%1}function Ee(e){return 100*e|0}function Te(t,r,o,n,i){const a=function(o,n){if(o)return i(o);if(n){t.url&&n.tiles&&t.tiles&&delete t.tiles;const o=e.af(e.e(n,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(o.vectorLayers=n.vector_layers,o.vectorLayerIds=o.vectorLayers.map((e=>e.id))),n.raster_layers&&(o.rasterLayers=n.raster_layers,o.rasterLayerIds=o.rasterLayers.map((e=>e.id))),o.tiles=r.canonicalizeTileset(o,t.url),i(null,o)}};return t.url?e.g(r.transformRequest(r.normalizeSourceURL(t.url,null,o,n),e.R.Source),a):e.f.frame((()=>a(null,t)))}class Pe{constructor(t,r,o){this.bounds=e.ag.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=o||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),o=Math.floor(e.a8(this.bounds.getWest())*r),n=Math.floor(e.ah(this.bounds.getNorth())*r),i=Math.ceil(e.a8(this.bounds.getEast())*r),a=Math.ceil(e.ah(this.bounds.getSouth())*r);return t.x>=o&&t.x<i&&t.y>=n&&t.y<a}}class Ce extends e.E{constructor(t,r,o,n){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.af(r,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.ai}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=Te(this._options,this.map._requestManager,r,o,((n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new e.a(n))):i&&(e.e(this,i),i.bounds&&(this.tileBounds=new Pe(i.bounds,this.minzoom,this.maxzoom)),e.am(i.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aj(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}loadTile(t,r){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(o,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",n,i.bind(this));else if(t.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,i.bind(this),void 0,!0);else{const r=e.ak.call({deduped:this._deduped},n,((e,r)=>{e||!r?i.call(this,e):(n.data={cacheControl:r.cacheControl,expires:r.expires,rawData:r.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,i.bind(this),void 0,!0))}),!0);t.request={cancel:r}}function i(o,n){return delete t.request,t.aborted?r(null):o&&404!==o.status?r(o):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.al(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Re extends e.E{constructor(t,r,o,n){super(),this.id=t,this.dispatcher=o,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},r),e.e(this,e.af(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Te(this._options,this.map._requestManager,null,null,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new e.a(r)):o&&(e.e(this,o),o.bounds&&(this.tileBounds=new Pe(o.bounds,this.minzoom,this.maxzoom)),e.am(o.tiles),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aj(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,r){const o=e.f.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);t.request=e.d(this.map._requestManager.transformRequest(n,e.R.Tile),((o,n,i,a)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):o?(t.state="errored",r(o)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:i,expires:a}),t.setTexture(n,this.map.painter),t.state="loaded",e.al(this.dispatcher),void r(null)):r(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(t,r){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Me extends Re{constructor(t,r,o,n){super(t,r,o,n),this.type="raster-array",this.maxzoom=22,this._options=e.e({type:"raster-array"},r)}triggerRepaint(e){const t=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);t&&t.enabled&&r&&t._clearRenderCacheForTile(r.id,e.tileID),this.map.triggerRepaint()}loadTile(t,r){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(o,e.R.Tile);t.requestParams=n,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,((e,o,n,i)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(e){if(20===e.code)return;return t.state="errored",r(e)}this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:i}),t.state="empty",r(null)}))}unloadTile(t){const r=t.texture;r&&r instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(r)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,o){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(r,o,((r,o)=>{if(r)return t.state="errored",this.fire(new e.a(r)),void this.triggerRepaint(t);o&&(t.setTexture(o,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((t=>{let{id:r}=t;return r===e})),r=t&&t.fields,o=r&&r.bands&&r.bands;return o?o[0]:0}getTextureDescriptor(t,r,o){if(!t)return;const n=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let i=null;r instanceof e.aq?i=r.paint.get("raster-array-band"):r instanceof e.ar&&(i=r.paint.get("raster-particle-array-band"));const a=i||this.getInitialBand(n);if(null!=a)if(t.textureDescriptor){if(!t.updateNeeded(n,a)||o)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,a)}}const Ie=32,Oe=33,De=new Uint16Array(8184);for(let ys=0;ys<2046;ys++){let e=ys+2,t=0,r=0,o=0,n=0,i=0,a=0;for(1&e?o=n=i=Ie:t=r=a=Ie;(e>>=1)>1;){const s=t+o>>1,l=r+n>>1;1&e?(o=t,n=r,t=i,r=a):(t=o,r=n,o=i,n=a),i=s,a=l}const s=4*ys;De[s+0]=t,De[s+1]=r,De[s+2]=o,De[s+3]=n}const ke=new Uint16Array(2178),Ne=new Uint8Array(1089),Be=new Uint16Array(1089);function Fe(e){return 0===e?-.03125:32===e?.03125:0}class ze{constructor(e,t,r,o){this.id=ze.uniqueIdxCounter,ze.uniqueIdxCounter++,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||o||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=ze.uniqueIdxCounter,ze.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ze.uniqueIdxCounter=0;const Ue={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ve{constructor(e,t,r,o,n,i){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=o,this.instanceCount=i,this.context=e;const a=e.gl;this.buffer=a.createBuffer(),e.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){const o=t.attributes[this.attributes[r].name];void 0!==o&&e.enableVertexAttribArray(o)}}setVertexAttribPointers(e,t,r){for(let o=0;o<this.attributes.length;o++){const n=this.attributes[o],i=t.attributes[n.name];void 0!==i&&e.vertexAttribPointer(i,n.components,e[Ue[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,t,r){for(let o=0;o<this.attributes.length;o++){const n=t.attributes[this.attributes[o].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(n,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class He{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ge extends He{getDefault(){return e.aA.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class je extends He{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class We extends He{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ke extends He{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Je extends He{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ze extends He{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ye extends He{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class qe extends He{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class $e extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Xe extends He{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Qe extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class et extends He{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class tt extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class rt extends He{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ot extends He{getDefault(){return e.aA.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nt extends He{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class it extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class at extends He{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class st extends He{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let lt=class extends He{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ct extends He{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ut extends He{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class dt extends He{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ht extends He{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ft extends He{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class mt extends He{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class pt extends He{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class gt extends He{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class _t extends He{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class yt extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class vt extends He{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class xt extends He{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class bt extends xt{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Lt extends xt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class At extends xt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class wt extends Lt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class St{constructor(e,t,r,o,n){this.context=e,this.width=t,this.height=r;const i=this.framebuffer=e.gl.createFramebuffer();o&&(this.colorAttachment=new bt(e,i)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new Lt(e,i):new At(e,i))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Et{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);const Tt=7680;class Pt{constructor(e,t,r,o,n,i){this.test=e,this.ref=t,this.mask=r,this.fail=o,this.depthFail=n,this.pass=i}}Pt.disabled=new Pt({func:519,mask:0},0,0,Tt,Tt,Tt);const Ct=771;class Rt{constructor(e,t,r,o){this.blendFunction=e,this.blendColor=t,this.mask=r,this.blendEquation=o}}Rt.Replace=[1,0,1,0],Rt.disabled=new Rt(Rt.Replace,e.aA.transparent,[!1,!1,!1,!1]),Rt.unblended=new Rt(Rt.Replace,e.aA.transparent,[!0,!0,!0,!0]),Rt.alphaBlended=new Rt([1,Ct,1,Ct],e.aA.transparent,[!0,!0,!0,!0]),Rt.multiply=new Rt([774,0,774,0],e.aA.transparent,[!0,!0,!0,!0]);const Mt=1029,It=2305;class Ot{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}Ot.disabled=new Ot(!1,Mt,It),Ot.backCCW=new Ot(!0,Mt,It),Ot.backCW=new Ot(!0,Mt,2304),Ot.frontCW=new Ot(!0,1028,2304),Ot.frontCCW=new Ot(!0,1028,It);class Dt{constructor(e,t){this.gl=e,this.clearColor=new Ge(this),this.clearDepth=new je(this),this.clearStencil=new We(this),this.colorMask=new Ke(this),this.depthMask=new Je(this),this.stencilMask=new Ze(this),this.stencilFunc=new Ye(this),this.stencilOp=new qe(this),this.stencilTest=new $e(this),this.depthRange=new Xe(this),this.depthTest=new Qe(this),this.depthFunc=new et(this),this.blend=new tt(this),this.blendFunc=new rt(this),this.blendColor=new ot(this),this.blendEquation=new nt(this),this.cullFace=new it(this),this.cullFaceSide=new at(this),this.frontFace=new st(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ut(this),this.bindFramebuffer=new dt(this),this.bindRenderbuffer=new ht(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new pt(this),this.bindVertexArrayOES=new gt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new vt(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,r){return new ze(this,e,t,r)}createVertexBuffer(e,t,r,o,n){return new Ve(this,e,t,r,o,n)}createRenderbuffer(e,t,r){const o=this.gl,n=o.createRenderbuffer();return this.bindRenderbuffer.set(n),o.renderbufferStorage(o.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,r,o){return new St(this,e,t,r,o)}clear(e){let{color:t,depth:r,stencil:o,colorMask:n}=e;const i=this.gl;let a=0;t&&(a|=i.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==r&&(a|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==o&&(a|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(o),this.stencilMask.set(255)),i.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t(e.blendFunction,Rt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var kt=e.aB([{name:"a_index",type:"Int16",components:1}]);const Nt=.15000000000000002;class Bt{constructor(t,r,o,n){const i={width:o[0],height:o[1],data:null},a=t.gl;this.targetColorTexture=new e.T(t,i,a.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,i,a.RGBA,{useMipmap:!1}),this.context=t,this.setParticleTextureDimension(r,n),this.lastInvalidatedAt=0}setParticleTextureDimension(t,r){if(this.particleTextureDimension===r)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const o=this.context.gl,n=r*r,i=new Uint8Array(4*n),a=.7692307692307692,s=e.aC(t.key);for(let e=0;e<i.length;e+=4){const t=a*(s()+Nt),r=a*(s()+Nt),o=255*t%1,n=255*r%1,l=o,c=r-n/255,u=n;i[e+0]=Math.floor(255*(t-o/255)),i[e+1]=Math.floor(255*l),i[e+2]=Math.floor(255*c),i[e+3]=Math.floor(255*u)}const l=new e.h({width:r,height:r},i);this.particleTexture0=new e.T(this.context,l,o.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,l,o.RGBA,{premultiply:!1,useMipmap:!1});const c=new e.aD;c.reserve(n);for(let e=0;e<n;e++)c.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(c,kt.members,!0),this.particleSegment=e.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}const Ft={type:2,extent:e.Y,loadGeometry:()=>[[new e.P(0,0),new e.P(e.Y+1,0),new e.P(e.Y+1,e.Y+1),new e.P(0,e.Y+1),new e.P(0,0)]]};class zt{constructor(t,r,o,n,i){this.tileID=t,this.uid=e.aF(),this.uses=0,this.tileSize=r,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<e.f.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,o){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const r={};if(!t)return r;for(const o of e){const e=o.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){o.layers=e,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)r[t.fqid]=o}}return r}(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.aH){if(this.hasSymbolBuckets=!0,!o)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.aH&&r.hasRTLText){this.hasRTLText=!0,e.aI();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],o=r.style.getOwnLayer(e);if(!o)continue;const n=o.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.aG}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const r=this.buckets[e];r.uploadPending()&&r.upload(t)}const r=t.gl,o=this.imageAtlas;if(o&&!o.uploaded){const n=!!Object.keys(o.patternPositions).length;this.imageAtlasTexture=new e.T(t,o.image,r.RGBA,{useMipmap:n}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const o=t.style.getBrightness();(this._lastUpdatedBrightness||o)&&(this._lastUpdatedBrightness&&o&&Math.abs(this._lastUpdatedBrightness-o)<.001||(this._lastUpdatedBrightness=o,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,r,o,n,i,a,s){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:o,pixelPosMatrix:a,transform:i,params:n,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(t,r){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const n=o.loadVTLayers(),i=r?r.sourceLayer:"",a=n._geojsonTileLayer||n[i];if(!a)return;const s=e.aJ(r&&r.filter),{z:l,x:c,y:u}=this.tileID.canonical,d={z:l,x:c,y:u};for(let h=0;h<a.length;h++){const r=a.feature(h);if(s.needGeometry){const t=e.aK(r,!0);if(!s.filter(new e.N(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new e.N(this.tileID.overscaledZ),r))continue;const n=o.getId(r,i),f=new e.aL(r,l,c,u,n);f.tile=d,t.push(f)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=e.aM(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(r)if(this.expirationTime<r)t=!0;else{const o=this.expirationTime-r;o?this.expirationTime=e+Math.max(o,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(t,r){if(!this.latestFeatureIndex)return;const o=this.latestFeatureIndex.loadVTLayers(),n=r.style.listImages(),i=r.style.getBrightness();for(const a in this.buckets){if(!r.style.hasLayer(a))continue;const s=this.buckets[a],l=s.layers[0].sourceLayer||"_geojsonTileLayer",c=o[l];let u={};if(t&&(u=t[l],!c||!u||0===Object.keys(u).length))continue;if(s.update(u,c,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},i),s instanceof e.aN||s instanceof e.aO){const e=r.style.getOwnSourceCache(s.layers[0].source);r._terrain&&r._terrain.enabled&&e&&s.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(e.id,this.tileID)}const d=r&&r.style&&r.style.getOwnLayer(a);d&&(this.queryPadding=Math.max(this.queryPadding,d.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.f.now()+t}setTexture(t,r){const o=r.context,n=o.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!0}):(this.texture=new e.T(o,t,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const r={};for(const o of t)r[o]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const o=e.aP(Ft,this.tileID.canonical,this.tileTransform)[0],n=new e.aQ,i=new e.aR;for(let e=0;e<o.length;e++){const{x:t,y:r}=o[e];n.emplaceBack(t,r),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(i),this._tileDebugBuffer=t.createVertexBuffer(n,e.aS.members),this._tileDebugSegments=e.aE.simpleSegment(0,0,n.length,i.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const o=e.aP(Ft,this.tileID.canonical,this.tileTransform)[0];let n,i;if(this.isRaster){const t=function(t,r){const o=e.av(t,r),n=Math.pow(2,t.z);for(let u=0;u<Oe;u++)for(let i=0;i<Oe;i++){const a=e.aw((t.x+(i+Fe(i))/Ie)/n),s=e.ax((t.y+(u+Fe(u))/Ie)/n),l=r.project(a,s),c=u*Oe+i;ke[2*c+0]=Math.round((l.x*o.scale-o.x)*e.Y),ke[2*c+1]=Math.round((l.y*o.scale-o.y)*e.Y)}Ne.fill(0),Be.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=De[t+0],o=De[t+1],n=De[t+2],i=De[t+3],a=r+n>>1,s=o+i>>1,l=a+s-o,c=s+r-a,u=o*Oe+r,d=i*Oe+n,h=s*Oe+a,f=Math.hypot((ke[2*u+0]+ke[2*d+0])/2-ke[2*h+0],(ke[2*u+1]+ke[2*d+1])/2-ke[2*h+1])>=16;Ne[h]=Ne[h]||(f?1:0),e<1022&&(Ne[h]=Ne[h]||Ne[(o+c>>1)*Oe+(r+l>>1)]||Ne[(i+c>>1)*Oe+(n+l>>1)])}const i=new e.ay,a=new e.az;let s=0;function l(t,r){const o=r*Oe+t;return 0===Be[o]&&(i.emplaceBack(ke[2*o+0],ke[2*o+1],t*e.Y/Ie,r*e.Y/Ie),Be[o]=++s),Be[o]-1}function c(e,t,r,o,n,i){const s=e+r>>1,u=t+o>>1;if(Math.abs(e-n)+Math.abs(t-i)>1&&Ne[u*Oe+s])c(n,i,e,t,s,u),c(r,o,n,i,s,u);else{const s=l(e,t),c=l(r,o),u=l(n,i);a.emplaceBack(s,c,u)}}return c(0,0,Ie,Ie,Ie,0),c(Ie,Ie,0,0,0,Ie),{vertices:i,indices:a}}(this.tileID.canonical,r);n=t.vertices,i=t.indices}else{n=new e.ay,i=new e.az;for(const{x:e,y:r}of o)n.emplaceBack(e,r,0,0);const t=e.aT(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)i.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,e.aU.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(i),this._tileBoundsSegments=e.aE.simpleSegment(0,0,n.length,i.length)}_makeGlobeTileDebugBuffers(t,r){const o=r.projection;if(!o||"globe"!==o.name||r.freezeTileCoverage)return;const n=this.tileID.canonical,i=e.aV(n,r),a=e.aW(i),s=e.W(r.zoom);let l;s>0&&(l=e.a9.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,r,a,l,s),this._makeGlobeTileDebugTextBuffer(t,n,r,a,l,s)}_globePoint(t,r,o,n,i,a,s){let l=e.aX(t,r,o);if(a){const i=1<<o.z,c=e.a8(n.center.lng),u=e.ah(n.center.lat),d=(o.x+.5)/i-c;let h=0;d>.5?h=-1:d<-.5&&(h=1);let f=(t/e.Y+o.x)/i+h,m=(r/e.Y+o.y)/i;f=(f-c)*n._pixelsPerMercatorPixel+c,m=(m-u)*n._pixelsPerMercatorPixel+u;const p=[f*n.worldSize,m*n.worldSize,0];e.Q.transformMat4(p,p,a),l=e.aY(l,p,s)}return e.Q.transformMat4(l,l,i)}_makeGlobeTileDebugBorderBuffer(t,r,o,n,i,a){const s=new e.aQ,l=new e.aR,c=new e.aZ,u=(e,t,u,d,h)=>{const f=(u-e)/(h-1),m=(d-t)/(h-1),p=s.length;for(let g=0;g<h;g++){const u=e+g*f,d=t+g*m;s.emplaceBack(u,d);const h=this._globePoint(u,d,r,o,n,i,a);c.emplaceBack(h[0],h[1],h[2]),l.emplaceBack(p+g)}},d=e.Y;u(0,0,d,0,16),u(d,0,d,d,16),u(d,d,0,d,16),u(0,d,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(s,e.aS.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.a_.members),this._tileDebugSegments=e.aE.simpleSegment(0,0,s.length,l.length)}_makeGlobeTileDebugTextBuffer(t,r,o,n,i,a){const s=e.Y/4,l=new e.aQ,c=new e.az,u=new e.aZ,d=25;c.reserve(32),l.reserve(d),u.reserve(d);const h=(e,t)=>d*e+t;for(let e=0;e<d;e++){const t=e*s;for(let e=0;e<d;e++){const c=e*s;l.emplaceBack(c,t);const d=this._globePoint(c,t,r,o,n,i,a);u.emplaceBack(d[0],d[1],d[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=h(e,t),o=h(e,t+1),n=h(e+1,t),i=h(e+1,t+1);c.emplaceBack(r,o,n),c.emplaceBack(n,o,i)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.aS.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.a_.members),this._tileDebugTextSegments=e.aE.simpleSegment(0,0,d,32)}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Ut={vector:Ce,raster:Re,"raster-dem":class extends Re{constructor(t,r,o,n){super(t,r,o,n),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(t,r){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,o){e&&(t.state="errored",r(e)),o&&(t.dem=o,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",r(null))}t.request=e.d(this.map._requestManager.transformRequest(o,e.R.Tile),function(o,i,a,s){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(o)t.state="errored",r(o);else if(i){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:s});const r=ImageBitmap&&i instanceof ImageBitmap&&e.an(),o=1-(i.width-e.ao(i.width))/2;o<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=r?i:e.f.getImageData(i,o),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:o};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const r=t.canonical,o=Math.pow(2,r.z),n=(r.x-1+o)%o,i=0===r.x?t.wrap-1:t.wrap,a=(r.x+1+o)%o,s=r.x+1===o?t.wrap+1:t.wrap,l={};return l[new e.ap(t.overscaledZ,i,r.z,n,r.y).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new e.ap(t.overscaledZ,i,r.z,n,r.y-1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<o&&(l[new e.ap(t.overscaledZ,i,r.z,n,r.y+1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l}},"raster-array":Me,geojson:class extends e.E{constructor(t,r,o,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(n),this._data=r.data,this._options=e.e({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const i=e.Y/this.tileSize;this.workerOptions=e.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*i,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*i,extent:e.Y,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.Y,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*i,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){return this._options.dynamic?(this._data=t,this._updateWorkerData(!0),this):this.fire(new e.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},o),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.b("dataloading",{dataType:"source"})),this._loaded=!1;const r=e.e({append:t},this.workerOptions);r.scope=this.scope;const o=this._data;"string"==typeof o?(r.request=this.map._requestManager.transformRequest(e.f.resolveURL(o),e.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,((r,o)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new e.a(r));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&o&&o.resourceTiming&&o.resourceTiming[this.id]&&(t.resourceTiming=o.resourceTiming[this.id]),this.fire(new e.b("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,r){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const n={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(o,n,((e,n)=>(delete t.request,t.destroy(),t.aborted?r(null):e?r(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===o),r(null)))),void 0,"loadTile"===o)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.as{constructor(e,t,r,o){super(e,t,r,o),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,e.R.Source).url);e.at(this.urls,((t,r)=>{this._loaded=!0,t?this.fire(new e.a(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new e.a(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.as,model:class extends e.E{constructor(e,t,r,o){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const r in this._options.models){const o=this._options.models[r],n=e.l(this.map._requestManager.transformRequest(o.uri,e.R.Model).url).then((t=>{if(!t)return;const n=e.c(t),i=new e.M(r,o.position,o.orientation,n);i.computeBoundsAndApplyParent(),this.models.push(i)})).catch((t=>{this.fire(new e.a(new Error(`Could not load model ${r} from ${o.uri}: ${t.message}`)))}));t.push(n)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.a(new Error(`Could not load models: ${t.message}`)))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,r,o){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(o)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=Te(this._options,this.map._requestManager,r,o,((n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new e.a(n))):i&&(e.e(this,i),i.bounds&&(this.tileBounds=new Pe(i.bounds,this.minzoom,this.maxzoom)),e.am(i.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,r){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(o,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=r;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",n,i.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,i.bind(this),void 0,!0);function i(e,o){return t.aborted?r(null):e&&404!==e.status?r(e):(o&&(o.resourceTiming&&(t.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(o),t.buckets={...t.buckets,...o.buckets},o.featureIndex&&(t.latestFeatureIndex=o.featureIndex)),t.state="loaded",void r(null))}}serialize(){return e.e({},this._options)}},canvas:class extends e.as{constructor(t,r,o,n){super(t,r,o,n),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.a(new e.V(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.a(new e.V(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.a(new e.V(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.a(new e.V(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.a(new e.V(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,r,o,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=r,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pe(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),e.e(this,e.af(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:o}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:o})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:r,y:o,z:n}=e.tileID.canonical,i=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:o,z:n},{signal:i.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===r?(e.state="errored",t(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((r=>{20!==r.code&&(e.state="errored",t(r))})),e.request.cancel=()=>i.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(t,r){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:r,z:o}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:r,z:o})}r()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.aj(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}}},Vt=function(t,r,o,n){const i=new Ut[r.type](t,r,o,n);if(i.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${i.id}`);return e.a$(["load","abort","unload","serialize","prepare"],i),i};function Ht(t,r){const o=e.a9.identity([]);return e.a9.scale(o,o,[.5*t.width,.5*-t.height,1]),e.a9.translate(o,o,[1,-1,0]),e.a9.multiply(o,o,t.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(o)}function Gt(e,t,r,o,n,i,a){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(o,a,s);l.sort(Wt);const c=[];for(const d of l)c.push({wrappedTileID:d.tile.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(t,r,e._state,d,n,i,Ht(e.transform,d.tile.tileID),s)});const u=function(e){const t={},r={};for(const o of e){const e=o.queryResults,n=o.wrappedTileID,i=r[n]=r[n]||{};for(const r in e){const o=e[r],n=i[r]=i[r]||{},a=t[r]=t[r]||[];for(const e of o)n[e.featureIndex]||(n[e.featureIndex]=!0,a.push(e))}}return t}(c);for(const d in u)u[d].forEach((t=>{const r=t.feature,o=r.layer;o&&"background"!==o.type&&"sky"!==o.type&&"slot"!==o.type&&(r.source=o.source,o["source-layer"]&&(r.sourceLayer=o["source-layer"]),r.state=void 0!==r.id?e.getFeatureState(o["source-layer"],r.id):{})}));return u}function jt(e,t){const r=e.getRenderableIds().map((t=>e.getTileByID(t))),o=[],n={};for(let i=0;i<r.length;i++){const e=r[i],a=e.tileID.canonical.key;n[a]||(n[a]=!0,e.querySourceFeatures(o,t))}return o}function Wt(e,t){const r=e.tileID,o=t.tileID;return r.overscaledZ-o.overscaledZ||r.canonical.y-o.canonical.y||r.wrap-o.wrap||r.canonical.x-o.canonical.x}class Kt extends zt{constructor(e,t,r,o,n){super(e,t,r,o,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,r){const o=r.context,n=o.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new e.T(o,t,n.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,r=arguments.length>1?arguments[1]:void 0;const o=this._mrt=new e.b0(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.b1(n,((e,n,i,a)=>{if(e)r(e);else try{const e=o.getHeaderLength(n);if(e>t)return void(this.request=this.fetchHeader(e,r));o.parseHeader(n),this._isHeaderLoaded=!0;let s=0;for(const t of Object.values(o.layers))s=Math.max(s,t.dataIndex[t.dataIndex.length-1].last_byte);n.byteLength>=s&&(this.entireBuffer=n),r(null,this.entireBuffer||n,i,a)}catch(e){r(e)}})),this.request}fetchBand(t,r,o){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void o(new Error("Tile header is not ready"));const i=this.actor;if(!i)return void o(new Error("Can't fetch tile band without an actor"));let a;const s=(e,n)=>{a.complete(e,n),e?o(e):(this.updateTextureDescriptor(t,r),o(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return o(e);const r=i.send("decodeRasterArray",{buffer:t,task:a},s,void 0,!0);this._workQueue.push((()=>{r&&r.cancel(),a.cancel()}))},c=n.getLayer(t);if(!c)return void o(new Error(`Unknown sourceLayer "${t}"`));if(c.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void o(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([r]);if(a=n.createDecodingTask(u),!a||a.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),r=e.b1(t,l);this._fetchQueue.push((()=>{r.cancel(),a.cancel()}))}else o(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(t,r){if(!this._mrt)return;const o=this._mrt.getLayer(t);if(!o||!o.hasBand(r)||!o.hasDataForBand(r))return;const{bytes:n,tileSize:i,buffer:a,offset:s,scale:l}=o.getBandView(r),c=i+2*a,u={data:n,width:c,height:c},d=this.texture;d&&d instanceof e.T&&d.update(u,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:u,buffer:a,offset:s,tileSize:i,format:o.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Jt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const o=e.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);const n={value:t,timeout:void 0};if(void 0!==r&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),r)),this.data[o].push(n),this.order.push(o),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,o=void 0===t?0:this.data[r].indexOf(t),n=this.data[r][o];return this.data[r].splice(o,1),n.timeout&&clearTimeout(n.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const o of this.data[r])e(o.value)||t.push(o);for(const r of t)this.remove(r.value.tileID,r)}}class Zt extends e.E{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Jt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new x,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return e.b2(this._tiles).map((e=>e.tileID)).sort(Yt).map((e=>e.key))}getRenderableIds(t,r){const o=[];for(const e in this._tiles)this._isIdRenderable(+e,t,r)&&o.push(this._tiles[e]);return t?o.sort(((t,r)=>{const o=t.tileID,n=r.tileID,i=new e.P(o.canonical.x,o.canonical.y)._rotate(this.transform.angle),a=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return o.overscaledZ-n.overscaledZ||a.y-i.y||a.x-i.x})).map((e=>e.tileID.key)):o.map((e=>e.tileID)).sort(Yt).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(t,r,o,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new e.a(n,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new e.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.f.now(),"expired"===o&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.b("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let o=0;o<t.length;o++){const n=t[o];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const o=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),i=t.tileID.key;0===r&&0===o||Math.abs(o)>1||(Math.abs(r)>1&&(1===Math.abs(r+n)?r+=n:1===Math.abs(r-n)&&(r-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,o),e.neighboringTiles&&e.neighboringTiles[i]&&(e.neighboringTiles[i].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,o){for(const n in this._tiles){let i=this._tiles[n];if(o[n]||!i.hasData()||i.tileID.overscaledZ<=t||i.tileID.overscaledZ>r)continue;let a=i.tileID;for(;i&&i.tileID.overscaledZ>t+1;){const e=i.tileID.scaledTo(i.tileID.overscaledZ-1);i=this._tiles[e.key],i&&i.hasData()&&(a=e)}let s=a;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){o[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),o=this._getLoadedTile(t);if(o)return o}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,o=Math.ceil(e.height/t)+1,n=Math.floor(r*o*5),i="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const o=this._tiles[r];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),e[o.tileID.key]=o}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,r,o,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!o)return;let i;if(this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)i=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.ap(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,i=n.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(i.push(new e.ap(1,0,1,0,0)),i.push(new e.ap(1,0,1,1,0)),i.push(new e.ap(1,0,1,0,1)),i.push(new e.ap(1,0,1,1,1)))}else i=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))));else i=[];if(i.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!qt(this._source.type)){const e=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),a=Math.min(e,this._source.maxzoom),s=t.extendTileCoverForShadows(i,n,a);for(const t of s)this._shadowCasterTiles[t.key]=!0,i.push(t)}const a=this._updateRetainedTiles(i);if(qt(this._source.type)&&0!==i.length){const t={},r={},o=Object.keys(a);for(const i of o){const o=a[i],n=this._tiles[i];if(!n||n.fadeEndTime&&n.fadeEndTime<=e.f.now())continue;const s=this.findLoadedParent(o,Math.max(o.overscaledZ-Zt.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),r[i]=o}const n=i[i.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(a[e]||!t.hasData())continue;let o=t.tileID;for(;o.overscaledZ>n;){o=o.scaledTo(o.overscaledZ-1);const n=this._tiles[o.key];if(n&&n.hasData()&&r[o.key]){a[e]=t.tileID;break}}}for(const e in t)a[e]||(this._coveredTiles[e]=!0,a[e]=t[e])}for(const e in a)this._tiles[e].clearFadeHold();const s=e.b3(this._tiles,a);for(const e of s){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},o=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,i=Math.max(n-Zt.maxOverzooming,this._source.minzoom),a=Math.max(n+Zt.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||o<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,o,a,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let o=e.wasRequested();for(let n=l.overscaledZ-1;n>=i;--n){const i=l.scaledTo(n);if(r[i.key])break;if(r[i.key]=!0,e=this.getTile(i),!e&&o&&(e=this._addTile(i)),e&&(t[i.key]=i,o=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){r=this._loadedParentTiles[o.key];break}t.push(o.key);const e=o.scaledTo(o.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;o=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const o=Boolean(r);if(!o){const e=this.map?this.map.painter:null,o=this._source.tileSize*t.overscaleFactor();r="raster-array"===this._source.type?new Kt(t,o,this.transform.tileZoom,e,this._isRaster):new zt(t,o,this.transform.tileZoom,e,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r?(r.uses++,this._tiles[t.key]=r,o||this._source.fire(new e.b("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,o){const n=[],i=this.transform;if(!i)return n;const a="globe"===i.projection.name,s=e.a8(i.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(o&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(a){const t=c.tileID.canonical;if(0===t.z){const r=[Math.abs(e.ad(s,...$t(t,-1))-s),Math.abs(e.ad(s,...$t(t,1))-s)];u=[0,2*r.indexOf(Math.min(...r))-1]}else{const r=[Math.abs(e.ad(s,...$t(t,-1))-s),Math.abs(e.ad(s,...$t(t,0))-s),Math.abs(e.ad(s,...$t(t,1))-s)];u=[r.indexOf(Math.min(...r))-1]}}else u=[0];for(const e of u){const o=t.containsTile(c,i,r,e);o&&n.push(o)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const r=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),o="globe"===this.transform.projection.name;for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped()),n.expandedProjMatrix=o?this.transform.calculateProjMatrix(n.toUnwrapped(),!1,!0):n.projMatrix;return r}sortCoordinatesByDistance(e){const t=e.slice(),r=this.transform._camera.position,o=this.transform._camera.forward(),n={};for(const i of t){const e=1/(1<<i.canonical.z);n[i.key]=((i.canonical.x+.5)*e+i.wrap-r[0])*o[0]+((i.canonical.y+.5)*e-r[1])*o[1]-r[2]*o[2]}return t.sort(((e,t)=>n[e.key]-n[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(qt(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=e.f.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const o=this._tiles[e];o&&o.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((r=>!r.hasDependency(e,t)))}_preloadTiles(t,r){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,r))};return void this._source.on("data",e)}const o=new Map,n=Array.isArray(t)?t:[t],i=this.map.painter.terrain,a=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)o.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const s=Array.from(o.values());e.b4(s,((e,t)=>{const r=new zt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,(e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)}))}),r)}}function Yt(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||o-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function qt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function $t(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Zt.maxOverzooming=10,Zt.maxUnderzooming=3;class Xt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const r in this.style._mergedLayers){const o=this.style._mergedLayers[r];if("fill-extrusion"===o.type)this.layers.push({layer:o,visible:e,visibilityChanged:t});else if("model"===o.type){const r=this.style.getLayerSource(o);r&&"batched-model"===r.type&&this.layers.push({layer:o,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const r=t.layer;let o=!1;"fill-extrusion"===r.type?o=!r.isHidden(e)&&r.paint.get("fill-extrusion-opacity")>0:"model"===r.type&&(o=!r.isHidden(e)&&r.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!o&&t.visible,t.visible=o}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const o of this.layers){const e=o.layer,r=this.style.getLayerSourceCache(e);let n=1;"fill-extrusion"===e.type&&(n=o.visible?e.paint.get("fill-extrusion-vertical-scale"):0);let i=r?r.getTile(t):null;if(!i&&r&&t.canonical.z>r.getSource().minzoom){let e=t.scaledTo(Math.min(r.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=r.getSource().minzoom&&(i=r.getTile(e),!i&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:i?i.getBucket(e):null,tileID:i?i.tileID:t,verticalScale:n})}e.hasAnyZOffset=!1;let r=!1;for(let o=0;o<e.symbolInstances.length;o++){const n=e.symbolInstances.get(o),i=n.zOffset,a=this._getHeightAtTileOffset(t,n.tileAnchorX,n.tileAnchorY);n.zOffset=a!==Number.NEGATIVE_INFINITY?a:i,r||i===n.zOffset||(r=!0),e.hasAnyZOffset||0===n.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,o,n){let i=r,a=o;if(t.canonical.z!==n.canonical.z){const s=n.canonical,l=1/(1<<t.canonical.z-s.z);i=(r+t.canonical.x*e.Y)*l-s.x*e.Y|0,a=(o+t.canonical.y*e.Y)*l-s.y*e.Y|0}return{tileX:i,tileY:a}}_getHeightAtTileOffset(e,t,r){let o,n;for(let i=0;i<this.layers.length;++i){if("fill-extrusion"!==this.layers[i].layer.type)continue;const{bucket:a,tileID:s,verticalScale:l}=this.currentBuildingBuckets[i];if(!a)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(e,t,r,s),d=a.getHeightAtTileCoord(c,u);d&&void 0!==d.height&&(d.hidden?o=d.height:n=Math.max(d.height*l,n||0))}if(void 0!==n)return n;for(let i=0;i<this.layers.length;++i){const n=this.layers[i];if("model"!==n.layer.type||!n.visible)continue;const{bucket:a,tileID:s}=this.currentBuildingBuckets[i];if(!a)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,r,s),u=a.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==o?Math.min(u.maxHeight,o)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Qt(t,r){const o={};for(const e in t)"ref"!==e&&(o[e]=t[e]);return e.b5.forEach((e=>{e in r&&(o[e]=r[e])})),o}function er(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Qt(e[r],t[e[r].ref]));return e}const tr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function rr(e,t,r){r.push({command:tr.addSource,args:[e,t[e]]})}function or(e,t,r){t.push({command:tr.removeSource,args:[e]}),r[e]=!0}function nr(e,t,r,o){or(e,r,o),rr(e,t,r)}function ir(e,r,o){let n;for(n in e[o])if(e[o].hasOwnProperty(n)&&"data"!==n&&!t(e[o][n],r[o][n]))return!1;for(n in r[o])if(r[o].hasOwnProperty(n)&&"data"!==n&&!t(e[o][n],r[o][n]))return!1;return!0}function ar(e,r,o,n,i,a){let s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],r[s])||o.push({command:a,args:[n,s,r[s],i]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],r[s])||o.push({command:a,args:[n,s,r[s],i]}))}function sr(e){return e.id}function lr(e,t){return e[t.id]=t,e}class cr{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ad(t,0,1);let r=1,o=this._distances[r];const n=t*this.paddedLength+this.padding;for(;o<n&&r<this._distances.length;)o=this._distances[++r];const i=r-1,a=this._distances[i],s=o-a,l=s>0?(n-a)/s:0;return this.points[i].mult(1-l).add(this.points[r].mult(l))}}class ur{constructor(e,t,r){const o=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let i=0;i<this.xCellCount*this.yCellCount;i++)o.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,o,n){this._forEachCell(t,r,o,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(n)}insertCircle(e,t,r,o){this._forEachCell(t-o,r-o,t+o,r+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(o)}_insertBoxCell(e,t,r,o,n,i){this.boxCells[n].push(i)}_insertCircleCell(e,t,r,o,n,i){this.circleCells[n].push(i)}_query(e,t,r,o,n,i){if(r<0||e>this.width||o<0||t>this.height)return!n&&[];const a=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=o){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],o=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-o,y1:r-o,x2:t+o,y2:r+o})}return i?a.filter(i):a}return this._forEachCell(e,t,r,o,this._queryCell,a,{hitTest:n,seenUids:{box:{},circle:{}}},i),n?a.length>0:a}_queryCircle(e,t,r,o,n){const i=e-r,a=e+r,s=t-r,l=t+r;if(a<0||i>this.width||l<0||s>this.height)return!o&&[];const c=[];return this._forEachCell(i,s,a,l,this._queryCellCircle,c,{hitTest:o,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},n),o?c.length>0:c}query(e,t,r,o,n){return this._query(e,t,r,o,!1,n)}hitTest(e,t,r,o,n){return this._query(e,t,r,o,!0,n)}hitTestCircle(e,t,r,o){return this._queryCircle(e,t,r,!0,o)}_queryCell(e,t,r,o,n,i,a,s){const l=a.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=n[c+2]&&t<=n[c+3]&&r>=n[c+0]&&o>=n[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return i.push(!0),!0;i.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],e,t,r,o)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return i.push(!0),!0;{const e=n[u],t=n[u+1],r=n[u+2];i.push({key:this.circleKeys[c],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,o,n,i,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[n];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!s||s(this.boxKeys[t])))return i.push(!0),!0}}const d=this.circleCells[n];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return i.push(!0),!0}}}_forEachCell(e,t,r,o,n,i,a,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(r),d=this._convertToYCellCoord(o);for(let h=l;h<=u;h++)for(let l=c;l<=d;l++)if(n.call(this,e,t,r,o,this.xCellCount*l+h,i,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,o,n,i){const a=o-e,s=n-t,l=r+i;return l*l>a*a+s*s}_circleAndRectCollide(e,t,r,o,n,i,a){const s=(i-o)/2,l=Math.abs(e-(o+s));if(l>s+r)return!1;const c=(a-n)/2,u=Math.abs(t-(n+c));if(u>c+r)return!1;if(l<=s||u<=c)return!0;const d=l-s,h=u-c;return d*d+h*h<=r*r}}const dr={unknown:0,flipRequired:1,flipNotRequired:2},hr=Math.tan(85*Math.PI/180);function fr(t,r,o,n,i,a,s){const l=e.a9.create();if(o)if("globe"===a.name){const t=e.b6(i,r);e.a9.multiply(l,l,t)}else{const t=e.b7.invert([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.a9.rotateZ(l,l,i.angle)}else e.a9.multiply(l,i.labelPlaneMatrix,t);return l}function mr(e,t,r,o,n,i,a){const s=fr(e,t,r,o,n,i,a);return"globe"===i.name&&r||(s[2]=s[6]=s[10]=s[14]=0),s}function pr(t,r,o,n,i,a,s){if(o){if("globe"===a.name){const l=fr(t,r,o,n,i,a,s);return e.a9.invert(l,l),e.a9.multiply(l,t,l),l}{const r=e.a9.clone(t),o=e.a9.identity([]);return o[0]=s[0],o[1]=s[1],o[4]=s[2],o[5]=s[3],e.a9.multiply(r,r,o),n||e.a9.rotateZ(r,r,-i.angle),r}}return i.glCoordMatrix}function gr(t,r,o,n){const i=[t,r,o,1];o?e.aa.transformMat4(i,i,n):Tr(i,i,n);const a=i[3];return i[0]/=a,i[1]/=a,i[2]/=a,i}function _r(e,t){return Math.min(.5+e/t*.5,1.5)}function yr(e,t){const r=e[0]/e[3],o=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&o>=-t[1]&&o<=t[1]}function vr(t,r,o,n,i,a,s,l,c,u){const d=o.transform,h=n?t.textSizeData:t.iconSizeData,f=e.b8(h,o.transform.zoom),m="globe"===d.projection.name,p=[256/o.width*2+1,256/o.height*2+1],g=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;m&&(_=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=o.transform.width/o.transform.height;let b,L=!1;for(let A=0;A<v.length;A++){const n=v.get(A),{numGlyphs:m,writingMode:w}=n;if(w!==e.b9.vertical||L||b===e.b9.horizontal||(L=!0),b=w,(n.hidden||w===e.b9.vertical)&&!L){Er(m,g);continue}L=!1;const S=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:E,y:T,z:P}=d.projection.projectTilePoint(S.x,S.y,u.canonical);if(c){const[e,t,r]=c(S);E+=e,T+=t,P+=r}const C=[E,T,P,1];if(e.aa.transformMat4(C,C,r),!yr(C,p)){Er(m,g);continue}const R=C[3],M=_r(o.transform.getCameraToCenterDistance(d.projection),R),I=e.ba(h,f,n),O=s?I/M:I*M,D=gr(E,T,P,i);if(D[3]<=0){Er(m,g);continue}let k={};const N=s?null:c,B=Lr(n,O,!1,l,r,i,a,t.glyphOffsetArray,y,g,_,D,S,k,x,N,d.projection,u,s);L=B.useVertical,N&&B.needsFlipping&&(k={}),(B.notEnoughRoom||L||B.needsFlipping&&Lr(n,O,!0,l,r,i,a,t.glyphOffsetArray,y,g,_,D,S,k,x,N,d.projection,u,s).notEnoughRoom)&&Er(m,g)}n?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function xr(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,v=_+s.numGlyphs,x=g+s.lineLength,b=t.getoffsetX(_),L=t.getoffsetX(v-1),A=Sr(e*b,r,o,n,i,a,y,g,x,l,c,u,d,h,!0,f,m,p);if(!A)return null;const w=Sr(e*L,r,o,n,i,a,y,g,x,l,c,u,d,h,!0,f,m,p);return w?{first:A,last:w}:null}function br(t,r,o,n){return t===e.b9.horizontal&&Math.abs(n)>Math.abs(o)?{useVertical:!0}:t===e.b9.vertical?n>0?{needsFlipping:!0}:null:r!==dr.unknown&&function(e,t){return 0===e||Math.abs(t/e)>hr}(o,n)?r===dr.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Lr(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v){const x=r/24,b=t.lineOffsetX*x,L=t.lineOffsetY*x,{lineStartIndex:A,glyphStartIndex:w,numGlyphs:S,segment:E,writingMode:T,flipState:P}=t,C=A+t.lineLength,R=t=>{if(d){const[r,o,n]=t.up,i=u.length;e.bb(d,i+0,r,o,n),e.bb(d,i+1,r,o,n),e.bb(d,i+2,r,o,n),e.bb(d,i+3,r,o,n)}const[r,o,n]=t.point;e.bc(u,r,o,n,t.angle)};if(S>1){const e=xr(x,l,b,L,o,h,f,t,c,a,m,g,!1,_,y,v);if(!e)return{notEnoughRoom:!0};if(n&&!o){let[r,o,n]=e.first.point,[i,a,l]=e.last.point;[r,o]=gr(r,o,n,s),[i,a]=gr(i,a,l,s);const c=br(T,P,(i-r)*p,a-o);if(t.flipState=c&&c.needsFlipping?dr.flipRequired:dr.flipNotRequired,c)return c}R(e.first);for(let t=w+1;t<w+S-1;t++){const e=Sr(x*l.getoffsetX(t),b,L,o,h,f,E,A,C,c,a,m,g,!1,!1,_,y,v);if(!e)return u.length-=4*(t-w),{notEnoughRoom:!0};R(e)}R(e.last)}else{if(n&&!o){const r=gr(f.x,f.y,0,i),o=A+E+1,n=new e.P(c.getx(o),c.gety(o)),a=gr(n.x,n.y,0,i),s=a[3]>0?a:wr(f,n,r,1,i,void 0,_,y.canonical),l=br(T,P,(s[0]-r[0])*p,s[1]-r[1]);if(t.flipState=l&&l.needsFlipping?dr.flipRequired:dr.flipNotRequired,l)return l}const r=Sr(x*l.getoffsetX(w),b,L,o,h,f,E,A,C,c,a,m,g,!1,!1,_,y,v);if(!r)return{notEnoughRoom:!0};R(r)}return{}}function Ar(e,t,r,o,n){const{x:i,y:a,z:s}=o.projectTilePoint(e.x,e.y,t);if(!n)return gr(i,a,s,r);const[l,c,u]=n(e);return gr(i+l,a+c,s+u,r)}function wr(t,r,o,n,i,a,s,l){const c=Ar(t.sub(r)._unit()._add(t),l,i,s,a);return e.Q.sub(c,o,c),e.Q.normalize(c,c),e.Q.scaleAndAdd(c,o,c,n)}function Sr(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y){const v=n?t-r:t+r;let x=v>0?1:-1,b=0;n&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let L=l+s+(x>0?0:1)|0,A=i,w=i,S=0,E=0;const T=Math.abs(v),P=[],C=[];let R=a,M=R;const I=()=>wr(M,R,w,T-S+1,d,f,g,_.canonical);for(;S+E<=T;){if(L+=x,L<l||L>=c)return null;if(w=A,M=R,P.push(w),m&&C.push(M),R=new e.P(u.getx(L),u.gety(L)),A=h[L],!A){const e=Ar(R,_.canonical,d,g,f);A=e[3]>0?h[L]=e:I()}S+=E,E=e.Q.distance(w,A)}p&&f&&(h[L]&&(A=I(),E=e.Q.distance(w,A)),h[L]=A);const O=(T-S)/E,D=R.sub(M)._mult(O)._add(M),k=e.Q.sub([],A,w),N=e.Q.scaleAndAdd([],w,k,O);let B=[0,0,1],F=k[0],z=k[1];if(y&&(B=g.upVector(_.canonical,D.x,D.y),0!==B[0]||0!==B[1]||1!==B[2])){const t=[B[2],0,-B[0]],r=e.Q.cross([],B,t);e.Q.normalize(t,t),e.Q.normalize(r,r),F=e.Q.dot(k,t),z=e.Q.dot(k,r)}if(o){const t=e.Q.cross([],B,k);e.Q.normalize(t,t),e.Q.scaleAndAdd(N,N,t,o*x)}const U=b+Math.atan2(z,F);return P.push(N),m&&C.push(D),{point:N,angle:U,path:P,tilePath:C,up:B}}function Er(e,t){const r=t.length,o=r+4*e;t.resize(o),t.float32.fill(-1/0,4*r,4*o)}function Tr(e,t,r){const o=t[0],n=t[1];return e[0]=r[0]*o+r[4]*n+r[12],e[1]=r[1]*o+r[5]*n+r[13],e[3]=r[3]*o+r[7]*n+r[15],e}const Pr=100;class Cr{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ur(e.width+200,e.height+200,25),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ur(e.width+200,e.height+200,25);this.transform=e,this.grid=r,this.ignoredGrid=o,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pr,this.screenBottomBoundary=e.height+Pr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,r,o,n,i,a,s){let l=r.projectedAnchorX,c=r.projectedAnchorY,u=r.projectedAnchorZ;const d=r.elevation,h=r.tileID,f=e.getProjection();if(d&&h){const[e,t,o]=f.upVector(h.canonical,r.tileAnchorX,r.tileAnchorY),n=f.upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*d*n,c+=t*d*n,u+=o*d*n}const m=this.projectAndGetPerspectiveRatio(a,l,c,u,r.tileID,"globe"===f.name||!!d||this.transform.pitch>0,f),p=i*m.perspectiveRatio,g=(r.x1*t+o.x-r.padding)*p+m.point.x,_=(r.y1*t+o.y-r.padding)*p+m.point.y,y=(r.x2*t+o.x+r.padding)*p+m.point.x,v=(r.y2*t+o.y+r.padding)*p+m.point.y,x=m.perspectiveRatio<=.55||m.occluded;return!this.isInsideGrid(g,_,y,v)||!n&&this.grid.hitTest(g,_,y,v,s)||x?{box:[],offscreen:!1,occluded:m.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){const g=[],_=this.transform.elevation,y=t.getProjection(),v=_?_.getAtTileOffsetFunc(p,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(o.tileAnchorX,o.tileAnchorY);let{x:b,y:L,z:A}=y.projectTilePoint(x.x,x.y,p.canonical);if(v){const[e,t,r]=v(x);b+=e,L+=t,A+=r}const w="globe"===y.name,S=this.projectAndGetPerspectiveRatio(s,b,L,A,p,w||!!_||this.transform.pitch>0,y),{perspectiveRatio:E}=S,T=(d?a/E:a*E)/e.bf,P=gr(b,L,A,l),C=S.signedDistanceFromCamera>0?xr(T,i,o.lineOffsetX*T,o.lineOffsetY*T,!1,P,x,o,n,l,{},_&&!d?v:null,d&&!!_,y,p,d):null;let R=!1,M=!1,I=!0;if(C&&!S.occluded){const t=.5*f*E+m,o=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),i=new cr,{first:a,last:s}=C,l=a.path.length;let d=[];for(let e=l-1;e>=1;e--)d.push(a.path[e]);for(let e=1;e<s.path.length;e++)d.push(s.path[e]);const p=2.5*t;c&&(d=d.map(((e,t)=>{let[r,o,n]=e;return v&&!w&&(n=v(t<l-1?a.tilePath[l-1-t]:s.tilePath[t-l+2])[2]),gr(r,o,n,c)})),d.some((e=>e[3]<=0))&&(d=[]));let _=[];if(d.length>0){let t=1/0,r=-1/0,i=1/0,a=-1/0;for(const e of d)t=Math.min(t,e[0]),i=Math.min(i,e[1]),r=Math.max(r,e[0]),a=Math.max(a,e[1]);r>=o.x&&t<=n.x&&a>=o.y&&i<=n.y&&(_=[d.map((t=>new e.P(t[0],t[1])))],(t<o.x||r>n.x||i<o.y||a>n.y)&&(_=e.bd(_,o.x,o.y,n.x,n.y)))}for(const e of _){i.reset(e,.25*t);let o=0;o=i.length<=.5*t?1:Math.ceil(i.paddedLength/p)+1;for(let e=0;e<o;e++){const n=e/Math.max(o-1,1),a=i.lerp(n),s=a.x+Pr,l=a.y+Pr;g.push(s,l,t,0);const c=s-t,d=l-t,f=s+t,m=l+t;if(I=I&&this.isOffscreen(c,d,f,m),M=M||this.isInsideGrid(c,d,f,m),!r&&this.grid.hitTestCircle(s,l,t,h)&&(R=!0,!u))return{circles:[],offscreen:!1,collisionDetected:R,occluded:!1}}}}return{circles:!u&&R||!M?[]:g,offscreen:I,collisionDetected:R,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let o=1/0,n=1/0,i=-1/0,a=-1/0;for(const u of t){const t=new e.P(u.x+Pr,u.y+Pr);o=Math.min(o,t.x),n=Math.min(n,t.y),i=Math.max(i,t.x),a=Math.max(a,t.y),r.push(t)}const s=this.grid.query(o,n,i,a).concat(this.ignoredGrid.query(o,n,i,a)),l={},c={};for(const u of s){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const o=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.be(r,o)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,r,o,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:o,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,o,n){const i=t?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:o,collisionGroupID:n};for(let s=0;s<e.length;s+=4)i.insertCircle(a,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,r,o,n,i,a,s){const l=[r,o,n,1];let c=!1;if(n||this.transform.pitch>0){if(e.aa.transformMat4(l,l,t),this.fogState&&i&&"globe"!==s.name){const t=function(t,r,o,n,i,a){const s=a.calculateFogTileMatrix(i),l=[r,o,n];return e.Q.transformMat4(l,l,s),me(t,e.Q.length(l),a.pitch,a._fov)}(this.fogState,r,o,n,i.toUnwrapped(),this.transform);c=t>.9}}else Tr(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+Pr,(-l[1]/u+1)/2*this.transform.height+Pr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&l[2]>u||c}}isOffscreen(e,t,r,o){return r<Pr||e>=this.screenRightBoundary||o<Pr||t>this.screenBottomBoundary}isInsideGrid(e,t,r,o){return r>=0&&e<this.gridRightBoundary&&o>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.a9.identity([]);return e.a9.translate(t,t,[-100,-100,0]),t}}function Rr(t,r,o){const n=r.createTileMatrix(t,t.worldSize,o.toUnwrapped());return e.a9.multiply(new Float32Array(16),t.projMatrix,n)}function Mr(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const o=r.clone();return o.setProjection(t.projection),Rr(o,t.getProjection(),e)}function Ir(e,t,r){return t.name===r.projection.name?e.projMatrix:Rr(r,t,e)}class Or{constructor(e,t,r,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):o&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class Dr{constructor(e,t,r,o,n){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new Or(e?e.text:null,t,r,n),this.icon=new Or(e?e.icon:null,t,o,n),this.clipped=i}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kr{constructor(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=r,this.clipped=o}}class Nr{constructor(){this.invProjMatrix=e.a9.create(),this.viewportMatrix=e.a9.create(),this.circles=[]}}class Br{constructor(e,t,r,o,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=o,this.tileID=n}}class Fr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function zr(t,r,o,n,i){const{horizontalAlign:a,verticalAlign:s}=e.bi(t),l=-(a-.5)*r,c=-(s-.5)*o,u=e.bh(t,n);return new e.P(l+u[0]*i,c+u[1]*i)}function Ur(t,r,o,n,i){const a=new e.P(t,r);return o&&a._rotate(n?i:-i),a}class Vr{constructor(e,t,r,o,n,i){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Cr(this.transform,n),this.buildingIndex=i,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Fr(r),this.collisionCircleArrays={},this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,o,n){const i=o.getBucket(r),a=o.latestFeatureIndex;if(!i||!a||r.fqid!==i.layerIds[0])return;const s=i.layers[0].layout,l=o.collisionBoxArray,c=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),u=o.tileSize/e.Y,d=o.tileID.toUnwrapped();this.transform.setProjection(i.projection);const h=(f=o.tileID,m=i.getProjection(),p=this.transform,m.name===this.projection?p.calculateProjMatrix(f.toUnwrapped()):Rr(p,m,f));var f,m,p;const g="map"===s.get("text-pitch-alignment"),_="map"===s.get("text-rotation-alignment");r.compileFilter();const y=r.dynamicFilter(),v=r.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(o),b=mr(h,o.tileID.canonical,g,_,this.transform,i.getProjection(),x);let L=null;if(g){const t=pr(h,o.tileID.canonical,g,_,this.transform,i.getProjection(),x);L=e.a9.multiply([],this.transform.labelPlaneMatrix,t)}let A=null;y&&o.latestFeatureIndex&&(A={unwrappedTileID:d,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:o.latestFeatureIndex}),this.retainedQueryData[i.bucketInstanceId]=new Br(i.bucketInstanceId,a,i.sourceLayerIndex,i.index,o.tileID);const w={bucket:i,layout:s,posMatrix:h,textLabelPlaneMatrix:b,labelToScreenMatrix:L,clippingData:A,scale:c,textPixelRatio:u,holdingForFade:o.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.b8(i.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.b8(i.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(i.sourceID)};if(n)for(const e of i.sortKeyRanges){const{sortKey:r,symbolInstanceStart:o,symbolInstanceEnd:n}=e;t.push({sortKey:r,symbolInstanceStart:o,symbolInstanceEnd:n,parameters:w})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:i.symbolInstances.length,parameters:w})}attemptAnchorPlacement(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_){const{textOffset0:y,textOffset1:v,crossTileID:x}=d,b=[y,v],L=zr(e,r,o,b,n),A=this.collisionIndex.placeCollisionBox(f,n,t,Ur(L.x,L.y,i,a,this.transform.angle),u,s,l,c.predicate);if(p){const e=f.getSymbolInstanceIconSize(_,this.transform.zoom,d.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(f,e,p,Ur(L.x,L.y,i,a,this.transform.angle),u,s,l,c.predicate).box.length)return}if(A.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:r,height:o,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(f,e,d,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,d),this.placedOrientations[x]=m),{shift:L,placedGlyphBoxes:A}}}placeLayerBucketPart(t,r,o,n){const{bucket:i,layout:a,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:d,holdingForFade:h,collisionBoxArray:f,partiallyEvaluatedTextSize:m,partiallyEvaluatedIconSize:p,collisionGroup:g}=t.parameters,_=a.get("text-optional"),y=a.get("icon-optional"),v=a.get("text-allow-overlap"),x=a.get("icon-allow-overlap"),b="map"===a.get("text-rotation-alignment"),L="map"===a.get("text-pitch-alignment"),A="viewport-y"===a.get("symbol-z-order"),w=a.get("symbol-z-elevate");this.transform.setProjection(i.projection);let S=v&&(x||!i.hasIconData()||y),E=x&&(v||!i.hasTextData()||_);!i.collisionArrays&&f&&i.deserializeCollisionBoxes(f),o&&n&&i.updateCollisionDebugBuffers(this.transform.zoom,f);const T=(t,n,f)=>{const{crossTileID:A,numVerticalGlyphVertices:w}=t;if(u){const o={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[i.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(o,n,this.retainedQueryData[i.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[A]=new kr(!1,!1,!1,!0),void r.add(A)}if(r.has(A))return;if(h)return void(this.placements[A]=new kr(!1,!1,!1));let T=!1,P=!1,C=!0,R=!1,M=!1,I=null,O={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},k=null,N=null,B=null,F=0,z=0,U=0;f.textFeatureIndex?F=f.textFeatureIndex:t.useRuntimeCollisionCircles&&(F=t.featureIndex),f.verticalTextFeatureIndex&&(z=f.verticalTextFeatureIndex);const V=e=>{e.tileID=this.retainedQueryData[i.bucketInstanceId].tileID;const r=this.transform.elevation;e.elevation=t.zOffset+(r?r.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},H=f.textBox;if(H){V(H);const r=r=>{let o=e.b9.horizontal;if(i.allowVerticalPlacement&&!r&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[A];e&&(this.placedOrientations[A]=e,o=e,this.markUsedOrientation(i,o,t))}return o},o=(t,r)=>{if(i.allowVerticalPlacement&&w>0&&f.verticalTextBox){for(const o of i.writingModes)if(o===e.b9.vertical?(O=r(),D=O):O=t(),O&&O.box&&O.box.length)break}else O=t()};if(a.get("text-variable-anchor")){let l=a.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[A]){const e=this.prevPlacement.variableOffsets[A];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,r,o)=>{const a=i.getSymbolInstanceTextSize(m,t,this.transform.zoom,n),c=(e.x2-e.x1)*a+2*e.padding,u=(e.y2-e.y1)*a+2*e.padding,h=t.hasIconTextFit&&!x?r:null;h&&V(h);let f={box:[],offscreen:!1,occluded:!1};const _=v?2*l.length:l.length;for(let y=0;y<_;++y){const r=this.attemptAnchorPlacement(l[y%l.length],e,c,u,a,b,L,d,s,g,y>=l.length,t,n,i,o,h,m,p);if(r&&(f=r.placedGlyphBoxes,f&&f.box&&f.box.length)){T=!0,I=r.shift;break}}return f};o((()=>c(H,f.iconBox,e.b9.horizontal)),(()=>{const t=f.verticalTextBox;return t&&V(t),i.allowVerticalPlacement&&!(O&&O.box&&O.box.length)&&w>0&&t?c(t,f.verticalIconBox,e.b9.vertical):{box:null,offscreen:null,occluded:null}})),O&&(T=O.box,C=O.offscreen,R=O.occluded);const u=r(!(!O||!O.box));if(!T&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[A];e&&(this.variableOffsets[A]=e,this.markUsedJustification(i,e.anchor,t,u))}}else{const a=(r,o)=>{const a=i.getSymbolInstanceTextSize(m,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(i,a,r,new e.P(0,0),v,d,s,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(i,o,t),this.placedOrientations[A]=o),l};o((()=>a(H,e.b9.horizontal)),(()=>{const t=f.verticalTextBox;return i.allowVerticalPlacement&&w>0&&t?(V(t),a(t,e.b9.vertical)):{box:null,offscreen:null,occluded:null}})),r(!!(O&&O.box&&O.box.length))}}if(k=O,T=k&&k.box&&k.box.length>0,C=k&&k.offscreen,R=k&&k.occluded,t.useRuntimeCollisionCircles){const r=i.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.ba(i.textSizeData,m,r),u=a.get("text-padding");N=this.collisionIndex.placeCollisionCircles(i,v,r,i.lineVertexArray,i.glyphOffsetArray,n,s,l,c,o,L,g.predicate,t.collisionCircleDiameter*n/e.bf,u,this.retainedQueryData[i.bucketInstanceId].tileID),T=v||N.circles.length>0&&!N.collisionDetected,C=C&&N.offscreen,R=N.occluded}if(f.iconFeatureIndex&&(U=f.iconFeatureIndex),f.iconBox){const r=r=>{V(r);const o=t.hasIconTextFit&&I?Ur(I.x,I.y,b,L,this.transform.angle):new e.P(0,0),n=i.getSymbolInstanceIconSize(p,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(i,n,r,o,x,d,s,g.predicate)};D&&D.box&&D.box.length&&f.verticalIconBox?(B=r(f.verticalIconBox),P=B.box.length>0):(B=r(f.iconBox),P=B.box.length>0),C=C&&B.offscreen,M=B.occluded}const G=_||0===t.numHorizontalGlyphVertices&&0===w,j=y||0===t.numIconVertices;if(G||j?j?G||(P=P&&T):T=P&&T:P=T=P&&T,T&&k&&k.box&&this.collisionIndex.insertCollisionBox(k.box,a.get("text-ignore-placement"),i.bucketInstanceId,D&&D.box&&z?z:F,g.ID),P&&B&&this.collisionIndex.insertCollisionBox(B.box,a.get("icon-ignore-placement"),i.bucketInstanceId,U,g.ID),N&&(T&&this.collisionIndex.insertCollisionCircles(N.circles,a.get("text-ignore-placement"),i.bucketInstanceId,F,g.ID),o)){const e=i.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Nr);for(let r=0;r<N.circles.length;r+=4)t.circles.push(N.circles[r+0]),t.circles.push(N.circles[r+1]),t.circles.push(N.circles[r+2]),t.circles.push(N.collisionDetected?1:0)}const W="globe"!==i.projection.name;S=S&&(W||!R),E=E&&(W||!M),this.placements[A]=new kr(T||S,P||E,C||i.justReloaded),r.add(A)};if(w&&this.buildingIndex&&(this.buildingIndex.updateZOffset(i,this.retainedQueryData[i.bucketInstanceId].tileID),i.updateZOffset()),A){const t=i.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const r=t[e];T(i.symbolInstances.get(r),r,i.collisionArrays[r])}i.hasAnyZOffset&&e.w(`${i.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(i.hasAnyZOffset){const e=i.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const r=e[t];T(i.symbolInstances.get(r),r,i.collisionArrays[r])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)T(i.symbolInstances.get(e),e,i.collisionArrays[e]);if(o&&i.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[i.bucketInstanceId];e.a9.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}i.justReloaded=!1}markUsedJustification(t,r,o,n){const{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=o,u=e.bg(r),d=n===e.b9.vertical?l:"left"===u?i:"center"===u?a:"right"===u?s:-1;i>=0&&(t.text.placedSymbolArray.get(i).crossTileID=d>=0&&i!==d?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:c)}markUsedOrientation(t,r,o){const n=r===e.b9.horizontal||r===e.b9.horizontalOnly?r:0,i=r===e.b9.vertical?r:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=o,u=t.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=n),s>=0&&(u.get(s).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=i)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const o=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},i=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=n[s];t?(this.opacities[s]=new Dr(t,o,e.text,e.icon,null,e.clipped),r=r||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new Dr(null,o,e.text,e.icon,e.skipFade,e.clipped),r=r||e.text||e.icon)}for(const s in n){const e=n[s];if(!this.opacities[s]){const t=new Dr(e,o,!1,!1);t.isHidden()||(this.opacities[s]=t,r=r||e.text.placed||e.icon.placed)}}for(const s in i)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=i[s]);for(const s in a)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=a[s]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const r=new Set;for(const o of t){const t=o.getBucket(e);t&&o.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,o.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,o.tileID),t.updateZOffset()))}}updateBucketOpacities(t,r,o){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,i=!!t.layers[0].dynamicFilter(),a=new Dr(null,0,!1,!1,!0),s=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),d="map"===n.get("text-pitch-alignment"),h=new Dr(null,0,s&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(s||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&o&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(o);const f=(e,t,r)=>{for(let o=0;o<t/4;o++)e.opacityVertexArray.emplaceBack(r)};let m=0;for(let p=0;p<t.symbolInstances.length;p++){const o=t.symbolInstances.get(p),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:s,crossTileID:l,numIconVertices:g}=o,_=r.has(l);let y=this.opacities[l];_?y=a:y||(y=h,this.opacities[l]=y),r.add(l);const v=n>0||s>0,x=g>0,b=this.placedOrientations[l],L=b===e.b9.vertical,A=b===e.b9.horizontal||b===e.b9.horizontalOnly;if(!v&&!x||y.isHidden()||m++,v){const e=qr(y.text);f(t.text,n,L?$r:e),f(t.text,s,A?$r:e);const r=y.text.isHidden(),{leftJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:u}=o,d=t.text.placedSymbolArray,h=r||L?1:0;i>=0&&(d.get(i).hidden=h),a>=0&&(d.get(a).hidden=h),c>=0&&(d.get(c).hidden=h),u>=0&&(d.get(u).hidden=r||A?1:0);const m=this.variableOffsets[l];m&&this.markUsedJustification(t,m.anchor,o,b);const p=this.placedOrientations[l];p&&(this.markUsedJustification(t,"left",o,p),this.markUsedOrientation(t,p,o))}if(x){const e=qr(y.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:n}=o,i=t.icon.placedSymbolArray,a=y.icon.isHidden()?1:0;r>=0&&(f(t.icon,g,L?$r:e),i.get(r).hidden=a),n>=0&&(f(t.icon,o.numVerticalIconVertices,A?$r:e),i.get(n).hidden=a)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const r=t.collisionArrays[p];if(r){let n=new e.P(0,0),a=!0;if(r.textBox||r.verticalTextBox){if(c){const e=this.variableOffsets[l];e?(n=zr(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(d?this.transform.angle:-this.transform.angle)):a=!1}i&&(a=!y.clipped),r.textBox&&Hr(t.textCollisionBox.collisionVertexArray,y.text.placed,!a||L,n.x,n.y),r.verticalTextBox&&Hr(t.textCollisionBox.collisionVertexArray,y.text.placed,!a||A,n.x,n.y)}const s=a&&Boolean(!A&&r.verticalIconBox);r.iconBox&&Hr(t.iconCollisionBox.collisionVertexArray,y.icon.placed,s,o.hasIconTextFit?n.x:0,o.hasIconTextFit?n.y:0),r.verticalIconBox&&Hr(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,o.hasIconTextFit?n.x:0,o.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function Hr(e,t,r,o,n){e.emplaceBack(t?1:0,r?1:0,o||0,n||0),e.emplaceBack(t?1:0,r?1:0,o||0,n||0),e.emplaceBack(t?1:0,r?1:0,o||0,n||0),e.emplaceBack(t?1:0,r?1:0,o||0,n||0)}const Gr=Math.pow(2,25),jr=Math.pow(2,24),Wr=Math.pow(2,17),Kr=Math.pow(2,16),Jr=Math.pow(2,9),Zr=Math.pow(2,8),Yr=Math.pow(2,1);function qr(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*Gr+t*jr+r*Wr+t*Kr+r*Jr+t*Zr+r*Yr+t}const $r=0;class Xr{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,r,o,n){const i=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(i,o,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,i.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<i.length;){const e=i[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Qr{constructor(e,t,r,o,n,i,a,s,l){this.placement=new Vr(e,n,i,a,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=o,this._done=!1}isDone(){return this._done}continuePlacement(t,r,o,n){const i=e.f.now(),a=()=>{const t=e.f.now()-i;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const i=r[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=s)&&(!i.maxzoom||i.maxzoom>s)){const t=i,r=t.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new Xr(t),l=e.aj(i.source,i.scope);if(s.continuePlacement(r?n[l]:o[l],this.placement,this._showCollisionBoxes,i,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const eo=512/e.Y/2;class to{constructor(t,r,o){this.tileID=t,this.bucketInstanceId=o,this.index=new e.bj(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=t.canonical.x*e.Y,i=t.canonical.y*e.Y;for(let e=0;e<r.length;e++){const{key:t,crossTileID:o,tileAnchorX:a,tileAnchorY:s}=r.get(e),l=Math.floor((n+a)*eo),c=Math.floor((i+s)*eo);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(o)}this.index.finish()}findMatches(t,r,o){const n=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),i=eo/Math.pow(2,r.canonical.z-this.tileID.canonical.z),a=r.canonical.x*e.Y,s=r.canonical.y*e.Y;for(let e=0;e<t.length;e++){const r=t.get(e);if(r.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=r,d=Math.floor((a+c)*i),h=Math.floor((s+u)*i),f=this.index.range(d-n,h-n,d+n,h+n);for(const e of f){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!o.has(t)){o.add(t),r.crossTileID=t;break}}}}}class ro{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const r in this.indexes){const e=this.indexes[r],o={};for(const r in e){const n=e[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),o[n.tileID.key]=n}this.indexes[r]=o}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let n=0;n<t.symbolInstances.length;n++)t.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const o=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const r=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in r){const i=r[n];i.tileID.isChildOf(e)&&i.findMatches(t.symbolInstances,e,o)}else{const i=r[e.scaledTo(Number(n)).key];i&&i.findMatches(t.symbolInstances,e,o)}}for(let n=0;n<t.symbolInstances.length;n++){const e=t.symbolInstances.get(n);e.crossTileID||(e.crossTileID=r.generate(),o.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new to(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r of t.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const o=this.indexes[r];for(const n in o)e[o[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,o[n]),delete o[n],t=!0)}return t}}class no{constructor(){this.layerIndexes={},this.crossTileIDs=new ro,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,o){let n=this.layerIndexes[e.fqid];void 0===n&&(n=this.layerIndexes[e.fqid]=new oo);let i=!1;const a={};"globe"!==o.name&&n.handleWrapJump(r);for(const s of t){const t=s.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(s.tileID,t,this.crossTileIDs)&&(i=!0),a[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(i=!0),i}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const r in this.layerIndexes)t[r]||delete this.layerIndexes[r]}}class io{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=o}interpolate(t,r,o){return null!=r.top&&null!=t.top&&(this.top=e.X(t.top,r.top,o)),null!=r.bottom&&null!=t.bottom&&(this.bottom=e.X(t.bottom,r.bottom,o)),null!=r.left&&null!=t.left&&(this.left=e.X(t.left,r.left,o)),null!=r.right&&null!=t.right&&(this.right=e.X(t.right,r.right,o)),this}getCenter(t,r){const o=e.ad((this.left+t-this.right)/2,0,t),n=e.ad((this.top+r-this.bottom)/2,0,r);return new e.P(o,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new io(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ao(t,r){const o=e.bn(t,3);e.a9.fromQuat(t,r),e.bp(t,3,o)}function so(t,r){const o=e.bl.identity([]);return e.bl.rotateZ(o,o,-r),e.bl.rotateX(o,o,-t),o}function lo(t,r){const o=[t[0],t[1],0],n=[r[0],r[1],0];if(e.Q.length(o)>=1e-15){const t=e.Q.normalize([],o);e.Q.scale(n,t,e.Q.dot(n,t)),r[0]=n[0],r[1]=n[1]}const i=e.Q.cross([],r,t);if(e.Q.len(i)<1e-15)return null;const a=Math.atan2(-i[1],i[0]);return so(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}class co{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const r=t instanceof e.O?t:new e.O(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=e.bk(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const o=this.position,n=this._elevation?this._elevation.getAtPointOrZero(e.O.fromLngLat(t)):0,i=e.O.fromLngLat(t,n),a=[i.x-o.x,i.y-o.y,i.z-o.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=lo(a,r)}setPitchBearing(t,r){this.orientation=so(e.bm(t),e.bm(-r))}}class uo{constructor(t,r){this._transform=e.a9.identity([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new e.O(t[0],t[1],t[2])}get position(){const t=e.bn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&e.bp(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.bl.identity([]),t&&ao(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=so(e,t),ao(this._transform,this._orientation)}forward(){const t=e.bn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.bn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.bn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const o=new Float64Array(16);return e.a9.invert(o,this.getWorldToCamera(t,r)),o}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,o){const n=this.position;e.Q.scale(n,n,-t);const i=new Float64Array(16);return e.a9.fromScaling(i,[o,o,o]),e.a9.translate(i,i,n),i[10]*=r,i}getWorldToCamera(t,r){const o=new Float64Array(16),n=new Float64Array(4),i=this.position;return e.bl.conjugate(n,this._orientation),e.Q.scale(i,i,-t),e.a9.fromQuat(o,n),e.a9.translate(o,o,i),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=r,o[9]*=r,o[10]*=r,o[11]*=r,o}getCameraToClipPerspective(t,r,o,n){const i=new Float64Array(16);return e.a9.perspective(i,t,r,o,n),i}getCameraToClipOrthographic(t,r,o,n,i,a){const s=new Float64Array(16);return e.a9.ortho(s,t,r,o,n,i,a),s}getDistanceToElevation(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=0===t?0:e.bo(t,r?e.ax(this.position[1]):this.position[1]),n=this.forward();return(o-this.position[2])/n[2]}clone(){return new uo([...this.position],[...this.orientation])}}const ho=(e,t,r)=>(1-r)*e+r*t,fo=e=>e*e*e*e*e;class mo{constructor(t,r,o,n,i,a,s){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=null==o?0:o,this._maxPitch=null==n?60:n,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new io,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new uo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new mo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.af(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=e.br(this.projectionOptions);const n=!t(o,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.br({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bk(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=e.b7.create(),e.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=e.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.bm(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop();let n=0,i=0;for(let a=0;a<r.length;a++){const s=new e.P(r[a][0]*this.width,o+r[a][1]*(this.height-o)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,i+=c}return 0===i?NaN:n/i}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*t,o=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),i=Math.max(o-r,n);this._setZoom(this._zoomFromMercatorZ(i))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let o;o=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const n=e.Q.length(e.Q.sub([],this._camera.position,o));return e.ad(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!e.bl.exactEquals(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const o=[t.position.x,t.position.y,t.position.z];e.Q.exactEquals(o,this._camera.position)||(this._setCameraPosition(o),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new co;return r.position=new e.O(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!e.bl.length(t))return!1;e.bl.normalize(t,t);const r=e.Q.transformQuat([],[0,0,-1],t),o=e.Q.transformQuat([],[0,-1,0],t);if(o[2]<0)return!1;const n=lo(r,o);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.ad(t[2],n/o,n/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const r=[new e.bs(0,t)];if(this.renderWorldCopies){const o=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),i=this.pointCoordinate(new e.P(this.width,this.height)),a=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(o.x,n.x,i.x,a.x)),l=Math.floor(Math.max(o.x,n.x,i.x,a.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&r.push(new e.bs(u,t))}return r}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,r,o){let n=[];if(0===r[0]&&0===r[1])return n;for(const a of t){const t=a.canonical,o=a.overscaledZ,i=a.wrap,s=1<<t.z,l=t.x+1<s,c=t.x>0,u=t.y+1<s,d=t.y>0,h=a.wrap-(c?0:1),f=a.wrap+(l?0:1),m=c?t.x-1:s-1,p=l?t.x+1:0;r[0]<0?(n.push(new e.ap(o,f,t.z,p,t.y)),r[1]<0&&u&&(n.push(new e.ap(o,i,t.z,t.x,t.y+1)),n.push(new e.ap(o,f,t.z,p,t.y+1))),r[1]>0&&d&&(n.push(new e.ap(o,i,t.z,t.x,t.y-1)),n.push(new e.ap(o,f,t.z,p,t.y-1)))):r[0]>0?(n.push(new e.ap(o,h,t.z,m,t.y)),r[1]<0&&u&&(n.push(new e.ap(o,i,t.z,t.x,t.y+1)),n.push(new e.ap(o,h,t.z,m,t.y+1))),r[1]>0&&d&&(n.push(new e.ap(o,i,t.z,t.x,t.y-1)),n.push(new e.ap(o,h,t.z,m,t.y-1)))):r[1]<0&&u?n.push(new e.ap(o,i,t.z,t.x,t.y+1)):d&&n.push(new e.ap(o,i,t.z,t.x,t.y-1))}if(n.length>1){n.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<n.length;)n[t].equals(n[e])?++t:n[++e]=n[t++];n.length=e+1}const i=[];for(const e of n)n.some((t=>e.isChildOf(t)))||i.push(e);return n=i.filter((e=>!t.some((t=>!!(e.overscaledZ<o&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),n}coveringTiles(t){let r=this.coveringZoomLevel(t);const o=r,n=this.elevation&&this.elevation.exaggeration(),i=n&&!t.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<r,u=[c*s.x,c*s.y,0],d="globe"===this.projection.name,h=!d,f=e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,h),m=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),p=c*e.bo(1,this.center.lat),g=this._camera.position[2]/e.bo(1,this.center.lat),_=[c*m.x,c*m.y,g*(h?1:p)],y=d||n,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?r:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const L=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,A=this.projection.isReprojectedInTileSpace?e.bu(this):1,w=t=>{const r=1/4e4,o=new e.O(t.x+r,t.y,t.z),n=new e.O(t.x,t.y+r,t.z),i=t.toLngLat(),a=o.toLngLat(),s=n.toLngLat(),l=this.locationCoordinate(i),c=this.locationCoordinate(a),u=this.locationCoordinate(s),d=Math.hypot(c.x-l.x,c.y-l.y),h=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(d*h)*A/r},S=t=>{const r=b,o=L;return{aabb:e.bx(this,c,0,0,0,t,o,r,this.projection),zoom:0,x:0,y:0,minZ:o,maxZ:r,wrap:t,fullyVisible:!1}},E=[];let T=[];const P=r,C=t.reparseOverscaled?o:r,R=e=>e*e,M=R((g-this._centerAltitude)*p),I=e=>{if(!this._elevation||!e.tileID||!a)return;const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=O(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},O=t=>{if(t.zoom<x)return!0;if(t.zoom===P)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const r=t.aabb.distanceX(_),n=t.aabb.distanceY(_);let a=M,s=1;if(d){a=R(t.aabb.distanceZ(_));const r=Math.pow(2,t.zoom),o=e.ax((t.y+1)/r),n=e.ax(t.y/r),i=Math.min(Math.max(l,o),n),c=e.bM(i)/e.bM(l);if(s=i===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.bJ&&t.zoom===P-1&&c>=.9)return!0}else if(i&&(a=R(t.aabb.distanceZ(_)*p)),this.projection.isReprojectedInTileSpace&&o<=5){const r=Math.pow(2,t.zoom),o=w(new e.O((t.x+.5)/r,(t.y+.5)/r));s=o>.85?1:o}const c=r*r+n*n+a,u=R((1<<P-t.zoom)*v*s*((e,t)=>{if(t*R(.707)<e)return 1;const r=Math.sqrt(t/e);return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(a,M),c));return c<u};if(this.renderWorldCopies)for(let e=1;e<=3;e++)E.push(S(-e)),E.push(S(e));for(E.push(S(0));E.length>0;){const o=E.pop(),n=o.x,s=o.y;let l=o.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===o.y||o.y===(1<<o.zoom)-1);if(!l){let t=y?o.aabb.intersects(f):o.aabb.intersectsFlat(f);if(0===t&&h()){const r=new e.bv(o.zoom,n,s);t=e.bw(this,c,r,!0).intersects(f)}if(0===t)continue;l=2===t}if(o.zoom!==P&&O(o))for(let t=0;t<4;t++){const r=(n<<1)+t%2,u=(s<<1)+(t>>1),h={aabb:a?o.aabb.quadrant(t):e.bx(this,c,o.zoom+1,r,u,o.wrap,o.minZ,o.maxZ,this.projection),zoom:o.zoom+1,x:r,y:u,wrap:o.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:o.minZ,maxZ:o.maxZ};i&&!d&&(h.tileID=new e.ap(o.zoom+1===P?C:o.zoom+1,o.wrap,o.zoom+1,r,u),I(h)),E.push(h)}else{const i=o.zoom===P?C:o.zoom;if(t.minzoom&&t.minzoom>i)continue;if(!l){let t=y?o.aabb.intersectsPrecise(f):o.aabb.intersectsPreciseFlat(f);if(0===t&&h()){const r=new e.bv(o.zoom,n,s);t=e.bw(this,c,r,!0).intersectsPrecise(f)}if(0===t)continue}const a=u[0]-(.5+n+(o.wrap<<o.zoom))*(1<<r-o.zoom),d=u[1]-.5-s,m=o.tileID?o.tileID:new e.ap(i,o.wrap,o.zoom,n,s);T.push({tileID:m,distanceSq:a*a+d*d})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,o=this.horizonLineFromTop();T=T.filter((n=>{const i=[0,0,0,1],a=[e.Y,e.Y,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.aa.transformMat4(i,i,s),e.aa.transformMat4(a,a,s);const l=e.aa.min([],i,a),c=e.aa.max([],i,a),u=e.by(l,c);if(0===u)return!0;let d=!1;const h=this._elevation;if(h&&u>r&&0!==o){const r=this.calculateProjMatrix(n.tileID.toUnwrapped());let i;t.isTerrainDEM||(i=h.getMinMaxForTile(n.tileID)),i||(i={min:L,max:b});const a=e.bK(this.rotation),s=[a[0]*e.Y,a[1]*e.Y,i.max];e.Q.transformMat4(s,s,r),d=(1-s[1])*this.height*.5<o}return u<r||d}))}return T.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const r=e.ad(t.lat,-e.bz,e.bz),o=this.projection.project(t.lng,r);return new e.P(o.x*this.worldSize,o.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let o,n;const i=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;o=(r.x-i.x)/e,n=(r.y-i.y)/e}else{const e=this.pointCoordinate(r),t=this.pointCoordinate(i);o=e.x-t.x,n=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.O(a.x-o,a.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,r){const o=r?e.bo(r,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.O(n.x,n.y,o)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,r){const o=null!=r?r:this._centerAltitude,n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];e.aa.transformMat4(n,n,this.pixelMatrixInverse),e.aa.transformMat4(i,i,this.pixelMatrixInverse);const a=i[3];e.aa.scale(n,n,1/n[3]),e.aa.scale(i,i,1/a);const s=n[2],l=i[2];return{p0:n,p1:i,t:s===l?0:(o-s)/(l-s)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];return e.aa.transformMat4(r,r,this.pixelMatrixInverse),e.aa.transformMat4(o,o,this.pixelMatrixInverse),e.aa.scale(r,r,1/r[3]),e.aa.scale(o,o,1/o[3]),r[2]=e.bo(r[2],this._center.lat)*this.worldSize,o[2]=e.bo(o[2],this._center.lat)*this.worldSize,e.aa.scale(r,r,1/this.worldSize),e.aa.scale(o,o,1/this.worldSize),new e.a5([r[0],r[1],r[2]],e.Q.normalize([],e.Q.sub([],o,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:o,t:n}=t,i=e.bo(r[2],this._center.lat),a=e.bo(o[2],this._center.lat);return new e.O(e.X(r[0],o[0],n)/this.worldSize,e.X(r[1],o[1],n)/this.worldSize,e.X(i,a,n))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new e.O(r[0],r[1],r[2]);let o=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const i=.02*n,a=t.clone();for(let s=0;s<10&&n-o>i;s++){a.y=e.X(o,n,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(n=a.y,r=t):o=a.y}return r?new e.O(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.bA)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const o=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,o+t.toAltitude(),1];return e.aa.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.P(n[0]/n[3],n[1]/n[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,i=this.pointLocation3D(new e.P(r,t)),a=this.pointLocation3D(new e.P(n,t)),s=this.pointLocation3D(new e.P(n,o)),l=this.pointLocation3D(new e.P(r,o));let c=Math.min(i.lng,a.lng,s.lng,l.lng),u=Math.max(i.lng,a.lng,s.lng,l.lng),d=Math.min(i.lat,a.lat,s.lat,l.lat),h=Math.max(i.lat,a.lat,s.lat,l.lat);const f=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,p=(t,r,o,n,i)=>{const a=(t+o)/2,s=(r+n)/2,l=new e.P(a,s),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,d-_,g-u,_-h);c=Math.min(c,g),u=Math.max(u,g),d=Math.min(d,_),h=Math.max(h,_),(i<m||y>f)&&(p(t,r,a,s,i+1),p(a,s,o,n,i+1))};if(p(r,t,n,t,1),p(n,t,n,o,1),p(n,o,r,o,1),p(r,o,r,t,1),"globe"===this.projection.name){const[t,r]=e.bB(this);t?(h=90,u=180,c=-180):r&&(d=-90,u=180,c=-180)}return new e.ag(new e.bq(c,d),new e.bq(u,h))}_getBoundsRectangular(t,r){const{top:o,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,s=new e.P(n,o),l=new e.P(a,o),c=new e.P(a,i),u=new e.P(n,i);let d=this.pointCoordinate(s,t),h=this.pointCoordinate(l,t);const f=this.pointCoordinate(c,r),m=this.pointCoordinate(u,r),p=(e,t)=>(t.y-e.y)/(t.x-e.x);return d.y>1&&h.y>=0?d=new e.O((1-m.y)/p(m,d)+m.x,1):d.y<0&&h.y<=1&&(d=new e.O(-m.y/p(m,d)+m.x,0)),h.y>1&&d.y>=0?h=new e.O((1-f.y)/p(f,h)+f.x,1):h.y<0&&d.y<=1&&(h=new e.O(-f.y/p(f,h)+f.x,0)),(new e.ag).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(f))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const r=t.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.bz,this.maxLat=e.bz,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.a8(this.minLng)*this.tileSize,this.worldMaxX=e.a8(this.maxLng)*this.tileSize,this.worldMinY=e.ah(this.maxLat)*this.tileSize,this.worldMaxY=e.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const r=t.key,o=this._distanceTileDataCache;if(o[r])return o[r];const n=t.canonical,i=1/this.height,a=this.cameraWorldSize,s=a/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*t.wrap)*s,c=n.y*s,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const d=this.angle,h=Math.sin(-d),f=-Math.cos(-d);return o[r]={bearing:[h,f],center:[(u.x-l)*i,(u.y-c)*i],scale:s/e.Y*i},o[r]}calculateFogTileMatrix(t){const r=t.key,o=this._fogTileMatrixCache;if(o[r])return o[r];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.a9.multiply(n,this.worldToFogMatrix,n),o[r]=new Float32Array(n),o[r]}calculateProjMatrix(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.key;let i;if(i=o?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,i[n])return i[n];const a=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,e.a9.multiply(a,s,a),i[n]=new Float32Array(a),i[n]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,o=this._pixelsToTileUnitsCache;if(o[r])return o[r];const n=e.bC(t,this);return o[r]=n,o[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=e.a9.fromScaling([],[t,t,t]);return e.a9.multiply(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=e.bo(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(r),n=this._camera.forward(),i=e.bo(1,this._center.lat);o[2]/=i,n[2]/=i,e.Q.normalize(n,n);const a=t.raycast(o,n,t.exaggeration());if(a){const t=e.Q.scaleAndAdd([],o,n,a),r=new e.O(t[0],t[1],e.bo(t[2],e.ax(t[1]))),s=(r.z+e.Q.length([r.x-o[0],r.y-o[1],r.z-o[2]*i]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const r=this._elevation,o=e.bo(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(o),i=r.getAtPointOrZero(new e.O(...n)),a=this.pixelsPerMeter/this.worldSize*i,s=this._minimumHeightOverTerrain(),l=n[2]-a;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),r=[n[0],n[1],t.z-n[2]],o=e.Q.length(r);r[2]-=(s-l)/this._pixelsPerMercatorPixel;const i=e.Q.length(r);if(0===i)return;e.Q.scale(r,r,o/i*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],t.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const r=this.center;return r.lat=e.ad(r.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(r.lng=e.ad(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}const r=this._unmodified,{x:o,y:n}=this.point;let i=0,a=o,s=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,d=this.worldMaxY*this.scale;if(n-c<u&&(s=u+c),n+c>d&&(s=d-c),d-u<this.height&&(i=Math.max(i,this.height/(d-u)),s=(d+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;a=(o+r+this.worldSize)%this.worldSize-r,a-l<e&&(a=e+l),a+l>t&&(a=t-l),t-e<this.width&&(i=Math.max(i,this.width/(t-e)),a=(t+e)/2)}a===o&&s===n||(this.center=this.unproject(new e.P(a,s))),i&&(this.zoom+=this.scaleZoom(i)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.bo(1,this.center.lat)/e.bo(1,e.bL));const n=e.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const i="meters"===this.projection.zAxisUnit?o:1,a=this._camera.getWorldToCamera(this.worldSize,i);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),r=e*this.aspect,o=-r,n=-e;r-=t.x,o-=t.x,e+=t.y,n+=t.y,s=this._camera.getCameraToClipOrthographic(o,r,n,e,this._nearZ,this._farZ),((e,t,r,o)=>{for(let n=0;n<16;n++)e[n]=ho(t[n],r[n],o)})(s,s,l,fo(this.pitch>=15?1:this.pitch/15))}else s=l;const c=e.a9.mul([],l,a);let u=e.a9.mul([],s,a);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),r=e.a9.identity([]);e.a9.translate(r,r,[t.x*this.worldSize,t.y*this.worldSize,0]),e.a9.multiply(r,r,e.bE(this)),e.a9.translate(r,r,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.a9.multiply(u,u,r),e.a9.multiply(c,c,r),this.inverseAdjustmentMatrix=e.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.a9.scale([],u,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=u,this.invProjMatrix=e.a9.invert(new Float64Array(16),this.projMatrix),r){const r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);r[8]=2*-t.x/this.width,r[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.a9.mul([],r,a)}else this.expandedFarZProjMatrix=this.projMatrix;const d=e.a9.invert([],s);this.frustumCorners=e.bG.fromInvProjectionMatrix(d,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const h=new Float32Array(16);e.a9.identity(h),e.a9.scale(h,h,[1,-1,1]),e.a9.rotateX(h,h,this._pitch),e.a9.rotateZ(h,h,this.angle);const f=e.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.a9.clone(f);const m=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;f[8]=2*-t.x/this.width,f[9]=2*(t.y+m)/this.height,this.skyboxMatrix=e.a9.multiply(h,f,h);const p=this.point,g=p.x,_=p.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),L=g-Math.round(g)+x*y+b*v,A=_-Math.round(_)+x*v+b*y,w=new Float64Array(u);if(e.a9.translate(w,w,[L>.5?L-1:L,A>.5?A-1:A,0]),this.alignedProjMatrix=w,u=e.a9.create(),e.a9.scale(u,u,[this.width/2,-this.height/2,1]),e.a9.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.a9.create(),e.a9.scale(u,u,[1,-1,1]),e.a9.translate(u,u,[-1,-1,0]),e.a9.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.a9.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.bH(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.Q.transformMat4(t,t,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,o=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,i=[t,t,r];e.Q.scale(i,i,n),e.Q.scale(o,o,-1),e.Q.multiply(o,o,i);const a=e.a9.create();e.a9.translate(a,a,o),e.a9.scale(a,a,i),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),o=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[o.x/this.worldSize-r[0]*n,o.y/this.worldSize-r[1]*n,e/this.worldSize*this._centerAltitude-r[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=this._camera.position[2],n=t[2];let i=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(i=Math.min((r-o)/n,1)),this._camera.position=e.Q.scaleAndAdd([],this._camera.position,t,i),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:o,bearing:n}=this._camera.getPitchBearing(),i=e.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.bm(this._maxPitch)),s=Math.max((t[2]-i)/Math.cos(o),a),l=this._zoomFromMercatorZ(s);e.Q.scaleAndAdd(t,t,r,s),this._pitch=e.ad(o,e.bm(this.minPitch),e.bm(this.maxPitch)),this.angle=e.bk(n,-Math.PI,Math.PI),this._setZoom(e.ad(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.O(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,o=e.bA,n=0,i=1/0;for(;o-r>1e-6&&o>r;){const e=r+.5*(o-r),a=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,a),l=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(e-l);c<i&&(i=c,n=e),e<l?r=e:o=e}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const o=Math.min(t.x,r.x),n=Math.max(t.x,r.x),i=Math.min(t.y,r.y),a=Math.max(t.y,r.y);if(i<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.P(o,i),new e.P(n,a),new e.P(o,a),new e.P(n,i)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const r=this.rayIntersectionCoordinate(t);if(r.x<l||r.y<0||r.x>c||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,r){const o=e.Q.length(e.Q.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(o)+r;return o-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,r){let[o,n,i]=t;const a=[o,n,i,1];e.aa.transformMat4(a,a,r);const s=a[3]=Math.max(a[3],1e-6);return a[0]/=s,a[1]/=s,a[2]/=s,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const n=e.bD(t,r,this.width,this.height,1024),i=t.pixelSpaceConversion(this.center.lat,o,n);let a=.5/Math.tan(.5*this._fov)*this.height*i;return this.isOrthographic&&(a=ho(1,a,fo(this.pitch>=15?1:this.pitch/15))),a}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.a9.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},go=(t,r)=>{if(r>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),r<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=t.transform,n=Math.max(Math.abs(o._zoom-(t.minCutoffZoom-1)),1),i=o.isLODDisabled(!1)?e.S(60,45,o.pitch):e.S(30,15,o.pitch),a=o._farZ-o._nearZ,s=r*o.height,l=((1-(c=i))*o.cameraToCenterDistance+c*(o._farZ+s))*n;var c;return{shouldRenderCutoff:i<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(l-o._nearZ)/a,(l-s-o._nearZ)/a]}}},_o={cascadeCount:2,shadowMapResolution:2048};class yo{constructor(e,t){this.aabb=e,this.lastCascade=t}}class vo{add(e,t){const r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],t.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],t.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],t.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],t.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],t.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],t.max[2])):this.receivers[e.key]=new yo(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,r,o){const n=e.bV.fromPoints(t.points);let i=0;for(const a in this.receivers){const t=this.receivers[a];if(!t)continue;if(!n.intersectsAabb(t.aabb))continue;t.aabb.min=n.closestPoint(t.aabb.min),t.aabb.max=n.closestPoint(t.aabb.max);const s=t.aabb.getCorners();for(let n=0;n<o.length;n++){let a=!0;for(const t of s){const i=[t[0]*r,t[1]*r,t[2]];if(e.Q.transformMat4(i,i,o[n].matrix),i[0]<-1||i[0]>1||i[1]<-1||i[1]>1){a=!1;break}}if(t.lastCascade=n,i=Math.max(i,n),a)break}}return i+1}}class xo{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vo,this._depthMode=new Et(e.context.gl.LEQUAL,Et.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),e.tp.registerParameter(_o,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(_o,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const n=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=o.style.order.reduce(((e,r)=>{const n=o.style._mergedLayers[r];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const i=o.context,a=_o.shadowMapResolution,s=_o.shadowMapResolution;if(0===this._cascades.length||_o.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<_o.cascadeCount;++t){const t=o._shadowMapDebug,r=i.gl,n=i.createFramebuffer(a,s,t,"texture"),l=new e.T(i,{width:a,height:s,data:null},r.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),t){const t=new e.T(i,{width:a,height:s,data:null},r.RGBA);n.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.bt,scale:0})}}this.shadowDirection=Lo(r);let l=0;if(t.elevation){const e=t.elevation,r=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;r[0]=Math.min(r[0],t.minimums[0]),r[1]=Math.max(r[1],t.maximums[0])})),1e4!==r[0]&&(l=(r[1]-r[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,d=new Float64Array(16);for(let m=0;m<this._cascades.length;++m){const r=this._cascades[m];let o=t.height/50,n=1;1===_o.cascadeCount?n=u:0===m?n=c:(o=c,n=u);const[i,a]=wo(t,this.shadowDirection,o,n,_o.shadowMapResolution,l);r.scale=t.scale,r.matrix=i,r.boundingSphereRadius=a,e.a9.invert(d,r.matrix),r.frustum=e.bt.fromInvProjectionMatrix(d,1,0,!0),r.far=n}const h=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[h].far,this._cascades[h].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/_o.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=_o.shadowMapResolution,this._uniformValues.u_shadowmap_0=po.ShadowMap0,this._uniformValues.u_shadowmap_1=po.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const f=o.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(f){const r=f.getMinMaxForTile(e);r&&(t=r)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,r){if(!this.enabled)return;const o=this.painter,n=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),n.viewport.set([0,0,_o.shadowMapResolution,_o.shadowMapResolution]);for(let i=0;i<this._numCascadesToRender;++i){o.currentShadowCascade=i,n.bindFramebuffer.set(this._cascades[i].framebuffer.framebuffer),n.clear({color:e.aA.white,depth:1});for(const e of t.order){const n=t._mergedLayers[e];if(!n.hasShadowPass()||n.isHidden(o.transform.zoom))continue;const i=t.getLayerSourceCache(n),a=i?r[i.id]:void 0;("model"===n.type||a&&a.length)&&o.renderLayer(o,i,n,a)}}o.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,r=e.context,o=t.directionalLight,n=t.ambientLight;if(!o||!n)return;const i=[],a=go(e,e.longestCutoffRange);a.shouldRenderCutoff&&i.push("RENDER_CUTOFF");const s=Ao(o,n),l=new Et(r.gl.LEQUAL,Et.ReadOnly,e.depthRangeFor3D);for(const c of this._groundShadowTiles){const t=c.toUnwrapped(),o=e.isTileAffectedByFog(c),n=e.getOrCreateProgram("groundShadow",{defines:i,overrideFog:o});this.setupShadows(t,n),e.uploadCommonUniforms(r,n,t,null,a);const u={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:s};n.draw(e,r.gl.TRIANGLES,l,Pt.disabled,Rt.multiply,Ot.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Rt.unblended:Rt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,o=r.calculatePosMatrix(t,r.worldSize);return e.a9.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}calculateShadowPassMatrixFromMatrix(t){return e.a9.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.enabled)return;const i=this.painter.transform,a=this.painter.context,s=a.gl,l=this._uniformValues,c=new Float64Array(16),u=i.calculatePosMatrix(t,i.worldSize);for(let d=0;d<this._cascades.length;d++)e.a9.multiply(c,this._cascades[d].matrix,u),l[0===d?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),a.activeTexture.set(s.TEXTURE0+po.ShadowMap0+d),this._cascades[d].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!o,this.useNormalOffset){const r=e.bU(t.canonical),a=2/i.tileSize*e.Y/_o.shadowMapResolution,s=a*this._cascades[0].boundingSphereRadius,c=a*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===o?1:3)/Math.pow(2,n-t.canonical.z-(1-i.zoom+Math.floor(i.zoom)));l.u_shadow_normal_offset=[r,s*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(a,l)}setupShadowsFromMatrix(t,r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const n=this.painter.context,i=n.gl,a=this._uniformValues,s=new Float64Array(16);for(let l=0;l<_o.cascadeCount;l++)e.a9.multiply(s,this._cascades[l].matrix,t),a[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),n.activeTexture.set(i.TEXTURE0+po.ShadowMap0+l),this._cascades[l].texture.bind(i.NEAREST,i.CLAMP_TO_EDGE);if(this.useNormalOffset=o,o){const e=5;a.u_shadow_normal_offset=[1,e,e],a.u_shadow_bias=[6e-5,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(n,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,o,n){if(n[2]>=0)return{};const i=function(t,r,o){const n=o/(1<<t.canonical.z);return new e.bV([t.canonical.x*n+t.wrap*o,t.canonical.y*n+t.wrap*o,0],[(t.canonical.x+1)*n+t.wrap*o,(t.canonical.y+1)*n+t.wrap*o,r])}(t,r,o).getCorners(),a=r/-n[2];n[0]<0?(e.Q.add(i[0],i[0],[n[0]*a,0,0]),e.Q.add(i[3],i[3],[n[0]*a,0,0])):n[0]>0&&(e.Q.add(i[1],i[1],[n[0]*a,0,0]),e.Q.add(i[2],i[2],[n[0]*a,0,0])),n[1]<0?(e.Q.add(i[0],i[0],[0,n[1]*a,0]),e.Q.add(i[1],i[1],[0,n[1]*a,0])):n[1]>0&&(e.Q.add(i[2],i[2],[0,n[1]*a,0]),e.Q.add(i[3],i[3],[0,n[1]*a,0]));const s={};return s.vertices=i,s.planes=[bo(i[1],i[0],i[4]),bo(i[2],i[1],i[5]),bo(i[3],i[2],i[6]),bo(i[0],i[3],i[7])],s}addShadowReceiver(t,r,o){this._receivers.add(t,e.bV.fromTileIdAndHeight(t,r,o))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function bo(t,r,o){const n=e.Q.sub([],o,r),i=e.Q.sub([],t,r),a=e.Q.cross([],n,i),s=e.Q.length(a);return 0===s?[0,0,1,0]:(e.Q.scale(a,a,1/s),[a[0],a[1],a[2],-e.Q.dot(a,r)])}function Lo(t){const r=t.properties.get("direction"),o=e.bT(r.x,r.y,r.z);o[2]=e.ad(o[2],0,75);const n=e.bW([o[0],o[1],o[2]]);return e.Q.fromValues(n.x,n.y,n.z)}function Ao(t,r){const o=t.properties.get("color"),n=t.properties.get("intensity"),i=t.properties.get("direction"),a=[i.x,i.y,i.z],s=r.properties.get("color"),l=r.properties.get("intensity"),c=Math.max(e.Q.dot([0,0,1],a),0),u=[0,0,0];e.Q.scale(u,s.toArray01Linear().slice(0,3),l);const d=[0,0,0];return e.Q.scale(d,o.toArray01Linear().slice(0,3),c*n),e.bX([u[0]>0?u[0]/(u[0]+d[0]):0,u[1]>0?u[1]/(u[1]+d[1]):0,u[2]>0?u[2]/(u[2]+d[2]):0])}function wo(t,r,o,n,i,a){const s=t.zoom,l=t.scale,c=t.worldSize,u=1/c,d=t.aspect,h=Math.sqrt(1+d*d)*Math.tan(.5*t.fovX),f=h*h,m=n-o,p=n+o;let g,_;f>m/p?(g=n,_=n*h):(g=.5*p*(1+f),_=.5*Math.sqrt(m*m+2*(n*n+o*o)*f+p*p*f*f));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*u];e.Q.transformMat4(x,x,v);let b=_*u;const L=t._edgeInsets;if(!(0===L.left&&0===L.top&&0===L.right&&0===L.bottom||L.left===L.right&&L.top===L.bottom)){const r=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),i=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,o,n);i[8]=2*-t.centerOffset.x/t.width,i[9]=2*t.centerOffset.y/t.height;const a=new Float64Array(16);e.a9.mul(a,i,r);const u=new Float64Array(16);e.a9.invert(u,a);const d=e.bt.fromInvProjectionMatrix(u,c,s,!0);for(const o of d.points){const r=((A=o)[0]/=l,A[1]/=l,A[2]=e.bo(A[2],t._center.lat),A);b=Math.max(b,e.Q.len(e.Q.subtract([],x,r)))}}var A;b*=i/(i-1);const w=Math.acos(r[2]),S=Math.atan2(-r[0],-r[1]),E=new uo;E.position=x,E.setPitchBearing(w,S);const T=E.getWorldToCamera(c,y),P=b*c,C=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*P),R=E.getCameraToClipOrthographic(-P,P,-P,P,C,(P+a*y)/r[2]),M=new Float64Array(16);e.a9.multiply(M,R,T);const I=e.Q.fromValues(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),O=.5*i,D=[0,0,0];e.Q.transformMat4(D,I,M),e.Q.scale(D,D,O);const k=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],N=[0,0,0];e.Q.sub(N,D,k),e.Q.scale(N,N,-1/O);const B=new Float64Array(16);return e.a9.identity(B),e.a9.translate(B,B,N),e.a9.multiply(M,B,M),[M,P]}const So=(e,t)=>ae(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),Eo=e.af(tr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),To=e.af(tr,["setCenter","setZoom","setBearing","setPitch"]),Po={version:8,layers:[],sources:{}},Co={duration:300,delay:0};class Ro extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=e.e({},Co),this._buildingIndex=new Xt(this),this.crossTileSymbolIndex=new no,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new y,this.dispatcher=r.dispatcher?r.dispatcher:new e.bZ(e.b_(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new L,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new e.b$(t._requestManager,r.localFontFamily?e.c0.all:r.localIdeographFontFamily?e.c0.ideographs:e.c0.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new v(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",e.c1());const o=this;this._rtlTextPluginCallback=Ro.registerForPluginStateChange((t=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,r)=>{if(e.c2(t),r&&r.every((e=>e)))for(const e in o._sourceCaches){const t=o._sourceCaches[e],r=t.getSource().type;"vector"!==r&&"geojson"!==r||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===t.id&&this._validateLayer(e)}}))}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.c3(t))return t;const r=e.c4(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch(e){return r}return r}return`json://${e.c5(JSON.stringify(t))}`}_diffStyle(t,r,o){this.globalId=this._getGlobalId(t);const n=(e,t)=>{try{t(null,this.setState(e,o))}catch(e){t(e,!1)}};if("string"==typeof t){const o=this.map._requestManager.normalizeStyleURL(t),i=this.map._requestManager.transformRequest(o,e.R.Style);e.g(i,((t,o)=>{t?this.fire(new e.a(t)):o&&n(o,r)}))}else"object"==typeof t&&n(t,r)}loadURL(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.b("dataloading",{dataType:"style"}));const o="boolean"==typeof r.validate?r.validate:!e.c3(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const n=this.importsCache.get(t);if(n)return this._load(n,o);const i=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.g(i,((r,n)=>{if(this._request=null,r)this.fire(new e.a(r));else if(n)return this.importsCache.set(t,n),this._load(n,o)}))}loadJSON(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.f.frame((()=>{this._request=null,this._load(t,!1!==r.validate)}))}loadEmpty(){this.fire(new e.b("dataloading",{dataType:"style"})),this._load(Po,!1)}_loadImports(t,r,o){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const e of t){const t=this._createFragmentStyle(e),i=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(n.push(i),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const a=e.data||this.importsCache.get(e.url);a?(t.loadJSON(a,{validate:r}),this._isInternalStyle(a)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:r}):t.loadEmpty();const s={style:t,id:e.id,config:e.config};if(o){const e=this.fragments.findIndex((e=>{let{id:t}=e;return t===o}));this.fragments=this.fragments.slice(0,e).concat(s).concat(this.fragments.slice(e))}else this.fragments.push(s)}return Promise.allSettled(n)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const r of e.fragments)r.style.globalId&&t.add(r.style.globalId),this.getImportGlobalIds(r.style,t);return[...t.values()]}_createFragmentStyle(t){const r=this.scope?e.aj(t.id,this.scope):t.id;let o;const n=this._initialConfig&&this._initialConfig[r];(t.config||n)&&(o=e.e({},t.config,n));const i=new Ro(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:o,configOptions:this.options,configDependentLayers:this._configDependentLayers});return i.setEventedParent(this.map,{style:i}),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,r){const o=t.schema;if(this._isInternalStyle(t)){const o=e.e({},Po,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(o,r)}if(this.updateConfig(this._config,o),r&&So(this,Z(t)))return;this._loaded=!0,this.stylesheet=e.c6(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const n=er(this.stylesheet.layers);if(this._order=n.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new le(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new le(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const s of n){const t=e.c7(s,this.scope,this.options);t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const r=this.getOwnLayerSourceCache(t),o=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&t.canCastShadows()&&o&&(r.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const i=this.stylesheet.terrain;i&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(i,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.b("data",{dataType:"style"}));const a=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then((()=>{this._reloadImports(),this.fire(new e.b(a?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new e.b(a?"style.load":"style.import.load")))}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,r,o,n,i,a,s,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(r=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(o=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(i=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(a=e.stylesheet.projection),null!=e.stylesheet.transition&&(s=e.stylesheet.transition)}})),this.light=t,this.ambientLight=r,this.directionalLight=o,this.fog=i,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=e.e({},Co,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=r=>{for(const e of r.fragments)t(e.style);e(r)};t(this)}_prioritizeTerrain(e,t,r){const o=e&&0===e.drapeRenderMode;return null===r?t&&0===t.drapeRenderMode?t:o?e:null:null!=t&&(!e||o||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},r={},o={};this.forEachFragmentStyle((n=>{for(const r in n._sourceCaches){const o=e.aj(r,n.scope);t[o]=n._sourceCaches[r]}for(const t in n._otherSourceCaches){const o=e.aj(t,n.scope);r[o]=n._otherSourceCaches[t]}for(const t in n._symbolSourceCaches){const r=e.aj(t,n.scope);o[r]=n._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=o}mergeLayers(){var t=this;const r={},o=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((t=>{for(const n of t._order){const i=t._layers[n];if("slot"===i.type){const t=e.c8(n);if(r[t])continue;r[t]=[]}i.slot&&r[i.slot]?r[i.slot].push(i):o.push(i)}})),this._mergedOrder=[];const i=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const a of o)if("slot"===a.type){const t=e.c8(a.id);r[t]&&i(r[t])}else{const r=e.aj(a.id,a.scope);t._mergedOrder.push(r),n[r]=a,a.is3D()&&(t._has3DLayers=!0),"circle"===a.type&&(t._hasCircleLayers=!0),"symbol"===a.type&&(t._hasSymbolLayers=!0)}};i(o),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.e({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,r,o){let n,i,a;const s=e.f.devicePixelRatio>1?"@2x":"";let l=e.g(r.transformRequest(r.normalizeSpriteURL(t,s,".json"),e.R.SpriteJSON),((e,t)=>{l=null,a||(a=e,n=t,u())})),c=e.d(r.transformRequest(r.normalizeSpriteURL(t,s,".png"),e.R.SpriteImage),((e,t)=>{c=null,a||(a=e,i=t,u())}));function u(){if(a)o(a);else if(n&&i){const t=e.f.getImageData(i),r={};for(const o in n){const{width:i,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:d,stretchY:h,content:f}=n[o],m=new e.h({width:i,height:a});e.h.copy(t,m,{x:s,y:l},{x:0,y:0},{width:i,height:a}),r[o]={data:m,pixelRatio:u,sdf:c,stretchX:d,stretchY:h,content:f}}o(null,r)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,r)=>{if(this._spriteRequest=null,t)this.fire(new e.a(t));else if(r)for(const e in r)this.imageManager.addImage(e,this.scope,r[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.b("data",{dataType:"style"}))}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const o=t.sourceLayer;o&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(o))&&this.fire(new e.a(new Error(`Source layer "${o}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const r=this.fragments[t];return r&&r.style&&(e.data=r.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new e.a(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const o=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:r,removedIds:o}=e[t];(r||o)&&this._updateWorkerLayers(t,r,o)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const n={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];n[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const r=this._mergedLayers[e];if(r.recalculate(t,this._availableImages),!r.isHidden(t.zoom)){const e=this.getLayerSourceCache(r);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,r.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let e=r.minzoom||0;e<(r.maxzoom||25.5);e++){const e=this.map.painter;if(e){const o=r.getProgramIds();if(!o)continue;for(const n of o){const o=r.getDefaultProgramParams(n,t.zoom);o&&(e.style=this,this.fog&&(e._fogVisible=!0,o.overrideFog=!0,e.getOrCreateProgram(n,o)),e._fogVisible=!1,o.overrideFog=!1,e.getOrCreateProgram(n,o),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(o.overrideRtt=!0,e.getOrCreateProgram(n,o)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const i in n){const t=this._mergedSourceCaches[i];n[i]!==t.used&&t.getSource().fire(new e.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new e.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,r){const o=this.getFragmentStyle(e);o&&this.dispatcher.broadcast("updateLayers",{layers:t?o._serializeLayers(t):[],scope:e,removedIds:r||[],options:o.options})}setState(r,o){if(this._checkLoaded(),So(this,Z(r)))return!1;(r=e.c6(r)).layers=er(r.layers);const n=function(e,r){if(!e)return[{command:tr.setStyle,args:[r]}];let o=[];try{if(!t(e.version,r.version))return[{command:tr.setStyle,args:[r]}];t(e.center,r.center)||o.push({command:tr.setCenter,args:[r.center]}),t(e.zoom,r.zoom)||o.push({command:tr.setZoom,args:[r.zoom]}),t(e.bearing,r.bearing)||o.push({command:tr.setBearing,args:[r.bearing]}),t(e.pitch,r.pitch)||o.push({command:tr.setPitch,args:[r.pitch]}),t(e.sprite,r.sprite)||o.push({command:tr.setSprite,args:[r.sprite]}),t(e.glyphs,r.glyphs)||o.push({command:tr.setGlyphs,args:[r.glyphs]}),t(e.imports,r.imports)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2?arguments[2]:void 0;r=r||[];const n=(e=e||[]).map(sr),i=r.map(sr),a=e.reduce(lr,{}),s=r.reduce(lr,{}),l=n.slice();let c,u,d,h;for(c=0,u=0;c<n.length;c++)d=n[c],s.hasOwnProperty(d)?u++:(o.push({command:tr.removeImport,args:[d]}),l.splice(l.indexOf(d,u),1));for(c=0,u=0;c<i.length;c++)d=i[i.length-1-c],l[l.length-1-c]!==d&&(a.hasOwnProperty(d)?(o.push({command:tr.removeImport,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,h=l[l.length-c],o.push({command:tr.addImport,args:[s[d],h]}),l.splice(l.length-c,0,d));for(const f of r){const e=a[f.id];e&&!t(e,f)&&o.push({command:tr.updateImport,args:[f.id,f]})}}(e.imports,r.imports,o),t(e.transition,r.transition)||o.push({command:tr.setTransition,args:[r.transition]}),t(e.light,r.light)||o.push({command:tr.setLight,args:[r.light]}),t(e.fog,r.fog)||o.push({command:tr.setFog,args:[r.fog]}),t(e.projection,r.projection)||o.push({command:tr.setProjection,args:[r.projection]}),t(e.lights,r.lights)||o.push({command:tr.setLights,args:[r.lights]}),t(e.camera,r.camera)||o.push({command:tr.setCamera,args:[r.camera]});const n={},i=[];!function(e,r,o,n){let i;for(i in r=r||{},e=e||{})e.hasOwnProperty(i)&&(r.hasOwnProperty(i)||or(i,o,n));for(i in r){if(!r.hasOwnProperty(i))continue;const a=r[i];e.hasOwnProperty(i)?t(e[i],a)||("geojson"===e[i].type&&"geojson"===a.type&&ir(e,r,i)?o.push({command:tr.setGeoJSONSourceData,args:[i,a.data]}):nr(i,r,o,n)):rr(i,r,o)}}(e.sources,r.sources,i,n);const a=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?o.push({command:tr.removeLayer,args:[e.id]}):a.push(e)}));let s=e.terrain;s&&n[s.source]&&(o.push({command:tr.setTerrain,args:[void 0]}),s=void 0),o=o.concat(i),t(s,r.terrain)||o.push({command:tr.setTerrain,args:[r.terrain]}),function(e,r,o){r=r||[];const n=(e=e||[]).map(sr),i=r.map(sr),a=e.reduce(lr,{}),s=r.reduce(lr,{}),l=n.slice(),c=Object.create(null);let u,d,h,f,m,p,g;for(u=0,d=0;u<n.length;u++)h=n[u],s.hasOwnProperty(h)?d++:(o.push({command:tr.removeLayer,args:[h]}),l.splice(l.indexOf(h,d),1));for(u=0,d=0;u<i.length;u++)h=i[i.length-1-u],l[l.length-1-u]!==h&&(a.hasOwnProperty(h)?(o.push({command:tr.removeLayer,args:[h]}),l.splice(l.lastIndexOf(h,l.length-d),1)):d++,p=l[l.length-u],o.push({command:tr.addLayer,args:[s[h],p]}),l.splice(l.length-u,0,h),c[h]=!0);for(u=0;u<i.length;u++)if(h=i[u],f=a[h],m=s[h],!c[h]&&!t(f,m))if(t(f.source,m.source)&&t(f["source-layer"],m["source-layer"])&&t(f.type,m.type)){for(g in ar(f.layout,m.layout,o,h,null,tr.setLayoutProperty),ar(f.paint,m.paint,o,h,null,tr.setPaintProperty),t(f.slot,m.slot)||o.push({command:tr.setSlot,args:[h,m.slot]}),t(f.filter,m.filter)||o.push({command:tr.setFilter,args:[h,m.filter]}),t(f.minzoom,m.minzoom)&&t(f.maxzoom,m.maxzoom)||o.push({command:tr.setLayerZoomRange,args:[h,m.minzoom,m.maxzoom]}),f)f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?ar(f[g],m[g],o,h,g.slice(6),tr.setPaintProperty):t(f[g],m[g])||o.push({command:tr.setLayerProperty,args:[h,g,m[g]]}));for(g in m)m.hasOwnProperty(g)&&!f.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?ar(f[g],m[g],o,h,g.slice(6),tr.setPaintProperty):t(f[g],m[g])||o.push({command:tr.setLayerProperty,args:[h,g,m[g]]}))}else o.push({command:tr.removeLayer,args:[h]}),p=l[l.lastIndexOf(h)+1],o.push({command:tr.addLayer,args:[m,p]})}(a,r.layers,o)}catch(e){console.warn("Unable to compute style diff:",e),o=[{command:tr.setStyle,args:[r]}]}return o}(this.serialize(),r).filter((e=>!(e.command in To)));if(0===n.length)return!1;const i=n.filter((e=>!(e.command in Eo)));if(i.length>0)throw new Error(`Unimplemented: ${i.map((e=>e.command)).join(", ")}.`);const a=[];return n.forEach((e=>{a.push(this[e.command].apply(this,e.args))})),o&&Promise.all(a).then(o),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,r){return this.getImage(t)?this.fire(new e.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,r),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.a(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(ne,`models.${e}`,t,null,r)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Y,`sources.${t}`,r,null,o))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const n=Vt(t,r,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const i=t=>{const r=(t?"symbol:":"other:")+n.id,o=e.aj(r,this.scope),i=this._sourceCaches[r]=new Zt(o,n,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=i,i.onAdd(this.map)};i(!1),"vector"!==r.type&&"geojson"!==r.type||i(!0),n.onAdd&&n.onAdd(this.map),o.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while layer "${n}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.a(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const o=this.getOwnSourceCaches(t);for(const n of o){const t=e.c8(n.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(n.id),n.fire(new e.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const r=this.getOwnSourceCache(t);r&&e.push(r.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const r=e[t]._tiles;for(const e in r){const t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const e of t){if(this._validate($,"lights",e))return;switch(e.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(e),t.updateTransitions(r)}else this.ambientLight=new xe(e,be,this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(e),t.updateTransitions(r)}else this.directionalLight=new xe(e,Le,this.scope,this.options)}}const o=new e.N(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const o=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=t.properties.get("color").toArray01(),i=t.properties.get("intensity"),a=t.properties.get("direction"),s=1-e.bT(a.x,a.y,a.z)[2]/90,l=o(n)*i*s,c=r.properties.get("color").toArray01(),u=r.properties.get("intensity");return(l+o(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.c9(t)){const r=e.ca(t),o=this.fragments.find((e=>{let{id:t}=e;return t===r}));if(!o)throw new Error(`Style import not found: ${t}`);const n=e.c8(t);return o.style.getFragmentStyle(n)}{const e=this.fragments.find((e=>{let{id:r}=e;return r===t}));if(!e)throw new Error(`Style import not found: ${t}`);return e.style}}getConfigProperty(t,r){const o=this.getFragmentStyle(t);if(!o)return null;const n=e.aj(r,o.scope),i=o.options.get(n),a=i?i.value||i.default:null;return a?a.serialize():null}setConfigProperty(t,r,o){const n=this.getFragmentStyle(t);if(!n)return;const i=n.stylesheet.schema;if(!i||!i[r])return;const a=e.t(o);if("success"!==a.result)return void So(this,a.value);const s=a.value.expression,l=e.aj(r,n.scope),c=n.options.get(l);if(!c)return;let u;const{minValue:d,maxValue:h,stepValue:f,type:m,values:p}=i[r],g=e.t(i[r].default);"success"===g.result&&(u=g.value.expression),u?(this.options.set(l,{...c,value:s,default:u,minValue:d,maxValue:h,stepValue:f,type:m,values:p}),this.updateConfigDependencies()):this.fire(new e.a(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const o=r.stylesheet.schema;if(!o)return null;const n={};for(const i in o){const t=e.aj(i,r.scope),o=r.options.get(t),a=o?o.value||o.default:null;n[i]=a?a.serialize():null}return n}setConfig(e,t){const r=this.getFragmentStyle(e);r&&(r.updateConfig(t,r.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const r=this.getFragmentStyle(e);r&&(r.stylesheet.schema=t,r.updateConfig(r._config,t),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const o in r){let n,i;const a=e.t(r[o].default);if("success"===a.result&&(n=a.value.expression),t&&void 0!==t[o]){const r=e.t(t[o]);"success"===r.result&&(i=r.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:u,values:d}=r[o];if(n){const t=e.aj(o,this.scope);this.options.set(t,{default:n,value:i,minValue:s,maxValue:l,stepValue:c,type:u,values:d})}else this.fire(new e.a(new Error(`No schema defined for config option "${o}".`)))}else this.fire(new e.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=t.id;if(this._layers[n])return void this.fire(new e.a(new Error(`Layer with id "${n}" already exists on this map`)));let i;if("custom"===t.type){if(So(this,e.cb(t)))return;i=e.c7(t,this.scope,this.options)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.c6(t),t=e.e(t,{source:n})),this._validate(ee,`layers.${n}`,t,{arrayIndex:-1},o))return;i=e.c7(t,this.scope,this.options),this._validateLayer(i),i.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[i.id]=i.serialize()}i.isConfigDependent&&this._configDependentLayers.add(i.fqid);let a=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${r}" does not exist on this map.`)));i.slot===this._layers[r].slot?a=t:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(a,0,n),this._layerOrderChanged=!0,this._layers[n]=i;const s=this.getOwnLayerSourceCache(i),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&i.canCastShadows()&&l&&(s.castsShadows=!0);const c=this._changes.getRemovedLayer(i);if(c&&i.source&&s&&"custom"!==i.type){this._changes.discardLayerRemoval(i);const t=e.aj(i.source,i.scope);c.type!==i.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),s.pause())}this._updateLayer(i),i.onAdd&&i.onAdd(this.map),i.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(t===r)return;const n=this._order.indexOf(t);this._order.splice(n,1);let i=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.a(new Error(`Layer with id "${r}" does not exist on this map.`)));o.slot===this._layers[r].slot?i=t:e.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(i,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const o=this.getOwnLayerSourceCache(t);if(o&&o.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===t.source&&this._layers[r].canCastShadows()){e=!0;break}o.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const o=this._checkLayer(e);o&&(o.minzoom===t&&o.maxzoom===r||(null!=t&&(o.minzoom=t),null!=r&&(o.maxzoom=r),this._updateLayer(o)))}setSlot(e,t){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==t&&(r.slot=t,this._updateLayer(r))}setFilter(r,o){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(r);if(i&&!t(i.filter,o))return null==o?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(te,`layers.${i.id}.filter`,o,{layerType:i.type},n)||(i.filter=e.c6(o),this._updateLayer(i)))}getFilter(t){const r=this._checkLayer(t);if(r)return e.c6(r.filter)}setLayoutProperty(r,o,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this._checkLayer(r);if(a&&!t(a.getLayoutProperty(o),n)){if(null!=n&&(!i||!1!==i.validate)&&So(a,oe.call(Z,{key:`layers.${r}.layout.${o}`,layerType:a.type,objectKey:o,value:n,styleSpec:e.G,style:{glyphs:!0,sprite:!0}})))return;a.setLayoutProperty(o,n),a.isConfigDependent&&this._configDependentLayers.add(a.fqid),this._updateLayer(a)}}getLayoutProperty(e,t){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(t)}setPaintProperty(r,o,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const a=this._checkLayer(r);if(!a)return;if(t(a.getPaintProperty(o),n))return;if(null!=n&&(!i||!1!==i.validate)&&So(a,re.call(Z,{key:`layers.${r}.paint.${o}`,layerType:a.type,objectKey:o,value:n,styleSpec:e.G})))return;const s=a.setPaintProperty(o,n);a.isConfigDependent&&this._configDependentLayers.add(a.fqid),s&&this._updateLayer(a),this._changes.updatePaintProperties(a)}getPaintProperty(e,t){const r=this._checkLayer(e);if(r)return r.getPaintProperty(t)}setFeatureState(t,r){this._checkLoaded();const o=t.source,n=t.sourceLayer,i=this._checkSource(o);if(!i)return;const a=i.type;if("geojson"===a&&n)return void this.fire(new e.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!n)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(o);for(const e of s)e.setFeatureState(n,t.id,r)}removeFeatureState(t,r){this._checkLoaded();const o=t.source,n=this._checkSource(o);if(!n)return;const i=n.type,a="vector"===i?t.sourceLayer:void 0;if("vector"===i&&!a)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.a(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(o);for(const e of s)e.removeFeatureState(a,t.id,r)}getFeatureState(t){this._checkLoaded();const r=t.source,o=t.sourceLayer,n=this._checkSource(r);if(n){if("vector"!==n.type||o)return void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(o,t.id);this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.e({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),o=e.aj(t.source,t.scope),n=this._changes.getUpdatedSourceCaches();t.source&&!n[o]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(o,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,r=this.order,o={},n=[];for(let a=r.length-1;a>=0;a--){const i=r[a];if(t(i)){o[i]=a;for(const t of e){const e=t[i];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const i=[];for(let a=r.length-1;a>=0;a--){const s=r[a];if(t(s))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(o[t.layer.id]<a)break;i.push(t),n.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)i.push(t.feature)}}return i}queryRenderedFeatures(t,r,o){r&&r.filter&&this._validate(te,"queryRenderedFeatures.filter",r.filter,null,r),r.scope=this.scope,r.availableImages=this._availableImages,r.serializedLayers=this._serializedLayers;const n={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.a(new Error("parameters.layers must be an Array."))),[];for(const t of r.layers){const r=this._mergedLayers[t];if(!r)return this.fire(new e.a(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[r.source]=!0}}const i=[],a=r.serializedLayers||{},s=r&&r.layers?r.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Ae.createFromScreenPoints(t,o);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==r.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;r.layers&&!n[c]||i.push(Gt(this._mergedSourceCaches[e],this._mergedLayers,a,l,r,o,s,!!this.map._showQueryGeometry))}return this.placement&&i.push(function(e,t,r,o,n,i,a){const s={},l=i.queryRenderedSymbols(o),c=[];for(const u of Object.keys(l).map(Number))c.push(a[u]);c.sort(Wt);for(const u of c){const r=u.featureIndex.lookupSymbolFeatures(l[u.bucketInstanceId],t,u.bucketIndex,u.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=s[e]=s[e]||[],o=r[e];o.sort(((e,t)=>{const r=u.featureSortOrder;if(r){const o=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-o}return t.featureIndex-e.featureIndex}));for(const e of o)t.push(e)}}for(const u in s)s[u].forEach((t=>{const o=t.feature,n=r(e[u]);if(!n)return;const i=n.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=i}));return s}(this._mergedLayers,a,this.getLayerSourceCache.bind(this),l.screenGeometry,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(i)}querySourceFeatures(e,t){t&&t.filter&&this._validate(te,"querySourceFeatures.filter",t.filter,null,t);const r=this.getOwnSourceCaches(e);let o=[];for(const n of r)o=o.concat(jt(n,t));return o}addSourceType(e,t,r){return Ro.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(Ro.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=this.light.getLight();let i=!1;for(const s in e)if(!t(e[s],n[s])){i=!0;break}if(!i)return;const a=this._getTransitionParameters();this.light.setLight(e,r,o),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&0!==o||delete this.terrain,null===r?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=r;const i=null==r.source;if(1===o){if("object"==typeof n.source){const t="terrain-dem-src";this.addSource(t,n.source),n=e.c6(n),n=e.e(n,{source:t})}const t=e.e({},n),r={};if(this.terrain&&i){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(r.style=e.serialize())}if(this._validate(X,"terrain",t,r))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&o!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,o),this.fire(new e.b("data",{dataType:"style"}))}else{const o=this.terrain,i=o.get();for(const t of Object.keys(e.G.terrain))!n.hasOwnProperty(t)&&e.G.terrain[t].default&&(n[t]=e.G.terrain[t].default);for(const n in r)if(!t(r[n],i[n])){o.set(r,this.options),this.stylesheet.terrain=r;const t=this._getTransitionParameters({duration:0});o.updateTransitions(t),this.fire(new e.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new ve(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!t(r.get(),e)){r.set(e,this.options),this.stylesheet.fog=r.get();const t=this._getTransitionParameters({duration:0});r.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:e.f.now(),transition:e.e(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?e.push(r):t.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const r=this.terrain=new ue(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const o=this._getTransitionParameters({duration:0});r.updateTransitions(o)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,r,o,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(i&&!1===i.validate)return!1;const a=e.e({},this.serialize());return So(this,t.call(Z,e.e({key:r,style:a,value:o,styleSpec:e.G},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const r of t)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const r of t)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=Lo(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,r,o,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=!1,s=!1;const l={},c={};for(const u of this._mergedOrder){const r=this._mergedLayers[u];if("symbol"!==r.type)continue;const o=e.aj(r.source,r.scope);let n=l[o];if(!n){const e=this.getLayerSourceCache(r);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));c[o]=t.slice(),n=l[o]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(r,n,t.center.lng,t.projection);a=a||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),i=i||this._layerOrderChanged||0===o,this._layerOrderChanged&&this.fire(new e.b("neworder")),(i||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.f.now(),t.zoom))&&(this.pauseablePlacement=new Qr(t,this._mergedOrder,i,r,o,n,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.f.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a){this._buildingIndex.onNewFrame(t.zoom);for(const t of this._mergedOrder){const r=this._mergedLayers[t];"symbol"===r.type&&this.placement.updateLayerOpacities(r,l[e.aj(r.source,r.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.f.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const o=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==o.findIndex((e=>{let{id:r}=e;return r===t.id})))return void this.fire(new e.a(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return o.push(t),this._loadImports([t],!0);const n=o.findIndex((e=>{let{id:t}=e;return t===r}));return-1===n&&this.fire(new e.a(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=o.slice(0,n).concat(t).concat(o.slice(n)),this._loadImports([t],!0,r)}updateImport(e,r){this._checkLoaded();const o=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n?this:"string"==typeof r?(this.setImportUrl(e,r),this):(r.url&&r.url!==o[n].url&&this.setImportUrl(e,r.url),t(r.config,o[n].config)||this.setImportConfig(e,r.config),t(r.data,o[n].data)||this.setImportData(e,r.data),this)}moveImport(e,t){this._checkLoaded();let r=this.stylesheet.imports||[];const o=this.getImportIndex(e);if(-1===o)return this;const n=this.getImportIndex(t);if(-1===n)return this;const i=r[o],a=this.fragments[o];return r=r.filter((t=>{let{id:r}=t;return r!==e})),this.fragments=this.fragments.filter((t=>{let{id:r}=t;return r!==e})),this.stylesheet.imports=r.slice(0,n).concat(i).concat(r.slice(n)),this.fragments=this.fragments.slice(0,n).concat(a).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const r=this.stylesheet.imports||[],o=this.getImportIndex(e);if(-1===o)return this;r[o].url=t;const n=this.fragments[o];return n.style=this._createFragmentStyle(r[o]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const r=this.getImportIndex(e),o=this.stylesheet.imports||[];return-1===r?this:t?(this.fragments[r].style.setState(t),this._reloadImports(),this):(delete o[r].data,this.setImportUrl(e,o[r].url))}setImportConfig(e,t){this._checkLoaded();const r=this.getImportIndex(e),o=this.stylesheet.imports||[];if(-1===r)return this;t?o[r].config=t:delete o[r].config;const n=this.fragments[r],i=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=t,n.style.updateConfig(t,i),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],r=this.getImportIndex(e);-1!==r&&(t.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===r&&this.fire(new e.a(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[t];r&&e.push(r.getSource())}return e}getSource(e,t){const r=this.getSourceCache(e,t);return r&&r.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,r){const o=e.aj(t,r);return this._mergedOtherSourceCaches[o]}getLayerSourceCache(t){const r=e.aj(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const r=e[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const r of t){const t=this.getLayer(r);t&&t.updateTransitions(e)}}getImages(e,t,r){this.imageManager.getImages(t.icons,t.scope,r),this._updateTilesForChangedImages();const o=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};o(this._otherSourceCaches[t.source]),o(this._symbolSourceCaches[t.source])}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,t.scope,r)}getResource(t,r,o){return e.ce(r,o)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new e.a(new Error(`There is no source with ID '${t}'`))),!1):r.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ro.getSourceType=function(e){return Ut[e]},Ro.setSourceType=function(e,t){Ut[e]=t},Ro.registerForPluginStateChange=e.bY;var Mo="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Io="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Oo="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Do="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ko="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",No="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Bo="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Fo="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",zo="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Uo="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Vo="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Ho=[];Zo(Mo,Ho),Zo(Oo,Ho),Zo(Io,Ho);const Go={"_prelude_fog.vertex.glsl":No,"_prelude_terrain.vertex.glsl":ko,"_prelude_shadow.vertex.glsl":Uo,"_prelude_fog.fragment.glsl":Bo,"_prelude_shadow.fragment.glsl":Vo,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Fo,"_prelude_raster_particle.glsl":zo},jo={};Yo("",ko),Yo(Bo,No),Yo(Vo,Uo),Yo(Fo,""),Yo(zo,"");const Wo=Yo(Io,Oo),Ko=Mo;var Jo={background:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Yo("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yo('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Yo("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yo("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Yo("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yo("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Yo("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Yo('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Yo("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Yo("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin vec2 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Yo("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Yo("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Yo('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Yo('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Yo('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Yo('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Yo("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Yo('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Do),skyboxGradient:Yo('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Do),skyboxCapture:Yo("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Yo('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Yo('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Yo("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Yo("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Zo(e,t){const r=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let o of r)if(o=o.trim(),"#"===o[0]&&o.includes("if")&&!o.includes("endif")){o=o.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=o.split(" ");for(const r of e)t.includes(r)||t.push(r)}}function Yo(e,t){const r=/#include\s+"([^"]+)"/g,o=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((e=>{const t=e.split(" ");return t[t.length-1]})),n=[...new Set(n)]);const i={},a=[],s=[];if(e=e.replace(r,((e,t)=>(s.push(t),""))),(t=t.replace(r,((e,t)=>(a.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Ho];Zo(e,l),Zo(t,l);for(const c of[...a,...s])Go[c]||console.error(`Undefined include: ${c}`),jo[c]||(jo[c]=[],Zo(Go[c],jo[c])),l=[...l,...jo[c]];return{fragmentSource:e=e.replace(o,((e,t,r,o,n)=>(i[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${r} ${o} ${n};\n#else\nuniform ${r} ${o} u_${n};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${r} ${o} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${o} ${n};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(o,((e,t,r,o,n)=>{const a="float"===o?"vec2":o,s=n.match(/color/)?"color":a;return"define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${r} ${o} a_${n};\n#endif\n`:i[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${a} a_${n};\nout ${r} ${o} ${n};\n#else\nuniform ${r} ${o} u_${n};\n#endif\n`:"initialize"===t?"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${r} ${o} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${o} ${n} = u_${n};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${r} ${o} a_${n};\n    out ${r} ${o} ${n};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${r} ${a} a_${n};\n#else\nuniform ${r} ${o} u_${n};\n#endif\n`:"define-instanced"===t?"mat4"===s?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${r} ${o} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${r} ${a} a_${n};\n#else\nuniform ${r} ${o} u_${n};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${r} ${o} ${n} = a_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${o} ${n} = a_${n};\n#else\n    ${r} ${o} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${r} ${o} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${r} ${o} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:a,fragmentIncludes:s}}class qo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,o,n,i,a,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==o.length;for(let u=0;!l&&u<o.length;u++)this.boundPaintVertexBuffers[u]!==o[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let u=0;!c&&u<a.length;u++)this.boundDynamicVertexBuffers[u]!==a[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==i)this.freshBind(t,r,o,n,i,a,s);else{e.bindVertexArrayOES.set(this.vao);for(const r of a)r&&(r.bind(),s&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,t,s));n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,r,o,n,i,a){const s=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=o,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=i,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const u of r)u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,n);for(const u of i)u&&(u.enableAttributes(c,e),u.bind(),u.setVertexAttribPointers(c,e,n),a&&u.instanceCount&&u.setVertexAttribDivisor(c,e,a));o&&o.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $o(t,r){const o=Math.pow(2,r.canonical.z),n=r.canonical.y;return[new e.O(0,n/o).toLngLat().lat,new e.O(0,(n+1)/o).toLngLat().lat]}function Xo(t,r,o,n,i,a,s){const l=t.context,c=l.gl,u=o.hillshadeFBO;if(!u)return;t.prepareDrawTile();const d=t.isTileAffectedByFog(r),h=t.getOrCreateProgram("hillshade",{overrideFog:d});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const f=((t,r,o,n)=>{const i=o.paint.get("hillshade-shadow-color"),a=o.paint.get("hillshade-highlight-color"),s=o.paint.get("hillshade-accent-color"),l=o.paint.get("hillshade-emissive-strength");let c=e.bm(o.paint.get("hillshade-illumination-direction"));if("viewport"===o.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const r=t.style.directionalLight.properties.get("direction"),o=e.bT(r.x,r.y,r.z);c=e.bm(o[1])}const u=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(r.tileID.toUnwrapped(),u),u_image:0,u_latrange:$o(0,r.tileID),u_light:[o.paint.get("hillshade-exaggeration"),c],u_shadow:i,u_highlight:a,u_emissive_strength:l,u_accent:s}})(t,o,n,t.terrain?r.projMatrix:null);t.uploadCommonUniforms(l,h,r.toUnwrapped());const{tileBoundsBuffer:m,tileBoundsIndexBuffer:p,tileBoundsSegments:g}=t.getTileBoundsBuffers(o);h.draw(t,c.TRIANGLES,i,a,s,Ot.disabled,f,n.id,m,p,g)}function Qo(t,r,o){if(!r.needsDEMTextureUpload)return;const n=t.context,i=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(o.stride);const a=o.getPixels();r.demTexture?r.demTexture.update(a,{premultiply:!1}):r.demTexture=new e.T(n,a,i.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function en(t,r,o){const n=t.context,i=n.gl;if(!r.dem)return;const a=r.dem;if(n.activeTexture.set(i.TEXTURE1),Qo(t,r,a),!r.demTexture)return;r.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE);const s=a.dim;n.activeTexture.set(i.TEXTURE0);let l=r.hillshadeFBO;if(!l){const t=new e.T(n,{width:s,height:s,data:null},i.RGBA);t.bind(i.LINEAR,i.CLAMP_TO_EDGE),l=r.hillshadeFBO=n.createFramebuffer(s,s,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:d}=t.getMercatorTileBoundsBuffers(),h=[];t.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(t,i.TRIANGLES,Et.disabled,Pt.disabled,Rt.unblended,Ot.disabled,((t,r)=>{const o=r.stride,n=e.a9.create();return e.a9.ortho(n,0,e.Y,-e.Y,0,0,1),e.a9.translate(n,n,[0,-e.Y,0]),{u_matrix:n,u_image:1,u_dimension:[o,o],u_zoom:t.overscaledZ}})(r.tileID,a),o.id,c,u,d),r.needsHillshadePrepare=!1}const tn=t=>({u_matrix:new e.bN(t),u_image0:new e.bR(t),u_skirt_height:new e.bQ(t),u_ground_shadow_factor:new e.bP(t)}),rn=(e,t,r)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),on=(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(o),u_merc_matrix:r,u_zoom_transition:n,u_merc_center:i,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:d,u_viewport:h,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9),u_skirt_height:f,u_far_z_cutoff:m});function nn(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const an=new class{constructor(){this.operations={}}newMorphing(e,t,r,o,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:o,phase:0,duration:n,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},sn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ln(e,t,r){if(0===t)return 0;const o=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*o}function cn(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}const un=e=>({u_matrix:e});function dn(t,r,o,n,i){if(i>0){const a=e.f.now(),s=(a-t.timeAdded)/i,l=r?(a-r.timeAdded)/i:-1,c=o.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),d=!r||Math.abs(r.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),h=d&&t.refreshedUponExpiration?1:e.ad(d?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),r?{opacity:1,mix:1-h}:{opacity:h,mix:0}}return{opacity:1,mix:0}}class hn extends Zt{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},o=new e.bZ(e.b_(),null),n=Vt("mock-dem",r,o,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class fn extends Zt{constructor(t){const r=Vt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.bZ(e.b_(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,r){if(e.freezeTileCoverage)return;this.transform=e;const o=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,r)=>{if(t[r.key]="",!this._tiles[r.key]){const t=new zt(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[r.key]=t}return t}),{});for(const n in this._tiles)n in o||(this.freeFBO(n),this._tiles[n].unloadVectorData(),delete this._tiles[n])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const r=Object.values(t);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class mn extends e.ap{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class pn extends e.cp{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[o,n,i]=function(){const t=new e.aQ,r=new e.az,o=131;t.reserve(17161),r.reserve(33800);const n=e.Y/128,i=e.Y+n/2,a=i+n;for(let l=-n;l<a;l+=n)for(let r=-n;r<a;r+=n){const o=r<0||r>i||l<0||l>i?24575:0,n=e.ad(Math.round(r),0,e.Y),a=e.ad(Math.round(l),0,e.Y);t.emplaceBack(n+o,a)}const s=(e,t)=>{const n=t*o+e;r.emplaceBack(n+1,n,n+o),r.emplaceBack(n+o,n+o+1,n+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)s(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)})),[t,r,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(o,e.aS.members),this.gridIndexBuffer=a.createIndexBuffer(n),this.gridSegments=e.aE.simpleSegment(0,0,o.length,n.length),this.gridNoSkirtSegments=e.aE.simpleSegment(0,0,o.length,i),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fn(r.map),this.orthoMatrix=e.a9.create(),e.a9.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.Y,0,e.Y,0,1);const s=a.gl;this._overlapStencilMode=new Pt({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new hn(r.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,r,o){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const n=t.terrain.properties,i=0===t.terrain.drapeRenderMode,a=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.f.now();const s=t.terrain&&t.terrain.scope,l=n.get("source"),c=i?this._mockSourceCache:t.getSourceCache(l,s);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=a?this.calculateExaggeration(r):n.get("exaggeration"),!r.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(r,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),r.updateElevation(!0,o),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){const r=this._previousCameraAltitude,o=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=o;const n=null!=r?o-r:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const i=t.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(i);let s=i-this._previousZoom;const l=this._previousUpdateTimestamp;let c=i;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(i-c)>.5&&(s=.5*(i-c+s)),s*n<0&&(c+=s)),this._evaluationZoom=c;const u=a.getExaggeration(c),d=u===a.getExaggeration(Math.max(0,c-.1));if(d&&Math.abs(u-this._exaggeration)<.01)return u;let h=Math.min(.1,.00375*(this._updateTimestamp-l));return(d||u<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),e.X(this._exaggeration,u,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=0===o._centerAltitude&&-1===this.getAtPointOrZero(e.O.fromLngLat(o.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=r.getIds().map((e=>{const t=r.getTileByID(e).tileID;return t.projMatrix=o.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,r){const o=r.transform.pointCoordinate(r.transform.getCameraPoint()),n=new e.P(o.x,o.y);t.sort(((t,r)=>{if(r.overscaledZ-t.overscaledZ)return r.overscaledZ-t.overscaledZ;const o=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),i=new e.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),a=n.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(o)-a.distSqr(i)}))}(n,this.painter);const i=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const e in a){const r=a[e];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,t[e],i),r.usedForTerrain)continue;const o=t[e];r.getSource().reparseOverscaled&&this._assignTerrainTiles(o)}this.proxiedCoords[r.id]=n.map((e=>new mn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(i),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const r=t.tileID.key;r in s||(this._visibleDemTiles.push(t),s[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const r in this.terrainTileForTile){const o=this.terrainTileForTile[r],n=o.dem;!n||o.demTexture&&!o.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Qo(this.painter,o,n))}}_prepareDemTileUniforms(e,t,r,o){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,i=Math.pow(2,t.tileID.canonical.z-n.z),a=o||"";return r[`u_dem_tl${a}`]=[n.x*i%1,n.y*i%1],r[`u_dem_scale${a}`]=i,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,r=t.gl;if(!this._emptyDepthBufferTexture){const o=new e.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.T(t,o,r.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,r)=>{if(!r.dem)return t;const o=r.dem.tree.minimums[0];return o>0&&e++,t+o}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const o=this._getLoadedAreaMinimum(),[n,i]=(()=>{const t=new e.cr({width:1,height:1},new Float32Array([o]));return[r.R32F,t]})();this._emptyDEMTextureDirty=!1;let a=this._emptyDEMTexture;return a?a.update(i,{premultiply:!1}):a=this._emptyDEMTexture=new e.T(t,i,n,{premultiply:!1}),a}setupElevationDraw(t,r,o){const n=this.painter.context,i=n.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};a.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(o&&o.morphing&&this._useVertexMorphing){const e=o.morphing.srcDemTile,r=o.morphing.dstDemTile;c=o.morphing.phase,e&&r&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(l=e),this._prepareDemTileUniforms(t,r,a)&&(s=r))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?i.LINEAR:i.NEAREST,d=e=>{a.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&s)n.activeTexture.set(i.TEXTURE2),s.demTexture.bind(u(s),i.CLAMP_TO_EDGE),n.activeTexture.set(i.TEXTURE4),l.demTexture.bind(u(l),i.CLAMP_TO_EDGE),s.demTexture&&d(s.demTexture),a.u_dem_lerp=c;else{s=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(i.TEXTURE2);const e=this._prepareDemTileUniforms(t,s,a)?s.demTexture:this.emptyDEMTexture;e.bind(u(s),i.CLAMP_TO_EDGE),d(e)}if(n.activeTexture.set(i.TEXTURE3),o&&o.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),this._depthFBO&&(a.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),a.u_depth_size_inv=[1,1]),o&&o.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*e.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}if(o&&o.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),r.setTerrainUniformValues(n,a),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,o&&o.useDenormalizedUpVectorScale);r.setGlobeUniformValues(n,e)}}globeUniformValues(t,r,o){const n=t.projection;return{u_tile_tl_up:n.upVector(r,0,0),u_tile_tr_up:n.upVector(r,e.Y,0),u_tile_br_up:n.upVector(r,e.Y,e.Y),u_tile_bl_up:n.upVector(r,0,e.Y),u_tile_up_scale:o?e.cq(1):n.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,o=this.painter.context;0!==t.length&&(o.bindFramebuffer.set(null),o.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,r,o,n,i){if("globe"===t.transform.projection.name)!function(t,r,o,n,i){const a=t.context,s=a.gl;let l,c;const u=t.transform,d=e.ci(t,a,u),h=(e,r)=>{if(c===r)return;const o=[sn[r],"PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:o,overrideFog:n}),c=r},f=t.colorModeForRenderPass(),m=new Et(s.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);an.update(i);const p=e.cj(u),g=[e.a8(u.center.lng),e.ah(u.center.lat)],_=t.globeSharedBuffers,y=[u.width*e.f.devicePixelRatio,u.height*e.f.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,d=ln(u.zoom,r.exaggeration(),r.sourceCache._source.tileSize);c=-1;const b=s.TRIANGLES;for(const c of n){const n=o.getTile(c),L=Pt.disabled,A=r.prevTerrainTileForTile[c.key],w=r.terrainTileForTile[c.key];nn(A,w)&&an.newMorphing(c.key,A,w,i,250),a.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const S=an.getMorphValuesForProxy(c.key),E=S?1:0;S&&e.k(x,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.ch(S.phase)}});const T=e.ck(c.canonical),P=e.cl(T.getCenter().lat),C=e.cm(c.canonical,T,P,u.worldSize/u._pixelsPerMercatorPixel),R=e.aW(e.cn(c.canonical)),M=on(u.expandedFarZProjMatrix,v,p,R,e.W(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,d,u._farZ,C);if(h(c,E),l&&(r.setupElevationDraw(n,l,x),t.uploadCommonUniforms(a,l,c.toUnwrapped()),_)){const[e,r,o]=_.getGridBuffers(P,0!==d);l.draw(t,b,m,L,f,Ot.backCCW,M,"globe_raster",e,r,o)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const i=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&i.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:i});for(const c of n){const{x:n,y:i,z:d}=c.canonical,h=0===i,p=i===(1<<d)-1,[v,b,L,A]=_.getPoleBuffers(d,!1);if(A&&(h||p)){const i=o.getTile(c);a.activeTexture.set(s.TEXTURE0),i.texture&&i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=e.co(d,n,u);const w=e.aW(e.cn(c.canonical)),S=(e,r)=>e.draw(t,s.TRIANGLES,m,Pt.disabled,f,Ot.disabled,on(u.expandedFarZProjMatrix,_,_,w,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",r,L,A);r.setupElevationDraw(i,l,x),t.uploadCommonUniforms(a,l,c.toUnwrapped()),h&&t.renderDefaultNorthPole&&S(l,v),p&&t.renderDefaultSouthPole&&(_=e.a9.scale(e.a9.create(),_,[1,-1,1]),S(l,b))}}}}(t,r,o,n,i);else{const a=t.context,s=a.gl;let l,c;const u=t.shadowRenderer,d=go(t,t.longestCutoffRange),h=e=>{if(c===e)return;const r=[];r.push(sn[e]),d.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:r}),c=e},f=t.colorModeForRenderPass(),m=new Et(s.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);an.update(i);const p=t.transform,g=ln(p.zoom,r.exaggeration(),r.sourceCache._source.tileSize);let _=[0,0,0];if(u){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(_=Ao(e,r))}{c=-1;const y=s.TRIANGLES,[v,x]=[r.gridIndexBuffer,r.gridSegments];for(const c of n){const n=o.getTile(c),b=Pt.disabled,L=r.prevTerrainTileForTile[c.key],A=r.terrainTileForTile[c.key];nn(L,A)&&an.newMorphing(c.key,L,A,i,250),a.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const w=an.getMorphValuesForProxy(c.key),S=w?1:0;let E;w&&(E={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.ch(w.phase)}});const T=rn(c.projMatrix,cn(c.canonical,p.renderWorldCopies)?g/10:g,_);if(h(S),!l)continue;r.setupElevationDraw(n,l,E);const P=c.toUnwrapped();u&&u.setupShadows(P,l),t.uploadCommonUniforms(a,l,P,null,d),l.draw(t,y,m,b,f,Ot.backCCW,T,"terrain_raster",r.gridBuffer,v,x)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,o=this.painter.context,n=this.proxySourceCache,i=this.proxiedCoords[n.id],a=this._drapedRenderBatches.shift(),s=r.style.order,l=[];let c=0;for(const u of i){const i=n.getTileByID(u.proxyTileKey),d=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][t]:void 0,h=void 0!==d?n.renderCache[d]:this.pool[c++],f=void 0!==d;if(i.texture=h.tex,f&&!h.dirty){l.push(i.tileID);continue}let m;o.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(o.clear({color:e.aA.transparent,stencil:0}),h.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=r.style._mergedLayers[s[e]];if(t.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(t),i=n?this.proxyToSource[u.key][n.id]:[u];if(!i)continue;const a=i;o.viewport.set([0,0,h.fb.width,h.fb.height]),m!==(n?n.id:null)&&(this._setupStencil(h,i,t,n),m=n?n.id:null),r.renderLayer(r,n,t,a)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=r.style._mergedLayers[s[e]];if(t.isHidden(r.transform.zoom))continue;const n=r.style.getLayerSourceCache(t),i=n?this.proxyToSource[u.key][n.id]:[u];if(!i)continue;const a=i;o.viewport.set([0,0,h.fb.width,h.fb.height]),m!==(n?n.id:null)&&(this._setupStencil(h,i,t,n),m=n?n.id:null),r.renderLayer(r,n,t,a)}this.renderedToTile?(h.dirty=!0,l.push(i.tileID)):f||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,o.bindFramebuffer.set(null),o.viewport.set([0,0,r.width,r.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let r=-1,o=t;for(let n=0;n<t;++n)this._style.isLayerDraped(e._mergedLayers[e.order[n]])?r=Math.max(r,n):o=Math.min(o,n);return o>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,r){if(!this._visibleDemTiles)return null;const o=this._visibleDemTiles.filter((e=>e.dem)).map((o=>{const n=o.tileID,i=1<<n.overscaledZ,{x:a,y:s}=n.canonical,l=a/i,c=(a+1)/i,u=s/i,d=(s+1)/i;return{minx:l,miny:u,maxx:c,maxy:d,t:o.dem.tree.raycastRoot(l,u,c,d,e,t,r),tile:o}}));o.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of o){if(null==n.t)return null;const o=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,r);if(null!=o)return o}return null}_createFBO(){const t=this.painter.context,r=t.gl,o=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const n=new e.T(t,{width:o[0],height:o[1],data:null},r.RGBA);n.bind(r.LINEAR,r.CLAMP_TO_EDGE);const i=t.createFramebuffer(o[0],o[1],!0,null);return i.colorAttachment.set(n.texture),i.depthAttachment=new wt(t,i.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,i.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):i.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:i,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],r=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!r&&t.shouldRedrape():!r&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Ce){t=!0;break}if(!t)return;const r={};for(let o=0;o<this._style.order.length;++o){const t=this._style._mergedLayers[this._style.order[o]],n=this._style.getLayerSourceCache(t);if(n&&!r[n.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.Z){r[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof Re){e=!0;break}if(!e)return;const t={};for(let r=0;r<this._style.order.length;++r){const e=this._style._mergedLayers[this._style.order[r]],o=this._style.getLayerSourceCache(e);if(!o||t[o.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const n=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][o.id];if(e)for(const t of e){const e=dn(o.getTile(t),o.findLoadedParent(t,0),o,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(o.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,r=t.length;if(0===r)return;const o=[];this._pendingGroundEffectLayers=[];let n,i=0,a=this._style._mergedLayers[t[i]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++i<r;)a=this._style._mergedLayers[t[i]];for(;i<r;++i){const e=this._style._mergedLayers[t[i]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=i):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(i),void 0!==n&&(o.push({start:n,end:i-1}),n=void 0)))}if(void 0!==n&&o.push({start:n,end:i-1}),0!==o.length){const t=o[o.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=o}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let r=0;r<e.length;++r){const o=Object.values(e[r]);t.renderCachePool.push(...o)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,o=this._tilesDirty;for(let i=r.length-1;i>=0;i--){const n=r[i];if(t.getTileByID(n.key),void 0!==t.proxyCachedFBO[n.key]){const r=e[n.key],i=this.proxyToSource[n.key];let a=0;for(const e in i){const t=i[e],n=r[e];if(!n||n.length!==t.length||t.some(((t,r)=>t!==n[r]||o[e]&&o[e].hasOwnProperty(t.key)))){a=-1;break}++a}for(const e in t.proxyCachedFBO[n.key])t.renderCache[t.proxyCachedFBO[n.key][e]].dirty=a<0||a!==Object.values(r).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const i of n)for(const e of r){if(t.proxyCachedFBO[e.key])continue;let r=t.renderCachePool.pop();void 0===r&&t.renderCache.length<50&&(r=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==r&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][i.start]=r,t.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,r,o){if(!o||!this._sourceTilesOverlap[o.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,i=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(r.isTileClipped())a=t.length,this._overlapStencilMode.test={func:i.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:i.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Pt.disabled}_renderTileClippingMasks(e,t){const r=this.painter,o=this.painter.context,n=o.gl;r._tileClippingMaskIDs={},o.setColorMode(Rt.disabled),o.setDepthMode(Et.disabled);const i=r.getOrCreateProgram("clippingMask");for(const a of e){const e=r._tileClippingMaskIDs[a.key]=--t;i.draw(r,n.TRIANGLES,Et.disabled,new Pt({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),Rt.disabled,Ot.disabled,un(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const o=[t.x,t.y,1,1];e.aa.transformMat4(o,o,r.pixelMatrixInverse),e.aa.scale(o,o,1/o[3]),o[0]/=r.worldSize,o[1]/=r.worldSize;const n=r._camera.position,i=e.bo(1,r.center.lat),a=[n[0],n[1],n[2]/i,0],s=e.Q.subtract([],o.slice(0,3),a);e.Q.normalize(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(e.Q.scaleAndAdd(a,a,s,l),a[3]=a[2],a[2]*=i,a):null}drawDepth(){const t=this.painter,r=t.context,o=this.proxySourceCache,n=Math.ceil(t.width),i=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===i||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=r.gl,o=r.createFramebuffer(n,i,!0,"renderbuffer");r.activeTexture.set(t.TEXTURE0);const a=new e.T(r,{width:n,height:i,data:null},t.RGBA);a.bind(t.NEAREST,t.CLAMP_TO_EDGE),o.colorAttachment.set(a.texture);const s=r.createRenderbuffer(r.gl.DEPTH_COMPONENT16,n,i);o.depthAttachment.set(s),this._depthFBO=o,this._depthTexture=a}r.bindFramebuffer.set(this._depthFBO.framebuffer),r.viewport.set([0,0,n,i]),function(e,t,r,o){if("globe"===e.transform.projection.name)return;const n=e.context,i=n.gl;n.clear({depth:1});const a=e.getOrCreateProgram("terrainDepth"),s=new Et(i.LESS,Et.ReadWrite,e.depthRangeFor3D);for(const l of o){const o=r.getTile(l),n=rn(l.projMatrix,0,[0,0,0]);t.setupElevationDraw(o,a),a.draw(e,i.TRIANGLES,s,Pt.disabled,Rt.unblended,Ot.backCCW,n,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(t,this,o,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,r,o){if(t.getSource()instanceof e.as)return this._setupProxiedCoordsForImageSource(t,r,o);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],i=this.proxyCoords;for(let e=0;e<i.length;e++){const r=i[e],a=this._findTileCoveringTileID(r,t);if(a){const e=this._createProxiedId(r,a,o[r.key]&&o[r.key][t.id]);n.push(e),this.proxyToSource[r.key][t.id]=[e]}}let a=!1;const s=new Set;for(let e=0;e<r.length;e++){const i=t.getTile(r[e]);if(!i||!i.hasData())continue;const l=this._findTileCoveringTileID(i.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==i.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],r=this._createProxiedId(l.tileID,i,o[l.tileID.key]&&o[l.tileID.key][t.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[l.tileID.key][t.id]=[r];const c=this.proxyToSource[l.tileID.key][t.id];s.has(c)||s.add(c),n.push(r),a=!0}}if(this._sourceTilesOverlap[t.id]=a,a&&this._debugParams.sortTilesHiZFirst)for(const e of s)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,r,o){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],i=this.proxyCoords,a=t.getSource(),s=a.tileID;if(!s)return;const l=new e.P(s.x,s.y)._div(1<<s.z),c=a.coordinates.map(e.O.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,r)=>{const o=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),i=e.Y/(1<<t.canonical.z),a=r.wrap+r.canonical.x/(1<<r.canonical.z),s=r.canonical.y/(1<<r.canonical.z);return o+i<a+c.min.x||o>a+c.max.x||n+i<s+c.min.y||n>s+c.max.y};for(let e=0;e<i.length;e++){const a=i[e];for(let e=0;e<r.length;e++){const i=t.getTile(r[e]);if(!i||!i.hasData())continue;if(u(a,i.tileID))continue;const s=this._createProxiedId(a,i,o[a.key]&&o[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],n.push(s)}}}_createProxiedId(t,r,o){let n=this.orthoMatrix;if(o){const e=o.find((e=>e.key===r.tileID.key));if(e)return e}if(r.tileID.key!==t.key){const o=t.canonical.z-r.tileID.canonical.z;let i,a,s;n=e.a9.create();const l=r.tileID.wrap-t.wrap<<t.overscaledZ;o>0?(i=e.Y>>o,a=i*((r.tileID.canonical.x<<o)-t.canonical.x+l),s=i*((r.tileID.canonical.y<<o)-t.canonical.y)):(i=e.Y<<-o,a=e.Y*(r.tileID.canonical.x-(t.canonical.x+l<<-o)),s=e.Y*(r.tileID.canonical.y-(t.canonical.y<<-o))),e.a9.ortho(n,0,i,0,i,0,1),e.a9.translate(n,n,[a,s,0])}return new mn(r.tileID,t.key,n)}_findTileCoveringTileID(t,r){let o=r.getTile(t);if(o&&o.hasData())return o;const n=this._findCoveringTileCache[r.id],i=n[t.key];if(o=i?r.getTileByID(i):null,o&&o.hasData()||null===i)return o;let a=o?o.tileID:t,s=a.overscaledZ;const l=r.getSource().minzoom,c=[];if(!i){const n=r.getSource().maxzoom;if(t.canonical.z>=n){const o=t.canonical.z-n;r.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,r.transform.tileZoom),a=new e.ap(s,t.wrap,n,t.canonical.x>>o,t.canonical.y>>o)):0!==o&&(s=n,a=new e.ap(s,t.wrap,n,t.canonical.x>>o,t.canonical.y>>o))}a.key!==t.key&&(c.push(a.key),o=r.getTile(a))}const u=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(s-=1;s>=l&&(!o||!o.hasData());s--){o&&u(o.tileID.key);const e=a.calculateScaledKey(s);if(o=r.getTileByID(e),o&&o.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):o=r.getTileByID(t)}return u(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[t.key]=!0}}function gn(t,r,o){const n=function(t,r,o){const n=e.Q.dot(r,t),i=e.Q.dot(o,[.2126,.7152,.0722]),a=(e,t,r)=>(1-r)*e+r*t,s=a(1-.3*Math.min(i,1),1,Math.min(n+1,1));return a(.92,1,Math.asin(e.ad(r[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],r),i=[0,0,0];e.Q.scale(i,o.slice(0,3),n);const a=[0,0,0];e.Q.scale(a,r.slice(0,3),t[2]);const s=[0,0,0];return e.Q.add(s,i,a),e.bX(s)}const _n=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],yn=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class vn{static cacheKey(e,t,r,o){let n=`${t}${o?o.cacheKey:""}`;for(const i of r)e.usedDefines.includes(i)&&(n+=`/${i}`);return n}constructor(t,r,o,n,i,a){const s=t.gl;this.program=s.createProgram(),this.configuration=n,this.name=r,this.fixedDefines=[...a];const l=n?n.getBinderAttributes():[],c=(o.staticAttributes||[]).concat(l);let u=n?n.defines():[];u=u.concat(a.map((e=>`#define ${e}`)));const d="#version 300 es\n";let h=d+u.concat("precision mediump float;",Ko,Wo.fragmentSource).join("\n");for(const e of o.fragmentIncludes)h+=`\n${Go[e]}`;h+=`\n${o.fragmentSource}`;let f=d+u.concat("precision highp float;",Ko,Wo.vertexSource).join("\n");for(const e of o.vertexIncludes)f+=`\n${Go[e]}`;f+=`\n${o.vertexSource}`;const m=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(m,h),s.compileShader(m),s.attachShader(this.program,m);const p=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(p,f),s.compileShader(p),s.attachShader(this.program,p),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(p),s.deleteShader(m),this.fixedUniforms=i(t),this.binderUniforms=n?n.getUniforms(t):[],a.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.bR(t),u_dem_prev:new e.bR(t),u_dem_tl:new e.bO(t),u_dem_scale:new e.bQ(t),u_dem_tl_prev:new e.bO(t),u_dem_scale_prev:new e.bQ(t),u_dem_size:new e.bQ(t),u_dem_lerp:new e.bQ(t),u_exaggeration:new e.bQ(t),u_depth:new e.bR(t),u_depth_size_inv:new e.bO(t),u_meter_to_dem:new e.bQ(t),u_label_plane_matrix_inv:new e.bN(t)}))(t)),a.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.bP(t),u_tile_tr_up:new e.bP(t),u_tile_br_up:new e.bP(t),u_tile_bl_up:new e.bP(t),u_tile_up_scale:new e.bQ(t)}))(t)),a.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.bN(t),u_fog_range:new e.bO(t),u_fog_color:new e.bS(t),u_fog_horizon_blend:new e.bQ(t),u_fog_vertical_limit:new e.bO(t),u_fog_temporal_offset:new e.bQ(t),u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_globe_pos:new e.bP(t),u_globe_radius:new e.bQ(t),u_globe_transition:new e.bQ(t),u_is_globe:new e.bR(t),u_viewport:new e.bO(t)}))(t)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.bS(t)}))(t)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.bP(t),u_lighting_directional_dir:new e.bP(t),u_lighting_directional_color:new e.bP(t),u_ground_radiance:new e.bP(t)}))(t)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.bN(t),u_light_matrix_1:new e.bN(t),u_fade_range:new e.bO(t),u_shadow_normal_offset:new e.bP(t),u_shadow_intensity:new e.bQ(t),u_shadow_texel_size:new e.bQ(t),u_shadow_map_resolution:new e.bQ(t),u_shadow_direction:new e.bP(t),u_shadow_bias:new e.bP(t),u_shadowmap_0:new e.bR(t),u_shadowmap_1:new e.bR(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const o in t)r[o].set(this.program,o,t[o])}_drawDebugWireframe(t,r,o,n,i,a,s,l,c,u){const d=t.options.wireframe;if(!1===d.terrain&&!1===d.layers2D&&!1===d.layers3D)return;const h=t.context;if(!(()=>!(!d.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!d.layers2D||t._terrain&&t._terrain.renderingToTexture||!_n.includes(this.name))||!(!d.layers3D||!yn.includes(this.name)))())return;const f=h.gl,m=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,i,h);if(!m)return;const p=[...this.fixedDefines];p.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:p});h.program.set(g.program);const _=(e,t,r)=>{if(t[e]&&r[e])for(const o in t[e])r[e][o]&&r[e][o].set(r.program,o,t[e][o].current)};c&&c.setUniforms(g.program,h,g.binderUniforms,s,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),m.bind(),h.setColorMode(new Rt([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.ZERO,f.ONE],e.aA.transparent,[!0,!0,!0,!1])),h.setDepthMode(new Et(r.func===f.LESS?f.LEQUAL:r.func,Et.ReadOnly,r.range)),h.setStencilMode(Pt.disabled);const y=3*a.primitiveLength*2,v=3*a.primitiveOffset*2*2;u&&u>1?f.drawElementsInstanced(f.LINES,y,f.UNSIGNED_SHORT,v,u):f.drawElements(f.LINES,y,f.UNSIGNED_SHORT,v),i.bind(),h.program.set(this.program),h.setDepthMode(r),h.setStencilMode(o),h.setColorMode(n)}draw(e,t,r,o,n,i,a,s,l,c,u,d,h,f,m,p){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(r),g.setStencilMode(o),g.setColorMode(n),g.setCullFace(i);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,a[x]);f&&f.setUniforms(this.program,g,this.binderUniforms,d,{zoom:h});const y={[_.POINTS]:1,[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t],v=p&&p>0?1:void 0;for(const x of u.get()){const i=x.vaos||(x.vaos={});(i[s]||(i[s]=new qo)).bind(g,this,l,f?f.getPaintVertexBuffers():[],c,x.vertexOffset,m||[],v),p&&p>1?_.drawElementsInstanced(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2,p):c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength),t===_.TRIANGLES&&c&&this._drawDebugWireframe(e,r,o,n,c,x,d,h,f,p)}}}function xn(t,r){const o=Math.pow(2,r.tileID.overscaledZ),n=r.tileSize*Math.pow(2,t.transform.tileZoom)/o,i=n*(r.tileID.canonical.x+r.tileID.wrap*o),a=n*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.a6(r,1,t.transform.tileZoom),u_pixel_coord_upper:[i>>16,a>>16],u_pixel_coord_lower:[65535&i,65535&a]}}const bn=e.a9.create(),Ln=(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g)=>{const _=r.style.light,y=_.properties.get("position"),v=[y.x,y.y,y.z],x=e.ct.create();"viewport"===_.properties.get("anchor")&&(e.ct.fromRotation(x,-r.transform.angle),e.Q.transformMat3(v,v,x));const b=_.properties.get("color"),L=r.transform,A={u_matrix:t,u_lightpos:v,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+o,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:i,u_edge_radius:a,u_flood_light_color:h,u_vertical_scale:f,u_flood_light_intensity:m,u_ground_shadow_factor:p,u_emissive_strength:g};return"globe"===L.projection.name&&(A.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],A.u_zoom_transition=c,A.u_inv_rot_matrix=d,A.u_merc_center=u,A.u_up_dir=L.projection.upVector(new e.bv(0,0,0),u[0]*e.Y,u[1]*e.Y),A.u_height_lift=l),A},An=(e,t,r)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:r}),wn=(t,r,o,n,i,a,s,l,c,u,d,h,f,m)=>{const p=Ln(t,r,o,n,i,a,s,c,u,d,h,f,m,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return e.e(p,xn(r,l),g)},Sn=(e,t)=>({u_matrix:e,u_emissive_strength:t}),En=(t,r,o,n)=>e.e(Sn(t,r),xn(o,n)),Tn=(e,t,r)=>({u_matrix:e,u_world:r,u_emissive_strength:t}),Pn=(t,r,o,n,i)=>e.e(En(t,r,o,n),{u_world:i}),Cn=(t,r,o,n)=>{const i=e.Y/o.tileSize;return{u_matrix:t,u_camera_to_center_distance:r.getCameraToCenterDistance(n),u_extrude_scale:[r.pixelsToGLUnits[0]/i,r.pixelsToGLUnits[1]/i]}},Rn=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},Mn=e.a9.create(),In=(t,r,o,n,i,a,s)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.cu(l.zoom,r.canonical)*l._pixelsPerMercatorPixel:e.a6(o,1,a),d={u_matrix:r.projMatrix,u_extrude_scale:u,u_intensity:s,u_inv_rot_matrix:Mn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){d.u_inv_rot_matrix=n,d.u_merc_center=i,d.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],d.u_zoom_transition=e.W(l.zoom);const t=i[0]*e.Y,o=i[1]*e.Y;d.u_up_dir=l.projection.upVector(new e.bv(0,0,0),t,o)}return d};function On(e,t,r){let[o,n,i,a]=t,[s,l]=r;if(s===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-s));return[o*c,n*c,i*c,a*c]}function Dn(e,t,r){let[o,n]=r;return o===n?0:.5/e+(t-o)*(e-1)/(e*(n-o))}const kn=(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v,x,b)=>({u_matrix:t,u_normalize_matrix:r,u_globe_matrix:o,u_merc_matrix:n,u_grid_matrix:i,u_tl_parent:a,u_scale_parent:u,u_fade_t:d.mix,u_opacity:d.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:e.cv(h.paint.get("raster-saturation")),u_contrast_factor:e.cw(h.paint.get("raster-contrast")),u_spin_weights:Nn(h.paint.get("raster-hue-rotate")),u_perspective_transform:f,u_raster_elevation:m,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:On(e.cx,g,y),u_colorization_offset:Dn(e.cx,_,y),u_color_ramp:p,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function Nn(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Bn=(e,t,r,o,n,i,a,s,l,c,u,d)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:o,u_grid_matrix:n,u_tl_parent:i,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:d,u_zoom_transition:a,u_merc_center:s,u_cutoff_params:l}),Fn=(e,t,r,o,n,i,a,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:o,u_color_ramp:i,u_velocity_res:n,u_max_speed:a,u_uv_offset:s,u_data_scale:l,u_data_offset:c,u_particle_pos_scale:1.3,u_particle_pos_offset:[Nt,Nt]}),zn=(e,t,r,o,n,i,a,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:o,u_max_speed:n,u_speed_factor:i,u_reset_rate:a,u_rand_seed:Math.random(),u_uv_offset:s,u_data_scale:l,u_data_offset:c,u_particle_pos_scale:1.3,u_particle_pos_offset:[Nt,Nt]}),Un=e.a9.create(),Vn=(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y)=>{const v=i.transform,x={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:v.getCameraToCenterDistance(g),u_rotate_symbol:+o,u_aspect_ratio:v.width/v.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Un,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Un,u_up_vector:[0,-1,0],u_color_adj_mat:_,u_icon_transition:y||0};return"globe"===g.name&&(x.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],x.u_zoom_transition=h,x.u_inv_rot_matrix=m,x.u_merc_center=f,x.u_camera_forward=v._camera.forward(),x.u_ecef_origin=e.cy(v.globeMatrix,d.toUnwrapped()),x.u_tile_matrix=Float32Array.from(v.globeMatrix),x.u_up_vector=p),x},Hn=(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_)=>e.e(Vn(t,r,o,n,i,a,s,l,c,u,h,f,m,p,g,_),{u_gamma_scale:n?i.transform.getCameraToCenterDistance(_)*Math.cos(i.terrain?0:i.transform._pitch):1,u_device_pixel_ratio:e.f.devicePixelRatio,u_is_halo:+d,undefined:void 0}),Gn=(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g)=>e.e(Hn(t,r,o,n,i,a,s,l,!0,c,!0,d,h,f,m,p,g),{u_texsize_icon:u,u_texture_icon:1}),jn=(e,t,r,o)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:o}),Wn=(t,r,o,n,i,a,s)=>e.e(function(t,r,o,n){const i=o.imageManager.getPattern(t.toString(),r),{width:a,height:s}=o.imageManager.getPixelSize(r),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,o.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),d=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:i.tl,u_pattern_br:i.br,u_texsize:[a,s],u_pattern_size:i.displaySize,u_tile_units_to_pixels:1/e.a6(n,1,o.transform.tileZoom),u_pixel_coord_upper:[u>>16,d>>16],u_pixel_coord_lower:[65535&u,65535&d]}}(i,a,n,s),{u_matrix:t,u_emissive_strength:r,u_opacity:o}),Kn=new Float32Array(e.a9.identity([])),Jn=function(t,r,o,n,i,a,s,l,c,u,d,h,f){let m=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],p=arguments.length>14?arguments[14]:void 0;const g=i.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],v=e.ct.create();"viewport"===g.properties.get("anchor")&&(e.ct.fromRotation(v,-i.transform.angle),e.Q.transformMat3(y,y,v));const x="MASK"===d.alphaMode,b=g.properties.get("color"),L=f.paint.get("model-ambient-occlusion-intensity"),A=f.paint.get("model-color").constantOr(e.aA.white),w=f.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:r,u_normal_matrix:o,u_node_matrix:n||Kn,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:m,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:d.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:po.BaseColor,u_metallicRoughnessTexture:po.MetallicRoughness,u_normalTexture:po.Normal,u_occlusionTexture:po.Occlusion,u_emissionTexture:po.Emission,u_color_mix:[A.r,A.g,A.b,w],u_aoIntensity:L,u_emissive_strength:h,u_occlusionTextureTransform:p||[0,0,0,0]}},Zn=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kn,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Kn}},Yn={fillExtrusion:t=>({u_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_vertical_gradient:new e.bQ(t),u_opacity:new e.bQ(t),u_edge_radius:new e.bQ(t),u_ao:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_up_dir:new e.bP(t),u_height_lift:new e.bQ(t),u_flood_light_color:new e.bP(t),u_vertical_scale:new e.bQ(t),u_flood_light_intensity:new e.bQ(t),u_ground_shadow_factor:new e.bP(t),u_emissive_strength:new e.bQ(t)}),fillExtrusionDepth:t=>({u_matrix:new e.bN(t),u_edge_radius:new e.bQ(t),u_vertical_scale:new e.bQ(t)}),fillExtrusionPattern:t=>({u_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_vertical_gradient:new e.bQ(t),u_height_factor:new e.bQ(t),u_edge_radius:new e.bQ(t),u_ao:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_up_dir:new e.bP(t),u_height_lift:new e.bQ(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t),u_opacity:new e.bQ(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.bN(t),u_opacity:new e.bQ(t),u_ao_pass:new e.bQ(t),u_meter_to_tile:new e.bQ(t),u_ao:new e.bO(t),u_flood_light_intensity:new e.bQ(t),u_flood_light_color:new e.bP(t),u_attenuation:new e.bQ(t),u_edge_radius:new e.bQ(t),u_fb:new e.bR(t),u_fb_size:new e.bQ(t)}),fill:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t)}),fillPattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),fillOutline:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_world:new e.bO(t)}),fillOutlinePattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_world:new e.bO(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),circle:e.cz,collisionBox:t=>({u_matrix:new e.bN(t),u_camera_to_center_distance:new e.bQ(t),u_extrude_scale:new e.bO(t)}),collisionCircle:t=>({u_matrix:new e.bN(t),u_inv_matrix:new e.bN(t),u_camera_to_center_distance:new e.bQ(t),u_viewport_size:new e.bO(t)}),debug:t=>({u_color:new e.cf(t),u_matrix:new e.bN(t),u_overlay:new e.bR(t),u_overlay_scale:new e.bQ(t)}),clippingMask:t=>({u_matrix:new e.bN(t)}),heatmap:t=>({u_extrude_scale:new e.bQ(t),u_intensity:new e.bQ(t),u_matrix:new e.bN(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_up_dir:new e.bP(t)}),heatmapTexture:t=>({u_image:new e.bR(t),u_color_ramp:new e.bR(t),u_opacity:new e.bQ(t)}),hillshade:t=>({u_matrix:new e.bN(t),u_image:new e.bR(t),u_latrange:new e.bO(t),u_light:new e.bO(t),u_shadow:new e.cf(t),u_highlight:new e.cf(t),u_emissive_strength:new e.bQ(t),u_accent:new e.cf(t)}),hillshadePrepare:t=>({u_matrix:new e.bN(t),u_image:new e.bR(t),u_dimension:new e.bO(t),u_zoom:new e.bQ(t)}),line:e.cA,linePattern:e.cB,raster:t=>({u_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_grid_matrix:new e.cg(t),u_tl_parent:new e.bO(t),u_scale_parent:new e.bQ(t),u_fade_t:new e.bQ(t),u_opacity:new e.bQ(t),u_image0:new e.bR(t),u_image1:new e.bR(t),u_brightness_low:new e.bQ(t),u_brightness_high:new e.bQ(t),u_saturation_factor:new e.bQ(t),u_contrast_factor:new e.bQ(t),u_spin_weights:new e.bP(t),u_perspective_transform:new e.bO(t),u_raster_elevation:new e.bQ(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_cutoff_params:new e.bS(t),u_colorization_mix:new e.bS(t),u_colorization_offset:new e.bQ(t),u_color_ramp:new e.bR(t),u_texture_offset:new e.bO(t),u_texture_res:new e.bO(t),u_emissive_strength:new e.bQ(t)}),rasterParticle:t=>({u_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_grid_matrix:new e.cg(t),u_tl_parent:new e.bO(t),u_scale_parent:new e.bQ(t),u_fade_t:new e.bQ(t),u_opacity:new e.bQ(t),u_image0:new e.bR(t),u_image1:new e.bR(t),u_raster_elevation:new e.bQ(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_cutoff_params:new e.bS(t)}),rasterParticleTexture:t=>({u_texture:new e.bR(t),u_opacity:new e.bQ(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.bR(t),u_particle_texture_side_len:new e.bQ(t),u_tile_offset:new e.bO(t),u_velocity:new e.bR(t),u_color_ramp:new e.bR(t),u_velocity_res:new e.bO(t),u_max_speed:new e.bQ(t),u_uv_offset:new e.bO(t),u_data_scale:new e.bS(t),u_data_offset:new e.bQ(t),u_particle_pos_scale:new e.bQ(t),u_particle_pos_offset:new e.bO(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.bR(t),u_particle_texture_side_len:new e.bQ(t),u_velocity:new e.bR(t),u_velocity_res:new e.bO(t),u_max_speed:new e.bQ(t),u_speed_factor:new e.bQ(t),u_reset_rate:new e.bQ(t),u_rand_seed:new e.bQ(t),u_uv_offset:new e.bO(t),u_data_scale:new e.bS(t),u_data_offset:new e.bQ(t),u_particle_pos_scale:new e.bQ(t),u_particle_pos_offset:new e.bO(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_camera_forward:new e.bP(t),u_tile_matrix:new e.bN(t),u_up_vector:new e.bP(t),u_ecef_origin:new e.bP(t),u_texture:new e.bR(t),u_icon_transition:new e.bQ(t),u_color_adj_mat:new e.bN(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_texture:new e.bR(t),u_gamma_scale:new e.bQ(t),u_device_pixel_ratio:new e.bQ(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_camera_forward:new e.bP(t),u_tile_matrix:new e.bN(t),u_up_vector:new e.bP(t),u_ecef_origin:new e.bP(t),u_is_halo:new e.bR(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_texsize_icon:new e.bO(t),u_texture:new e.bR(t),u_texture_icon:new e.bR(t),u_gamma_scale:new e.bQ(t),u_device_pixel_ratio:new e.bQ(t),u_is_halo:new e.bR(t)}),background:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_opacity:new e.bQ(t),u_color:new e.cf(t)}),backgroundPattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_opacity:new e.bQ(t),u_image:new e.bR(t),u_pattern_tl:new e.bO(t),u_pattern_br:new e.bO(t),u_texsize:new e.bO(t),u_pattern_size:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),terrainRaster:tn,terrainDepth:tn,skybox:t=>({u_matrix:new e.bN(t),u_sun_direction:new e.bP(t),u_cubemap:new e.bR(t),u_opacity:new e.bQ(t),u_temporal_offset:new e.bQ(t)}),skyboxGradient:t=>({u_matrix:new e.bN(t),u_color_ramp:new e.bR(t),u_center_direction:new e.bP(t),u_radius:new e.bQ(t),u_opacity:new e.bQ(t),u_temporal_offset:new e.bQ(t)}),skyboxCapture:t=>({u_matrix_3f:new e.cg(t),u_sun_direction:new e.bP(t),u_sun_intensity:new e.bQ(t),u_color_tint_r:new e.bS(t),u_color_tint_m:new e.bS(t),u_luminance:new e.bQ(t)}),globeRaster:t=>({u_proj_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_image0:new e.bR(t),u_grid_matrix:new e.cg(t),u_skirt_height:new e.bQ(t),u_far_z_cutoff:new e.bQ(t),u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_globe_pos:new e.bP(t),u_globe_radius:new e.bQ(t),u_viewport:new e.bO(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_horizon:new e.bQ(t),u_transition:new e.bQ(t),u_fadeout_range:new e.bQ(t),u_color:new e.bS(t),u_high_color:new e.bS(t),u_space_color:new e.bS(t),u_temporal_offset:new e.bQ(t),u_horizon_angle:new e.bQ(t)}),model:t=>({u_matrix:new e.bN(t),u_lighting_matrix:new e.bN(t),u_normal_matrix:new e.bN(t),u_node_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_camera_pos:new e.bP(t),u_opacity:new e.bQ(t),u_baseColorFactor:new e.bS(t),u_emissiveFactor:new e.bS(t),u_metallicFactor:new e.bQ(t),u_roughnessFactor:new e.bQ(t),u_baseTextureIsAlpha:new e.bR(t),u_alphaMask:new e.bR(t),u_alphaCutoff:new e.bQ(t),u_baseColorTexture:new e.bR(t),u_metallicRoughnessTexture:new e.bR(t),u_normalTexture:new e.bR(t),u_occlusionTexture:new e.bR(t),u_emissionTexture:new e.bR(t),u_color_mix:new e.bS(t),u_aoIntensity:new e.bQ(t),u_emissive_strength:new e.bQ(t),u_occlusionTextureTransform:new e.bS(t)}),modelDepth:t=>({u_matrix:new e.bN(t),u_instance:new e.bN(t),u_node_matrix:new e.bN(t)}),groundShadow:t=>({u_matrix:new e.bN(t),u_ground_shadow_factor:new e.bP(t)}),stars:t=>({u_matrix:new e.bN(t),u_up:new e.bP(t),u_right:new e.bP(t),u_intensity_multiplier:new e.bQ(t)})};let qn;function $n(t,r,o,n,i,a,s){const l=t.context,c=l.gl,u=t.transform,d=t.getOrCreateProgram("collisionBox"),h=[];let f=0,m=0;for(let b=0;b<n.length;b++){const l=n[b],p=r.getTile(l),g=p.getBucket(o);if(!g)continue;const _=Mr(l,g,u);let y=_;0===i[0]&&0===i[1]||(y=t.translatePosMatrix(_,p,i,a));const v=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const t=e.a9.create(),r=y;e.a9.mul(t,g.placementInvProjMatrix,u.glCoordMatrix),e.a9.mul(t,t,g.placementViewportMatrix),h.push({circleArray:x,circleOffset:m,transform:r,invTransform:t,projection:g.getProjection()}),f+=x.length/4,m=f}v&&(t.terrain&&t.terrain.setupElevationDraw(p,d),d.draw(t,c.LINES,Et.disabled,Pt.disabled,t.colorModeForRenderPass(),Ot.disabled,Cn(y,u,p,g.getProjection()),o.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!s||!h.length)return;const p=t.getOrCreateProgram("collisionCircle"),g=new e.cC;g.resize(4*f),g._trim();let _=0;for(const e of h)for(let t=0;t<e.circleArray.length/4;t++){const r=4*t,o=e.circleArray[r+0],n=e.circleArray[r+1],i=e.circleArray[r+2],a=e.circleArray[r+3];g.emplace(_++,o,n,i,a,0),g.emplace(_++,o,n,i,a,1),g.emplace(_++,o,n,i,a,2),g.emplace(_++,o,n,i,a,3)}(!qn||qn.length<2*f)&&(qn=function(t){const r=2*t,o=new e.az;o.resize(r),o._trim();for(let e=0;e<r;e++){const t=6*e;o.uint16[t+0]=4*e+0,o.uint16[t+1]=4*e+1,o.uint16[t+2]=4*e+2,o.uint16[t+3]=4*e+2,o.uint16[t+4]=4*e+3,o.uint16[t+5]=4*e+0}return o}(f));const y=l.createIndexBuffer(qn,!0),v=l.createVertexBuffer(g,e.cD.members,!0);for(const b of h){const r={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(b.projection),u_viewport_size:[x.width,x.height]};p.draw(t,c.TRIANGLES,Et.disabled,Pt.disabled,t.colorModeForRenderPass(),Ot.disabled,r,o.id,v,y,e.aE.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,u.zoom)}var x;v.destroy(),y.destroy()}const Xn=e.a9.create();function Qn(t){const r=t._camera.getWorldToCamera(t.worldSize,1),o=e.a9.multiply([],r,t.globeMatrix);e.a9.invert(o,o);const n=[0,0,0],i=[0,1,0,0];return e.aa.transformMat4(i,i,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],e.Q.normalize(n,n),n}function ei(t,r){let{width:o,height:n,anchor:i,textOffset:a,textScale:s}=t;const{horizontalAlign:l,verticalAlign:c}=e.bi(i),u=-(l-.5)*o,d=-(c-.5)*n,h=e.bh(i,a);return new e.P((u/s+h[0])*r,(d/s+h[1])*r)}function ti(t,r,o,n,i,a,s,l,c,u,d){const h=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,p={},g=t.getProjection(),_=Ir(l,g,a),y=a.elevation,v=g.upVectorScale(l.canonical,a.center.lat,a.worldSize).metersToTile;f.clear();for(let x=0;x<h.length;x++){const m=h.get(x),{tileAnchorX:b,tileAnchorY:L,numGlyphs:A}=m,w=m.hidden||!m.crossTileID||t.allowVerticalPlacement&&!m.placedOrientation?null:n[m.crossTileID];if(w){let n=0,h=0,x=0;if(y){const e=y?y.getAtTileOffset(l,b,L):0,[t,r,o]=g.upVector(l.canonical,b,L);n=e*t*v,h=e*r*v,x=e*o*v}let[S,E,T,P]=gr(m.projectedAnchorX+n,m.projectedAnchorY+h,m.projectedAnchorZ+x,o?_:s);const C=_r(a.getCameraToCenterDistance(g),P);let R=i.evaluateSizeForFeature(t.textSizeData,u,m)*C/e.bf;o&&(R*=t.tilePixelRatio/c);const M=ei(w,R);o?(({x:S,y:E,z:T}=g.projectTilePoint(b+M.x,L+M.y,l.canonical)),[S,E,T]=gr(S+n,E+h,T+x,s)):(r&&M._rotate(-a.angle),S+=M.x,E+=M.y,T=0);const I=t.allowVerticalPlacement&&m.placedOrientation===e.b9.vertical?Math.PI/2:0;for(let t=0;t<A;t++)e.bc(f,S,E,T,I);d&&m.associatedIconIndex>=0&&(p[m.associatedIconIndex]={x:S,y:E,z:T,angle:I})}else Er(A,f)}if(d){m.clear();const r=t.icon.placedSymbolArray;for(let t=0;t<r.length;t++){const o=r.get(t),{numGlyphs:n}=o,i=p[t];if(o.hidden||!i)Er(n,m);else{const{x:t,y:r,z:o,angle:a}=i;for(let i=0;i<n;i++)e.bc(m,t,r,o,a)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function ri(t,r,o,n,i,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=o.paint.get("icon-translate"),c=o.paint.get("text-translate"),u=o.paint.get("icon-translate-anchor"),d=o.paint.get("text-translate-anchor"),h=o.layout.get("icon-rotation-alignment"),f=o.layout.get("text-rotation-alignment"),m=o.layout.get("icon-pitch-alignment"),p=o.layout.get("text-pitch-alignment"),g=o.layout.get("icon-keep-upright"),_=o.layout.get("text-keep-upright"),y=o.paint.get("icon-color-saturation"),v=o.paint.get("icon-color-contrast"),x=o.paint.get("icon-color-brightness-min"),b=o.paint.get("icon-color-brightness-max"),L=t.context,A=L.gl,w=t.transform,S="map"===h,E="map"===f,T="map"===m,P="map"===p,C=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let R=!1;const M=t.depthModeForSublayer(0,Et.ReadOnly),I=[e.a8(w.center.lng),e.ah(w.center.lat)],O=o.layout.get("text-variable-anchor"),D="globe"===w.projection.name,k=[],N=[0,-1,0];for(const B of n){const n=r.getTile(B),i=n.getBucket(o);if(!i)continue;if("mercator"===i.projection.name&&D)continue;if(i.fullyClipped)continue;const a="globe"===i.projection.name,h=a?e.W(w.zoom):0,f=Ir(B,i.getProjection(),w),m=w.calculatePixelsToTileUnitsMatrix(n),p=O&&i.hasTextData(),L=i.hasIconTextFit()&&p&&i.hasIconData(),M=i.getProjection().createInversionMatrix(w,B.canonical),F=()=>{const r=S&&"point"!==o.layout.get("symbol-placement"),s=[],c=r||L,d=o.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&T&&s.push("PITCH_WITH_MAP_TERRAIN"),a&&(s.push("PROJECTION_GLOBE_VIEW"),c&&s.push("PROJECTED_POS_ON_VIEWPORT")),d>0&&s.push("ICON_TRANSITION"),i.icon.zOffsetVertexBuffer&&s.push("Z_OFFSET"),0===y&&0===v&&0===x&&1===b||s.push("COLOR_ADJUSTMENT");const p=i.icon.programConfigurations.get(o.id),_=t.getOrCreateProgram(i.sdfIcons?"symbolSDF":"symbolIcon",{config:p,defines:s});let E;const P=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],C=i.iconSizeData,R=e.b8(C,w.zoom),O=T||0!==w.pitch,k=fr(f,n.tileID.canonical,T,S,w,i.getProjection(),m),F=pr(f,n.tileID.canonical,T,S,w,i.getProjection(),m),z=t.translatePosMatrix(F,n,l,u,!0),U=t.translatePosMatrix(f,n,l,u),V=c?Xn:k,H=S&&!T&&!r;let G=N;!D&&!w.mercatorFromTransition||S||(G=Qn(w));const j=a?G:N;if(i.sdfIcons&&!i.iconsInText)E=Hn(C.kind,R,H,T,t,U,V,z,!1,P,!0,B,h,I,M,j,i.getProjection());else{const e=o.getColorAdjustmentMatrix(y,v,x,b);E=Vn(C.kind,R,H,T,t,U,V,z,!1,P,B,h,I,M,j,i.getProjection(),e,d)}const W=n.imageAtlasTexture?n.imageAtlasTexture:null,K=1!==o.layout.get("icon-size").constantOr(0)||i.iconsNeedLinear,J=i.sdfIcons||t.options.rotating||t.options.zooming||K||O?A.LINEAR:A.NEAREST,Z=i.sdfIcons&&0!==o.paint.get("icon-halo-width").constantOr(1),Y=t.terrain&&T&&r?e.a9.invert(e.a9.create(),k):Xn;if(r&&i.icon){const e=w.elevation,r=e?e.getAtTileOffsetFunc(B,w.center.lat,w.worldSize,i.getProjection()):null,o=mr(f,n.tileID.canonical,T,S,w,i.getProjection(),m);vr(i,f,t,!1,o,F,T,g,r,B)}return{program:_,buffers:i.icon,uniformValues:E,atlasTexture:W,atlasTextureIcon:null,atlasInterpolation:J,atlasInterpolationIcon:null,isSDF:i.sdfIcons,hasHalo:Z,tile:n,labelPlaneMatrixInv:Y}},z=()=>{const r=E&&"point"!==o.layout.get("symbol-placement"),s=[],l=r||O||L;t.terrainRenderModeElevated()&&P&&s.push("PITCH_WITH_MAP_TERRAIN"),a&&(s.push("PROJECTION_GLOBE_VIEW"),l&&s.push("PROJECTED_POS_ON_VIEWPORT")),i.text.zOffsetVertexBuffer&&s.push("Z_OFFSET");const u=i.text.programConfigurations.get(o.id),p=t.getOrCreateProgram(i.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:s});let g,y=[0,0],v=null;const x=i.textSizeData;i.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],v=n.imageAtlasTexture?n.imageAtlasTexture:null,g=P||0!==w.pitch||t.options.rotating||t.options.zooming||"composite"===x.kind||"camera"===x.kind?A.LINEAR:A.NEAREST);const b=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],S=e.b8(x,w.zoom),T=fr(f,n.tileID.canonical,P,E,w,i.getProjection(),m),C=pr(f,n.tileID.canonical,P,E,w,i.getProjection(),m),R=t.translatePosMatrix(C,n,c,d,!0),k=t.translatePosMatrix(f,n,c,d),F=l?Xn:T,z=E&&!P&&!r;let U=N;!D&&!w.mercatorFromTransition||E||(U=Qn(w));const V=a?U:N;let H;H=i.iconsInText?Gn(x.kind,S,z,P,t,k,F,R,b,y,B,h,I,M,V,i.getProjection()):Hn(x.kind,S,z,P,t,k,F,R,!0,b,!0,B,h,I,M,V,i.getProjection());const G=n.glyphAtlasTexture?n.glyphAtlasTexture:null,j=A.LINEAR,W=0!==o.paint.get("text-halo-width").constantOr(1),K=t.terrain&&P&&r?e.a9.invert(e.a9.create(),T):Xn;if(r&&i.text){const e=w.elevation,r=e?e.getAtTileOffsetFunc(B,w.center.lat,w.worldSize,i.getProjection()):null,o=mr(f,n.tileID.canonical,P,E,w,i.getProjection(),m);vr(i,f,t,!0,o,C,P,_,r,B)}return{program:p,buffers:i.text,uniformValues:H,atlasTexture:G,atlasTextureIcon:v,atlasInterpolation:j,atlasInterpolationIcon:g,isSDF:!0,hasHalo:W,tile:n,labelPlaneMatrixInv:K}},U=i.icon.segments.get().length,V=i.text.segments.get().length,H=U&&!s.onlyText?F():null,G=V&&!s.onlyIcons?z():null,j=o.paint.get("icon-opacity").constantOr(1),W=o.paint.get("text-opacity").constantOr(1);if(C&&i.canOverlap){R=!0;const t=j&&!s.onlyText?i.icon.segments.get():[],r=W&&!s.onlyIcons?i.text.segments.get():[];for(const o of t)k.push({segments:new e.aE([o]),sortKey:o.sortKey,state:H});for(const o of r)k.push({segments:new e.aE([o]),sortKey:o.sortKey,state:G})}else s.onlyText||k.push({segments:j?i.icon.segments:new e.aE([]),sortKey:0,state:H}),s.onlyIcons||k.push({segments:W?i.text.segments:new e.aE([]),sortKey:0,state:G})}R&&k.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of k){const r=e.state;if(r)if(t.terrain&&t.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:w.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}),L.activeTexture.set(A.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,A.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(L.activeTexture.set(A.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,A.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,r.program),r.hasHalo){const n=r.uniformValues;n.u_is_halo=1,oi(r.buffers,e.segments,o,t,r.program,M,i,a,n,2),n.u_is_halo=0}else{if(r.isSDF){const n=r.uniformValues;r.hasHalo&&(n.u_is_halo=1,oi(r.buffers,e.segments,o,t,r.program,M,i,a,n,1)),n.u_is_halo=0}oi(r.buffers,e.segments,o,t,r.program,M,i,a,r.uniformValues,1)}}}function oi(e,t,r,o,n,i,a,s,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];n.draw(o,o.context.gl.TRIANGLES,i,a,s,Ot.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,o.transform.zoom,e.programConfigurations.get(r.id),u,c)}function ni(e,t,r,o,n,i,a){const s=e.context.gl,l=r.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,d,h,f,m;a?(d=c&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=s.LINES):(d=c?"fillPattern":"fill",u=s.TRIANGLES);for(const p of o){const o=t.getTile(p);if(c&&!o.patternsLoaded())continue;const g=o.getBucket(r);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(r.id),y=e.isTileAffectedByFog(p),v=e.getOrCreateProgram(d,{config:_,overrideFog:y});c&&(e.context.activeTexture.set(s.TEXTURE0),o.imageAtlasTexture&&o.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=l.constantOr(null);if(x&&o.imageAtlas){const e=o.imageAtlas.patternPositions[x.toString()];e&&_.setConstantPatternPositions(e)}const b=e.translatePosMatrix(p.projMatrix,o,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),L=r.paint.get("fill-emissive-strength");if(a){f=g.indexBuffer2,m=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[s.drawingBufferWidth,s.drawingBufferHeight];h="fillOutlinePattern"===d&&c?Pn(b,L,e,o,t):Tn(b,L,t)}else f=g.indexBuffer,m=g.segments,h=c?En(b,L,e,o):Sn(b,L);e.uploadCommonUniforms(e.context,v,p.toUnwrapped()),v.draw(e,u,n,e.stencilModeForClipping(p),i,Ot.disabled,h,r.id,g.layoutVertexBuffer,f,m,r.paint,e.transform.zoom,_,void 0)}}function ii(t,r,o,n,i,a,s,l){o.resetLayerRenderingStats(t);const c=t.context,u=c.gl,d=t.transform,h=o.paint.get("fill-extrusion-pattern"),f=h.constantOr(1),m=o.paint.get("fill-extrusion-opacity"),p=t.style.enable3dLights(),g=o.paint.get(p&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=o.layout.get("fill-extrusion-edge-radius"),v=y>0&&!o.paint.get("fill-extrusion-rounded-roof"),x=v?0:y,b="globe"===d.projection.name?e.cM():0,L="globe"===d.projection.name,A=L?e.W(d.zoom):0,w=[e.a8(d.center.lng),e.ah(d.center.lat)],S=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=o.paint.get("fill-extrusion-flood-light-intensity"),T=o.paint.get("fill-extrusion-vertical-scale"),P=go(t,o.paint.get("fill-extrusion-cutoff-fade-range")),C=o.paint.get("fill-extrusion-emissive-strength"),R=[];let M;L&&R.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&R.push("FAUX_AO"),v&&R.push("ZERO_ROOF_RADIUS"),l&&R.push("HAS_CENTROID"),E>0&&R.push("FLOOD_LIGHT"),P.shouldRenderCutoff&&R.push("RENDER_CUTOFF");const I="shadow"===t.renderPass,O=t.shadowRenderer,D=I&&!!O;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let k=[0,0,0];if(O){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(k=Ao(e,r)),M=R.concat(["SHADOWS_SINGLE_CASCADE"])}const N=D?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",B=o.getLayerRenderingStats();for(const e of n){const n=r.getTile(e),p=n.getBucket(o);if(!p||p.projection.name!==d.projection.name)continue;let g=!1;O&&(g=0===O.getMaxCascadeForTile(e.toUnwrapped()));const y=t.isTileAffectedByFog(e),v=p.programConfigurations.get(o.id),D=t.getOrCreateProgram(N,{config:v,defines:g?M:R,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(n,D,{useMeterToDem:!0}),!p.centroidVertexBuffer){const e=D.attributes.a_centroid_pos;void 0!==e&&u.vertexAttrib2f(e,0,0)}!I&&O&&O.setupShadows(n.tileID.toUnwrapped(),D,"vector-tile",n.tileID.overscaledZ),f&&(t.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers());const F=h.constantOr(null);if(F&&n.imageAtlas){const e=n.imageAtlas.patternPositions[F.toString()];e&&v.setConstantPatternPositions(e)}const z=o.paint.get("fill-extrusion-vertical-gradient");let U;if(I&&O){if(di(n.tileID,p,t))continue;const e=O.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());U=An(e,x,T)}else{const r=t.translatePosMatrix(e.expandedProjMatrix,n,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),i=d.projection.createInversionMatrix(d,e.canonical);U=f?wn(r,t,z,m,_,x,e,n,b,A,w,i,S,T):Ln(r,t,z,m,_,x,e,b,A,w,i,S,T,E,k,C)}t.uploadCommonUniforms(c,D,e.toUnwrapped(),null,P);let V=p.segments;if("mercator"===d.projection.name&&!I&&(V=p.getVisibleSegments(n.tileID,t.terrain,t.transform.getFrustum(0)),!V.get().length))continue;if(B)if(I)for(const e of V.get())B.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of V.get())B.numRenderedVerticesInTransparentPass+=e.primitiveLength;const H=[];(t.terrain||l)&&H.push(p.centroidVertexBuffer),L&&H.push(p.layoutVertexExtBuffer),D.draw(t,c.gl.TRIANGLES,i,a,s,Ot.backCCW,U,o.id,p.layoutVertexBuffer,p.indexBuffer,V,o.paint,t.transform.zoom,v,H)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function ai(t,r,o,n,i,a,s,l,c,u,d,h,f,m,p,g,_,y,v){const x=t.context,b=x.gl,L=t.transform,A=t.transform.zoom,w=[],S=go(t,o.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(w.push("CLEAR_SUBPASS"),v&&(w.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===u&&w.push("SDF_SUBPASS"),_&&w.push("HAS_CENTROID"),S.shouldRenderCutoff&&w.push("RENDER_CUTOFF");const E=o.layout.get("fill-extrusion-edge-radius"),T=(e,r,n,u,y)=>{const b=r.programConfigurations.get(o.id),L=t.isTileAffectedByFog(e),T=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:w,overrideFog:L}),P=((e,t,r,o,n,i,a,s,l,c,u)=>({u_matrix:t,u_opacity:r,u_ao_pass:o?1:0,u_meter_to_tile:n,u_ao:i,u_flood_light_intensity:a,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,d,c,y,[h,f*y],m,p,g,A>=17?0:E*y,v?v.size[0]:0),C=[];_&&C.push(r.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(x,T,e.toUnwrapped(),null,S),T.draw(t,x.gl.TRIANGLES,i,a,s,l,P,o.id,r.vertexBuffer,r.indexBuffer,n,o.paint,A,b,C)};for(const P of n){const n=r.getTile(P),i=n.getBucket(o);if(!i||i.projection.name!==L.projection.name||!i.groundEffect||i.groundEffect&&!i.groundEffect.hasData())continue;const a=i.groundEffect,s=1/i.tileToMeter;{const e=t.translatePosMatrix(P.projMatrix,n,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),r=a.getDefaultSegment();T(P,a,r,e,s)}if(y)for(let l=0;l<4;l++){const i=e.cN[l](P),a=r.getTile(i);if(!a)continue;const c=a.getBucket(o);if(!c||c.projection.name!==L.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let d,h;0===l?(d=[-e.Y,0,0],h=1):1===l?(d=[e.Y,0,0],h=0):2===l?(d=[0,-e.Y,0],h=3):(d=[0,e.Y,0],h=2);const f=u.regionSegments[h];if(!f)continue;const m=new Float32Array(16);e.a9.translate(m,P.projMatrix,d),T(P,u,f,t.translatePosMatrix(m,n,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),s)}}}function si(t,r,o,n,i,a,s){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=a?a.findDEMTileFor(o):null;if(!(l&&l.dem||s))return;const c=t=>new e.P(Math.ceil((t+e.cQ)*e.cR),0),u=e=>{const t=r.getSource().minzoom,o=e=>{const t=r.getTileByID(e);if(t&&t.hasData())return t.getBucket(i)},n=[0,-1,1];for(const r of n){if(e.overscaledZ+r<t)continue;const n=o(e.calculateScaledKey(e.overscaledZ+r));if(n)return n}},d=[0,0,0],h=(t,r)=>(d[0]=Math.min(t.min.y,r.min.y),d[1]=Math.max(t.max.y,r.max.y),d[2]=e.Y-r.min.x>t.max.x?r.min.x-e.Y:t.max.x,d),f=(t,r)=>(d[0]=Math.min(t.min.x,r.min.x),d[1]=Math.max(t.max.x,r.max.x),d[2]=e.Y-r.min.y>t.max.y?r.min.y-e.Y:t.max.y,d),m=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>f(e,t),(e,t)=>f(t,e)],p=(t,r,n,i,s,c,u)=>{if(!a)return 0;const d=[[c?n:t,c?t:n,0],[c?n:r,c?r:n,0]],h=u<0?e.Y+u:u,f=[c?h:(t+r)/2,c?(t+r)/2:h,0];return 0===n&&u<0||0!==n&&u>0?a.getForTilePoints(s,[f],!0,i):d.push(f),a.getForTilePoints(o,d,!0,l),Math.max(d[0][2],d[1][2],f[2])/a.exaggeration()};for(let y=0;y<4;y++){const t=n.borderFeatureIndices[y];if(0===t.length)continue;const r=e.cN[y](o),i=u(r);if(!(i&&i instanceof e.cO))continue;if(n.borderDoneWithNeighborZ[y]===i.canonical.z)continue;0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const l=a?a.findDEMTileFor(r):null;if(!(l&&l.dem||s))continue;const d=(y<2?1:5)-y,h=i.borderDoneWithNeighborZ[d]!==n.canonical.z,f=i.borderFeatureIndices[d];let v=0;if(n.canonical.z!==i.canonical.z){for(const e of t)n.showCentroid(n.featuresOnBorder[e]);if(h)for(const e of f)i.showCentroid(i.featuresOnBorder[e]);n.borderDoneWithNeighborZ[y]=i.canonical.z,i.borderDoneWithNeighborZ[d]=n.canonical.z}for(const o of t){const t=n.featuresOnBorder[o],a=n.centroidData[t.centroidDataIndex],u=t.borders[y];let h;for(;v<f.length;){h=i.featuresOnBorder[f[v]];const e=h.borders[d];if(e[1]>u[0]+3||e[0]>u[0]-3)break;i.showCentroid(h),v++}if(h&&v<f.length){const o=v;let x=0;for(;!(h.borders[d][0]>u[1]-3)&&(x++,++v!==f.length);)h=i.featuresOnBorder[f[v]];if(h=i.featuresOnBorder[f[o]],x>1){const e=h.borders[d];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,v=o+1)}else if(0===x){n.showCentroid(t);continue}const b=i.centroidData[h.centroidDataIndex];s&&1===x&&(((g=a).flags|(_=b).flags)&e.cP?(g.flags|=e.cP,_.flags|=e.cP):(g.flags&=~e.cP,_.flags&=~e.cP));const L=t.intersectsCount()>1||h.intersectsCount()>1;if(x>1)v=o,a.centroidXY=b.centroidXY=new e.P(0,0);else if(l&&l.dem&&!L){const t=m[y](a,b),o=y%2?e.Y-1:0,n=p(t[0],Math.min(e.Y-1,t[1]),o,l,r,y<2,t[2]);a.centroidXY=b.centroidXY=c(n)}else L?a.centroidXY=b.centroidXY=new e.P(0,0):(a.centroidXY=n.encodeBorderCentroid(t),b.centroidXY=i.encodeBorderCentroid(h));n.writeCentroidToBuffer(a),i.writeCentroidToBuffer(b)}else n.showCentroid(t)}n.borderDoneWithNeighborZ[y]=i.canonical.z,i.borderDoneWithNeighborZ[d]=n.canonical.z}var g,_;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const li=[1,0,0],ci=[0,1,0],ui=[0,0,1];function di(t,r,o){const n=o.transform,i=o.shadowRenderer;if(!i)return!0;const a=t.toUnwrapped(),s=n.tileSize*i._cascades[o.currentShadowCascade].scale;let l=r.maxHeight;if(n.elevation){const e=n.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...i.shadowDirection];c[2]=-c[2];const u=i.computeSimplifiedTileShadowVolume(a,l,s,c);if(!u)return!1;const d=[li,ci,ui,c,[c[0],0,c[2]],[0,c[1],c[2]]],h="globe"===n.projection.name,f=n.scaleZoom(s),m=e.bt.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,f,!h),p=i.getCurrentCascadeFrustum();return 0===m.intersectsPrecise(u.vertices,u.planes,d)||0===p.intersectsPrecise(u.vertices,u.planes,d)}function hi(t){return[t[0]*e.cS,t[1]*e.cS,t[2]*e.cS,0]}function fi(t,r,o,n,i,a,s,l,c){const u=n.getSource(),d=o.globeSharedBuffers;if(!d)return;let h,f,m;if(r&&(h=n.getTile(r)),u instanceof e.as?(f=u.texture,m=e.co(0,0,o.transform)):h&&r&&(f=h.texture,m=e.co(r.canonical.z,r.canonical.x,o.transform)),!f||!m)return;t||(m=e.a9.scale(e.a9.create(),m,[1,-1,1]));const p=o.context,g=p.gl,_="nearest"===i.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=o.colorModeForDrapableLayerRenderPass(a),v=s.defines;v.push("GLOBE_POLES");const x=new Et(g.LEQUAL,Et.ReadWrite,o.depthRangeFor3D),b=Float32Array.from(o.transform.expandedFarZProjMatrix),L=Float32Array.from(e.aW(e.cn(new e.bv(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),p.activeTexture.set(g.TEXTURE0),f.bind(_,g.CLAMP_TO_EDGE),p.activeTexture.set(g.TEXTURE1),f.bind(_,g.CLAMP_TO_EDGE),f.useMipmap&&p.extTextureFilterAnisotropic&&o.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,p.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,p.extTextureFilterAnisotropicMax);const[A,w,S,E]=r?d.getPoleBuffers(r.canonical.z,!1):d.getPoleBuffers(0,!0),T=i.paint.get("raster-elevation");let P;t?(P=A,o.renderDefaultNorthPole=0!==T):(P=w,o.renderDefaultSouthPole=0!==T);const C=hi(s.mix),R=((e,t,r,o,n,i,a,s,l,c,u,d,h)=>kn(e,t,r,new Float32Array(16),new Float32Array(9),[0,0],o,[0,0],[0,0,0,0],1,{opacity:1,mix:0},i,[0,0]||0,s,2,c,u,d,1,0,h))(b,L,m,e.W(o.transform.zoom),0,i,0,T,0,C,s.offset,s.range,a),M=o.getOrCreateProgram("raster",{defines:v});o.uploadCommonUniforms(p,M,null),M.draw(o,g.TRIANGLES,x,c,y,l,R,i.id,P,S,E)}function mi(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),o=r-t,n=.2*e.height,i=t+n;return[t,r,(i-n-t)/o,(i-t)/o]}function pi(e,t,r,o){if(e)return t instanceof Me&&e instanceof Kt?t.getTextureDescriptor(e,r,!0):{texture:e.texture,mix:hi(o.mix),offset:o.offset,buffer:0,tileSize:1}}function gi(t,r,o){if(!t)return null;const n=r.getTextureDescriptor(t,o,!0);if(!n)return null;let{texture:i,mix:a,offset:s,tileSize:l,buffer:c,format:u}=n;if(!i||!u)return null;let d=!1;return"uint32"===u&&(d=!0,a[3]=0,a=On(e.cT,a,[0,o.paint.get("raster-particle-max-speed")]),s=Dn(e.cT,s,[0,o.paint.get("raster-particle-max-speed")])),{texture:i,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:d,scale:a,offset:s,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function _i(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),o=r-t,n=.2*e.height,i=t+n;return[t,r,(i-n-t)/o,(i-t)/o]}const yi=new e.aA(1,0,0,1),vi=new e.aA(0,1,0,1),xi=new e.aA(0,0,1,1),bi=new e.aA(1,0,1,1),Li=new e.aA(0,1,1,1);function Ai(t,r,o,n,i,a,s){const l=t.context,c=t.transform,u=l.gl,d="globe"===c.projection.name,h=d?["PROJECTION_GLOBE_VIEW"]:[];let f=e.a9.clone(o.projMatrix);if(d&&e.W(c.zoom)>0){const t=e.aV(o.canonical,c),r=e.cU(t);f=e.a9.multiply(new Float32Array(16),c.globeMatrix,r),e.a9.multiply(f,c.projMatrix,f)}const m=e.a9.create();m[12]+=2*i/(e.f.devicePixelRatio*c.width),m[13]+=2*a/(e.f.devicePixelRatio*c.height),e.a9.multiply(f,m,f);const p=t.getOrCreateProgram("debug",{defines:h}),g=r.getTileByID(o.key);t.terrain&&t.terrain.setupElevationDraw(g,p);const _=Et.disabled,y=Pt.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),d?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,L=g._tileDebugIndexBuffer||t.debugIndexBuffer,A=g._tileDebugSegments||t.debugSegments;if(p.draw(t,u.LINE_STRIP,_,y,v,Ot.disabled,Rn(f,n),x,b,L,A,null,null,null,[g._globeTileDebugBorderBuffer]),s){const e=g.latestRawTileData,r=Math.floor((e&&e.byteLength||0)/1024);let n=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(n+=` => ${o.overscaledZ}`),n+=` ${g.state}`,n+=` ${r}kb`,function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,o=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,r.width,r.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}(t,n)}const w=r.getTile(o).tileSize,S=512/Math.min(w,512)*(o.overscaledZ/c.zoom)*.5,E=g._tileDebugTextBuffer||t.debugBuffer,T=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,P=g._tileDebugTextSegments||t.debugSegments;p.draw(t,u.TRIANGLES,_,y,Rt.alphaBlended,Ot.disabled,Rn(f,e.aA.transparent,S),x,E,T,P,null,null,null,[g._globeTileDebugTextBuffer])}function wi(e,t,r,o){Ei(e,0,t+r/2,e.transform.width,r,o)}function Si(e,t,r,o){Ei(e,t-r/2,0,r,e.transform.height,o)}function Ei(t,r,o,n,i,a){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*e.f.devicePixelRatio,o*e.f.devicePixelRatio,n*e.f.devicePixelRatio,i*e.f.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}const Ti=e.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pi}=Ti;function Ci(e,t,r,o){e.emplaceBack(t,r,o)}class Ri{constructor(t){this.vertexArray=new e.cV,this.indices=new e.az,Ci(this.vertexArray,-1,-1,1),Ci(this.vertexArray,1,-1,1),Ci(this.vertexArray,-1,1,1),Ci(this.vertexArray,1,1,1),Ci(this.vertexArray,-1,-1,-1),Ci(this.vertexArray,1,-1,-1),Ci(this.vertexArray,-1,1,-1),Ci(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Pi),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.aE.simpleSegment(0,0,36,12)}}function Mi(t,r,o,n,i,a){const s=t.context.gl,l=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),u=r.paint.get("sky-atmosphere-sun-intensity"),d=((e,t,r,o,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:r,u_color_tint_r:[o.r,o.g,o.b,o.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.ct.fromMat4(e.ct.create(),n),i,u,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,r.skyboxTexture,0),o.draw(t,s.TRIANGLES,Et.disabled,Pt.disabled,Rt.unblended,Ot.frontCW,d,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ii=e.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Oi{constructor(t){const r=new e.cW;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const o=new e.az;o.emplaceBack(0,1,2),o.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Ii.members),this.indexBuffer=t.createIndexBuffer(o),this.segments=e.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Di=e.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ki{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ni{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Rt([1,Ct,1,Ct],e.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Rt([1,0,1,0],e.aA.transparent,[!1,!1,!1,!0]),this.params=new ki,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Oi(r);const t=this.params.sizeRange,o=this.params.intensityRange,n=function(t){const r=e.aC(30),o=[];for(let n=0;n<t;++n){const t=2*Math.PI*r(),n=Math.acos(1-2*r())-.5*Math.PI;o.push(e.Q.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return o}(this.params.starsCount),i=e.aC(300),a=new e.cX,s=new e.az;let l=0;for(let r=0;r<n.length;++r){const c=e.Q.scale([],n[r],200),u=Math.max(0,1+.01*t*(1*i()-.5)),d=Math.max(0,1+.01*o*(1*i()-.5));a.emplaceBack(c[0],c[1],c[2],-1,-1,u,d),a.emplaceBack(c[0],c[1],c[2],1,-1,u,d),a.emplaceBack(c[0],c[1],c[2],1,1,u,d),a.emplaceBack(c[0],c[1],c[2],-1,1,u,d),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=r.createVertexBuffer(a,Di.members),this.starsIdx=r.createIndexBuffer(s),this.starsSegments=e.aE.simpleSegment(0,0,a.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const o=t.context,n=o.gl,i=t.transform,a=new Et(n.LEQUAL,Et.ReadOnly,[0,1]),s=e.W(i.zoom),l=r.properties.get("color").toArray01(),c=r.properties.get("high-color").toArray01(),u=r.properties.get("space-color").toArray01PremultipliedAlpha(),d=5e-4,h=e.cY(r.properties.get("horizon-blend"),0,1,d,.25),f=e.ci(t,o,i)&&h===d?i.worldSize/(2*Math.PI*1.025)-1:i.globeRadius,m=t.frameCounter/1e3%1,p=e.Q.length(i.globeCenterInViewSpace),g=Math.sqrt(Math.pow(p,2)-Math.pow(f,2)),_=Math.acos(g/p),y=e=>{const r="globe"===i.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&r.push("ALPHA_PASS");const d=t.getOrCreateProgram("globeAtmosphere",{defines:r}),f=((e,t,r,o,n,i,a,s,l,c,u,d)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:r,u_frustum_bl:o,u_horizon:n,u_transition:i,u_fadeout_range:a,u_color:s,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:d}))(i.frustumCorners.TL,i.frustumCorners.TR,i.frustumCorners.BR,i.frustumCorners.BL,i.frustumCorners.horizon,s,h,l,c,u,m,_);t.uploadCommonUniforms(o,d);const p=this.atmosphereBuffer;p&&d.draw(t,n.TRIANGLES,a,Pt.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ot.backCW,f,e?"atmosphere_glow_alpha":"atmosphere_glow",p.vertexBuffer,p.indexBuffer,p.segments)};y(!1),y(!0)}drawStars(t,r){const o=e.ad(r.properties.get("star-intensity"),0,1);if(0===o)return;const n=t.context,i=n.gl,a=t.transform,s=t.getOrCreateProgram("stars"),l=e.bl.identity([]);e.bl.rotateX(l,l,-a._pitch),e.bl.rotateZ(l,l,-a.angle),e.bl.rotateX(l,l,e.bm(a._center.lat)),e.bl.rotateY(l,l,-e.bm(a._center.lng));const c=e.a9.fromQuat(new Float32Array(16),l),u=e.a9.multiply([],a.starsProjMatrix,c),d=e.ct.fromMat4([],c),h=e.ct.invert([],d),f=[0,1,0];e.Q.transformMat3(f,f,h),e.Q.scale(f,f,this.params.sizeMultiplier);const m=[1,0,0];e.Q.transformMat3(m,m,h),e.Q.scale(m,m,this.params.sizeMultiplier);const p=(g=f,_=m,y=o,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(n,s),this.starsVx&&this.starsIdx&&s.draw(t,i.TRIANGLES,Et.disabled,Pt.disabled,this.colorModeAlphaBlendedWriteRGB,Ot.disabled,p,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Bi(t,r){const o=[...t],n=r.cameraWorldSizeForFog/r.worldSize,i=e.a9.identity([]);return e.a9.scale(i,i,[n,n,1]),e.a9.multiply(o,i,o),e.a9.multiply(o,r.worldToFogMatrix,o),o}function Fi(e,t,r,o){const n=r.material,i=o.context,{baseColorTexture:a,metallicRoughnessTexture:s}=n.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=n;function d(t,r,o){if(t&&(e.push(r),i.activeTexture.set(i.gl.TEXTURE0+o),t.gfxTexture)){const{minFilter:e,magFilter:r,wrapS:o,wrapT:n}=t.sampler;t.gfxTexture.bindExtraParam(e,r,o,n)}}d(a,"HAS_TEXTURE_u_baseColorTexture",po.BaseColor),d(s,"HAS_TEXTURE_u_metallicRoughnessTexture",po.MetallicRoughness),d(l,"HAS_TEXTURE_u_normalTexture",po.Normal),d(c,"HAS_TEXTURE_u_occlusionTexture",po.Occlusion),d(u,"HAS_TEXTURE_u_emissionTexture",po.Emission),r.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(e.push(12===r.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function zi(t,r,o,n,i,a){const s=o.paint.get("model-opacity"),l=r.context,c=new Et(r.context.gl.LEQUAL,Et.ReadWrite,r.depthRangeFor3D),u=r.transform,d=t.mesh,h=d.material,f=h.pbrMetallicRoughness,m=r.style.fog;let p;p="pixels"===r.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.a9.multiply([],n.zScaleMatrix,t.nodeModelMatrix),e.a9.multiply(p,n.negCameraPosMatrix,p);const g=e.a9.invert([],p);e.a9.transpose(g,g);const _=o.paint.get("model-emissive-strength").constantOr(0),y=Jn(new Float32Array(t.worldViewProjection),new Float32Array(p),new Float32Array(g),null,r,s,f.baseColorFactor,h.emissiveFactor,f.metallicFactor,f.roughnessFactor,h,_,o),v={defines:[]},x=[];Fi(v.defines,x,d,r);const b=r.shadowRenderer;b&&(b.useNormalOffset=!1);let L=null;if(m){const e=Bi(t.nodeModelMatrix,r.transform);if(L=new Float32Array(e),"globe"!==u.projection.name){const t=d.aabb.min,r=d.aabb.max,[o,n]=m.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);v.overrideFog=o>=fe||n>=fe}}const A=go(r,o.paint.get("model-cutoff-fade-range"));A.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const w=r.getOrCreateProgram("model",v);r.uploadCommonUniforms(l,w,null,L,A),"shadow"!==r.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,w),w.draw(r,l.gl.TRIANGLES,c,i,a,d.material.doubleSided?Ot.disabled:Ot.backCCW,y,o.id,d.vertexBuffer,d.indexBuffer,d.segments,o.paint,r.transform.zoom,void 0,x)}function Ui(t,r,o,n,i,a,s){let l;l="globe"===t.projection.name?e.c_(o,t):[...o],e.a9.multiply(l,l,r.matrix);const c=e.a9.multiply([],n,l);if(r.meshes)for(const u of r.meshes){if("BLEND"!==u.material.alphaMode){s.push({mesh:u,depth:0,modelIndex:i,worldViewProjection:c,nodeModelMatrix:l});continue}const t=e.Q.transformMat4([],u.centroid,c);t[2]>0&&a.push({mesh:u,depth:t[2],modelIndex:i,worldViewProjection:c,nodeModelMatrix:l})}if(r.children)for(const e of r.children)Ui(t,e,o,n,i,a,s)}function Vi(e,t,r,o){const n=r.shadowRenderer;if(!n)return;const i=n.getShadowPassDepthMode(),a=n.getShadowPassColorMode(),s=n.calculateShadowPassMatrixFromMatrix(t),l=Zn(s);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,i,Pt.disabled,a,Ot.backCCW,l,o.id,e.vertexBuffer,e.indexBuffer,e.segments,o.paint,r.transform.zoom,void 0,void 0)}function Hi(t,r,o){const n=r.updateZoomBasedPaintProperties(),i=function(t,r,o){let n,i,a,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const r=t.terrain,i=r.findDEMTileFor(o);i&&i.dem?n=e.d0.create(r,o,i):s=0}if(0===s&&(r.terrainElevationMin=0,r.terrainElevationMax=0),s===r.validForExaggeration&&(0===s||n&&n._demTile&&n._demTile.tileID===r.validForDEMTile.id&&n._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(const e in r.instancesPerModel){const t=r.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const o=(n?s*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=o,i=i?Math.min(r.terrainElevationMin,o):o,a=a?Math.max(r.terrainElevationMax,o):o}}return r.terrainElevationMin=i||0,r.terrainElevationMax=a||0,r.validForExaggeration=s,r.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,r,o);(n||i)&&(r.uploaded=!1,r.upload(t.context))}const Gi={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.bV([0,0,0],[e.Y,e.Y,0])};function ji(t,r){const o=1<<t.canonical.z,n=r.getFreeCameraOptions().position,i=r.elevation,a=t.canonical.x/o,s=(t.canonical.x+1)/o,l=t.canonical.y/o,c=(t.canonical.y+1)/o;let u=r._centerAltitude;if(i){const e=i.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const d=e.ad(n.x,a,s)-n.x,h=e.ad(n.y,l,c)-n.y,f=e.bo(u,r.center.lat)-n.z;return r._zoomFromMercatorZ(Math.sqrt(d*d+h*h+f*f))}function Wi(e,t,r,o,n,i,a){const s=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Et(s.gl.LEQUAL,Et.ReadWrite,e.depthRangeFor3D),d=e.isTileAffectedByFog(i);if(r.meshes)for(const h of r.meshes){const f=["MODEL_POSITION_ON_GPU"],m=[];let p,g,_;o.instancedDataArray.length>20&&f.push("INSTANCED_ARRAYS");const y=go(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&c)p=e.getOrCreateProgram("modelDepth",{defines:f}),g=Zn(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(r.matrix)),_=c.getShadowPassColorMode();else{Fi(f,m,h,e),p=e.getOrCreateProgram("model",{defines:f,overrideFog:d});const o=h.material,l=o.pbrMetallicRoughness,u=t.paint.get("model-opacity"),v=t.paint.get("model-emissive-strength").constantOr(0);g=Jn(i.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,e,u,l.baseColorFactor,o.emissiveFactor,l.metallicFactor,l.roughnessFactor,o,v,t,n),c&&(a.shadowUniformsInitialized?p.setShadowUniformValues(s,c.getShadowUniformValues()):(c.setupShadows(i.toUnwrapped(),p,"model-tile",i.overscaledZ),a.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==o.alphaMode?Rt.alphaBlended:Rt.unblended}e.uploadCommonUniforms(s,p,i.toUnwrapped(),null,y);const v=h.material.doubleSided?Ot.disabled:Ot.backCCW;if(o.instancedDataArray.length>20)m.push(o.instancedDataBuffer),p.draw(e,s.gl.TRIANGLES,u,Pt.disabled,_,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,m,o.instancedDataArray.length);else{const r=l?"u_instance":"u_normal_matrix";for(let n=0;n<o.instancedDataArray.length;++n)g[r]=new Float32Array(o.instancedDataArray.arrayBuffer,64*n,16),p.draw(e,s.gl.TRIANGLES,u,Pt.disabled,_,v,g,t.id,h.vertexBuffer,h.indexBuffer,h.segments,t.paint,e.transform.zoom,void 0,m)}}if(r.children)for(const h of r.children)Wi(e,t,h,o,n,i,a)}const Ki=[1,-1,1];function Ji(t,r,o,n){if(!o.modelManager)return!0;const i=o.modelManager;if(!o.shadowRenderer)return!0;const a=o.shadowRenderer,s=r.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const r in t.instancesPerModel){const t=i.getModel(r,n);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}s.max[2]=c,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,e.Q.transformMat4(s.min,s.min,r.tileMatrix),e.Q.transformMat4(s.max,s.max,r.tileMatrix);const u=s.intersects(a.getCurrentCascadeFrustum());return 0===o.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}class Zi{}class Yi{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,o){{const e=this._storage.get(r.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const n=o.gl,i=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),a=new ArrayBuffer(i),s=new Int16Array(a);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const l=new e.d2;for(let e=0;e<i/2;e+=3){const t=s[e],r=s[e+1],o=s[e+2];l.emplaceBack(t,r),l.emplaceBack(r,o),l.emplaceBack(o,t)}const c=o.bindVertexArrayOES.current,u=new Zi;return u.buf=new ze(o,l),u.lastUsedFrameIdx=t,this._storage.set(r.id,u),o.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const qi={symbol:function(t,r,o,n,i){if("translucent"!==t.renderPass)return;const a=Pt.disabled,s=t.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(t,r,o,n,i,a,s){const l=r.transform,c="map"===i,u="map"===a;for(const d of t){const t=n.getTile(d),r=t.getBucket(o);if(!r||!r.text||!r.text.segments.get().length)continue;const i=e.b8(r.textSizeData,l.zoom),a=Ir(d,r.getProjection(),l),h=l.calculatePixelsToTileUnitsMatrix(t),f=fr(a,t.tileID.canonical,u,c,l,r.getProjection(),h),m=r.hasIconTextFit()&&r.hasIconData();if(i){const o=Math.pow(2,l.zoom-t.tileID.overscaledZ);ti(r,c,u,s,e.cE,l,f,d,o,i,m)}}}(n,t,o,r,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),i);const l=0!==o.paint.get("icon-opacity").constantOr(1),c=0!==o.paint.get("text-opacity").constantOr(1);void 0!==o.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?ri(t,r,o,n,a,s):(l&&ri(t,r,o,n,a,s,{onlyIcons:!0}),c&&ri(t,r,o,n,a,s,{onlyText:!0})),r.map.showCollisionBoxes&&($n(t,r,o,n,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),$n(t,r,o,n,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(t,r,o,n){if("translucent"!==t.renderPass)return;const i=o.paint.get("circle-opacity"),a=o.paint.get("circle-stroke-width"),s=o.paint.get("circle-stroke-opacity"),l=void 0!==o.layout.get("circle-sort-key").constantOr(1),c=o.paint.get("circle-emissive-strength");if(0===i.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const u=t.context,d=u.gl,h=t.transform,f=t.depthModeForSublayer(0,Et.ReadOnly),m=Pt.disabled,p=t.colorModeForDrapableLayerRenderPass(c),g="globe"===h.projection.name,_=[e.a8(h.center.lng),e.ah(h.center.lat)],y=[];for(let x=0;x<n.length;x++){const i=n[x],a=r.getTile(i),s=a.getBucket(o);if(!s||s.projection.name!==h.projection.name)continue;const c=s.programConfigurations.get(o.id),u=e.cF(o),d=t.isTileAffectedByFog(i);g&&u.push("PROJECTION_GLOBE_VIEW");const f=t.getOrCreateProgram("circle",{config:c,defines:u,overrideFog:d}),m=s.layoutVertexBuffer,p=s.globeExtVertexBuffer,v=s.indexBuffer,b=h.projection.createInversionMatrix(h,i.canonical),L={programConfiguration:c,program:f,layoutVertexBuffer:m,globeExtVertexBuffer:p,indexBuffer:v,uniformValues:e.cG(t,i,a,b,_,o),tile:a};if(l){const t=s.segments.get();for(const r of t)y.push({segments:new e.aE([r]),sortKey:r.sortKey,state:L})}else y.push({segments:s.segments,sortKey:0,state:L})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const v={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const e of y){const{programConfiguration:r,program:n,layoutVertexBuffer:i,globeExtVertexBuffer:a,indexBuffer:s,uniformValues:l,tile:c}=e.state,g=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,n,v),t.uploadCommonUniforms(u,n,c.tileID.toUnwrapped()),n.draw(t,d.TRIANGLES,f,m,p,Ot.disabled,l,o.id,i,s,g,o.paint,h.zoom,r,[a])}},heatmap:function(t,r,o,n){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const i=t.context,a=i.gl,s=Pt.disabled,l=new Rt([a.ONE,a.ONE,a.ONE,a.ONE],e.aA.transparent,[!0,!0,!0,!0]);!function(e,t,r,o){const n=e.gl,i=t.width*o,a=t.height*o;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,i,a]);let s=r.heatmapFbo;if(!s||s&&(s.width!==i||s.height!==a)){s&&s.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),s=r.heatmapFbo=e.createFramebuffer(i,a,!0,null),function(e,t,r,o,n,i){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,n,i,0,a.RGBA,e.extRenderToTextureHalfFloat?a.HALF_FLOAT:a.UNSIGNED_BYTE,null),o.colorAttachment.set(r)}(e,0,t,s,i,a)}else n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(i,t,o,"globe"===t.transform.projection.name?.5:.25),i.clear({color:e.aA.transparent});const c=t.transform,u="globe"===c.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[],h=u?Ot.frontCCW:Ot.disabled,f=[e.a8(c.center.lng),e.ah(c.center.lat)];for(let e=0;e<n.length;e++){const m=n[e];if(r.hasRenderableParent(m))continue;const p=r.getTile(m),g=p.getBucket(o);if(!g||g.projection.name!==c.projection.name)continue;const _=t.isTileAffectedByFog(m),y=g.programConfigurations.get(o.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:d,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(p,v),t.uploadCommonUniforms(i,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(t,a.TRIANGLES,Et.disabled,s,l,h,In(t,m,p,b,f,x,o.paint.get("heatmap-intensity")),o.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,o.paint,t.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}i.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){const o=t.context,n=o.gl,i=r.heatmapFbo;if(!i)return;o.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),o.activeTexture.set(n.TEXTURE1);let a=r.colorRampTexture;a||(a=r.colorRampTexture=new e.T(o,r.colorRamp,n.RGBA)),a.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,n.TRIANGLES,Et.disabled,Pt.disabled,t.colorModeForRenderPass(),Ot.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,r),r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}(t,o))},line:function(t,r,o,n){if("translucent"!==t.renderPass)return;const i=o.paint.get("line-opacity"),a=o.paint.get("line-width");if(0===i.constantOr(1)||0===a.constantOr(1))return;const s=o.paint.get("line-emissive-strength"),l=t.depthModeForSublayer(0,Et.ReadOnly),c=t.colorModeForDrapableLayerRenderPass(s),u=t.terrain&&t.terrain.renderingToTexture?1:e.f.devicePixelRatio,d=o.paint.get("line-dasharray"),h=d.constantOr(1),f=o.layout.get("line-cap"),m=o.paint.get("line-pattern"),p=m.constantOr(1),g=1!==o.paint.get("line-opacity").constantOr(1);let _=!p&&g;const y=o.paint.get("line-gradient"),v=p?"linePattern":"line",x=t.context,b=x.gl,L=e.cH(o);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(_=!1);for(const A of n){const n=r.getTile(A);if(p&&!n.patternsLoaded())continue;const i=n.getBucket(o);if(!i)continue;t.prepareDrawTile();const a=i.programConfigurations.get(o.id),s=t.isTileAffectedByFog(A),g=t.getOrCreateProgram(v,{config:a,defines:L,overrideFog:s}),w=m.constantOr(null);if(w&&n.imageAtlas){const e=n.imageAtlas.patternPositions[w.toString()];e&&a.setConstantPatternPositions(e)}const S=d.constantOr(null),E=f.constantOr(null);if(!p&&S&&E&&n.lineAtlas){const e=n.lineAtlas.getDash(S,E);e&&a.setConstantPatternPositions(e)}let[T,P]=o.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;T!==P&&(0===T&&(T-=e),1===P&&(P+=e))}const C=t.terrain?A.projMatrix:null,R=p?e.cI(t,n,o,C,u,[T,P]):e.cJ(t,n,o,C,i.lineClipsArray.length,u,[T,P]);if(y){const n=i.gradients[o.id];let a=n.texture;if(o.gradientVersion!==n.version){let s=256;if(o.stepInterpolant){const o=r.getSource().maxzoom,n=A.canonical.z===o?Math.ceil(1<<t.transform.maxZoom-A.canonical.z):1;s=e.ad(e.cK(i.maxLineLength/e.Y*1024*n),256,x.maxTextureSize)}n.gradient=e.cL({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:n.gradient||void 0,clips:i.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.T(x,n.gradient,b.RGBA),n.version=o.gradientVersion,a=n.texture}x.activeTexture.set(b.TEXTURE1),a.bind(o.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}h&&(x.activeTexture.set(b.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),a.updatePaintBuffers()),p&&(x.activeTexture.set(b.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),a.updatePaintBuffers()),t.uploadCommonUniforms(x,g,A.toUnwrapped());const M=e=>{g.draw(t,b.TRIANGLES,l,e,c,Ot.disabled,R,o.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,o.paint,t.transform.zoom,a,[i.layoutVertexBuffer2,i.patternVertexBuffer])};if(_){const e=t.stencilModeForClipping(A).ref;0===e&&t.terrain&&x.clear({stencil:0});const r={func:b.EQUAL,mask:255};R.u_alpha_discard_threshold=.8,M(new Pt(r,e,255,b.KEEP,b.KEEP,b.INVERT)),R.u_alpha_discard_threshold=0,M(new Pt(r,e,255,b.KEEP,b.KEEP,b.KEEP))}else M(t.stencilModeForClipping(A))}_&&(t.resetStencilClippingMasks(),t.terrain&&x.clear({stencil:0}))},fill:function(t,r,o,n){const i=o.paint.get("fill-color"),a=o.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=o.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(s),c=o.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===i.constantOr(e.aA.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Et.ReadWrite:Et.ReadOnly);ni(t,r,o,n,e,l,!1)}if("translucent"===t.renderPass&&o.paint.get("fill-antialias")){const e=t.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);ni(t,r,o,n,e,l,!0)}},"fill-extrusion":function(t,r,o,n){const i=o.paint.get("fill-extrusion-opacity"),a=t.context,s=a.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===i)return;const u=t.conflationActive&&t.layerUsedInConflation(o,r.getSource());if(u&&function(e,t,r,o){for(const n of o){const o=t.getTile(n).getBucket(r);o&&(o.updateReplacement(n,e.replacementSource),o.uploadCentroid(e.context))}}(t,r,o,n),l||u)for(const e of n){const n=r.getTile(e).getBucket(o);n&&si(t.context,r,e,n,o,l,u)}if("shadow"===t.renderPass&&t.shadowRenderer){const a=t.shadowRenderer;if(l&&i<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.Z)return;const s=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode();ii(t,r,o,n,s,Pt.disabled,c,u)}else if("translucent"===t.renderPass){const d=!o.paint.get("fill-extrusion-pattern").constantOr(1),h=o.paint.get("fill-extrusion-color").constantOr(e.aA.white);if(!c&&0!==h.a){const e=new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);1===i&&d?ii(t,r,o,n,e,Pt.disabled,Rt.unblended,u):(ii(t,r,o,n,e,Pt.disabled,Rt.disabled,u),ii(t,r,o,n,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),u),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&d&&(!l&&"globe"!==t.transform.projection.name||c)){const i=o.paint.get("fill-extrusion-opacity"),d=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),h=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=o.paint.get("fill-extrusion-flood-light-intensity"),m=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),p=d>0&&h>0,g=f>0,_=(e,t,r)=>(1-r)*e+r*t,y=a=>{const l=t.depthModeForSublayer(1,Et.ReadOnly,s.LEQUAL,!0),c=o.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=_(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new Pt({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new Rt([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0],s.MIN);ai(t,r,o,n,l,c,g,Ot.disabled,a,"sdf",i,d,h,f,m,p,u,!1)}{const c=g?Pt.disabled:new Pt({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=g?t.colorModeForRenderPass():new Rt([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],e.aA.transparent,[!0,!0,!0,!0]);ai(t,r,o,n,l,c,_,Ot.disabled,a,"color",i,d,h,f,m,p,u,!1)}};if(c){const c=(a,l,c)=>{const p=t.depthModeForSublayer(1,Et.ReadOnly,s.LEQUAL,!1),g=o.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new Rt([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0]);ai(t,r,o,n,p,Pt.disabled,c,Ot.disabled,a,"clear",i,d,h,f,m,y,u,l)}{const c=new Pt({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new Rt([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0],s.MIN);ai(t,r,o,n,p,c,g,Ot.disabled,a,"sdf",i,d,h,f,m,y,u,l)}{const c=a?s.ZERO:s.ONE_MINUS_DST_ALPHA,g=new Pt({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=new Rt([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],e.aA.transparent,[!0,!0,!0,!0]);ai(t,r,o,n,p,g,_,Ot.disabled,a,"color",i,d,h,f,m,y,u,l)}{const g=new Rt([s.ONE,s.ONE,s.ONE,a?s.ZERO:s.ONE],e.aA.transparent,[!1,!1,!1,!0],a?s.FUNC_ADD:s.MAX);ai(t,r,o,n,p,Pt.disabled,g,Ot.disabled,a,"clear",i,d,h,f,m,y,u,l,c)}};if(p||g){let r;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],o=l.drapeBufferSize[1];r=l.framebufferCopyTexture,r&&(!r||r.size[0]===t&&r.size[1]===o)||(r&&r.destroy(),r=l.framebufferCopyTexture=new e.T(a,new e.h({width:t,height:o}),s.RGBA)),r.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,t,o,0)}p&&c(!0,!1,r),g&&c(!1,!0,r)}}else p&&y(!0),g&&y(!1)}}},hillshade:function(e,t,r,o){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const n=e.context,i=e.terrain&&e.terrain.renderingToTexture,[a,s]="translucent"!==e.renderPass||i?[{},o]:e.stencilConfigForOverlap(o);for(const l of s){const o=t.getTile(l);if(o.needsHillshadePrepare&&"offscreen"===e.renderPass)en(e,o,r);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Et.ReadOnly),n=r.paint.get("hillshade-emissive-strength"),s=e.colorModeForDrapableLayerRenderPass(n),c=i&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):a[l.overscaledZ];Xo(e,l,o,r,t,c,s)}}n.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,r,o,n,i,a){if("translucent"!==t.renderPass)return;if(0===o.paint.get("raster-opacity"))return;const s="globe"===t.transform.projection.name,l=0!==o.paint.get("raster-elevation"),c=l&&s;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,d=u.gl,h=r.getSource(),f=function(t,r,o,n){const i=r.paint.get("raster-color"),a="raster-array"===t.type,s=[],l=r.paint.get("raster-resampling"),c=r.paint.get("raster-color-mix");let u=r.paint.get("raster-color-range");const d=[c[0],c[1],c[2],0],h=c[3];let f="nearest"===l?n.NEAREST:n.LINEAR;if(a&&(s.push("RASTER_ARRAY"),i||s.push("RASTER_COLOR"),"linear"===l&&s.push("RASTER_ARRAY_LINEAR"),f=n.NEAREST,!u&&t.rasterLayers)){const e=t.rasterLayers.find((e=>{let{id:t}=e;return t===r.sourceLayer}));e&&e.fields&&e.fields.range&&(u=e.fields.range)}if(u=u||[0,1],i){s.push("RASTER_COLOR"),o.activeTexture.set(n.TEXTURE2),r.updateColorRamp(u);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(o,r.colorRamp,n.RGBA)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:d,range:u,offset:h,defines:s,resampling:f}}(h,o,u,d);if(h instanceof e.as&&!n.length&&!s)return;const m=o.paint.get("raster-emissive-strength"),p=t.colorModeForDrapableLayerRenderPass(m),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===o.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(h instanceof e.as&&!n.length&&(h.onNorthPole||h.onSouthPole)){const e=l?t.stencilModeFor3D():Pt.disabled;return void fi(!!h.onNorthPole,null,t,r,o,m,f,Ot.disabled,e)}if(!n.length)return;const[v,x]=h instanceof e.as||g?[{},n]:t.stencilConfigForOverlap(n),b=x[x.length-1].overscaledZ;c&&f.defines.push("PROJECTION_GLOBE_VIEW"),l&&f.defines.push("RENDER_CUTOFF");const L=(n,i,x)=>{for(const L of n){const n=L.toUnwrapped(),A=r.getTile(L);if(g&&(!A||!A.hasData()))continue;u.activeTexture.set(d.TEXTURE0);const w=pi(A,h,o,f);if(!w||!w.texture)continue;const{texture:S,mix:E,offset:T,tileSize:P,buffer:C}=w;let R,M;g?(R=Et.disabled,M=L.projMatrix):l?(R=new Et(d.LEQUAL,Et.ReadWrite,t.depthRangeFor3D),M=s?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,_)):(R=t.depthModeForSublayer(L.overscaledZ-b,1===o.paint.get("raster-opacity")?Et.ReadWrite:Et.ReadOnly,d.LESS),M=t.transform.calculateProjMatrix(n,_));const I=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(L):v[L.overscaledZ],O=a?0:o.paint.get("raster-fade-duration");A.registerFadeDuration(O);const D=r.findLoadedParent(L,0),k=dn(A,D,r,t.transform,O);let N,B;t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),S.bind(y,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),D?(D.texture&&D.texture.bind(y,d.CLAMP_TO_EDGE),N=Math.pow(2,D.tileID.overscaledZ-A.tileID.overscaledZ),B=[A.tileID.canonical.x*N%1,A.tileID.canonical.y*N%1]):S.bind(y,d.CLAMP_TO_EDGE),S.useMipmap&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const F=t.transform;let z;const U=l?mi(F):[0,0,0,0];let V,H,G,j,W,K=0;if(c&&h instanceof e.as&&h.coordinates.length>3)V=Float32Array.from(e.aW(e.cn(new e.bv(0,0,0)))),H=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.cj(F)),j=[e.a8(F.center.lng),e.ah(F.center.lat)],z=h.elevatedGlobePerspectiveTransform,W=h.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.ck(L.canonical);K=e.cl(t.getCenter().lat),V=Float32Array.from(e.aW(e.cn(L.canonical))),H=Float32Array.from(F.globeMatrix),G=Float32Array.from(e.cj(F)),j=[e.a8(F.center.lng),e.ah(F.center.lat)],z=[0,0],W=Float32Array.from(e.cm(L.canonical,t,K,F.worldSize/F._pixelsPerMercatorPixel))}else z=h instanceof e.as?h.perspectiveTransform:[0,0],V=new Float32Array(16),H=new Float32Array(9),G=new Float32Array(16),j=[0,0],W=new Float32Array(9);const J=kn(M,V,H,G,W,B||[0,0],e.W(t.transform.zoom),j,U,N||1,k,o,z,l?o.paint.get("raster-elevation"):0,2,E,T,f.range,P,C,m),Z=t.isTileAffectedByFog(L),Y=t.getOrCreateProgram("raster",{defines:f.defines,overrideFog:Z});if(t.uploadCommonUniforms(u,Y,n),h instanceof e.as){const r=h.elevatedGlobeVertexBuffer,n=h.elevatedGlobeIndexBuffer;if(g||!s)h.boundsBuffer&&h.boundsSegments&&Y.draw(t,d.TRIANGLES,R,Pt.disabled,p,Ot.disabled,J,o.id,h.boundsBuffer,t.quadTriangleIndexBuffer,h.boundsSegments);else if(r&&n){const a=F.zoom<=e.bJ?h.elevatedGlobeSegments:h.getSegmentsForLongitude(F.center.lng);a&&Y.draw(t,d.TRIANGLES,R,Pt.disabled,p,i,J,o.id,r,n,a)}}else if(c){R=new Et(d.LEQUAL,Et.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[r,n,a]=e.getGridBuffers(K,!1);Y.draw(t,d.TRIANGLES,R,x||I,t.colorModeForRenderPass(),i,J,o.id,r,n,a)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:n}=t.getTileBoundsBuffers(A);Y.draw(t,d.TRIANGLES,R,I,p,Ot.disabled,J,o.id,e,r,n)}}if(!(h instanceof e.as)&&c)for(const e of n){const n=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&fi(!0,e,t,r,o,m,f,i,x||Pt.disabled),n&&fi(!1,e,t,r,o,m,f,i===Ot.frontCW?Ot.backCW:Ot.frontCW,x||Pt.disabled)}};c?L(x,t.renderElevatedRasterBackface?Ot.backCW:Ot.frontCW,t.stencilModeFor3D()):L(x,Ot.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,r,o,n,i,a){"offscreen"===t.renderPass&&function(t,r,o,n){if(!n.length)return;const i=t.context,a=i.gl,s=r.getSource();if(!(s instanceof Me))return;const l=Math.ceil(Math.sqrt(o.paint.get("raster-particle-count")));let c=o.particleFramebuffer;c?c.width!==l&&(c.destroy(),c=o.particleFramebuffer=i.createFramebuffer(l,l,!0,null)):c=o.particleFramebuffer=i.createFramebuffer(l,l,!0,null);const u=[];for(const e of n){const t=r.getTile(e);if(!(t instanceof Kt))continue;const n=gi(t,s,o);if(!n)continue;const a=[t.tileSize,t.tileSize];let c=o.tileFramebuffer;c||(c=o.tileFramebuffer=i.createFramebuffer(a[0],a[1],!0,null));let d=t.rasterParticleState;d||(d=t.rasterParticleState=new Bt(i,e,a,l));const h=d.update(o.lastInvalidatedAt);d.particleTextureDimension!==l&&d.setParticleTextureDimension(e,l);const f=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=f;const m=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=m,u.push([e,n,d,h])}if(0===u.length)return;const d=e.f.now(),h=o.previousDrawTimestamp?.001*(d-o.previousDrawTimestamp):.0167;if(o.previousDrawTimestamp=d,o.hasColorMap()){i.activeTexture.set(a.TEXTURE0+2);let t=o.colorRampTexture;t||(t=o.colorRampTexture=new e.T(i,o.colorRamp,a.RGBA)),t.bind(a.LINEAR,a.CLAMP_TO_EDGE)}i.bindFramebuffer.set(o.tileFramebuffer.framebuffer),function(t,r,o){const n=t.context,i=n.gl,a=r.tileFramebuffer;n.activeTexture.set(i.TEXTURE0);const s={u_texture:0,u_opacity:1.05*(c=r.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of o){const[,,o,c]=u;a.colorAttachment.set(o.targetColorTexture.texture),n.viewport.set([0,0,a.width,a.height]),n.clear({color:e.aA.transparent}),c&&(o.backgroundColorTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),l.draw(t,i.TRIANGLES,Et.disabled,Pt.disabled,Rt.alphaBlended,Ot.disabled,s,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,o,u),function(t,r,o,n){const i=t.context,a=i.gl,s=o.tileFramebuffer,l="globe"===t.transform.projection.name,c=o.paint.get("raster-particle-max-speed");for(const u of n){const[n,d,h]=u;i.activeTexture.set(a.TEXTURE0+0),d.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.colorAttachment.set(h.targetColorTexture.texture);const f=t.getOrCreateProgram("rasterParticleDraw",{defines:d.defines,overrideFog:!1});i.activeTexture.set(a.TEXTURE0+1);const m=d.scalarData?[]:[0,1,2,3].map((t=>e.cN[t](n)));m.push(n);const p=n.canonical.x,g=n.canonical.y;for(const e of m){const i=r.getTile(l?e.wrapped():e);if(!i)continue;const s=i.rasterParticleState;if(!s)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-n.wrap),h=e.canonical.y;s.particleTexture0.bind(a.NEAREST,a.CLAMP_TO_EDGE);const m=Fn(1,s.particleTexture0.size[0],[u-p,h-g],0,d.texture.size,2,c,d.textureOffset,d.scale,d.offset);f.draw(t,a.POINTS,Et.disabled,Pt.disabled,Rt.alphaBlended,Ot.disabled,m,o.id,s.particleIndexBuffer,void 0,s.particleSegment)}}}(t,r,o,u),i.bindFramebuffer.set(o.particleFramebuffer.framebuffer),function(t,r,o,n){const i=t.context,a=i.gl,s=r.paint.get("raster-particle-max-speed"),l=n*r.paint.get("raster-particle-speed-factor")*.3,c=function(e){return Math.pow(e,6)}(.01+1*r.paint.get("raster-particle-reset-rate-factor")),u=r.particleFramebuffer;i.viewport.set([0,0,u.width,u.height]);for(const d of o){const[,o,n]=d;i.activeTexture.set(a.TEXTURE0+0),o.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),i.activeTexture.set(a.TEXTURE0+1);const h=n.particleTexture0;h.bind(a.NEAREST,a.CLAMP_TO_EDGE);const f=zn(1,h.size[0],0,o.texture.size,s,l,c,o.textureOffset,o.scale,o.offset);u.colorAttachment.set(n.particleTexture1.texture),i.clear({color:e.aA.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:o.defines}).draw(t,a.TRIANGLES,Et.disabled,Pt.disabled,Rt.unblended,Ot.disabled,f,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,o,u,h)}(t,r,o,n),"translucent"===t.renderPass&&(function(t,r,o,n){const i=t.context,a=i.gl,s=!t.options.moving,l="globe"===t.transform.projection.name;if(!n.length)return;const[c,u]=t.stencilConfigForOverlap(n),d=[];l&&d.push("PROJECTION_GLOBE_VIEW");const h=t.stencilModeFor3D();for(const f of u){const n=f.toUnwrapped(),u=r.getTile(f);if(!u.rasterParticleState)continue;const m=u.rasterParticleState,p=100;u.registerFadeDuration(p);const g=r.findLoadedParent(f,0),_=dn(u,g,r,t.transform,p);let y,v;t.terrain&&t.terrain.prepareDrawTile(),i.activeTexture.set(a.TEXTURE0),m.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),i.activeTexture.set(a.TEXTURE1),g&&g.rasterParticleState?(g.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y=Math.pow(2,g.tileID.overscaledZ-u.tileID.overscaledZ),v=[u.tileID.canonical.x*y%1,u.tileID.canonical.y*y%1]):m.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const x=l?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,s),b=t.transform,L=_i(b),A=e.ck(f.canonical),w=e.cl(A.getCenter().lat);let S,E,T,P,C;l?(S=Float32Array.from(e.aW(e.cn(f.canonical))),E=Float32Array.from(b.globeMatrix),T=Float32Array.from(e.cj(b)),P=[e.a8(b.center.lng),e.ah(b.center.lat)],C=Float32Array.from(e.cm(f.canonical,A,w,b.worldSize/b._pixelsPerMercatorPixel))):(S=new Float32Array(16),E=new Float32Array(9),T=new Float32Array(16),P=[0,0],C=new Float32Array(9));const R=Bn(x,S,E,T,C,v||[0,0],e.W(t.transform.zoom),P,L,y||1,_,250),M=t.isTileAffectedByFog(f),I=t.getOrCreateProgram("rasterParticle",{defines:d,overrideFog:M});if(t.uploadCommonUniforms(i,I,n),l){const e=new Et(a.LEQUAL,Et.ReadWrite,t.depthRangeFor3D),r=0,n=t.globeSharedBuffers;if(n){const[i,s,l]=n.getGridBuffers(w,0!==r);I.draw(t,a.TRIANGLES,e,h,Rt.alphaBlended,Ot.backCCW,R,o.id,i,s,l)}}else{const e=t.depthModeForSublayer(0,Et.ReadOnly),r=c[f.overscaledZ],{tileBoundsBuffer:n,tileBoundsIndexBuffer:i,tileBoundsSegments:s}=t.getTileBoundsBuffers(u);I.draw(t,a.TRIANGLES,e,r,Rt.alphaBlended,Ot.disabled,R,o.id,n,i,s)}}t.resetStencilClippingMasks()}(t,r,o,n),t.style.map.triggerRepaint())},background:function(e,t,r,o){const n=r.paint.get("background-color"),i=r.paint.get("background-opacity"),a=r.paint.get("background-emissive-strength");if(0===i)return;const s=e.context,l=s.gl,c=e.transform,u=c.tileSize,d=r.paint.get("background-pattern");if(e.isPatternMissing(d,r.scope))return;const h=!d&&1===n.a&&1===i&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==h)return;const f=Pt.disabled,m=e.depthModeForSublayer(0,"opaque"===h?Et.ReadWrite:Et.ReadOnly),p=e.colorModeForDrapableLayerRenderPass(a),g=d?"backgroundPattern":"background";let _,y=o;y||(_=e.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),d&&(s.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,r.scope));for(const v of y){const h=e.isTileAffectedByFog(v),y=e.getOrCreateProgram(g,{overrideFog:h}),x=v.toUnwrapped(),b=o?v.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const L=t?t.getTile(v):_?_[v.key]:new zt(v,u,c.zoom,e),A=d?Wn(b,a,i,e,d,r.scope,{tileID:v,tileSize:u}):jn(b,a,i,n);e.uploadCommonUniforms(s,y,x);const{tileBoundsBuffer:w,tileBoundsIndexBuffer:S,tileBoundsSegments:E}=e.getTileBoundsBuffers(L);y.draw(e,l.TRIANGLES,m,f,p,Ot.disabled,A,r.id,w,S,E)}},sky:function(t,r,o){const n=t._atmosphere?e.W(t.transform.zoom):1,i=o.paint.get("sky-opacity")*n;if(0===i)return;const a=t.context,s=o.paint.get("sky-type"),l=new Et(a.gl.LEQUAL,Et.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?o.needsSkyboxCapture(t)&&(function(t,r){const o=t.context,n=o.gl;let i=r.skyboxFbo;if(!i){i=r.skyboxFbo=o.createFramebuffer(32,32,!0,null),r.skyboxGeometry=new Ri(o),r.skyboxTexture=o.gl.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,r.skyboxTexture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);for(let e=0;e<6;++e)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,n.RGBA,32,32,0,n.RGBA,n.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(i.framebuffer),o.viewport.set([0,0,32,32]);const a=r.getCenter(t,!0),s=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.a9.identity(l),e.a9.rotateY(l,l,.5*-Math.PI),Mi(t,r,s,l,a,0),e.a9.identity(l),e.a9.rotateY(l,l,.5*Math.PI),Mi(t,r,s,l,a,1),e.a9.identity(l),e.a9.rotateX(l,l,.5*-Math.PI),Mi(t,r,s,l,a,2),e.a9.identity(l),e.a9.rotateX(l,l,.5*Math.PI),Mi(t,r,s,l,a,3),e.a9.identity(l),Mi(t,r,s,l,a,4),e.a9.identity(l),e.a9.rotateY(l,l,Math.PI),Mi(t,r,s,l,a,5),o.viewport.set([0,0,t.width,t.height])}(t,o),o.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,r,o,n){const i=e.context,a=i.gl,s=e.transform,l=e.getOrCreateProgram("skybox");i.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,r,o,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:o,u_temporal_offset:n}))(s.skyboxMatrix,t.getCenter(e,!1),0,o,n);e.uploadCommonUniforms(i,l),l.draw(e,a.TRIANGLES,r,Pt.disabled,e.colorModeForRenderPass(),Ot.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,o,l,i,c):"gradient"===s&&"sky"===t.renderPass&&function(t,r,o,n,i){const a=t.context,s=a.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new Ri(a)),a.activeTexture.set(s.TEXTURE0);let u=r.colorRampTexture;u||(u=r.colorRampTexture=new e.T(a,r.colorRamp,s.RGBA)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const d=((t,r,o,n,i)=>({u_matrix:t,u_color_ramp:0,u_center_direction:r,u_radius:e.bm(o),u_opacity:n,u_temporal_offset:i}))(l.skyboxMatrix,r.getCenter(t,!1),r.paint.get("sky-gradient-radius"),n,i);t.uploadCommonUniforms(a,c),c.draw(t,s.TRIANGLES,o,Pt.disabled,t.colorModeForRenderPass(),Ot.backCW,d,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(t,o,l,i,c)},debug:function(t,r,o,n,i,a){for(let s=0;s<o.length;s++)if(i){const i=1,l=.8,c=new e.aA(n.r*l,n.g*l,n.b*l,1);Ai(t,r,o[s],n,-i,-i,a),Ai(t,r,o[s],n,-i,i,a),Ai(t,r,o[s],n,i,i,a),Ai(t,r,o[s],n,i,-i,a),Ai(t,r,o[s],c,0,0,a)}else Ai(t,r,o[s],n,0,0,a)},custom:function(t,r,o,n){const i=t.context,a=o.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&o.isDraped(r)){if("offscreen"===t.renderPass){const r=a.prerender;if(r){if(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const o=t.transform.pointMerc;r.call(a,i.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.W(t.transform.zoom),[o.x,o.y],t.transform.pixelsPerMeterRatio)}else r.call(a,i.gl,t.transform.customLayerMatrix());i.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const r=a.renderToTile;if(r){const o=n[0].canonical,s=new e.O(o.x+n[0].wrap*(1<<o.z),o.y,o.z);i.setDepthMode(Et.disabled),i.setStencilMode(Pt.disabled),i.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),r.call(a,i.gl,s),i.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(Pt.disabled);const r="3d"===a.renderingMode?new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Et.ReadOnly);if(i.setDepthMode(r),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;a.render(i.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.W(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else a.render(i.gl,t.transform.customLayerMatrix());i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,r,o,n){if("opaque"===t.renderPass)return;const i=o.paint.get("model-opacity");if(0===i)return;const a=o.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!a)return;if(t.terrain&&i<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof e.Z)return}const s=t.shadowRenderer,l=o.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,l||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,l||(s.enabled=!0))},u=r.getSource();if("light-beam"===t.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(t,r,o,n,i){const a=t.transform;if("mercator"!==a.projection.name)return void e.w(`Drawing 3D models for ${a.projection.name} projection is not yet implemented`);const s=a.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;o.modelManager=l;const c=t.shadowRenderer;if(!o._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=o._unevaluatedLayout._values["model-id"],d={...o.layout.get("model-id").parameters};for(const h of n){const n=r.getTile(h).getBucket(o);if(!n||n.projection.name!==a.projection.name)continue;const f=n.getModelUris();f&&!n.modelsRequested&&(l.addModelsFromBucket(f,i),n.modelsRequested=!0);const m=ji(h,a);d.zoom=m;const p=u.possiblyEvaluate(d);if(Hi(t,n,h),Gi.shadowUniformsInitialized=!1,Gi.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const r=a.calculatePosMatrix(h.toUnwrapped(),a.worldSize);if(Gi.tileMatrix.set(r),Gi.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(r)),Gi.aabb.min.fill(0),Gi.aabb.max[0]=Gi.aabb.max[1]=e.Y,Gi.aabb.max[2]=0,Ji(n,Gi,t,o.scope))continue}const g=1<<h.canonical.z,_=[((s.x-h.wrap)*g-h.canonical.x)*e.Y,(s.y*g-h.canonical.y)*e.Y,s.z*g*e.Y];for(let e in n.instancesPerModel){const r=n.instancesPerModel[e];r.features.length>0&&(e=p.evaluate(r.features[0].feature,{}));const a=l.getModel(e,i);if(a&&a.uploaded)for(const e of a.nodes)Wi(t,o,e,r,_,h,Gi)}}}(t,r,o,n,"vector"===u.type?o.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(t,r,o,n){o.resetLayerRenderingStats(t);const i=t.context,a=t.transform,s=t.style.fog,l=t.shadowRenderer;if("mercator"!==a.projection.name)return void e.w(`Drawing 3D landmark models for ${a.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,u=e.Q.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.Q.negate(u,u);const d=e.a9.identity([]),h=e.cZ(a.center.lat,a.zoom),f=e.a9.fromScaling([],[1,1,1/h]);e.a9.translate(d,d,u);const m=o.paint.get("model-opacity"),p=new Et(i.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D),g=new Et(i.gl.LEQUAL,Et.ReadOnly,t.depthRangeFor3D),_=new e.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,v=y&&l?l.getCurrentCascadeFrustum():a.getFrustum(a.scaleZoom(a.worldSize)),x=o.getLayerRenderingStats(),b=function(c,u){for(const h of n){const n=r.getTile(h).getBucket(o);if(!n||!n.uploaded)continue;let b=!1;l&&(b=0===l.getMaxCascadeForTile(h.toUnwrapped()));const L=a.calculatePosMatrix(h.toUnwrapped(),a.worldSize),A=n.modelTraits;for(const r of n.getNodesInfo()){if(r.hiddenByReplacement)continue;if(!r.node.meshes)continue;const n=r.evaluatedScale,h=r.node;let w=0;if(t.terrain&&h.elevation&&(w=h.elevation*t.terrain.exaggeration()),n[0]<=1&&n[1]<=1&&n[2]<=1&&0===(()=>{const t=r.getLocalBounds();return _.min=[...t.min],_.max=[...t.max],_.min[2]+=w,_.max[2]+=w,e.Q.transformMat4(_.min,_.min,L),e.Q.transformMat4(_.max,_.max,L),_})().intersects(v))continue;const S=[...L];e.a9.translate(S,S,[(h.anchor?h.anchor[0]:0)*(n[0]-1),(h.anchor?h.anchor[1]:0)*(n[1]-1),w]),e.Q.exactEquals(n,e.c$)||e.a9.scale(S,S,n);const E=e.a9.multiply([],S,h.matrix);let T=e.a9.multiply([],f,S);e.a9.multiply(T,d,T);const P=e.a9.invert([],T);e.a9.transpose(P,P),e.a9.scale(P,P,Ki),T=e.a9.multiply(T,T,h.matrix);const C="light-beam"===t.renderPass,R=e.a9.multiply([],a.expandedFarZProjMatrix,E),M=e.a9.multiply([],a.expandedFarZProjMatrix,S),I=A&e.d1.HasMapboxMeshFeatures,O=I?0:r.evaluatedRMEA[0][2];for(let e=0;e<h.meshes.length;++e){const n=h.meshes[e],d=e===h.lightMeshIndex;let f=R;if(d){if(!C&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}f=M}else if(C)continue;const _={defines:[]},v=[];if(Fi(_.defines,v,n,t),I||_.defines.push("DIFFUSE_SHADED"),b&&_.defines.push("SHADOWS_SINGLE_CASCADE"),x&&(y?x.numRenderedVerticesInShadowPass+=n.vertexArray.length:x.numRenderedVerticesInTransparentPass+=n.vertexArray.length),y){Vi(n,E,t,o);continue}let L=null;if(s){const e=Bi(E,t.transform);if(L=new Float32Array(e),"globe"!==a.projection.name){const t=n.aabb.min,r=n.aabb.max,[o,i]=s.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);_.overrideFog=o>=fe||i>=fe}}const A=n.material;let w;A.occlusionTexture&&A.occlusionTexture.offsetScale&&(w=A.occlusionTexture.offsetScale,_.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!n.normalBuffer);const D=t.getOrCreateProgram("model",_);!y&&l&&l.setupShadowsFromMatrix(S,D,l.useNormalOffset),t.uploadCommonUniforms(i,D,null,L);const k=A.pbrMetallicRoughness;k.metallicFactor=.9,k.roughnessFactor=.5;const N=Jn(new Float32Array(f),new Float32Array(T),new Float32Array(P),new Float32Array(h.matrix),t,m,k.baseColorFactor,A.emissiveFactor,k.metallicFactor,k.roughnessFactor,A,O,o,[0,0,0],w);D.draw(t,i.gl.TRIANGLES,u&&!d?p:g,Pt.disabled,c?d||m<1||r.hasTranslucentParts?Rt.alphaBlended:Rt.unblended:Rt.disabled,Ot.backCCW,N,o.id,n.vertexBuffer,n.indexBuffer,n.segments,o.paint,t.transform.zoom,void 0,v)}}}};(function(e,t,r,o){const n=e.terrain?e.terrain.exaggeration():0,i=e.transform.zoom;for(const a of o){const o=t.getTile(a).getBucket(r);o&&(e.conflationActive&&o.updateReplacement(a,e.replacementSource),o.evaluateScale(e,r),e.terrain&&n>0&&o.elevationUpdate(e.terrain,n,a,r.source),o.needsReEvaluation(e,i,r)&&o.evaluate(r))}})(t,r,o,n),1===m?b(!0,!0):(b(!1,!0),b(!0,!1))}(t,r,o,n),void c();const d=u.getModels(),h=[],f=t.transform.getFreeCameraOptions().position,m=e.Q.scale([],[f.x,f.y,f.z],t.transform.worldSize);e.Q.negate(m,m);const p=[],g=[];let _=0;for(const y of d){const r=o.paint.get("model-rotation").constantOr(null),n=o.paint.get("model-scale").constantOr(null),i=o.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,r,n,i,!0,!0,!1);const a=e.a9.identity([]),s=e.cZ(y.position.lat,t.transform.zoom),l=e.a9.fromScaling([],[1,1,1/s]);e.a9.translate(a,a,m),h.push({zScaleMatrix:l,negCameraPosMatrix:a});for(const e of y.nodes)Ui(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,_,p,g);_++}if(p.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===i)for(const e of g)zi(e,t,o,h[e.modelIndex],Pt.disabled,t.colorModeForRenderPass());else{for(const e of g)zi(e,t,o,h[e.modelIndex],Pt.disabled,Rt.disabled);for(const e of g)zi(e,t,o,h[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of p)zi(e,t,o,h[e.modelIndex],Pt.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)Vi(e.mesh,e.nodeModelMatrix,t,o);for(const e of p)Vi(e.mesh,e.nodeModelMatrix,t,o);c()}}},$i={model:function(e,t,r){const o=t.getSource();if(!o.loaded())return;if("vector"===o.type||"geojson"===o.type)return void(r.modelManager&&r.modelManager.upload(r,"vector"===o.type?e.scope:""));if("batched-model"===o.type)return;const n=o.getModels();for(const i of n)i.upload(r.context)},raster:function(e,t,r){const o=t.getSource();if(!(o instanceof Me&&o.loaded()))return;const n=e.sourceLayer||o.rasterLayerIds&&o.rasterLayerIds[0];if(!n)return;const i=e.paint.get("raster-array-band")||o.getInitialBand(n);if(null==i)return;const a=t.getIds().map((e=>t.getTileByID(e)));for(const s of a)s.updateNeeded(n,i)&&o.prepareTile(s,n,i)},"raster-particle":function(e,t,r){const o=t.getSource();if(!(o instanceof Me&&o.loaded()))return;const n=e.sourceLayer||o.rasterLayerIds&&o.rasterLayerIds[0];if(!n)return;const i=e.paint.get("raster-particle-array-band")||o.getInitialBand(n);if(null==i)return;const a=t.getIds().map((e=>t.getTileByID(e)));for(const s of a)s.updateNeeded(n,i)&&o.prepareTile(s,n,i)}};class Xi{constructor(t,r,o,n){this.context=new Dt(t,r),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._timeStamp=(new Date).getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const i=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const e of i)this._debugParams.enabledLayers[e]=!0;n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),n.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),n.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of i)n.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.setup(),this.numSublayers=Zt.maxUnderzooming+Zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new xo(this),this._wireframeDebugCache=new Yi,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new pn(this,e));const o=this._terrain;this.transform.elevation=r?o:null,o.update(e,this.transform,t),this.transform.elevation&&!o.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,o]=t.getFovAdjustedRange(this.transform._fov);if(r>o)return void(this.transform.fogCullDistSq=null);const n=r+.78*(o-r);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*e.f.devicePixelRatio,this.height=r*e.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,r=new e.aQ;r.emplaceBack(0,0),r.emplaceBack(e.Y,0),r.emplaceBack(0,e.Y),r.emplaceBack(e.Y,e.Y),this.tileExtentBuffer=t.createVertexBuffer(r,e.aS.members),this.tileExtentSegments=e.aE.simpleSegment(0,0,4,2);const o=new e.aQ;o.emplaceBack(0,0),o.emplaceBack(e.Y,0),o.emplaceBack(0,e.Y),o.emplaceBack(e.Y,e.Y),this.debugBuffer=t.createVertexBuffer(o,e.aS.members),this.debugSegments=e.aE.simpleSegment(0,0,4,5);const n=new e.aQ;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.aS.members),this.viewportSegments=e.aE.simpleSegment(0,0,4,2);const i=new e.ay;i.emplaceBack(0,0,0,0),i.emplaceBack(e.Y,0,e.Y,0),i.emplaceBack(0,e.Y,0,e.Y),i.emplaceBack(e.Y,e.Y,e.Y,e.Y),this.mercatorBoundsBuffer=t.createVertexBuffer(i,e.aU.members),this.mercatorBoundsSegments=e.aE.simpleSegment(0,0,4,2);const a=new e.az;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const s=new e.aR;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.T(t,new e.h({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.a9.create();const l=this.context.gl;this.stencilClearMode=new Pt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Et.disabled,this.stencilClearMode,Rt.disabled,Ot.disabled,un(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,r){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const o=this.context,n=o.gl;this.nextStencilID+r.length>256&&this.clearStencil(),o.setColorMode(Rt.disabled),o.setDepthMode(Et.disabled);const i=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of r){const e=t.getTile(a),r=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:o,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);i.draw(this,n.TRIANGLES,Et.disabled,new Pt({func:n.ALWAYS,mask:0},r,255,n.KEEP,n.KEEP,n.REPLACE),Rt.disabled,Ot.disabled,un(a.projMatrix),"$clipping",o,s,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Pt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Pt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,r=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),o=r[r.length-1].overscaledZ,n=r[0].overscaledZ-o+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let r=0;r<n;r++)e[r+o]=new Pt({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,r]}return[{[o]:Pt.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new Rt([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.aA(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Rt.unblended:Rt.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Rt([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new e.aA(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.opaquePassEnabledForLayer()&&!o)return Et.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Et(r||this.context.gl.LEQUAL,t,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){const e=(new Date).getTime(),t=e-this._timeStamp;this._timeStamp=e,this._fpsHistory.push(0===t?0:1e3/t),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((e,t)=>e+t/this._fpsHistory.length),0))}render(t,r){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const o=this.style._mergedLayers,n=this.style.order.filter((e=>{const t=o[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]})),i=n.map((e=>o[e])),a=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.f.now()),this.imageManager.beginFrame();let s=0,l=!1;for(const e in a){const t=a[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++s)}for(const e of i)e.isHidden(this.transform.zoom)||this.prepareLayer(e);const c={},u={},d={},h={},f={};for(const e in a){const t=a[e];c[e]=t.getVisibleCoordinates(),u[e]=c[e].slice().reverse(),d[e]=t.getVisibleCoordinates(!0).reverse(),h[e]=t.getShadowCasterCoordinates(),f[e]=t.sortCoordinatesByDistance(c[e])}const m=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(s){const e=[];for(const t of i)this.layerUsedInConflation(t,m(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const r of e){const e=this.style.getLayerSourceCache(r);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:r.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of i){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=m(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<i.length;e++)if(i[e].is3D()){this.opaquePassCutoff=e;break}const p=this.style&&this.style.fog;p?(this._fogVisible=0!==p.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=p.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(d),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in a)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ni(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.d5(this.context.gl))return;this.renderPass="offscreen";for(const e of i){const r=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const o=r?u[r.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||o&&o.length)&&this.renderLayer(this,r,e,o)}this.depthRangeFor3D=[0,1-(i.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,h)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(r.showOverdrawInspector)return e.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new e.aA(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new e.aA(...t)}return e.aA.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=i[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())continue;const o=r?(e.is3D()?f:u)[r.id]:void 0;this._renderTileClippingMasks(e,r,o),this.renderLayer(this,r,e,o)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.W(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=i[this.currentLayer],r=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,r,e,r?u[r.id]:void 0)}function x(e,t){let r;return t&&(r=("symbol"===e.type?d:e.is3D()?f:u)[t.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<n.length;){const e=i[this.currentLayer];if("raster"===e.type){const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,x(e,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(g&&(b=g.getShadowCastingLayerCount());this.currentLayer<n.length;){const e=i[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(_&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(e,r,r?c[r.id]:void 0),this.renderLayer(this,r,e,x(e,r)),!_&&g&&b>0&&e.hasShadowPass()&&0==--b&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=i[this.currentLayer];if(!e.hasLightBeamPass())continue;const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,r?u[r.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;i.forEach((e=>{const o=t.getLayerSourceCache(e);o&&!e.isHidden(this.transform.zoom)&&o.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<o.getSource().maxzoom)&&(r=o)})),r&&this.options.showTileBoundaries&&qi.debug(this,r,r.getVisibleCoordinates(),e.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&qi.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;wi(e,e.transform.height-(t.top||0),3,yi),wi(e,t.bottom||0,3,vi),Si(e,t.left||0,3,xi),Si(e,e.transform.width-(t.right||0),3,bi);const r=e.transform.centerPoint;!function(e,t,r,o){Ei(e,t-1,r-10,2,20,o),Ei(e,t-10,r-1,20,2,o)}(e,r.x,e.transform.height-r.y,Li)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,r=!t||!t.includes(e.type);if($i[e.type]&&(r||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);$i[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,r,o){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||o&&o.length)&&(this.id=r.id,this.gpuTimingStart(r),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(r.type)||e.terrain&&"custom"===r.type)&&qi[r.type](e,t,r,o,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,r=this.context.gl;let o=this.gpuTimers[e.id];o||(o=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),o.calls++,r.beginQuery(t.TIME_ELAPSED_EXT,o.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,r=t.createQuery();this.deferredRenderGpuTimeQueries.push(r),t.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const r in e){const o=e[r],n=this.context.extTimerQuery,i=n.getQueryParameter(o.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(o.query),t[r]=i}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,r=this.context.gl;let o=0;for(const n of e)o+=t.getQueryParameter(n,r.QUERY_RESULT)/1e6,t.deleteQueryEXT(n);return o}translatePosMatrix(t,r,o,n,i){if(!o[0]&&!o[1])return t;const a=i?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);o=[o[0]*t-o[1]*e,o[0]*e+o[1]*t]}const s=[i?o[0]:e.a6(r,o[0],this.transform.zoom),i?o[1]:e.a6(r,o[1],this.transform.zoom),0],l=new Float32Array(16);return e.a9.translate(l,t,s),l}saveTileTexture(e){const t=e.size[0],r=this._tileTextures[t];r?r.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,r){const o=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,n=this.terrain&&0===this.terrain.exaggeration(),i=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(i.push("LIGHTING_3D_MODE"),i.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):o||i.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||i.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?i.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):i.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(i.push("TERRAIN"),this.linearFloatFilteringSupported()&&i.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&i.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&i.push("GLOBE"),!this._fogVisible||o||void 0!==t&&!t||i.push("FOG","FOG_DITHERING"),o&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}getOrCreateProgram(e,t){this.cache=this.cache||{};const r=t&&t.defines||[],o=t&&t.config,n=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(r),i=vn.cacheKey(Jo[e],e,n,o);return this.cache[i]||(this.cache[i]=new vn(this.context,e,Jo[e],o,Yn[e],n)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const o=this.style.directionalLight,n=this.style.ambientLight;if(o&&n){const i=((t,r)=>{const o=t.properties.get("direction"),n=t.properties.get("color").toArray01(),i=t.properties.get("intensity"),a=r.properties.get("color").toArray01(),s=r.properties.get("intensity"),l=[o.x,o.y,o.z],c=e.cs(a,s),u=e.cs(n,i);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:gn(l,u,c)}})(o,n);r.setLightsUniformValues(t,i)}}}uploadCommonUniforms(t,r,o,n,i){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const i=a.getOpacity(this.transform.pitch),s=((t,r,o,n,i,a,s,l,c,u,d,h)=>{const f=t.transform,m=r.properties.get("color").toArray01();m[3]=n;const p=t.frameCounter/1e3%1,[g,_]=r.properties.get("vertical-range");return{u_fog_matrix:o?f.calculateFogTileMatrix(o):h||t.identityMat,u_fog_range:r.getFovAdjustedRange(f._fov),u_fog_color:m,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:p,u_frustum_tl:i,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:d,u_globe_transition:e.W(f.zoom),u_is_globe:+("globe"===f.projection.name)}})(this,a,o,i,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.f.devicePixelRatio,this.transform.height*e.f.devicePixelRatio],n);r.setFogUniformValues(t,s)}i&&r.setCutoffUniformValues(t,i.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const o of r)t[o.key]=e[o.key]||new zt(o,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=fe||t[1]>=fe}}function Qi(e,t){let r=!1,o=null;const n=()=>{o=null,r&&(e(),o=setTimeout(n,t),r=!1)};return()=>(r=!0,o||n(),o)}class ea{constructor(t){this._hashName=t&&encodeURIComponent(t),e.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qi(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=ta(e);if(this._hashName){const e=this._hashName;let r=!1;const o=location.hash.slice(1).split("&").map((o=>{const n=o.split("=")[0];return n===e?(r=!0,`${n}=${t}`):o})).filter((e=>e));return r||o.push(`${e}=${t}`),`#${o.join("&")}`}return`#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ta(e,t){const r=e.getCenter(),o=Math.round(100*e.getZoom())/100,n=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),a=Math.round(r.lng*i)/i,s=Math.round(r.lat*i)/i,l=e.getBearing(),c=e.getPitch();let u=t?`/${a}/${s}/${o}`:`${o}/${s}/${a}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const ra={linearity:.3,easing:e.d6(0,0,.3,1)},oa=e.e({deceleration:2500,maxSpeed:1400},ra),na=e.e({deceleration:20,maxSpeed:1400},ra),ia=e.e({deceleration:1e3,maxSpeed:360},ra),aa=e.e({deceleration:1e3,maxSpeed:90},ra);class sa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.f.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=e.f.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(r.pan.mag()){const i=ca(r.pan.mag(),o,e.e({},oa,t||{}));n.offset=r.pan.mult(i.amount/r.pan.mag()),n.center=this._map.transform.center,la(n,i)}if(r.zoom){const e=ca(r.zoom,o,na);n.zoom=this._map.transform.zoom+e.amount,la(n,e)}if(r.bearing){const t=ca(r.bearing,o,ia);n.bearing=this._map.transform.bearing+e.ad(t.amount,-179,179),la(n,t)}if(r.pitch){const e=ca(r.pitch,o,aa);n.pitch=this._map.transform.pitch+e.amount,la(n,e)}if(n.zoom||n.bearing){const e=void 0===r.pinchAround?r.around:r.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function la(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function ca(t,r,o){const{maxSpeed:n,linearity:i,deceleration:a}=o,s=e.ad(t*i/(r/1e3),-n,n),l=Math.abs(s)/(a*i);return{easing:o.easing,duration:1e3*l,amount:s*(l/2)}}class ua extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=m(r.getCanvasContainer(),o),a=r.unproject(i);super(t,e.e({point:i,lngLat:a,originalEvent:o},n)),this._defaultPrevented=!1,this.target=r}}class da extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,o){const n="touchend"===t?o.changedTouches:o.touches,i=p(r.getCanvasContainer(),n),a=i.map((e=>r.unproject(e))),s=i.reduce(((e,t,r,o)=>e.add(t.div(o.length))),new e.P(0,0));super(t,{points:i,point:s,lngLats:a,lngLat:r.unproject(s),originalEvent:o}),this._defaultPrevented=!1}}class ha extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class fa{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new ha(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new ua(e.type,this._map,e))}mouseup(e){this._map.fire(new ua(e.type,this._map,e))}preclick(t){const r=e.e({},t);r.type="preclick",this._map.fire(new ua(r.type,this._map,r))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new ua(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new ua(e.type,this._map,e))}mouseover(e){this._map.fire(new ua(e.type,this._map,e))}mouseout(e){this._map.fire(new ua(e.type,this._map,e))}touchstart(e){return this._firePreventable(new da(e.type,this._map,e))}touchmove(e){this._map.fire(new da(e.type,this._map,e))}touchend(e){this._map.fire(new da(e.type,this._map,e))}touchcancel(e){this._map.fire(new da(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ma{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new ua(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ua("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new ua(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pa{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const r=t,o=this._startPos,n=this._lastPos;if(!o||!n||n.equals(r)||!this._box&&r.dist(o)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=i("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const a=Math.min(o.x,r.x),s=Math.max(o.x,r.x),l=Math.min(o.y,r.y),c=Math.max(o.y,r.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${a}px,${l}px)`,this._box.style.width=s-a+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,r){if(!this._active)return;const o=this._startPos,n=r;if(o&&0===t.button){if(this.reset(),f(),o.x!==n.x||o.y!==n.y)return this._map.fire(new e.b("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(o,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),d(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new e.b(t,{originalEvent:r}))}}function ga(e,t){const r={};for(let o=0;o<e.length;o++)r[e[o].identifier]=t[o];return r}class _a{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(t){const r=new e.P(0,0);for(const e of t)r._add(e);return r.div(t.length)}(r),this.touches=ga(o,r)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;const o=ga(r,t);for(const n in this.touches){const e=o[n];(!e||e.dist(this.touches[n])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class ya{constructor(e){this.singleTap=new _a(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){const o=this.singleTap.touchend(e,t,r);if(o){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(o)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class va{constructor(){this._zoomIn=new ya({numTouches:1,numTaps:2}),this._zoomOut=new ya({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){const o=this._zoomIn.touchend(e,t,r),n=this._zoomOut.touchend(e,t,r);return o?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(o)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xa={0:1,2:2};class ba{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const r=g(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}mousemoveWindow(e,t){const r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const r=xa[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&f(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class La extends ba{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class Aa extends ba{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=.8*(t.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){e.preventDefault()}}class wa extends ba{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const r=-.5*(t.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){e.preventDefault()}}class Sa{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),e.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(t,r,o){if(this._active&&!(o.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===o.length&&!e.d7())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,o)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,o){o.length>0&&(this._active=!0);const n=ga(o,r),i=new e.P(0,0),a=new e.P(0,0);let s=0;for(const e in n){const t=n[e],r=this._touches[e];r&&(i._add(t),a._add(t.sub(r)),s++,n[e]=t)}if(this._touches=n,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:i.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=i("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Ea{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){const o=this._firstTwoTouches;if(!o)return;e.preventDefault();const[n,i]=o,a=Ta(r,t,n),s=Ta(r,t,i);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;const[o,n]=this._firstTwoTouches,i=Ta(r,t,o),a=Ta(r,t,n);i&&a||(this._active&&f(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ta(e,t,r){for(let o=0;o<e.length;o++)if(e[o].identifier===r)return t[o]}function Pa(e,t){return Math.log(e/t)/Math.LN2}class Ca extends Ea{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Pa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pa(this._distance,r),pinchAround:t}}}function Ra(e,t){return 180*e.angleWith(t)/Math.PI}class Ma extends Ea{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ra(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const o=Ra(e,r);return Math.abs(o)<t}}function Ia(e){return Math.abs(e.y)>Math.abs(e.x)}class Oa extends Ea{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Ia(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,r,o){const n=this._lastPoints;if(!n)return;const i=t[0].sub(n[0]),a=t[1].sub(n[1]);return this._map._cooperativeGestures&&!e.d7()&&o.touches.length<3||(this._valid=this.gestureBeginsVertically(i,a,o.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;const o=e.mag()>=2,n=t.mag()>=2;if(!o&&!n)return;if(!o||!n)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const i=e.y>0==t.y>0;return Ia(e)&&Ia(t)&&i}}const Da={panStep:100,bearingStep:15,pitchStep:10};class ka{constructor(){const e=Da;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,o=0,n=0,i=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),i=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),i=1);break;default:return}return this._rotationDisabled&&(r=0,o=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:Na,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:a.getBearing()+r*this._bearingStep,pitch:a.getPitch()+o*this._pitchStep,offset:[-n*this._panStep,-i*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Na(e){return e*(2-e)}const Ba=4.000244140625,Fa=1/450;class za{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Fa,e.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.d7()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=e.f.now(),n=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,0!==r&&r%Ba==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=m(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Ba?this._wheelZoomRate:this._defaultZoomRate;let o=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==o&&(o=1/o);const n=r(),i=Math.pow(2,n),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):i;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*o))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const o="number"==typeof this._targetZoom?this._targetZoom:r(),n=this._startZoom,i=this._easing;let a,s=!1;if("wheel"===this._type&&n&&i){const t=Math.min((e.f.now()-this._lastWheelEventTime)/200,1),r=i(t);a=e.X(n,o,r),t<1?this._frameId||(this._frameId=!0):s=!0}else a=o,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=a-r();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=e.d8;if(this._prevEase){const t=this._prevEase,o=(e.f.now()-t.start)/t.duration,n=t.easing(o+.01)-t.easing(o),i=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-i*i);r=e.d6(i,a,.25,1)}return this._prevEase={start:e.f.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=i("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Ua{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Va{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ha{constructor(){this._tap=new ya({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const o=t[0],n=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ga{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ja{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wa{constructor(e,t,r,o){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ka=e=>e.zoom||e.drag||e.pitch||e.rotate;class Ja extends e.b{}class Za{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const o=e.Q.sub([],r,t);this.radius=e.Q.length(o[2]<0?e.Q.div([],o,this.constants):[o[0],o[1],0])}projectRay(t){e.Q.div(t,t,this.constants),e.Q.normalize(t,t),e.Q.mul(t,t,this.constants);const r=e.Q.scale([],t,this.radius);if(r[2]>0){const t=e.Q.scale([],[0,0,1],e.Q.dot(r,[0,0,1])),o=e.Q.scale([],e.Q.normalize([],[r[0],r[1],0]),this.radius),n=e.Q.add([],r,e.Q.scale([],e.Q.sub([],e.Q.add([],o,t),r),2));r[0]=n[0],r[1]=n[1]}return r}}function Ya(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class qa{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sa(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Za,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.a$(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,n,i]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(n,t,i)}}destroy(){for(const[e,t,r]of this._listeners){const o=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,o,r)}}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new fa(t,e));const o=t.boxZoom=new pa(t,e);this._add("boxZoom",o);const n=new va,i=new Va;t.doubleClickZoom=new Ua(i,n),this._add("tapZoom",n),this._add("clickZoom",i);const a=new Ha;this._add("tapDragZoom",a);const s=t.touchPitch=new Oa(t);this._add("touchPitch",s);const l=new Aa(e),c=new wa(e);t.dragRotate=new ja(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new La(e),d=new Sa(t,e);t.dragPan=new Ga(r,u,d),this._add("mousePan",u),this._add("touchPan",d,["touchZoom","touchRotate"]);const h=new Ma,f=new Ca;t.touchZoomRotate=new Wa(r,f,h,a),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ma(t));const m=t.scrollZoom=new za(t,this);this._add("scrollZoom",m,["mousePan"]);const p=t.keyboard=new ka;this._add("keyboard",p);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ka(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const o in e)if(o!==r&&(!t||t.indexOf(o)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(e,t){this._updatingCamera=!0;const r="renderFrame"===e.type,o=r?void 0:e,n={needsRenderFrame:!1},i={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?p(this._el,s):r?void 0:m(this._el,e);for(const{handlerName:d,handler:h,allowed:f}of this._handlers){if(!h.isEnabled())continue;let r;this._blockedByActive(a,f,d)?h.reset():h[t||e.type]&&(r=h[t||e.type](e,l,s),this.mergeHandlerResult(n,i,r,d,o),r&&r.needsRenderFrame&&this._triggerRenderFrame()),(r||h.isActive())&&(a[d]=h)}const c={};for(const d in this._previousActiveHandlers)a[d]||(c[d]=o);this._previousActiveHandlers=a,(Object.keys(c).length||Ya(n))&&(this._changes.push([n,i,c]),this._triggerRenderFrame()),(Object.keys(a).length||Ya(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,r,o,n,i){if(!o)return;e.e(t,o);const a={handlerName:n,originalEvent:o.originalEvent||i};void 0!==o.zoomDelta&&(r.zoom=a),void 0!==o.panDelta&&(r.drag=a),void 0!==o.pitchDelta&&(r.pitch=a),void 0!==o.bearingDelta&&(r.rotate=a)}_applyChanges(){const t={},r={},o={};for(const[n,i,a]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.e(r,i),e.e(o,a);this._updateMapTransform(t,r,o),this._changes=[]}_updateMapTransform(t,r,o){const n=this._map,i=n.transform,a=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Ya(t)){const e=i.zoom;i.cameraElevationReference="sea",null!=this._originalZoom&&i._orthographicProjectionAtLowPitch&&"globe"!==i.projection.name&&0===i.pitch?(i.cameraElevationReference="ground",i.zoom=this._originalZoom):(i.recenterOnTerrain(),i.cameraElevationReference="ground"),e!==i.zoom&&this._map._update(!0)}if(i._isCameraConstrained&&n._stop(!0),!Ya(t))return void this._fireEvents(r,o,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:d,aroundCoord:h,pinchAround:f}=t;i._isCameraConstrained&&(l>0&&(l=0),i._isCameraConstrained=!1),void 0!==f&&(d=f),(l||(e=>r[e]&&!this._eventsInProgress[e])("drag"))&&d&&(this._dragOrigin=a(i.pointCoordinate3D(d)),this._originalZoom=i.zoom,this._trackingEllipsoid.setup(i._camera.position,this._dragOrigin)),i.cameraElevationReference="sea",n._stop(!0),d=d||n.transform.centerPoint,c&&(i.bearing+=c),u&&(i.pitch+=u),i._updateCameraState();const m=[0,0,0];if(s)if("mercator"===i.projection.name){const e=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(d).dir),t=this._trackingEllipsoid.projectRay(i.screenPointToMercatorRay(d.sub(s)).dir);m[0]=t[0]-e[0],m[1]=t[1]-e[1]}else{const t=i.pointCoordinate(d);if("globe"===i.projection.name){s=s.rotate(-i.angle);const r=i._pixelsPerMercatorPixel/i.worldSize;m[0]=-s.x*e.d9(e.ax(t.y))*r,m[1]=-s.y*e.d9(i.center.lat)*r}else{const e=i.pointCoordinate(d.sub(s));t&&e&&(m[0]=e.x-t.x,m[1]=e.y-t.y)}}const p=i.zoom,g=[0,0,0];if(l){const t=a(h||i.pointCoordinate3D(d)),r={dir:e.Q.normalize([],e.Q.sub([],t,i._camera.position))};if(r.dir[2]<0){const o=i.zoomDeltaToMovement(t,l);e.Q.scale(g,r.dir,o)}}const _=e.Q.add(m,m,g);i._translateCameraConstrained(_),l&&Math.abs(i.zoom-p)>1e-4&&i.recenterOnTerrain(),i.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,o,!0)}_fireEvents(t,r,o){const n=Ka(this._eventsInProgress),i=Ka(t),a={};for(const e in t){const{originalEvent:r}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=r),this._eventsInProgress[e]=t[e]}!n&&i&&this._fireEvent("movestart",i.originalEvent);for(const e in a)this._fireEvent(e,a[e]);i&&this._fireEvent("move",i.originalEvent);for(const e in t){const{originalEvent:r}=t[e];this._fireEvent(e,r)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:o}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=r[t]||o,s[`${e}end`]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=Ka(this._eventsInProgress);if(o&&(n||i)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(r(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.b("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new e.b(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Ja("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const $a="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Xa extends e.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,e.a$(["_renderFrameCallback"],this)}getCenter(){return new e.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,r,o){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},r),o)}panTo(t,r,o){return this.easeTo(e.e({center:t},r),o)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,r,o){return this.easeTo(e.e({zoom:t},r),o)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,r,o){return this.easeTo(e.e({bearing:t},r),o)}resetNorth(t,r){return this.rotateTo(0,e.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,r){t=e.ag.convert(t);const o=r&&r.bearing||0,n=r&&r.pitch||0,i=t.getNorthWest(),a=t.getSouthEast();return this._cameraForBounds(this.transform,i,a,o,n,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return null==t?e.e({},r,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.e({},r,t)}_extendCameraOptions(t){return(t=e.e({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const r=t.max[0]-t.min[0],o=t.max[1]-t.min[1];return r/o>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):o/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,r,o,n,i,a){const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=n,s.pitch=i;const c=e.bq.convert(r),u=e.bq.convert(o),d=.5*(c.lat+u.lat),h=.5*(c.lng+u.lng),f=e.da(d,h),m=e.Q.normalize([],f),p=e.Q.normalize([],e.Q.cross([],m,[0,1,0])),g=e.Q.cross([],p,m),_=[p[0],p[1],p[2],0,g[0],g[1],g[2],0,m[0],m[1],m[2],0,0,0,0,1],y=[f,e.da(c.lat,c.lng),e.da(u.lat,c.lng),e.da(u.lat,u.lng),e.da(c.lat,u.lng),e.da(d,c.lng),e.da(d,u.lng),e.da(c.lat,h),e.da(u.lat,h)];let v=e.bV.fromPoints(y.map((t=>[e.Q.dot(p,t),e.Q.dot(g,t),e.Q.dot(m,t)])));const x=e.Q.transformMat4([],v.center,_);0===e.Q.squaredLength(x)&&e.Q.set(x,0,0,1),e.Q.normalize(x,x),e.Q.scale(x,x,e.ae),s.center=e.db(x);const b=s.getWorldToCameraMatrix(),L=e.a9.invert(new Float64Array(16),b);v=e.bV.applyTransform(v,e.a9.multiply([],b,_));const A=this._extendAABB(v,s,l,n);if(!A)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=A,e.Q.transformMat4(x,x,b);const w=.5*(v.max[2]-v.min[2]),S=this._minimumAABBFrustumDistance(s,v),E=e.Q.scale([],[0,0,1],w),T=e.Q.add(E,x,E),P=S+(0===s.pitch?0:e.Q.distance(x,T)),C=s.globeCenterInViewSpace,R=e.Q.sub([],x,[C[0],C[1],C[2]]);e.Q.normalize(R,R),e.Q.scale(R,R,P);const M=e.Q.add([],x,R);e.Q.transformMat4(M,M,L);const I=e.dc/e.ae,O=e.Q.length(M),D=e.bo(Math.max(O*I-e.dc,Number.EPSILON),0),k=Math.min(s.zoomFromMercatorZAdjusted(D),l.maxZoom);return k>.5*(e.bJ+e.bA)?(s.setProjection({name:"mercator"}),s.zoom=k,this._cameraForBounds(s,r,o,n,i,a)):{center:s.center,zoom:k,bearing:n,pitch:i}}_extendAABB(t,r,o,n){const i=.5*((o.padding.left||0)+(o.padding.right||0)),a=.5*((o.padding.top||0)+(o.padding.bottom||0)),s=a,l=i,c=i,u=a,d=r.width-(l+c),h=r.height-(s+u),f=e.Q.sub([],t.max,t.min),m=Math.min(d/f[0],h/f[1]),p=Math.min(r.scaleZoom(r.scale*m),o.maxZoom);if(isNaN(p))return null;const g=r.scale/r.zoomScale(p),_=new e.bV([t.min[0]-l*g,t.min[1]-u*g,t.min[2]],[t.max[0]+c*g,t.max[1]+s*g,t.max[2]]),y=("number"==typeof o.offset.x&&"number"==typeof o.offset.y?new e.P(o.offset.x,o.offset.y):e.P.convert(o.offset)).rotate(-e.bm(n));return _.center[0]-=y.x*g,_.center[1]+=y.y*g,_}queryTerrainElevation(t,r){const o=this.transform.elevation;return o?(r=e.e({},{exaggerated:!0},r),o.getAtPoint(e.O.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,o,n,i,a){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,o,n,i,a);const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=n,s.pitch=i;const c=e.bq.convert(r),u=e.bq.convert(o),d=new e.bq(c.lng,u.lat),h=new e.bq(u.lng,c.lat),f=s.project(c),m=s.project(u),p=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(d),y=this.queryTerrainElevation(h),v=[[f.x,f.y,Math.min(p||0,g||0,_||0,y||0)],[m.x,m.y,Math.max(p||0,g||0,_||0,y||0)]];let x=e.bV.fromPoints(v);const b=s.getWorldToCameraMatrix(),L=e.a9.invert(new Float64Array(16),b);x=e.bV.applyTransform(x,b);const A=this._extendAABB(x,s,l,n);if(!A)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=A;const w=.5*e.Q.sub([],x.max,x.min)[2],S=this._minimumAABBFrustumDistance(s,x),E=[0,0,1,0];e.aa.transformMat4(E,E,b),e.aa.normalize(E,E);const T=e.Q.scale([],E,S+w),P=e.Q.add([],x.center,T);e.Q.transformMat4(x.center,x.center,L),e.Q.transformMat4(P,P,L);const C=[x.center[0],x.center[1],P[2]*s.pixelsPerMeter];e.Q.scale(C,C,1/s.worldSize);const R=e.aw(C[0]),M=e.ax(C[1]),I=Math.min(s._zoomFromMercatorZ(C[2]),l.maxZoom),O=new e.bq(R,M);return s.mercatorFromTransition&&I<.5*(e.bJ+e.bA)?(s.setProjection({name:"globe"}),s.zoom=I,this._cameraForBounds(s,r,o,n,i,a)):{center:O,zoom:I,bearing:n,pitch:i}}fitBounds(e,t,r){const o=this.cameraForBounds(e,t);return this._fitInternal(o,t,r)}fitScreenCoordinates(t,r,o,n,i){const a=e.P.convert(t),s=e.P.convert(r),l=new e.P(Math.min(a.x,s.x),Math.min(a.y,s.y)),c=new e.P(Math.max(a.x,s.x),Math.max(a.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,s))return this;const u=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(c),h=this.transform.pointLocation3D(new e.P(l.x,c.y)),f=this.transform.pointLocation3D(new e.P(c.x,l.y)),m=[Math.min(u.lng,d.lng,h.lng,f.lng),Math.min(u.lat,d.lat,h.lat,f.lat)],p=[Math.max(u.lng,d.lng,h.lng,f.lng),Math.max(u.lat,d.lat,h.lat,f.lat)],g=n&&n.pitch?n.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,m,p,o,g,n);return this._fitInternal(_,n,i)}_fitInternal(t,r,o){return t?(r=e.e(t,r)).linear?this.easeTo(r,o):this.flyTo(r,o):this}jumpTo(t,r){this.stop();const o=t.preloadOnly?this.transform.clone():this.transform;let n=!1,i=!1,a=!1;return"zoom"in t&&o.zoom!==+t.zoom&&(n=!0,o.zoom=+t.zoom),void 0!==t.center&&(o.center=e.bq.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(i=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(a=!0,o.pitch=+t.pitch),null==t.padding||o.isPaddingEqual(t.padding)||(o.padding=t.padding),t.preloadOnly?(this._preloadTiles(o),this):(this.fire(new e.b("movestart",r)).fire(new e.b("move",r)),n&&this.fire(new e.b("zoomstart",r)).fire(new e.b("zoom",r)).fire(new e.b("zoomend",r)),i&&this.fire(new e.b("rotatestart",r)).fire(new e.b("rotate",r)).fire(new e.b("rotateend",r)),a&&this.fire(new e.b("pitchstart",r)).fire(new e.b("pitch",r)).fire(new e.b("pitchend",r)),this.fire(new e.b("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w($a),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const o=this.transform;if(!o.projection.supportsFreeCamera)return e.w($a),this;this.stop();const n=o.zoom,i=o.pitch,a=o.bearing;o.setFreeCameraOptions(t);const s=n!==o.zoom,l=i!==o.pitch,c=a!==o.bearing;return this.fire(new e.b("movestart",r)).fire(new e.b("move",r)),s&&this.fire(new e.b("zoomstart",r)).fire(new e.b("zoom",r)).fire(new e.b("zoomend",r)),c&&this.fire(new e.b("rotatestart",r)).fire(new e.b("rotate",r)).fire(new e.b("rotateend",r)),l&&this.fire(new e.b("pitchstart",r)).fire(new e.b("pitch",r)).fire(new e.b("pitchend",r)),this.fire(new e.b("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.d8},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const o=this.transform,n=this.getZoom(),i=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,i):i,u="pitch"in t?+t.pitch:a,d=this._extendPadding(t.padding),h=e.P.convert(t.offset);let f,m,p;if("globe"===o.projection.name){const r=e.O.fromLngLat(o.center),n=h.rotate(-o.angle);r.x+=n.x/o.worldSize,r.y+=n.y/o.worldSize;const i=r.toLngLat(),a=e.bq.convert(t.center||i);this._normalizeCenter(a),f=o.centerPoint.add(n),m=new e.P(r.x,r.y).mult(o.worldSize),p=new e.P(e.a8(a.lng),e.ah(a.lat)).mult(o.worldSize).sub(m)}else{f=o.centerPoint.add(h);const r=o.pointLocation(f),n=e.bq.convert(t.center||r);this._normalizeCenter(n),m=o.project(r),p=o.project(n).sub(m)}const g=o.zoomScale(l-n);let _,y;t.around&&(_=e.bq.convert(t.around),y=o.locationPoint(_));const v=this._zooming||l!==n,x=this._rotating||i!==c,b=this._pitching||u!==a,L=!o.isPaddingEqual(d),A=o=>A=>{if(v&&(o.zoom=e.X(n,l,A)),x&&(o.bearing=e.X(i,c,A)),b&&(o.pitch=e.X(a,u,A)),L&&(o.interpolatePadding(s,d,A),f=o.centerPoint.add(h)),_)o.setLocationAtPoint(_,y);else{const e=o.zoomScale(o.zoom-n),t=l>n?Math.min(2,g):Math.max(.5,g),r=Math.pow(t,1-A),i=o.unproject(m.add(p.mult(A*r)).mult(e));o.setLocationAtPoint(o.renderWorldCopies?i.wrap():i,f)}return t.preloadOnly||this._fireMoveEvents(r),o};if(t.preloadOnly){const e=this._emulate(A,t.duration,o);return this._preloadTiles(e),this}const w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=L,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,w),this._ease(A(o),(e=>{"sea"===o.cameraElevationReference&&o.recenterOnTerrain(),this._afterEase(r,e)}),t),this}_prepareEase(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||o.moving||this.fire(new e.b("movestart",t)),this._zooming&&!o.zooming&&this.fire(new e.b("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new e.b("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new e.b("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.b("move",t)),this._zooming&&this.fire(new e.b("zoom",t)),this._rotating&&this.fire(new e.b("rotate",t)),this._pitching&&this.fire(new e.b("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const o=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new e.b("zoomend",t)),n&&this.fire(new e.b("rotateend",t)),i&&this.fire(new e.b("pitchend",t)),this.fire(new e.b("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const o=e.af(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(o,r)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.d8},t);const o=this.transform,n=this.getZoom(),i=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.ad(+t.zoom,o.minZoom,o.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,i):i,u="pitch"in t?+t.pitch:a,d=this._extendPadding(t.padding),h=o.zoomScale(l-n),f=e.P.convert(t.offset);let m=o.centerPoint.add(f);const p=o.pointLocation(m),g=e.bq.convert(t.center||p);this._normalizeCenter(g);const _=o.project(p),y=o.project(g).sub(_);let v=t.curve;const x=Math.max(o.width,o.height),b=x/h,L=y.mag();if("minZoom"in t){const r=e.ad(Math.min(t.minZoom,n,l),o.minZoom,o.maxZoom),i=x/o.zoomScale(r-n);v=Math.sqrt(i/L*2)}const A=v*v;function w(e){const t=(b*b-x*x+(e?-1:1)*A*A*L*L)/(2*(e?b:x)*A*L);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}const T=w(0);let P=function(e){return E(T)/E(T+v*e)},C=function(e){return x*((E(T)*(S(t=T+v*e)/E(t))-S(T))/A)/L;var t},R=(w(1)-T)/v;if(Math.abs(L)<1e-6||!isFinite(R)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,r);const e=b<x?-1:1;R=Math.abs(Math.log(b/x))/v,C=function(){return 0},P=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*R/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const M=i!==c,I=u!==a,O=!o.isPaddingEqual(d),D=o=>h=>{const p=h*R,v=1/P(p);o.zoom=1===h?l:n+o.scaleZoom(v),M&&(o.bearing=e.X(i,c,h)),I&&(o.pitch=e.X(a,u,h)),O&&(o.interpolatePadding(s,d,h),m=o.centerPoint.add(f));const x=1===h?g:o.unproject(_.add(y.mult(C(p))).mult(v));return o.setLocationAtPoint(o.renderWorldCopies?x.wrap():x,m),o._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),o};if(t.preloadOnly){const e=this._emulate(D,t.duration,o);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=M,this._pitching=I,this._padding=O,this._prepareEase(r,!1),this._ease(D(o),(()=>this._afterEase(r)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,r,o){!1===o.animate||0===o.duration?(t(1),r()):(this._easeStart=e.f.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.f.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=e.bk(t,-180,180);const o=Math.abs(t-r);return Math.abs(t-360-r)<o&&(t-=360),Math.abs(t+360-r)<o&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.f.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,r){const o=Math.ceil(15*t/1e3),n=[],i=e(r.clone());for(let a=0;a<=o;a++){const e=i(a/o);n.push(e.clone())}return n}_preloadTiles(e,t){}}class Qa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=i("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=i("button","mapboxgl-ctrl-attrib-button",this._container),i("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const r=this._map._getUIString(`AttributionControl.${t}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.dd.ACCESS_TOKEN}];if(t){const o=r.reduce(((e,t,o)=>(t.value&&(e+=`${t.key}=${t.value}${o<r.length-1?"&":""}`),e)),"?");t.href=`${e.dd.FEEDBACK_URL}/${o}#${ta(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const o in t){const r=t[o];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,r)=>{for(let o=r+1;o<e.length;o++)if(e[o].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class es{constructor(){e.a$(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=i("div","mapboxgl-ctrl");const t=i("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class ts{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const o of r)if(o.id===e)return void(o.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function rs(t,r,o){if(t=new e.bq(t.lng,t.lat),r){const n=new e.bq(t.lng-360,t.lat),i=new e.bq(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-o.center.lng)/360),s=o.locationPoint(t).distSqr(r),l=r.x<0||r.y<0||r.x>o.width||r.y>o.height;o.locationPoint(n).distSqr(r)<s&&(l||Math.abs(n.lng-o.center.lng)<a)?t=n:o.locationPoint(i).distSqr(r)<s&&(l||Math.abs(i.lng-o.center.lng)<a)&&(t=i)}for(;Math.abs(t.lng-o.center.lng)>180;){const e=o.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=o.width&&e.y<=o.height)break;t.lng>o.center.lng?t.lng-=360:t.lng+=360}return t}const os={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ns extends e.E{constructor(t,r){if(super(),(t instanceof HTMLElement||r)&&(t=e.e({element:t},r)),e.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=i("div");const r=41,o=27,n=a("svg",{display:"block",height:r*this._scale+"px",width:o*this._scale+"px",viewBox:`0 0 ${o} ${r}`},this._element),s=a("radialGradient",{id:"shadowGradient"},a("defs",{},n));a("stop",{offset:"10%","stop-opacity":.4},s),a("stop",{offset:"100%","stop-opacity":.05},s),a("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),a("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),a("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),a("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const o=this._element.classList;for(const e in os)o.remove(`mapboxgl-marker-anchor-${e}`);o.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=t&&t.className?t.className.trim().split(/\s+/):[];o.add(...n),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.bq.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,r=13.5,o=Math.sqrt(Math.pow(r,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[o,-1*(t-r+o)],"bottom-right":[-o,-1*(t-r+o)],left:[r,-1*(t-r)],right:[-r,-1*(t-r)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const r=e.unproject(t),o=e.getFreeCameraOptions();if(!o.position)return!1;const n=o.position.toLngLat();return n.distanceTo(r)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const o=t.unproject(r);let n;t._showingGlobe()&&e.de(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(o),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${os[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `}_calculateXYTransform(){const t=this._pos,r=this._map,o=this.getPitchAlignment();if(!r||!t||"map"!==o)return"";if(!r._showingGlobe()){const e=r.getPitch();return e?`rotateX(${e}deg)`:""}const n=e.bI(e.df(r.transform,this._lngLat)),i=t.sub(e.dg(r.transform)),a=Math.abs(i.x)+Math.abs(i.y);if(0===a)return"";const s=n/a;return`rotateX(${-i.y*s}deg) rotateY(${i.x*s}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let o=0;const n=this.getRotationAlignment();if("map"===n)if(r._showingGlobe()){const t=r.project(new e.bq(this._lngLat.lng,this._lngLat.lat+.001)),n=r.project(new e.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);o=e.bI(Math.atan2(n.y,n.x))-90}else o=-r.getBearing();else if("horizon"===n){const n=e.S(4,6,r.getZoom()),i=e.dg(r.transform);i.y+=n*r.transform.height;const a=t.sub(i),s=e.bI(Math.atan2(a.y,a.x));o=(s>90?s-270:s+90)*(1-n)}return o+=this._rotation,o?`rotateZ(${o}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=rs(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const r=this._map;if(!r)return;const o=this._pointerdownPos,n=this._positionDelta;if(o&&n){if(!this._isDragging){const e=this._clickTolerance||r._clickTolerance;if(t.point.dist(o)<e)return;this._isDragging=!0}this._pos=t.point.sub(n),this._lngLat=r.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.b("dragstart"))),this.fire(new e.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.b("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const is={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},as=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ss(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const o=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(r){case"top":return new e.P(0,t);case"top-left":return new e.P(o,o);case"top-right":return new e.P(-o,o);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(o,-o);case"bottom-right":return new e.P(-o,-o);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[r]||[0,0])}class ls{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=e.ch((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}class cs{registerParameter(e,t,r,o,n){}registerButton(e,t,r){}registerBinding(e,t,r,o){}refreshUI(){}}const us={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ds={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},hs={showCompass:!0,showZoom:!0,visualizePitch:!1};class fs{constructor(t,r){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=r,this.mouseRotate=new Aa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new wa({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const r=this.map,o=this.mouseRotate.mousemoveWindow(e,t),n=o&&o.bearingDelta;if(n&&r.setBearing(r.getBearing()+n),this.mousePitch){const o=this.mousePitch.mousemoveWindow(e,t),n=o&&o.pitchDelta;n&&r.setPitch(r.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){d(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),m(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,m(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=p(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=p(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ms={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ps={maxWidth:100,unit:"metric"},gs={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_s={version:e.du,supported:r,setRTLTextPlugin:e.dw,getRTLTextPluginStatus:e.dx,Map:class extends Xa{constructor(t){const r=t;if(null!=(t=e.e({},ds,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.dh(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mo(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new ts,this._domRenderTaskQueue=new ts,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.aF(),this._locale=e.e({},us,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ls(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.di(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=t.devtools?new cs(this):new cs,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new qa(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.dd.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new ea("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const o=t.bounds;o&&(this.resize(),this.fitBounds(o,e.e({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Qa({customAttribution:t.customAttribution})),this._logoControl=new es,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.b(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.b(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,r){if(void 0===r&&(r=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[r];return-1!==r.indexOf("bottom")?n.insertBefore(o,n.firstChild):n.appendChild(o),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(t);return r>-1&&this._controls.splice(r,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new e.b("movestart",t)).fire(new e.b("move",t)),this.fire(new e.b("resize",t)),r&&this.fire(new e.b("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.ag.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,r=t.projection.name;let o;"globe"===r&&t.zoom>=e.bA?(t.setMercatorFromTransition(),o=!0):"mercator"===r&&t.zoom<e.bA&&(t.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let r;return r="globe"===t.name&&this.transform.zoom>=e.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.bq.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){if("mouseenter"===e||"mouseover"===e){let o=!1;const n=n=>{const i=t.filter((e=>this.getLayer(e))),a=i.length?this.queryRenderedFeatures(n.point,{layers:i}):[];a.length?o||(o=!0,r.call(this,new ua(e,this,n.originalEvent,{features:a}))):o=!1},i=()=>{o=!1};return{layers:new Set(t),listener:r,delegates:{mousemove:n,mouseout:i}}}if("mouseleave"===e||"mouseout"===e){let o=!1;const n=n=>{const i=t.filter((e=>this.getLayer(e)));(i.length?this.queryRenderedFeatures(n.point,{layers:i}):[]).length?o=!0:o&&(o=!1,r.call(this,new ua(e,this,n.originalEvent)))},i=t=>{o&&(o=!1,r.call(this,new ua(e,this,t.originalEvent)))};return{layers:new Set(t),listener:r,delegates:{mousemove:n,mouseout:i}}}{const o=e=>{const o=t.filter((e=>this.getLayer(e))),n=o.length?this.queryRenderedFeatures(e.point,{layers:o}):[];n.length&&(e.features=n,r.call(this,e),delete e.features)};return{layers:new Set(t),listener:r,delegates:{[e]:o}}}}on(e,t,r){if(void 0===r)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const o=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(o);for(const n in o.delegates)this.on(n,o.delegates[n]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const o=this._createDelegatedListener(e,t,r);for(const n in o.delegates)this.once(n,o.delegates[n]);return this}off(e,t,r){if(void 0===r)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const i of t)if(!this._isValidId(i))return this;const o=(e,t)=>{if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const i=e[n];if(i.listener===r&&o(i.layers,t)){for(const e in i.delegates)this.off(e,i.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,r){if(!this.style)return[];if(void 0!==r||void 0===t||t instanceof e.P||Array.isArray(t)||(r=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers))for(const e of r.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,r,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&e.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,r){return r=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&t&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(t,((o,n)=>{o?(e.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(t,r)):n&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(t,r))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(t,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const o=e.e({},r);r&&r.config&&(o.initialConfig=r.config,delete o.config),this.style=new Ro(this,o).setEventedParent(this,{style:this.style}).load(t)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.a(new Error("IDs can't be empty."))),!1):!e.c9(t)||(this.fire(new e.a(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,r){let{pixelRatio:o=1,sdf:n=!1,stretchX:i,stretchY:a,content:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:l,height:c,data:u}=e.f.getImageData(r);this.style.addImage(t,{data:new e.h({width:l,height:c},u),pixelRatio:o,stretchX:i,stretchY:a,content:s,sdf:n,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new e.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=r,u=r;this.style.addImage(t,{data:new e.h({width:l,height:c},new Uint8Array(u.data)),pixelRatio:o,stretchX:i,stretchY:a,content:s,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,r){this._lazyInitEmptyStyle();const o=this.style.getImage(t);if(!o)return void this.fire(new e.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?e.f.getImageData(r):r,{width:i,height:a}=n,s=n.data;if(void 0===i||void 0===a)return void this.fire(new e.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(i!==o.data.width||a!==o.data.height)return void this.fire(new e.a(new Error(`The width and height of the updated image (${i}, ${a})\n                must be that same as the previous version of the image\n                (${o.data.width}, ${o.data.height})`)));const l=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);o.data.replace(s,l),this.style.updateImage(t,o)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.a(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,r){e.d(this._requestManager.transformRequest(t,e.R.Image),((t,o)=>{r(t,o instanceof HTMLImageElement?e.f.getImageData(o):o)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.a(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,o),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,o),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.bq.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,o,n,i=this._container;for(;i&&(!o||!n);){const e=window.getComputedStyle(i).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(o=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(n=r[3])),i=i.parentElement}this._containerWidth=o?Math.abs(e/o):e,this._containerHeight=n?Math.abs(t/n):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=i("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=i("div","mapboxgl-canvas-container",e);this._canvas=i("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=i("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{o[e]=i("div",`mapboxgl-ctrl-${e}`,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,r){const o=e.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(t),this._canvas.height=o*Math.ceil(r),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${r}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.e({},r.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",t);o?(e.dj(o,!0),this.painter=new Xi(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.dk.testSupport(o)):this.fire(new e.a(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.b("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.b("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let r;this.fire(new e.b("renderstart"));const o=this.painter.context.extTimerQuery,n=e.f.now(),i=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=i.createQuery(),i.beginQuery(o.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const a=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=this.transform.pitch,o=e.f.now(),n=new e.N(t,{now:o,fadeDuration:a,pitch:r,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const t=e.f.now()-n;i.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{const o=i.getQueryParameter(r,i.QUERY_RESULT)/1e6;i.deleteQuery(r),this.fire(new e.b("gpu-timing-frame",{cpuTime:t,gpuTime:o}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const r=this.painter.queryGpuTimers(t);this.fire(new e.b("gpu-timing-layer",{layerTimes:r}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const r=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.b("gpu-timing-deferred-render",{gpuTime:r}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.b("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&e.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const o=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(o||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const i=Math.abs(t-n);if(i>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(n),r(n);this._averageElevation.easeTo(n,e,300)}else if(i>1e-4)return this._averageElevation.jumpTo(n),r(n)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){e.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.dn||401===t.status)){const t=this.painter.context.gl;e.dj(t,!1),this._logoControl instanceof es&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&e.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,o=r.createFramebuffer();function n(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);const t=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,t),t}return r.bindFramebuffer(r.FRAMEBUFFER,o),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,r){let o=r[1]-r[0];const n=e.length/4;for(let i=0;i<t.length;i++){const a=t[i];let s=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(s+=1);o+=(r[i+2]-r[i+1])*(1-s/n)}return o}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.dr(this.painter.context.gl),e.ds.remove(),e.dt.remove(),this._removed=!0,this.fire(new e.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.f.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const r=this.style?this.style.getSourceCaches():[];return e.b4(r,((e,r)=>e._preloadTiles(t,r)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,r){e.dv(t,r)}get version(){return e.du}},NavigationControl:class{constructor(t){this.options=e.e({},hs,t),this._container=i("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),i("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),i("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=i("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),o=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fs(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=i("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends e.E{constructor(t){super();const r=navigator.geolocation;this.options=e.e({geolocation:r},ms,t),e.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qi(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=i("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const r=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=r,e(r)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>r("denied"!==e.state))).catch((()=>r())):r()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.b("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("geolocate",t)),this._finish()}}_updateCamera(t){const r=new e.bq(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,n=this._map.getBearing(),i=e.e({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(o),i,{geolocateSource:!0})}_updateMarker(t){if(t){const r=new e.bq(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,r=e.bo(1,t._center.lat)*t.worldSize,o=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=i("button","mapboxgl-ctrl-geolocate",this._container),i("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i("div","mapboxgl-user-location"),this._dotElement.appendChild(i("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(i("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ns({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=i("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ns({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.b("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Qa,ScaleControl:class{constructor(t){this.options=e.e({},ps,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,o=t._containerWidth/2-e/2,n=t.unproject([o,r]),i=t.unproject([o+e,r]),a=n.distanceTo(i);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,r){this._map._requestDomTask((()=>{const o=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let r=e/t;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r),t*r}(t),n=o/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(o):`${o}&nbsp;${gs[r]}`,this._container.style.width=e*n+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=i("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=i("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=i("button","mapboxgl-ctrl-fullscreen",this._controlContainer);i("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.e(Object.create(is),t),e.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.b("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.bq.convert(t),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),r=document.createElement("body");let o;for(r.innerHTML=e;o=r.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=i("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=i("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,o=this._pos;if(!t||!r||!o)return"bottom";const n=r.offsetWidth,i=r.offsetHeight,a=o.x<n/2,s=o.x>t.transform.width-n/2;if(o.y+e<i)return a?"top-left":s?"top-right":"top";if(o.y>t.transform.height-i){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const r=this._map,o=this._content;if(!r||!this._lngLat&&!this._trackPointer||!o)return;let n=this._container;if(n||(n=this._container=i("div","mapboxgl-popup",r.getContainer()),this._tip=i("div","mapboxgl-popup-tip",n),n.appendChild(o)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rs(this._lngLat,this._pos,r.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:r.project(this._lngLat),o=ss(this.options.offset),n=this._anchor=this._getAnchor(o.y),i=ss(this.options.offset,n),a=e.add(i).round();r._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${os[n]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&r._showingGlobe()){const t=e.de(r.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(as);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:ns,Style:Ro,LngLat:e.bq,LngLatBounds:e.ag,Point:e.P,MercatorCoordinate:e.O,FreeCameraOptions:co,Evented:e.E,config:e.dd,prewarm:e.dy,clearPrewarmedResources:e.dz,get accessToken(){return e.dd.ACCESS_TOKEN},set accessToken(t){e.dd.ACCESS_TOKEN=t},get baseApiUrl(){return e.dd.API_URL},set baseApiUrl(t){e.dd.API_URL=t},get workerCount(){return e.dA.workerCount},set workerCount(t){e.dA.workerCount=t},get maxParallelImageRequests(){return e.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.dd.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.dB(t)},get workerUrl(){return e.dC.workerUrl},set workerUrl(t){e.dC.workerUrl=t},get workerClass(){return e.dC.workerClass},set workerClass(t){e.dC.workerClass=t},get workerParams(){return e.dC.workerParams},set workerParams(t){e.dC.workerParams=t},get dracoUrl(){return e.dD()},set dracoUrl(t){e.dE(t)},get meshoptUrl(){return e.dF()},set meshoptUrl(t){e.dG(t)},setNow:e.f.setNow,restoreNow:e.f.restoreNow};return _s})),r}()},799:(e,t)=>{"use strict";var r=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function n(e,t,o){var n=null;if(void 0!==o&&(n=""+o),void 0!==t.key&&(n=""+t.key),"key"in t)for(var i in o={},t)"key"!==i&&(o[i]=t[i]);else o=t;return t=o.ref,{$$typeof:r,type:e,key:n,ref:void 0!==t?t:null,props:o}}t.Fragment=o,t.jsx=n,t.jsxs=n},853:(e,t,r)=>{"use strict";e.exports=r(896)},896:(e,t)=>{"use strict";function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var o=r-1>>>1,n=e[o];if(!(0<i(n,t)))break e;e[o]=t,e[r]=n,r=o}}function o(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var o=0,n=e.length,a=n>>>1;o<a;){var s=2*(o+1)-1,l=e[s],c=s+1,u=e[c];if(0>i(l,r))c<n&&0>i(u,l)?(e[o]=u,e[c]=r,o=c):(e[o]=l,e[s]=r,o=s);else{if(!(c<n&&0>i(u,r)))break e;e[o]=u,e[c]=r,o=c}}}return t}function i(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,h=null,f=3,m=!1,p=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=o(u);null!==t;){if(null===t.callback)n(u);else{if(!(t.startTime<=e))break;n(u),t.sortIndex=t.expirationTime,r(c,t)}t=o(u)}}function b(e){if(g=!1,x(e),!p)if(null!==o(c))p=!0,M();else{var t=o(u);null!==t&&I(b,t.startTime-e)}}var L,A=!1,w=-1,S=5,E=-1;function T(){return!(t.unstable_now()-E<S)}function P(){if(A){var e=t.unstable_now();E=e;var r=!0;try{e:{p=!1,g&&(g=!1,y(w),w=-1),m=!0;var i=f;try{t:{for(x(e),h=o(c);null!==h&&!(h.expirationTime>e&&T());){var a=h.callback;if("function"===typeof a){h.callback=null,f=h.priorityLevel;var s=a(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof s){h.callback=s,x(e),r=!0;break t}h===o(c)&&n(c),x(e)}else n(c);h=o(c)}if(null!==h)r=!0;else{var l=o(u);null!==l&&I(b,l.startTime-e),r=!1}}break e}finally{h=null,f=i,m=!1}r=void 0}}finally{r?L():A=!1}}}if("function"===typeof v)L=function(){v(P)};else if("undefined"!==typeof MessageChannel){var C=new MessageChannel,R=C.port2;C.port1.onmessage=P,L=function(){R.postMessage(null)}}else L=function(){_(P,0)};function M(){A||(A=!0,L())}function I(e,r){w=_((function(){e(t.unstable_now())}),r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||m||(p=!0,M())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return o(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var r=f;f=t;try{return e()}finally{f=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=f;f=e;try{return t()}finally{f=r}},t.unstable_scheduleCallback=function(e,n,i){var a=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:n,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>a?(e.sortIndex=i,r(u,e),null===o(c)&&e===o(u)&&(g?(y(w),w=-1):g=!0,I(b,i-a))):(e.sortIndex=s,r(c,e),p||m||(p=!0,M())),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=f;return function(){var r=f;f=t;try{return e.apply(this,arguments)}finally{f=r}}}},950:(e,t,r)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(672)}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(o,n){if(1&n&&(o=this(o)),8&n)return o;if("object"===typeof o&&o){if(4&n&&o.__esModule)return o;if(16&n&&"function"===typeof o.then)return o}var i=Object.create(null);r.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&n&&o;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>o[e]));return a.default=()=>o,r.d(i,a),i}})(),r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,o)=>(r.f[o](e,t),t)),[])),r.u=e=>"static/js/"+e+".ea3a331e.chunk.js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="gid-finland:";r.l=(o,n,i,a)=>{if(e[o])e[o].push(n);else{var s,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==t+i){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",t+i),s.src=o),e[o]=[n];var h=(t,r)=>{s.onerror=s.onload=null,clearTimeout(f);var n=e[o];if(delete e[o],s.parentNode&&s.parentNode.removeChild(s),n&&n.forEach((e=>e(r))),t)return t(r)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/gid-finland/",(()=>{var e={792:0};r.f.j=(t,o)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var i=new Promise(((r,o)=>n=e[t]=[r,o]));o.push(n[2]=i);var a=r.p+r.u(t),s=new Error;r.l(a,(o=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,n[1](s)}}),"chunk-"+t,t)}};var t=(t,o)=>{var n,i,a=o[0],s=o[1],l=o[2],c=0;if(a.some((t=>0!==e[t]))){for(n in s)r.o(s,n)&&(r.m[n]=s[n]);if(l)l(r)}for(t&&t(o);c<a.length;c++)i=a[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0},o=self.webpackChunkgid_finland=self.webpackChunkgid_finland||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),r.nc=void 0,(()=>{"use strict";var e={};r.r(e),r.d(e,{hasBrowserEnv:()=>ir,hasStandardBrowserEnv:()=>sr,hasStandardBrowserWebWorkerEnv:()=>lr,navigator:()=>ar,origin:()=>cr});var t=r(43),o=r.t(t,2),n=r(391),i=r(684),a=r.n(i);const s=["top","right","bottom","left"],l=Math.min,c=Math.max,u=Math.round,d=Math.floor,h=e=>({x:e,y:e}),f={left:"right",right:"left",bottom:"top",top:"bottom"},m={start:"end",end:"start"};function p(e,t,r){return c(e,l(t,r))}function g(e,t){return"function"===typeof e?e(t):e}function _(e){return e.split("-")[0]}function y(e){return e.split("-")[1]}function v(e){return"x"===e?"y":"x"}function x(e){return"y"===e?"height":"width"}function b(e){return["top","bottom"].includes(_(e))?"y":"x"}function L(e){return v(b(e))}function A(e){return e.replace(/start|end/g,(e=>m[e]))}function w(e){return e.replace(/left|right|bottom|top/g,(e=>f[e]))}function S(e){return"number"!==typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function E(e){const{x:t,y:r,width:o,height:n}=e;return{width:o,height:n,top:r,left:t,right:t+o,bottom:r+n,x:t,y:r}}function T(e,t,r){let{reference:o,floating:n}=e;const i=b(t),a=L(t),s=x(a),l=_(t),c="y"===i,u=o.x+o.width/2-n.width/2,d=o.y+o.height/2-n.height/2,h=o[s]/2-n[s]/2;let f;switch(l){case"top":f={x:u,y:o.y-n.height};break;case"bottom":f={x:u,y:o.y+o.height};break;case"right":f={x:o.x+o.width,y:d};break;case"left":f={x:o.x-n.width,y:d};break;default:f={x:o.x,y:o.y}}switch(y(t)){case"start":f[a]-=h*(r&&c?-1:1);break;case"end":f[a]+=h*(r&&c?-1:1)}return f}async function P(e,t){var r;void 0===t&&(t={});const{x:o,y:n,platform:i,rects:a,elements:s,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=g(t,e),m=S(f),p=s[h?"floating"===d?"reference":"floating":d],_=E(await i.getClippingRect({element:null==(r=await(null==i.isElement?void 0:i.isElement(p)))||r?p:p.contextElement||await(null==i.getDocumentElement?void 0:i.getDocumentElement(s.floating)),boundary:c,rootBoundary:u,strategy:l})),y="floating"===d?{x:o,y:n,width:a.floating.width,height:a.floating.height}:a.reference,v=await(null==i.getOffsetParent?void 0:i.getOffsetParent(s.floating)),x=await(null==i.isElement?void 0:i.isElement(v))&&await(null==i.getScale?void 0:i.getScale(v))||{x:1,y:1},b=E(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:y,offsetParent:v,strategy:l}):y);return{top:(_.top-b.top+m.top)/x.y,bottom:(b.bottom-_.bottom+m.bottom)/x.y,left:(_.left-b.left+m.left)/x.x,right:(b.right-_.right+m.right)/x.x}}function C(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function R(e){return s.some((t=>e[t]>=0))}function M(){return"undefined"!==typeof window}function I(e){return k(e)?(e.nodeName||"").toLowerCase():"#document"}function O(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function D(e){var t;return null==(t=(k(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function k(e){return!!M()&&(e instanceof Node||e instanceof O(e).Node)}function N(e){return!!M()&&(e instanceof Element||e instanceof O(e).Element)}function B(e){return!!M()&&(e instanceof HTMLElement||e instanceof O(e).HTMLElement)}function F(e){return!(!M()||"undefined"===typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof O(e).ShadowRoot)}function z(e){const{overflow:t,overflowX:r,overflowY:o,display:n}=W(e);return/auto|scroll|overlay|hidden|clip/.test(t+o+r)&&!["inline","contents"].includes(n)}function U(e){return["table","td","th"].includes(I(e))}function V(e){return[":popover-open",":modal"].some((t=>{try{return e.matches(t)}catch(r){return!1}}))}function H(e){const t=G(),r=N(e)?W(e):e;return["transform","translate","scale","rotate","perspective"].some((e=>!!r[e]&&"none"!==r[e]))||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||["transform","translate","scale","rotate","perspective","filter"].some((e=>(r.willChange||"").includes(e)))||["paint","layout","strict","content"].some((e=>(r.contain||"").includes(e)))}function G(){return!("undefined"===typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function j(e){return["html","body","#document"].includes(I(e))}function W(e){return O(e).getComputedStyle(e)}function K(e){return N(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function J(e){if("html"===I(e))return e;const t=e.assignedSlot||e.parentNode||F(e)&&e.host||D(e);return F(t)?t.host:t}function Z(e){const t=J(e);return j(t)?e.ownerDocument?e.ownerDocument.body:e.body:B(t)&&z(t)?t:Z(t)}function Y(e,t,r){var o;void 0===t&&(t=[]),void 0===r&&(r=!0);const n=Z(e),i=n===(null==(o=e.ownerDocument)?void 0:o.body),a=O(n);if(i){const e=q(a);return t.concat(a,a.visualViewport||[],z(n)?n:[],e&&r?Y(e):[])}return t.concat(n,Y(n,[],r))}function q(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function $(e){const t=W(e);let r=parseFloat(t.width)||0,o=parseFloat(t.height)||0;const n=B(e),i=n?e.offsetWidth:r,a=n?e.offsetHeight:o,s=u(r)!==i||u(o)!==a;return s&&(r=i,o=a),{width:r,height:o,$:s}}function X(e){return N(e)?e:e.contextElement}function Q(e){const t=X(e);if(!B(t))return h(1);const r=t.getBoundingClientRect(),{width:o,height:n,$:i}=$(t);let a=(i?u(r.width):r.width)/o,s=(i?u(r.height):r.height)/n;return a&&Number.isFinite(a)||(a=1),s&&Number.isFinite(s)||(s=1),{x:a,y:s}}const ee=h(0);function te(e){const t=O(e);return G()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:ee}function re(e,t,r,o){void 0===t&&(t=!1),void 0===r&&(r=!1);const n=e.getBoundingClientRect(),i=X(e);let a=h(1);t&&(o?N(o)&&(a=Q(o)):a=Q(e));const s=function(e,t,r){return void 0===t&&(t=!1),!(!r||t&&r!==O(e))&&t}(i,r,o)?te(i):h(0);let l=(n.left+s.x)/a.x,c=(n.top+s.y)/a.y,u=n.width/a.x,d=n.height/a.y;if(i){const e=O(i),t=o&&N(o)?O(o):o;let r=e,n=q(r);for(;n&&o&&t!==r;){const e=Q(n),t=n.getBoundingClientRect(),o=W(n),i=t.left+(n.clientLeft+parseFloat(o.paddingLeft))*e.x,a=t.top+(n.clientTop+parseFloat(o.paddingTop))*e.y;l*=e.x,c*=e.y,u*=e.x,d*=e.y,l+=i,c+=a,r=O(n),n=q(r)}}return E({width:u,height:d,x:l,y:c})}function oe(e,t){const r=K(e).scrollLeft;return t?t.left+r:re(D(e)).left+r}function ne(e,t,r){void 0===r&&(r=!1);const o=e.getBoundingClientRect();return{x:o.left+t.scrollLeft-(r?0:oe(e,o)),y:o.top+t.scrollTop}}function ie(e,t,r){let o;if("viewport"===t)o=function(e,t){const r=O(e),o=D(e),n=r.visualViewport;let i=o.clientWidth,a=o.clientHeight,s=0,l=0;if(n){i=n.width,a=n.height;const e=G();(!e||e&&"fixed"===t)&&(s=n.offsetLeft,l=n.offsetTop)}return{width:i,height:a,x:s,y:l}}(e,r);else if("document"===t)o=function(e){const t=D(e),r=K(e),o=e.ownerDocument.body,n=c(t.scrollWidth,t.clientWidth,o.scrollWidth,o.clientWidth),i=c(t.scrollHeight,t.clientHeight,o.scrollHeight,o.clientHeight);let a=-r.scrollLeft+oe(e);const s=-r.scrollTop;return"rtl"===W(o).direction&&(a+=c(t.clientWidth,o.clientWidth)-n),{width:n,height:i,x:a,y:s}}(D(e));else if(N(t))o=function(e,t){const r=re(e,!0,"fixed"===t),o=r.top+e.clientTop,n=r.left+e.clientLeft,i=B(e)?Q(e):h(1);return{width:e.clientWidth*i.x,height:e.clientHeight*i.y,x:n*i.x,y:o*i.y}}(t,r);else{const r=te(e);o={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return E(o)}function ae(e,t){const r=J(e);return!(r===t||!N(r)||j(r))&&("fixed"===W(r).position||ae(r,t))}function se(e,t,r){const o=B(t),n=D(t),i="fixed"===r,a=re(e,!0,i,t);let s={scrollLeft:0,scrollTop:0};const l=h(0);if(o||!o&&!i)if(("body"!==I(t)||z(n))&&(s=K(t)),o){const e=re(t,!0,i,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else n&&(l.x=oe(n));const c=!n||o||i?h(0):ne(n,s);return{x:a.left+s.scrollLeft-l.x-c.x,y:a.top+s.scrollTop-l.y-c.y,width:a.width,height:a.height}}function le(e){return"static"===W(e).position}function ce(e,t){if(!B(e)||"fixed"===W(e).position)return null;if(t)return t(e);let r=e.offsetParent;return D(e)===r&&(r=r.ownerDocument.body),r}function ue(e,t){const r=O(e);if(V(e))return r;if(!B(e)){let t=J(e);for(;t&&!j(t);){if(N(t)&&!le(t))return t;t=J(t)}return r}let o=ce(e,t);for(;o&&U(o)&&le(o);)o=ce(o,t);return o&&j(o)&&le(o)&&!H(o)?r:o||function(e){let t=J(e);for(;B(t)&&!j(t);){if(H(t))return t;if(V(t))return null;t=J(t)}return null}(e)||r}const de={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:r,offsetParent:o,strategy:n}=e;const i="fixed"===n,a=D(o),s=!!t&&V(t.floating);if(o===a||s&&i)return r;let l={scrollLeft:0,scrollTop:0},c=h(1);const u=h(0),d=B(o);if((d||!d&&!i)&&(("body"!==I(o)||z(a))&&(l=K(o)),B(o))){const e=re(o);c=Q(o),u.x=e.x+o.clientLeft,u.y=e.y+o.clientTop}const f=!a||d||i?h(0):ne(a,l,!0);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:r.y*c.y-l.scrollTop*c.y+u.y+f.y}},getDocumentElement:D,getClippingRect:function(e){let{element:t,boundary:r,rootBoundary:o,strategy:n}=e;const i=[..."clippingAncestors"===r?V(t)?[]:function(e,t){const r=t.get(e);if(r)return r;let o=Y(e,[],!1).filter((e=>N(e)&&"body"!==I(e))),n=null;const i="fixed"===W(e).position;let a=i?J(e):e;for(;N(a)&&!j(a);){const t=W(a),r=H(a);r||"fixed"!==t.position||(n=null),(i?!r&&!n:!r&&"static"===t.position&&n&&["absolute","fixed"].includes(n.position)||z(a)&&!r&&ae(e,a))?o=o.filter((e=>e!==a)):n=t,a=J(a)}return t.set(e,o),o}(t,this._c):[].concat(r),o],a=i[0],s=i.reduce(((e,r)=>{const o=ie(t,r,n);return e.top=c(o.top,e.top),e.right=l(o.right,e.right),e.bottom=l(o.bottom,e.bottom),e.left=c(o.left,e.left),e}),ie(t,a,n));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}},getOffsetParent:ue,getElementRects:async function(e){const t=this.getOffsetParent||ue,r=this.getDimensions,o=await r(e.floating);return{reference:se(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:o.width,height:o.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:r}=$(e);return{width:t,height:r}},getScale:Q,isElement:N,isRTL:function(e){return"rtl"===W(e).direction}};function he(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function fe(e,t,r,o){void 0===o&&(o={});const{ancestorScroll:n=!0,ancestorResize:i=!0,elementResize:a="function"===typeof ResizeObserver,layoutShift:s="function"===typeof IntersectionObserver,animationFrame:u=!1}=o,h=X(e),f=n||i?[...h?Y(h):[],...Y(t)]:[];f.forEach((e=>{n&&e.addEventListener("scroll",r,{passive:!0}),i&&e.addEventListener("resize",r)}));const m=h&&s?function(e,t){let r,o=null;const n=D(e);function i(){var e;clearTimeout(r),null==(e=o)||e.disconnect(),o=null}return function a(s,u){void 0===s&&(s=!1),void 0===u&&(u=1),i();const h=e.getBoundingClientRect(),{left:f,top:m,width:p,height:g}=h;if(s||t(),!p||!g)return;const _={rootMargin:-d(m)+"px "+-d(n.clientWidth-(f+p))+"px "+-d(n.clientHeight-(m+g))+"px "+-d(f)+"px",threshold:c(0,l(1,u))||1};let y=!0;function v(t){const o=t[0].intersectionRatio;if(o!==u){if(!y)return a();o?a(!1,o):r=setTimeout((()=>{a(!1,1e-7)}),1e3)}1!==o||he(h,e.getBoundingClientRect())||a(),y=!1}try{o=new IntersectionObserver(v,{..._,root:n.ownerDocument})}catch(x){o=new IntersectionObserver(v,_)}o.observe(e)}(!0),i}(h,r):null;let p,g=-1,_=null;a&&(_=new ResizeObserver((e=>{let[o]=e;o&&o.target===h&&_&&(_.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame((()=>{var e;null==(e=_)||e.observe(t)}))),r()})),h&&!u&&_.observe(h),_.observe(t));let y=u?re(e):null;return u&&function t(){const o=re(e);y&&!he(y,o)&&r();y=o,p=requestAnimationFrame(t)}(),r(),()=>{var e;f.forEach((e=>{n&&e.removeEventListener("scroll",r),i&&e.removeEventListener("resize",r)})),null==m||m(),null==(e=_)||e.disconnect(),_=null,u&&cancelAnimationFrame(p)}}const me=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var r,o;const{x:n,y:i,placement:a,middlewareData:s}=t,l=await async function(e,t){const{placement:r,platform:o,elements:n}=e,i=await(null==o.isRTL?void 0:o.isRTL(n.floating)),a=_(r),s=y(r),l="y"===b(r),c=["left","top"].includes(a)?-1:1,u=i&&l?-1:1,d=g(t,e);let{mainAxis:h,crossAxis:f,alignmentAxis:m}="number"===typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return s&&"number"===typeof m&&(f="end"===s?-1*m:m),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}(t,e);return a===(null==(r=s.offset)?void 0:r.placement)&&null!=(o=s.arrow)&&o.alignmentOffset?{}:{x:n+l.x,y:i+l.y,data:{...l,placement:a}}}}},pe=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:o,placement:n}=t,{mainAxis:i=!0,crossAxis:a=!1,limiter:s={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=g(e,t),c={x:r,y:o},u=await P(t,l),d=b(_(n)),h=v(d);let f=c[h],m=c[d];if(i){const e="y"===h?"bottom":"right";f=p(f+u["y"===h?"top":"left"],f,f-u[e])}if(a){const e="y"===d?"bottom":"right";m=p(m+u["y"===d?"top":"left"],m,m-u[e])}const y=s.fn({...t,[h]:f,[d]:m});return{...y,data:{x:y.x-r,y:y.y-o,enabled:{[h]:i,[d]:a}}}}}},ge=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var r,o;const{placement:n,middlewareData:i,rects:a,initialPlacement:s,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:p=!0,...v}=g(e,t);if(null!=(r=i.arrow)&&r.alignmentOffset)return{};const S=_(n),E=b(s),T=_(s)===s,C=await(null==l.isRTL?void 0:l.isRTL(c.floating)),R=h||(T||!p?[w(s)]:function(e){const t=w(e);return[A(e),t,A(t)]}(s)),M="none"!==m;!h&&M&&R.push(...function(e,t,r,o){const n=y(e);let i=function(e,t,r){const o=["left","right"],n=["right","left"],i=["top","bottom"],a=["bottom","top"];switch(e){case"top":case"bottom":return r?t?n:o:t?o:n;case"left":case"right":return t?i:a;default:return[]}}(_(e),"start"===r,o);return n&&(i=i.map((e=>e+"-"+n)),t&&(i=i.concat(i.map(A)))),i}(s,p,m,C));const I=[s,...R],O=await P(t,v),D=[];let k=(null==(o=i.flip)?void 0:o.overflows)||[];if(u&&D.push(O[S]),d){const e=function(e,t,r){void 0===r&&(r=!1);const o=y(e),n=L(e),i=x(n);let a="x"===n?o===(r?"end":"start")?"right":"left":"start"===o?"bottom":"top";return t.reference[i]>t.floating[i]&&(a=w(a)),[a,w(a)]}(n,a,C);D.push(O[e[0]],O[e[1]])}if(k=[...k,{placement:n,overflows:D}],!D.every((e=>e<=0))){var N,B;const e=((null==(N=i.flip)?void 0:N.index)||0)+1,t=I[e];if(t)return{data:{index:e,overflows:k},reset:{placement:t}};let r=null==(B=k.filter((e=>e.overflows[0]<=0)).sort(((e,t)=>e.overflows[1]-t.overflows[1]))[0])?void 0:B.placement;if(!r)switch(f){case"bestFit":{var F;const e=null==(F=k.filter((e=>{if(M){const t=b(e.placement);return t===E||"y"===t}return!0})).map((e=>[e.placement,e.overflows.filter((e=>e>0)).reduce(((e,t)=>e+t),0)])).sort(((e,t)=>e[1]-t[1]))[0])?void 0:F[0];e&&(r=e);break}case"initialPlacement":r=s}if(n!==r)return{reset:{placement:r}}}return{}}}},_e=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var r,o;const{placement:n,rects:i,platform:a,elements:s}=t,{apply:u=()=>{},...d}=g(e,t),h=await P(t,d),f=_(n),m=y(n),p="y"===b(n),{width:v,height:x}=i.floating;let L,A;"top"===f||"bottom"===f?(L=f,A=m===(await(null==a.isRTL?void 0:a.isRTL(s.floating))?"start":"end")?"left":"right"):(A=f,L="end"===m?"top":"bottom");const w=x-h.top-h.bottom,S=v-h.left-h.right,E=l(x-h[L],w),T=l(v-h[A],S),C=!t.middlewareData.shift;let R=E,M=T;if(null!=(r=t.middlewareData.shift)&&r.enabled.x&&(M=S),null!=(o=t.middlewareData.shift)&&o.enabled.y&&(R=w),C&&!m){const e=c(h.left,0),t=c(h.right,0),r=c(h.top,0),o=c(h.bottom,0);p?M=v-2*(0!==e||0!==t?e+t:c(h.left,h.right)):R=x-2*(0!==r||0!==o?r+o:c(h.top,h.bottom))}await u({...t,availableWidth:M,availableHeight:R});const I=await a.getDimensions(s.floating);return v!==I.width||x!==I.height?{reset:{rects:!0}}:{}}}},ye=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:o="referenceHidden",...n}=g(e,t);switch(o){case"referenceHidden":{const e=C(await P(t,{...n,elementContext:"reference"}),r.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:R(e)}}}case"escaped":{const e=C(await P(t,{...n,altBoundary:!0}),r.floating);return{data:{escapedOffsets:e,escaped:R(e)}}}default:return{}}}}},ve=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:o,placement:n,rects:i,platform:a,elements:s,middlewareData:c}=t,{element:u,padding:d=0}=g(e,t)||{};if(null==u)return{};const h=S(d),f={x:r,y:o},m=L(n),_=x(m),v=await a.getDimensions(u),b="y"===m,A=b?"top":"left",w=b?"bottom":"right",E=b?"clientHeight":"clientWidth",T=i.reference[_]+i.reference[m]-f[m]-i.floating[_],P=f[m]-i.reference[m],C=await(null==a.getOffsetParent?void 0:a.getOffsetParent(u));let R=C?C[E]:0;R&&await(null==a.isElement?void 0:a.isElement(C))||(R=s.floating[E]||i.floating[_]);const M=T/2-P/2,I=R/2-v[_]/2-1,O=l(h[A],I),D=l(h[w],I),k=O,N=R-v[_]-D,B=R/2-v[_]/2+M,F=p(k,B,N),z=!c.arrow&&null!=y(n)&&B!==F&&i.reference[_]/2-(B<k?O:D)-v[_]/2<0,U=z?B<k?B-k:B-N:0;return{[m]:f[m]+U,data:{[m]:F,centerOffset:B-F-U,...z&&{alignmentOffset:U}},reset:z}}}),xe=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:r,y:o,placement:n,rects:i,middlewareData:a}=t,{offset:s=0,mainAxis:l=!0,crossAxis:c=!0}=g(e,t),u={x:r,y:o},d=b(n),h=v(d);let f=u[h],m=u[d];const p=g(s,t),y="number"===typeof p?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(l){const e="y"===h?"height":"width",t=i.reference[h]-i.floating[e]+y.mainAxis,r=i.reference[h]+i.reference[e]-y.mainAxis;f<t?f=t:f>r&&(f=r)}if(c){var x,L;const e="y"===h?"width":"height",t=["top","left"].includes(_(n)),r=i.reference[d]-i.floating[e]+(t&&(null==(x=a.offset)?void 0:x[d])||0)+(t?0:y.crossAxis),o=i.reference[d]+i.reference[e]+(t?0:(null==(L=a.offset)?void 0:L[d])||0)-(t?y.crossAxis:0);m<r?m=r:m>o&&(m=o)}return{[h]:f,[d]:m}}}},be=(e,t,r)=>{const o=new Map,n={platform:de,...r},i={...n.platform,_c:o};return(async(e,t,r)=>{const{placement:o="bottom",strategy:n="absolute",middleware:i=[],platform:a}=r,s=i.filter(Boolean),l=await(null==a.isRTL?void 0:a.isRTL(t));let c=await a.getElementRects({reference:e,floating:t,strategy:n}),{x:u,y:d}=T(c,o,l),h=o,f={},m=0;for(let p=0;p<s.length;p++){const{name:r,fn:i}=s[p],{x:g,y:_,data:y,reset:v}=await i({x:u,y:d,initialPlacement:o,placement:h,strategy:n,middlewareData:f,rects:c,platform:a,elements:{reference:e,floating:t}});u=null!=g?g:u,d=null!=_?_:d,f={...f,[r]:{...f[r],...y}},v&&m<=50&&(m++,"object"===typeof v&&(v.placement&&(h=v.placement),v.rects&&(c=!0===v.rects?await a.getElementRects({reference:e,floating:t,strategy:n}):v.rects),({x:u,y:d}=T(c,h,l))),p=-1)}return{x:u,y:d,placement:h,strategy:n,middlewareData:f}})(e,t,{...n,platform:i})};var Le=r(139);const Ae="react-tooltip-core-styles",we="react-tooltip-base-styles",Se={core:!1,base:!1};function Ee(e){let{css:t,id:r=we,type:o="base",ref:n}=e;var i,a;if(!t||"undefined"==typeof document||Se[o])return;if("core"===o&&"undefined"!=typeof process&&(null===(i=null===process||void 0===process?void 0:{NODE_ENV:"production",PUBLIC_URL:"/gid-finland",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===i?void 0:i.REACT_TOOLTIP_DISABLE_CORE_STYLES))return;if("base"!==o&&"undefined"!=typeof process&&(null===(a=null===process||void 0===process?void 0:{NODE_ENV:"production",PUBLIC_URL:"/gid-finland",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===a?void 0:a.REACT_TOOLTIP_DISABLE_BASE_STYLES))return;"core"===o&&(r=Ae),n||(n={});const{insertAt:s}=n;if(document.getElementById(r))return;const l=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.id=r,c.type="text/css","top"===s&&l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),c.styleSheet?c.styleSheet.cssText=t:c.appendChild(document.createTextNode(t)),Se[o]=!0}const Te=async e=>{let{elementReference:t=null,tooltipReference:r=null,tooltipArrowReference:o=null,place:n="top",offset:i=10,strategy:a="absolute",middlewares:s=[me(Number(i)),ge({fallbackAxisSideDirection:"start"}),pe({padding:5})],border:l}=e;if(!t)return{tooltipStyles:{},tooltipArrowStyles:{},place:n};if(null===r)return{tooltipStyles:{},tooltipArrowStyles:{},place:n};const c=s;return o?(c.push(ve({element:o,padding:5})),be(t,r,{placement:n,strategy:a,middleware:c}).then((e=>{let{x:t,y:r,placement:o,middlewareData:n}=e;var i,a;const s={left:`${t}px`,top:`${r}px`,border:l},{x:c,y:u}=null!==(i=n.arrow)&&void 0!==i?i:{x:0,y:0},d=null!==(a={top:"bottom",right:"left",bottom:"top",left:"right"}[o.split("-")[0]])&&void 0!==a?a:"bottom",h=l&&{borderBottom:l,borderRight:l};let f=0;if(l){const e=`${l}`.match(/(\d+)px/);f=(null==e?void 0:e[1])?Number(e[1]):1}return{tooltipStyles:s,tooltipArrowStyles:{left:null!=c?`${c}px`:"",top:null!=u?`${u}px`:"",right:"",bottom:"",...h,[d]:`-${4+f}px`},place:o}}))):be(t,r,{placement:"bottom",strategy:a,middleware:c}).then((e=>{let{x:t,y:r,placement:o}=e;return{tooltipStyles:{left:`${t}px`,top:`${r}px`},tooltipArrowStyles:{},place:o}}))},Pe=(e,t)=>!("CSS"in window&&"supports"in window.CSS)||window.CSS.supports(e,t),Ce=(e,t,r)=>{let o=null;const n=function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];const s=()=>{o=null,r||e.apply(this,i)};r&&!o&&(e.apply(this,i),o=setTimeout(s,t)),r||(o&&clearTimeout(o),o=setTimeout(s,t))};return n.cancel=()=>{o&&(clearTimeout(o),o=null)},n},Re=e=>null!==e&&!Array.isArray(e)&&"object"==typeof e,Me=(e,t)=>{if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t))return e.length===t.length&&e.every(((e,r)=>Me(e,t[r])));if(Array.isArray(e)!==Array.isArray(t))return!1;if(!Re(e)||!Re(t))return e===t;const r=Object.keys(e),o=Object.keys(t);return r.length===o.length&&r.every((r=>Me(e[r],t[r])))},Ie=e=>{if(!(e instanceof HTMLElement||e instanceof SVGElement))return!1;const t=getComputedStyle(e);return["overflow","overflow-x","overflow-y"].some((e=>{const r=t.getPropertyValue(e);return"auto"===r||"scroll"===r}))},Oe=e=>{if(!e)return null;let t=e.parentElement;for(;t;){if(Ie(t))return t;t=t.parentElement}return document.scrollingElement||document.documentElement},De="undefined"!=typeof window?t.useLayoutEffect:t.useEffect,ke=e=>{e.current&&(clearTimeout(e.current),e.current=null)},Ne="DEFAULT_TOOLTIP_ID",Be={anchorRefs:new Set,activeAnchor:{current:null},attach:()=>{},detach:()=>{},setActiveAnchor:()=>{}},Fe=(0,t.createContext)({getTooltipData:()=>Be});function ze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne;return(0,t.useContext)(Fe).getTooltipData(e)}var Ue={tooltip:"core-styles-module_tooltip__3vRRp",fixed:"core-styles-module_fixed__pcSol",arrow:"core-styles-module_arrow__cvMwQ",noArrow:"core-styles-module_noArrow__xock6",clickable:"core-styles-module_clickable__ZuTTB",show:"core-styles-module_show__Nt9eE",closing:"core-styles-module_closing__sGnxF"},Ve={tooltip:"styles-module_tooltip__mnnfp",arrow:"styles-module_arrow__K0L3T",dark:"styles-module_dark__xNqje",light:"styles-module_light__Z6W-X",success:"styles-module_success__A2AKt",warning:"styles-module_warning__SCK0X",error:"styles-module_error__JvumD",info:"styles-module_info__BWdHW"};const He=e=>{let{forwardRef:r,id:o,className:n,classNameArrow:i,variant:a="dark",anchorId:s,anchorSelect:l,place:c="top",offset:u=10,events:d=["hover"],openOnClick:h=!1,positionStrategy:f="absolute",middlewares:m,wrapper:p,delayShow:g=0,delayHide:_=0,float:y=!1,hidden:v=!1,noArrow:x=!1,clickable:b=!1,closeOnEsc:L=!1,closeOnScroll:A=!1,closeOnResize:w=!1,openEvents:S,closeEvents:E,globalCloseEvents:T,imperativeModeOnly:P,style:C,position:R,afterShow:M,afterHide:I,disableTooltip:O,content:D,contentWrapperRef:k,isOpen:N,defaultIsOpen:B=!1,setIsOpen:F,activeAnchor:z,setActiveAnchor:U,border:V,opacity:H,arrowColor:G,role:j="tooltip"}=e;var W;const K=(0,t.useRef)(null),J=(0,t.useRef)(null),Z=(0,t.useRef)(null),Y=(0,t.useRef)(null),q=(0,t.useRef)(null),[$,X]=(0,t.useState)({tooltipStyles:{},tooltipArrowStyles:{},place:c}),[Q,ee]=(0,t.useState)(!1),[te,re]=(0,t.useState)(!1),[oe,ne]=(0,t.useState)(null),ie=(0,t.useRef)(!1),ae=(0,t.useRef)(null),{anchorRefs:se,setActiveAnchor:le}=ze(o),ce=(0,t.useRef)(!1),[ue,de]=(0,t.useState)([]),he=(0,t.useRef)(!1),me=h||d.includes("click"),pe=me||(null==S?void 0:S.click)||(null==S?void 0:S.dblclick)||(null==S?void 0:S.mousedown),ge=S?{...S}:{mouseover:!0,focus:!0,mouseenter:!1,click:!1,dblclick:!1,mousedown:!1};!S&&me&&Object.assign(ge,{mouseenter:!1,focus:!1,mouseover:!1,click:!0});const _e=E?{...E}:{mouseout:!0,blur:!0,mouseleave:!1,click:!1,dblclick:!1,mouseup:!1};!E&&me&&Object.assign(_e,{mouseleave:!1,blur:!1,mouseout:!1});const ye=T?{...T}:{escape:L||!1,scroll:A||!1,resize:w||!1,clickOutsideAnchor:pe||!1};P&&(Object.assign(ge,{mouseenter:!1,focus:!1,click:!1,dblclick:!1,mousedown:!1}),Object.assign(_e,{mouseleave:!1,blur:!1,click:!1,dblclick:!1,mouseup:!1}),Object.assign(ye,{escape:!1,scroll:!1,resize:!1,clickOutsideAnchor:!1})),De((()=>(he.current=!0,()=>{he.current=!1})),[]);const ve=e=>{he.current&&(e&&re(!0),setTimeout((()=>{he.current&&(null==F||F(e),void 0===N&&ee(e))}),10))};(0,t.useEffect)((()=>{if(void 0===N)return()=>null;N&&re(!0);const e=setTimeout((()=>{ee(N)}),10);return()=>{clearTimeout(e)}}),[N]),(0,t.useEffect)((()=>{if(Q!==ie.current)if(ke(q),ie.current=Q,Q)null==M||M();else{const e=(()=>{const e=getComputedStyle(document.body).getPropertyValue("--rt-transition-show-delay").match(/^([\d.]+)(ms|s)$/);if(!e)return 0;const[,t,r]=e;return Number(t)*("ms"===r?1:1e3)})();q.current=setTimeout((()=>{re(!1),ne(null),null==I||I()}),e+25)}}),[Q]);const xe=e=>{X((t=>Me(t,e)?t:e))},be=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;ke(Z),te?ve(!0):Z.current=setTimeout((()=>{ve(!0)}),e)},Ae=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;ke(Y),Y.current=setTimeout((()=>{ce.current||ve(!1)}),e)},we=e=>{var t;if(!e)return;const r=null!==(t=e.currentTarget)&&void 0!==t?t:e.target;if(!(null==r?void 0:r.isConnected))return U(null),void le({current:null});g?be():ve(!0),U(r),le({current:r}),ke(Y)},Se=()=>{b?Ae(_||100):_?Ae():ve(!1),ke(Z)},Ee=e=>{let{x:t,y:r}=e;var o;const n={getBoundingClientRect:()=>({x:t,y:r,width:0,height:0,top:r,left:t,right:t,bottom:r})};Te({place:null!==(o=null==oe?void 0:oe.place)&&void 0!==o?o:c,offset:u,elementReference:n,tooltipReference:K.current,tooltipArrowReference:J.current,strategy:f,middlewares:m,border:V}).then((e=>{xe(e)}))},Pe=e=>{if(!e)return;const t=e,r={x:t.clientX,y:t.clientY};Ee(r),ae.current=r},Re=e=>{var t;if(!Q)return;const r=e.target;r.isConnected&&((null===(t=K.current)||void 0===t?void 0:t.contains(r))||[document.querySelector(`[id='${s}']`),...ue].some((e=>null==e?void 0:e.contains(r)))||(ve(!1),ke(Z)))},Ie=Ce(we,50,!0),Ne=Ce(Se,50,!0),Be=e=>{Ne.cancel(),Ie(e)},Fe=()=>{Ie.cancel(),Ne()},He=(0,t.useCallback)((()=>{var e,t;const r=null!==(e=null==oe?void 0:oe.position)&&void 0!==e?e:R;r?Ee(r):y?ae.current&&Ee(ae.current):(null==z?void 0:z.isConnected)&&Te({place:null!==(t=null==oe?void 0:oe.place)&&void 0!==t?t:c,offset:u,elementReference:z,tooltipReference:K.current,tooltipArrowReference:J.current,strategy:f,middlewares:m,border:V}).then((e=>{he.current&&xe(e)}))}),[Q,z,D,C,c,null==oe?void 0:oe.place,u,f,R,null==oe?void 0:oe.position,y]);(0,t.useEffect)((()=>{var e,t;const r=new Set(se);ue.forEach((e=>{(null==O?void 0:O(e))||r.add({current:e})}));const o=document.querySelector(`[id='${s}']`);o&&!(null==O?void 0:O(o))&&r.add({current:o});const n=()=>{ve(!1)},i=Oe(z),a=Oe(K.current);ye.scroll&&(window.addEventListener("scroll",n),null==i||i.addEventListener("scroll",n),null==a||a.addEventListener("scroll",n));let l=null;ye.resize?window.addEventListener("resize",n):z&&K.current&&(l=fe(z,K.current,He,{ancestorResize:!0,elementResize:!0,layoutShift:!0}));const c=e=>{"Escape"===e.key&&ve(!1)};ye.escape&&window.addEventListener("keydown",c),ye.clickOutsideAnchor&&window.addEventListener("click",Re);const u=[],d=e=>{Q&&(null==e?void 0:e.target)===z||we(e)},h=e=>{Q&&(null==e?void 0:e.target)===z&&Se()},f=["mouseover","mouseout","mouseenter","mouseleave","focus","blur"],m=["click","dblclick","mousedown","mouseup"];Object.entries(ge).forEach((e=>{let[t,r]=e;r&&(f.includes(t)?u.push({event:t,listener:Be}):m.includes(t)&&u.push({event:t,listener:d}))})),Object.entries(_e).forEach((e=>{let[t,r]=e;r&&(f.includes(t)?u.push({event:t,listener:Fe}):m.includes(t)&&u.push({event:t,listener:h}))})),y&&u.push({event:"pointermove",listener:Pe});const p=()=>{ce.current=!0},g=()=>{ce.current=!1,Se()};return b&&!pe&&(null===(e=K.current)||void 0===e||e.addEventListener("mouseenter",p),null===(t=K.current)||void 0===t||t.addEventListener("mouseleave",g)),u.forEach((e=>{let{event:t,listener:o}=e;r.forEach((e=>{var r;null===(r=e.current)||void 0===r||r.addEventListener(t,o)}))})),()=>{var e,t;ye.scroll&&(window.removeEventListener("scroll",n),null==i||i.removeEventListener("scroll",n),null==a||a.removeEventListener("scroll",n)),ye.resize?window.removeEventListener("resize",n):null==l||l(),ye.clickOutsideAnchor&&window.removeEventListener("click",Re),ye.escape&&window.removeEventListener("keydown",c),b&&!pe&&(null===(e=K.current)||void 0===e||e.removeEventListener("mouseenter",p),null===(t=K.current)||void 0===t||t.removeEventListener("mouseleave",g)),u.forEach((e=>{let{event:t,listener:o}=e;r.forEach((e=>{var r;null===(r=e.current)||void 0===r||r.removeEventListener(t,o)}))}))}}),[z,He,te,se,ue,S,E,T,me,g,_]),(0,t.useEffect)((()=>{var e,t;let r=null!==(t=null!==(e=null==oe?void 0:oe.anchorSelect)&&void 0!==e?e:l)&&void 0!==t?t:"";!r&&o&&(r=`[data-tooltip-id='${o.replace(/'/g,"\\'")}']`);const n=new MutationObserver((e=>{const t=[],n=[];e.forEach((e=>{if("attributes"===e.type&&"data-tooltip-id"===e.attributeName&&(e.target.getAttribute("data-tooltip-id")===o?t.push(e.target):e.oldValue===o&&n.push(e.target)),"childList"===e.type){if(z){const t=[...e.removedNodes].filter((e=>1===e.nodeType));if(r)try{n.push(...t.filter((e=>e.matches(r)))),n.push(...t.flatMap((e=>[...e.querySelectorAll(r)])))}catch(e){}t.some((e=>{var t;return!!(null===(t=null==e?void 0:e.contains)||void 0===t?void 0:t.call(e,z))&&(re(!1),ve(!1),U(null),ke(Z),ke(Y),!0)}))}if(r)try{const o=[...e.addedNodes].filter((e=>1===e.nodeType));t.push(...o.filter((e=>e.matches(r)))),t.push(...o.flatMap((e=>[...e.querySelectorAll(r)])))}catch(e){}}})),(t.length||n.length)&&de((e=>[...e.filter((e=>!n.includes(e))),...t]))}));return n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-tooltip-id"],attributeOldValue:!0}),()=>{n.disconnect()}}),[o,l,null==oe?void 0:oe.anchorSelect,z]),(0,t.useEffect)((()=>{He()}),[He]),(0,t.useEffect)((()=>{if(!(null==k?void 0:k.current))return()=>null;const e=new ResizeObserver((()=>{setTimeout((()=>He()))}));return e.observe(k.current),()=>{e.disconnect()}}),[D,null==k?void 0:k.current]),(0,t.useEffect)((()=>{var e;const t=document.querySelector(`[id='${s}']`),r=[...ue,t];z&&r.includes(z)||U(null!==(e=ue[0])&&void 0!==e?e:t)}),[s,ue,z]),(0,t.useEffect)((()=>(B&&ve(!0),()=>{ke(Z),ke(Y)})),[]),(0,t.useEffect)((()=>{var e;let t=null!==(e=null==oe?void 0:oe.anchorSelect)&&void 0!==e?e:l;if(!t&&o&&(t=`[data-tooltip-id='${o.replace(/'/g,"\\'")}']`),t)try{const e=Array.from(document.querySelectorAll(t));de(e)}catch(e){de([])}}),[o,l,null==oe?void 0:oe.anchorSelect]),(0,t.useEffect)((()=>{Z.current&&(ke(Z),be(g))}),[g]);const Ge=null!==(W=null==oe?void 0:oe.content)&&void 0!==W?W:D,je=Q&&Object.keys($.tooltipStyles).length>0;return(0,t.useImperativeHandle)(r,(()=>({open:e=>{if(null==e?void 0:e.anchorSelect)try{document.querySelector(e.anchorSelect)}catch(r){return void console.warn(`[react-tooltip] "${e.anchorSelect}" is not a valid CSS selector`)}ne(null!=e?e:null),(null==e?void 0:e.delay)?be(e.delay):ve(!0)},close:e=>{(null==e?void 0:e.delay)?Ae(e.delay):ve(!1)},activeAnchor:z,place:$.place,isOpen:Boolean(te&&!v&&Ge&&je)}))),te&&!v&&Ge?t.createElement(p,{id:o,role:j,className:Le("react-tooltip",Ue.tooltip,Ve.tooltip,Ve[a],n,`react-tooltip__place-${$.place}`,Ue[je?"show":"closing"],je?"react-tooltip__show":"react-tooltip__closing","fixed"===f&&Ue.fixed,b&&Ue.clickable),onTransitionEnd:e=>{ke(q),Q||"opacity"!==e.propertyName||(re(!1),ne(null),null==I||I())},style:{...C,...$.tooltipStyles,opacity:void 0!==H&&je?H:void 0},ref:K},Ge,t.createElement(p,{className:Le("react-tooltip-arrow",Ue.arrow,Ve.arrow,i,x&&Ue.noArrow),style:{...$.tooltipArrowStyles,background:G?`linear-gradient(to right bottom, transparent 50%, ${G} 50%)`:void 0},ref:J})):null},Ge=e=>{let{content:r}=e;return t.createElement("span",{dangerouslySetInnerHTML:{__html:r}})},je=t.forwardRef(((e,r)=>{let{id:o,anchorId:n,anchorSelect:i,content:a,html:s,render:l,className:c,classNameArrow:u,variant:d="dark",place:h="top",offset:f=10,wrapper:m="div",children:p=null,events:g=["hover"],openOnClick:_=!1,positionStrategy:y="absolute",middlewares:v,delayShow:x=0,delayHide:b=0,float:L=!1,hidden:A=!1,noArrow:w=!1,clickable:S=!1,closeOnEsc:E=!1,closeOnScroll:T=!1,closeOnResize:P=!1,openEvents:C,closeEvents:R,globalCloseEvents:M,imperativeModeOnly:I=!1,style:O,position:D,isOpen:k,defaultIsOpen:N=!1,disableStyleInjection:B=!1,border:F,opacity:z,arrowColor:U,setIsOpen:V,afterShow:H,afterHide:G,disableTooltip:j,role:W="tooltip"}=e;const[K,J]=(0,t.useState)(a),[Z,Y]=(0,t.useState)(s),[q,$]=(0,t.useState)(h),[X,Q]=(0,t.useState)(d),[ee,te]=(0,t.useState)(f),[re,oe]=(0,t.useState)(x),[ne,ie]=(0,t.useState)(b),[ae,se]=(0,t.useState)(L),[le,ce]=(0,t.useState)(A),[ue,de]=(0,t.useState)(m),[he,fe]=(0,t.useState)(g),[me,pe]=(0,t.useState)(y),[ge,_e]=(0,t.useState)(null),[ye,ve]=(0,t.useState)(null),xe=(0,t.useRef)(B),{anchorRefs:be,activeAnchor:Ae}=ze(o),we=e=>null==e?void 0:e.getAttributeNames().reduce(((t,r)=>{var o;return r.startsWith("data-tooltip-")&&(t[r.replace(/^data-tooltip-/,"")]=null!==(o=null==e?void 0:e.getAttribute(r))&&void 0!==o?o:null),t}),{}),Se=e=>{const t={place:e=>{var t;$(null!==(t=e)&&void 0!==t?t:h)},content:e=>{J(null!=e?e:a)},html:e=>{Y(null!=e?e:s)},variant:e=>{var t;Q(null!==(t=e)&&void 0!==t?t:d)},offset:e=>{te(null===e?f:Number(e))},wrapper:e=>{var t;de(null!==(t=e)&&void 0!==t?t:m)},events:e=>{const t=null==e?void 0:e.split(" ");fe(null!=t?t:g)},"position-strategy":e=>{var t;pe(null!==(t=e)&&void 0!==t?t:y)},"delay-show":e=>{oe(null===e?x:Number(e))},"delay-hide":e=>{ie(null===e?b:Number(e))},float:e=>{se(null===e?L:"true"===e)},hidden:e=>{ce(null===e?A:"true"===e)},"class-name":e=>{_e(e)}};Object.values(t).forEach((e=>e(null))),Object.entries(e).forEach((e=>{let[r,o]=e;var n;null===(n=t[r])||void 0===n||n.call(t,o)}))};(0,t.useEffect)((()=>{J(a)}),[a]),(0,t.useEffect)((()=>{Y(s)}),[s]),(0,t.useEffect)((()=>{$(h)}),[h]),(0,t.useEffect)((()=>{Q(d)}),[d]),(0,t.useEffect)((()=>{te(f)}),[f]),(0,t.useEffect)((()=>{oe(x)}),[x]),(0,t.useEffect)((()=>{ie(b)}),[b]),(0,t.useEffect)((()=>{se(L)}),[L]),(0,t.useEffect)((()=>{ce(A)}),[A]),(0,t.useEffect)((()=>{pe(y)}),[y]),(0,t.useEffect)((()=>{xe.current!==B&&console.warn("[react-tooltip] Do not change `disableStyleInjection` dynamically.")}),[B]),(0,t.useEffect)((()=>{"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("react-tooltip-inject-styles",{detail:{disableCore:"core"===B,disableBase:B}}))}),[]),(0,t.useEffect)((()=>{var e;const t=new Set(be);let r=i;if(!r&&o&&(r=`[data-tooltip-id='${o.replace(/'/g,"\\'")}']`),r)try{document.querySelectorAll(r).forEach((e=>{t.add({current:e})}))}catch(e){console.warn(`[react-tooltip] "${r}" is not a valid CSS selector`)}const a=document.querySelector(`[id='${n}']`);if(a&&t.add({current:a}),!t.size)return()=>null;const s=null!==(e=null!=ye?ye:a)&&void 0!==e?e:Ae.current,l=new MutationObserver((e=>{e.forEach((e=>{var t;if(!s||"attributes"!==e.type||!(null===(t=e.attributeName)||void 0===t?void 0:t.startsWith("data-tooltip-")))return;const r=we(s);Se(r)}))})),c={attributes:!0,childList:!1,subtree:!1};if(s){const e=we(s);Se(e),l.observe(s,c)}return()=>{l.disconnect()}}),[be,Ae,ye,n,i]),(0,t.useEffect)((()=>{(null==O?void 0:O.border)&&console.warn("[react-tooltip] Do not set `style.border`. Use `border` prop instead."),F&&!Pe("border",`${F}`)&&console.warn(`[react-tooltip] "${F}" is not a valid \`border\`.`),(null==O?void 0:O.opacity)&&console.warn("[react-tooltip] Do not set `style.opacity`. Use `opacity` prop instead."),z&&!Pe("opacity",`${z}`)&&console.warn(`[react-tooltip] "${z}" is not a valid \`opacity\`.`)}),[]);let Ee=p;const Te=(0,t.useRef)(null);if(l){const e=l({content:(null==ye?void 0:ye.getAttribute("data-tooltip-content"))||K||null,activeAnchor:ye});Ee=e?t.createElement("div",{ref:Te,className:"react-tooltip-content-wrapper"},e):null}else K&&(Ee=K);Z&&(Ee=t.createElement(Ge,{content:Z}));const Ce={forwardRef:r,id:o,anchorId:n,anchorSelect:i,className:Le(c,ge),classNameArrow:u,content:Ee,contentWrapperRef:Te,place:q,variant:X,offset:ee,wrapper:ue,events:he,openOnClick:_,positionStrategy:me,middlewares:v,delayShow:re,delayHide:ne,float:ae,hidden:le,noArrow:w,clickable:S,closeOnEsc:E,closeOnScroll:T,closeOnResize:P,openEvents:C,closeEvents:R,globalCloseEvents:M,imperativeModeOnly:I,style:O,position:D,isOpen:k,defaultIsOpen:N,border:F,opacity:z,arrowColor:U,setIsOpen:V,afterShow:H,afterHide:G,disableTooltip:j,activeAnchor:ye,setActiveAnchor:e=>ve(e),role:W};return t.createElement(He,{...Ce})}));"undefined"!=typeof window&&window.addEventListener("react-tooltip-inject-styles",(e=>{e.detail.disableCore||Ee({css:":root{--rt-color-white:#fff;--rt-color-dark:#222;--rt-color-success:#8dc572;--rt-color-error:#be6464;--rt-color-warning:#f0ad4e;--rt-color-info:#337ab7;--rt-opacity:0.9;--rt-transition-show-delay:0.15s;--rt-transition-closing-delay:0.15s}.core-styles-module_tooltip__3vRRp{position:absolute;top:0;left:0;pointer-events:none;opacity:0;will-change:opacity}.core-styles-module_fixed__pcSol{position:fixed}.core-styles-module_arrow__cvMwQ{position:absolute;background:inherit}.core-styles-module_noArrow__xock6{display:none}.core-styles-module_clickable__ZuTTB{pointer-events:auto}.core-styles-module_show__Nt9eE{opacity:var(--rt-opacity);transition:opacity var(--rt-transition-show-delay)ease-out}.core-styles-module_closing__sGnxF{opacity:0;transition:opacity var(--rt-transition-closing-delay)ease-in}",type:"core"}),e.detail.disableBase||Ee({css:"\n.styles-module_tooltip__mnnfp{padding:8px 16px;border-radius:3px;font-size:90%;width:max-content}.styles-module_arrow__K0L3T{width:8px;height:8px}[class*='react-tooltip__place-top']>.styles-module_arrow__K0L3T{transform:rotate(45deg)}[class*='react-tooltip__place-right']>.styles-module_arrow__K0L3T{transform:rotate(135deg)}[class*='react-tooltip__place-bottom']>.styles-module_arrow__K0L3T{transform:rotate(225deg)}[class*='react-tooltip__place-left']>.styles-module_arrow__K0L3T{transform:rotate(315deg)}.styles-module_dark__xNqje{background:var(--rt-color-dark);color:var(--rt-color-white)}.styles-module_light__Z6W-X{background-color:var(--rt-color-white);color:var(--rt-color-dark)}.styles-module_success__A2AKt{background-color:var(--rt-color-success);color:var(--rt-color-white)}.styles-module_warning__SCK0X{background-color:var(--rt-color-warning);color:var(--rt-color-white)}.styles-module_error__JvumD{background-color:var(--rt-color-error);color:var(--rt-color-white)}.styles-module_info__BWdHW{background-color:var(--rt-color-info);color:var(--rt-color-white)}",type:"base"})}));var We=r(579);const Ke=["001-2025_2025_01_23"],Je=e=>{let{map:r,openWindows:o,setOpenWindows:n}=e;const[i,a]=(0,t.useState)(!1),s=(0,t.useRef)(null),l=(0,t.useRef)(!1);return(0,t.useEffect)((()=>{if(!r)return;s.current&&r.off("click","aerodromes2-3rc6jk",s.current);const e=async e=>{if(!l.current){l.current=!0;try{const t=r.queryRenderedFeatures(e.point,{layers:["aerodromes2-3rc6jk"]});if(!t.length)return;const i=t[0].properties,s=i.Name||"Unknown",l=i.ICAO||"";if(o.some((e=>e.title===s)))return;const c=`aerodrome-${s}-${Date.now()}`,u=i.Service||"No service information",d=!0===i.Controlled;let h=(0,We.jsxs)("div",{className:"p-2",children:[(0,We.jsx)("h3",{className:"font-bold text-lg mb-2",children:s}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"ICAO:"})," ",l||"N/A"]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"Service:"})," ",u]}),!d&&(0,We.jsxs)("p",{className:"mt-2",children:["Uncontrolled airfield. Check"," ",(0,We.jsxs)("a",{href:`https://lentopaikat.fi/${l||s}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:["lentopaikat.fi/",l||s]})]})]});if(n((e=>[...e,{id:c,title:s,content:h}])),d&&l){n((e=>e.map((e=>e.id===c?{...e,content:(0,We.jsxs)("div",{className:"p-2",children:[(0,We.jsx)("h3",{className:"font-bold text-lg mb-2",children:s}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"ICAO:"})," ",l||"N/A"]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"Service:"})," ",u]}),(0,We.jsx)("div",{className:"mt-4",children:(0,We.jsx)("h4",{className:"font-bold mb-2",children:"Loading charts..."})})]})}:e))));const{charts:e,success:t}=await(async(e,t)=>{a(!0);let r=[],o=!1;const n=t.toUpperCase().replace(/\s+/g,"-");for(const a of Ke)try{const t=`https://www.ais.fi/eaip/${a}/eAIP/EF-AD%202%20${e}%20-%20${n}%201-fi-FI.html`,i=await fetch(t);if(i.ok){const e=await i.json(),t=(new DOMParser).parseFromString(e.contents,"text/html").querySelectorAll("table.IndSubTable.AD_2_table");let n=null;if(t.forEach((e=>{e.innerHTML.includes("CHARTS_TABLE")&&(n=e)})),n){n.querySelectorAll("tbody tr").forEach((e=>{const t=e.querySelectorAll("td");if(t.length>=2){const e=t[0].textContent.trim(),o=t[1].querySelector("a.ulink");o&&r.push({name:e,url:o.getAttribute("href")})}})),o=!0;break}}}catch(i){console.error(`Error fetching charts for ${e} with date ${a}:`,i)}return a(!1),{charts:r,success:o}})(l,s);n((r=>r.map((r=>r.id===c?{...r,content:(0,We.jsxs)("div",{className:"p-2",children:[(0,We.jsx)("h3",{className:"font-bold text-lg mb-2",children:s}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"ICAO:"})," ",l||"N/A"]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("span",{className:"font-semibold",children:"Service:"})," ",u]}),t&&e.length>0?(0,We.jsxs)("div",{className:"mt-4",children:[(0,We.jsx)("h4",{className:"font-bold mb-2",children:"Available Charts:"}),(0,We.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,We.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,We.jsx)("thead",{className:"bg-gray-50",children:(0,We.jsxs)("tr",{children:[(0,We.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Chart"}),(0,We.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Link"})]})}),(0,We.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(((e,t)=>(0,We.jsxs)("tr",{children:[(0,We.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:e.name}),(0,We.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-gray-900",children:(0,We.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"View PDF"})})]},`${c}-chart-${t}`)))})]})})]}):(0,We.jsxs)("div",{className:"mt-4 text-red-500",children:["Could not load charts. Try visiting the AIP directly:",(0,We.jsxs)("a",{href:`https://www.ais.fi/eaip/${Ke[0]}/eAIP/EF-AD%202%20${l}%20-%20${s.toUpperCase().replace(/\s+/g,"-")}%201-fi-FI.html`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline block",children:["AIP Finland - ",s]})]})]})}:r))))}}finally{l.current=!1}}};return s.current=e,r.on("click","aerodromes2-3rc6jk",e),r.on("mouseenter","aerodromes2-3rc6jk",(()=>{r.getCanvas().style.cursor="pointer"})),r.on("mouseleave","aerodromes2-3rc6jk",(()=>{r.getCanvas().style.cursor=""})),()=>{s.current&&r.off("click","aerodromes2-3rc6jk",s.current),r.off("mouseenter","aerodromes2-3rc6jk"),r.off("mouseleave","aerodromes2-3rc6jk")}}),[r,o,n]),null};const Ze=r.p+"static/media/traffic.32dcd390020ab6201bbafd866edc5246.svg",Ye=e=>{let{map:r,traffic:o,openWindows:n,setOpenWindows:i}=e;const[a,s]=(0,t.useState)("true"===localStorage.getItem("trafficVisible")),l=(0,t.useRef)(!1),c=(0,t.useRef)(!1),u=(0,t.useCallback)((e=>({type:"FeatureCollection",features:e.map((e=>({type:"Feature",properties:{callsign:e.callsign,heading:e.heading||0,frul:e.flight_plan.flight_rules,atyp:e.flight_plan.aircraft,dep:e.flight_plan.departure,arr:e.flight_plan.arrival,altn:e.flight_plan.alternate,rfl:e.flight_plan.altitude,tas:e.flight_plan.cruise_tas,eobt:e.flight_plan.deptime,eet:e.flight_plan.enroute_time,route:e.flight_plan.route,rmk:e.flight_plan.remarks,pic:e.name,gs:e.groundspeed,ssr:e.transponder,hdg:e.heading,alt:e.altitude},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}})))})),[]),d=(0,t.useCallback)((e=>{const{callsign:t,frul:r="//",atyp:o="//",dep:n="//",arr:i="//",altn:a="",rfl:s="//",tas:l="//",eobt:c="//",eet:u="//",route:d="//",rmk:h="//",pic:f="//",gs:m="//",ssr:p="//",hdg:g="//",alt:_="//"}=e,y="//"!==s?Math.floor(Number(s)/100):"//";return(0,We.jsxs)("div",{className:"p-2 monospace-font text-sm overflow-y-auto mb-6",style:{userSelect:"text"},children:[(0,We.jsx)("h3",{className:"small-title",children:"FLIGHT PLAN"}),"(FPL-",t,"-",r,"S ",(0,We.jsx)("br",{}),"-",o," ",(0,We.jsx)("br",{}),"-",(0,We.jsx)("b",{className:"highlight",children:n}),c," ",(0,We.jsx)("br",{}),"-N0",l,"F",y," ",d," ",(0,We.jsx)("br",{}),"-",(0,We.jsx)("b",{className:"highlight",children:i}),u," ",a,(0,We.jsx)("br",{}),"-",h,")",(0,We.jsxs)("p",{style:{marginTop:"6px"},children:["PIC: ",f]}),(0,We.jsx)("h3",{className:"small-title",children:"SPATIAL"}),"-Groundspeed: ",m," kt ",(0,We.jsx)("br",{}),"-Altitude: ",_," ft ",(0,We.jsx)("br",{}),"-Track: ",g,"\xb0 ",(0,We.jsx)("br",{}),"-SSR-code: ",p," ",(0,We.jsx)("br",{}),"-Source: ADS-B"]})}),[]),h=(0,t.useCallback)((e=>{const t=e.features[0].properties.callsign,r=e.features[0].properties;console.log("Traffic clicked"),i((e=>{const o=e.findIndex((e=>e.title===t));if(-1!==o){const t=[...e];return t[o]={...t[o],content:d(r)},t}return[...e,{id:`traffic-window-${t}-${Date.now()}`,title:t,content:d(r)}]}))}),[i,d]),f=(0,t.useCallback)((()=>{if(!r||!o||!Array.isArray(o))return;const e=u(o);r.getSource("traffic")?r.getSource("traffic").setData(e):(r.addSource("traffic",{type:"geojson",data:e}),r.addLayer({id:"traffic-layer",type:"symbol",source:"traffic",layout:{"icon-image":"tfcIcon","icon-size":.3,"icon-rotate":["get","heading"],"icon-allow-overlap":!0,"text-field":["get","callsign"],"text-size":10,"text-offset":[1,0],"text-anchor":"left","text-allow-overlap":!0,"text-font":["Open Sans Bold"],visibility:a?"visible":"none"},paint:{"text-color":"black","text-halo-color":"white","text-halo-width":1}}),r.on("mouseenter","traffic-layer",(()=>{r.getCanvas().style.cursor="pointer"})),r.on("mouseleave","traffic-layer",(()=>{r.getCanvas().style.cursor="default"})),r.on("click","traffic-layer",h)),l.current=!0}),[r,o,a,u,h]),m=(0,t.useCallback)((()=>{r.hasImage("tfcIcon")?(c.current=!0,f()):r.loadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABWCAYAAABsMdCsAAAACXBIWXMAAAsSAAALEgHS3X78AAAOMklEQVR4nO2ca4xdVRXHf/fOuY/pvKmlBQptgaJTHlMNOG2CtoG0oEFphIZoFJtqjI8PjBK/9vFFPzUtMWrUpNTEGIyvNtEiYkIxGqlfOsW0BRGYhlYEBaYzbefOPWfu9cM+65519t3nvmbuLVZWsnPunHvOfvzvWmuv/V97T6pcLvOeJEv6Unfg3S7vAVRHvEvdAZFUKpXSf5ffJbafulT9sAGpJ5cKsI4DZAGTsq62lK1rx4HqKEAKnBRxcPTfImXiAFX+7iRIHfNBDnDSjs9aBJAScYDKqVSqYyB1BCALnLS6doVXDZZIKaFInR0BqZOzmIAipStsv4sIKAFJNGcuLEF4TYVXMJqUajdIbQco1B5d0mG7HpAJiwAlcVmZCJggvO+H9wQ8AbKtcik0qIsImByQVX+LFpUwwPhAUd0vEvmiFLTf1NoKkKU92qwEnG4gH34WTeoFpjDgzIb3xDe5HHdbpVNLDe13Mhit6QYWYQDpBz6YTvO7jMevgAfCe33hM93hOy6f1XTQ2WzH2yIJ07oAlMNoTgWgdJrdi7rJrVlNLpvhq8CNGIB6MACJOXrEHXrbwIH2a5AehMu8ejAgPFwqsfg7u0kf2ANFn6zn8Y3wu14iU7QdelvBgc6YmJ7enQB5XXx8ZBi2PQhr18DOMQgCbgTWkKxBrthpwaVTGmQ76CyRid0dzJEd+0L00rYHKx8/RtwHZYh8UCx8aJcfagtAjtgnyQd1ZzPcPtAXA4WVy2HDKORzDOOe6S5LE9MaVDGzcpkbtmyufmnjeijM0gtcTaQ9GpzLzsQ0SNmwXOUHZNbeXP3ixnWVj1fiBshmBNoi7QQoaZrXmrQEjGO2Rd27iTg4NkCXhQa5tEgG7ZTB/spHmf1c4LRdFhwgx2ziWsXrkigDfQAMEQfH9j8VTW3HTNYuDXLNYi6garYfmtkgycD8b/kgx/IiycS0RtStljhANcFaaC1akNW8BYxcbVBsBlFKI5IEkBThh1KERBosDHc9b4AStMblazzHvUY1yH7PLiX1vOau5804zgughBW7a7ayizCKjQJkM5BSfCJuqELFEgE2b5BaBshBxOuiB5RNKKJRdZuy6smFpUgEijwX46wJwZsPSPM1MRscGbT8wrIo7VZF1lW5BttPqXqkriKGkhXqVfoREIE0R+SfOqtBNYh4DYz82po57AnLIiJ+p56kicDtIdKcMtUTQFH1CaJMSMvcddMAOUzLpjFEO7Tm9BBRqwLUovD5epImAlgyG9K+ngBmiK/wNRgtm1qrJubiebQZCIeziEhrejEM4QARlZpvoK10+G5A5HxtjRWeqFaGtqU0UVMANZClyBMHZBRYC5wGXscAo8uyem2m0/SWSlxJNTgDYd1F4DfAG6pvZUcBKIkBNKpJDQOUAI5NgGlNuQ/4sqriIAakXuCabJbRYpGekWFDkLlkyz3w7FFyGY+7/IBTwPNhe8uBz8lzGY91fsCjVKeHbICgSXOrG4ekQqEx+lRI+IHuPPcO9MEzT8CKa6CvhzuBpcCdwF35HD17d8D4k8kAjW2HY4dhzWq6gFuyWT4JrAJuBfPdyDD4Ae8nMt1eoknAxUJWliiNLEtqApTgkF1mFQMHGJwpsHLbVkN8rVwOfkBfPsd9wKoNo3D8SQNAPVm7xoC4cwzyOXqBTcD18t2WeyqPDhIHScj+PDUIN6UAzQGUEAjqxJ/OTAg4/QIQxDgdCrPklr6P7K9/CEd+lqw1SbJrzIC6YRTCdmwZohokmSw0SE3xSk4fVAMcTZfamVEBZhAYzOeYGT9BN8C2reaXbkRjasnK5QbcffvhwM+rvh7E7XOS6JEg/FwKx+x03LWctEtzdE7LBkcDdK3qTCxjsRAytt1Z5whw3Op/rQJxkJyOu8rEGtxw4DIpUfGPZDy2FmbJb9va5MibEDHfLZvNJABsymR4CBM6DBE3OQlQxXlrn1TT1GIAWc6qkQ0HAswQsNLz+Dywfs1quo4dNp1vt4gTf2Q7+D7Xel18BbhD9WuIeHAqWVodXCbObLFNnJb2aJ+TIz5TiebIr/SJjMeoH+DtHDMO9VLIkedg26Nw+ix4HmeDgCeACWAyLFNhuQBcxCxPikRLmBImhqyAkgSQHQRqs9ImdXM2y2eLRRaPDMOBPe4UTidlcso48d37IOPh+wF/AH4LvEME1DRwHgNSgYgdKAElJ0BKtVzrK4mQRWuGgE8Dm/v7YPfX5z9DLbSMnzTadPwUZDxO+wE/AF7CAHWOSJNmMBu1ZLtfGaVFtpNuZK21OJvl28DmZgK+TosOMP2AFRmPXcCHqBM42vUkBYq1lhV3F4ss27ujtYBPZPykMYWND8Gufe7v5bsjz7XWBhh/eOwwXL2UbDbDfSSD45R6cZBridELzWvN+Ekz0CN/Mddz09F3G9dXPz85Bc8eNWV3eG/DqHl2y+bmfN3aNeaHnL7A0NuTMbI/KT6qiAugRgKsujJxxgBx8Kk4IF4XQTDHvzDO8iLw4TpVvYSZZfqPjrPk2aPkdu8zWdeN6wxgG9e1PDnUHVejdIeE7zIVVokAIhpy+qy5n/EIUinOAmeA14M5JokvcuvJ2+G7hcIss+F7y85Nc81Tf+S6Q0+b5UyDgOkxJNEhMXEBZL8oO95l3/IcGBPQGiKAAGQzvAK8CrzqB/yTKLEnoYPMjAH1ZQYz68iMUwT+DlCYJYXZP3T9uWlWHH6GFYeeNjz3QJ8xRQFMjU2mdA1UotTSIBc4Mh0ydFv0YHeeMxhTeAX4R9GvTJmSXRCC3SMKOmVKrScXMQBNE8Utvnr3P8BJwPMDPAyZdv1MgRt+eohVP/5llBi4YpASUdwjP7atUTFJAigJHA8o5rKcmS1yNATl5ZlCZTa0jxDoxruI4ioZYJde9WtRM9drIThT4VW0SMh7nYfzgLeAvxV9CNu+Crgx43H79HlK4ftVwaELHBdAtmnJkYAikdf/3myRx4mzdSnioApIUodkR0V7pO1cd56Lk1PVACmZxJiXgHSBSJOFjHelt2U8bwB/9QMeD4HRAOnzH05/VAGoXC5L0l8GmlYDlXyTaIhP9WrYBkg79HT4vAAhfkjOXtSSWTWwC5glwgxR2lnqt3P+uk/63IfU5/JFVQf2GjExPQ1qjdL7lfU78p5Ot3RhtEfa7A47HARz7llRiWtwsjyQdjRIenUu/dJmL5rjWwA5+5E0iwkYWrRP0iZnZxJshyfaI2amHXd5+jxFV8es/sggRXsFLBkgqi/2ssF+X/tHpwZpiQGkzEwq1iBpn2T/SvK87pCOwiVHLtJM8OkasPxYmqaw644NTfW/pN6pmuptRrFKg0KQ9C2pwN6oVGtwAg7qaq/tZH1XnDhTXcH4CcjnuFiYjc1QetuMNnsNkgxQZ1JdsV1VsNgwJ61A0rsnpGKb/LavGhwdHOq8vZQs8M7ps6yy+zA5Bd15ZgqzVe9J0sD2IS7zdl2dScWkJGJioGjNalJ5I8BoTdHAuLbB5Km9R0jv7FhE5JxjDGCDhaRrrQxrzbWYvKhMTkCyr7WoWtcmBr0FJjEGunCRLqJlSYG4Y3YFd9r/Ja23Ev2NSxraRFkOxeqErtylNfrAnGxWkFOEvcAVIT9zU7gfOiYrl0PRpz9rMhWrrXr6qE4Ouo5L2f2taEyjmxea2gacUKnWHHtXmd7MIOD0AR/1uvhi0Wf5I9th4s/VlR7YA3t3QD7PAPApzGaIJWE9/cTBttM5iSxhs/uDWvrXFIrcT6JldQZEygCwwvP4TBCwfGQY9u2MrbSdMjlluOVDT0M2w/mizyHgOaK1mRDwOlMxS3W2ogQdAMgi9/VGJsmbdWN+VcmdifY8gNl4QCupoYO/N0Cdm4ZshheLPj8C3iQOlAuk2IK0UwDZ2mPnzgScfuAOz+NLQcDAhlFjOq3y2JNThqN+bD94XRSDOQ5i9h1Jvus81ekcCQcuCUASuLk2UF0FbAPuGeiDXQmpockpox2aibx/k9nsIFtnbNEJwozHS37AHuBlIpCEXBPuyJnzakjK5XJThbhD7sZoyRLgOmAYk/a9P5flNaB8/ybK7zxPuTwRlVf/RHnvDvMd4eyS8fCzGU4DL2S8Cl9UHhmmvHOM8rHD8TrKE+Y+0ez0TWA9cAtmk9VSTIJTNotW1o7NjLcpDarhf+xZ62vAw888ETnh8ZNw4BdGU46fMvfyOS4UZnkFeBF4wWpuGTDSneeGmQJXgNmkIJolef+JM7DqTgB+AnyfuC9y0RpNOeqF/NcUVfGGzECas85meROz1/BEYZYzVNMjEuj9GzgRspWLgVvffIuRx/Zz3WP7I5Je7TBzLTXmLQulQXoG6wHuBb4l72UzPF/0OYXZv/MW8RW5ixdOqTbsw3Q9wG3ATRmP2/2gwjMdAL6LeyaLEXjNaFCrTtq160wfFVgEbMaAd4o4f2SDExDXIogHn3axybsPYPzfQcy0L6allyYtO+mFmubtRalcdWRrM3x2sddWriNV+giVAG2zjZpSraJVO7XTXjqotUEOkqDuSSbE5ohd5qUBcqW9k+hU0RABKpFrbkVaBUivmFOoQyNEIAS4Nwe4WD3tYCEOkDZnF5MpbQnDGGAFh6pfTUvTADl4Ivu0nwzatWDUQGgKNIkhsEHS9aWIa7HWZKdmduS0j5J6ALnA0c+UqdYcF0AuMj4pWeAq8zKxlv/RZI0TzvZAtNjElUtzYs0ktJFUrw16jANqZnyVDsznzGuN0872fahDe9Zqps7VrquKPZzPmdV5/6tSa9ts0mcRF0XacFNN1N0UrVqz0fkCVKmohQP9TUW0TdY/X2Aq7S4UQFUVa6a/TY10pI12AXS5SFOk/f+j/Be3pFmAXSYyBwAAAABJRU5ErkJggg==",((e,t)=>{e?console.error("Error loading traffic icon:",e):(r.addImage("tfcIcon",t),c.current=!0,f())}))}),[r,f]),p=(0,t.useCallback)((()=>{if(r&&r.getLayer("traffic-layer")&&(r.setLayoutProperty("traffic-layer","visibility",a?"visible":"none"),a&&o)){const e=u(o);r.getSource("traffic")&&r.getSource("traffic").setData(e)}}),[r,a,o,u]),g=(0,t.useCallback)((()=>{const e=!a;s(e),localStorage.setItem("trafficVisible",e.toString())}),[a]);return(0,t.useEffect)((()=>{if(!r)return;const e=()=>{m()};return r.isStyleLoaded()?e():r.on("load",e),r.on("click","traffic-layer",h),()=>{r.off("load",e),r.off("click","traffic-layer",h)}}),[r,m,h]),(0,t.useEffect)((()=>{if(r&&c.current)return l.current?(p(),r.on("click","traffic-layer",h)):f(),()=>{r.off("click","traffic-layer",h)}}),[r,o,a,f,p,h]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Traffic from/to Finland",className:`w-8 h-8 ${a?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:g,children:(0,We.jsx)("img",{className:"w-5",src:Ze,alt:"Traffic"})})},qe=e=>{let{map:r,openWindows:o,setOpenWindows:n}=e;const[i,a]=(0,t.useState)(!0),[s,l]=(0,t.useState)(null);(0,t.useEffect)((()=>{if(!r)return;const e=async()=>{try{const e=await fetch("https://flyk.com/api/supplements.geojson");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json();l(t),c(r,t)}catch(e){console.error("Failed fetching Supplements:",e)}};e();const t=setInterval(e,3e5);return()=>clearInterval(t)}),[r]);const c=(e,t)=>{e.getSource("supplements")?e.getSource("supplements").setData(t):e.addSource("supplements",{type:"geojson",data:t}),e.getLayer("supplements-layer")||(e.addLayer({id:"supplements-layer",type:"line",source:"supplements",filter:["==","active",!0],paint:{"line-color":["case",["==",["get","airspaceclass"],"TEMPO R"],"red",["==",["get","airspaceclass"],"TEMPO D"],"darkorange","blue"],"line-width":2}}),e.setLayoutProperty("supplements-layer","visibility",i?"visible":"none")),e.getLayer("supplements-labels")||(e.addLayer({id:"supplements-labels",type:"symbol",source:"supplements",filter:["all",["==","active",!0]],layout:{"icon-image":["case",["==",["slice",["get","name"],0,6],"EFINOB"],"observation-tower",""],"text-field":["case",["==",["slice",["get","name"],0,6],"EFINOB"],"",["get","name"]],"text-size":9,"text-font":["Open Sans Bold"],"text-allow-overlap":!0,"icon-allow-overlap":!0,"icon-size":1},paint:{"text-color":"darkred","text-halo-color":"white","text-halo-width":1},minzoom:5}),e.on("mouseenter","supplements-labels",(()=>{e.getCanvas().style.cursor="pointer"})),e.on("mouseleave","supplements-labels",(()=>{e.getCanvas().style.cursor="default"})),e.off("click","supplements-labels"),e.on("click","supplements-labels",(e=>{const t=e.features[0].properties,r=t.name||"Supplement",o=t.notams?JSON.parse(t.notams):[],i=o.length>0?o[0].text:null,a=t.lower,s=t.upper,l=(0,We.jsxs)("div",{className:"p-2 monospace-font text-sm overflow-y-auto mb-6",style:{userSelect:"text"},children:[(0,We.jsx)("h3",{className:"small-title",children:"Supplement Details"}),(0,We.jsx)("p",{className:"highlight",children:r}),a&&s&&(0,We.jsxs)("p",{className:"highlight",children:[a," - ",s]}),i&&(0,We.jsxs)("div",{children:[(0,We.jsx)("h4",{className:"small-title",children:"NOTAM"}),(0,We.jsx)("p",{children:i})]})]});n((e=>{const t=e.findIndex((e=>e.title===r));if(-1!==t){const o=[...e];return o[t]={id:o[t].id,title:r,content:l},o}return[...e,{id:`supplement-window-${r}-${Date.now()}`,title:r,content:l}]}))})),e.setLayoutProperty("supplements-labels","visibility",i?"visible":"none"))};return(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Supplements (R/D areas)",className:`w-8 h-8 ${i?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{if(!r)return;const e=i?"none":"visible";r.setLayoutProperty("supplements-layer","visibility",e),r.setLayoutProperty("supplements-labels","visibility",e),a(!i)},children:(0,We.jsx)("span",{role:"img","aria-label":"Supplements",className:"text-sm",children:"R/D"})})},$e=e=>{let{map:r}=e;const[o,n]=(0,t.useState)(!1);return(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Not yet functional",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{n(!o)},children:(0,We.jsx)("span",{role:"img","aria-label":"ATC",className:"text-sm",children:"ATC"})})};const Xe=r.p+"static/media/radar.4bd01779a7a9ae3e6d4de4b11c12bcc1.svg",Qe=e=>{let{map:r}=e;const[o,n]=(0,t.useState)("true"===localStorage.getItem("radarVisible")),i=(0,t.useRef)(null);(0,t.useEffect)((()=>{if(!r)return;const e="radar-source",t="radar-layer",n=()=>{r.getSource(e)||r.addSource(e,{type:"raster",tiles:["https://openwms.fmi.fi/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=Radar:suomi_rr_eureffin&styles=&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG:3857&format=image/png&transparent=true"],tileSize:256}),r.getLayer(t)||r.addLayer({id:t,type:"raster",source:e,paint:{"raster-opacity":.3}});const o=()=>{const t=`https://openwms.fmi.fi/geoserver/wms?service=WMS&version=1.1.0&request=GetMap&layers=Radar:suomi_rr_eureffin&styles=&bbox={bbox-epsg-3857}&width=256&height=256&srs=EPSG:3857&format=image/png&transparent=true&_uniqueTime=${(new Date).getTime()}`;r.getSource(e).setTiles([t]),console.log("Radar layer updated")};o(),i.current=setInterval(o,3e5)};return r.isStyleLoaded()?o?n():(r.getLayer(t)&&r.removeLayer(t),r.getSource(e)&&r.removeSource(e),i.current&&clearInterval(i.current)):r.on("load",(()=>{o&&n()})),()=>{r.getLayer(t)&&r.removeLayer(t),r.getSource(e)&&r.removeSource(e),i.current&&clearInterval(i.current)}}),[r,o]);return(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Weather Radar overlay",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!o;n(e),localStorage.setItem("radarVisible",e.toString())},children:(0,We.jsx)("img",{className:"w-6",src:Xe,alt:"Radar"})})};const et=r.p+"static/media/wind.d8f7d82e8aa047c18544f0433ea2120b.svg",tt=e=>{let{map:r}=e;const[o,n]=(0,t.useState)("true"===localStorage.getItem("windVisible")),[i,a]=(0,t.useState)(null),s=(0,t.useRef)(null),l=async()=>{console.log("Loading Wind Data");try{const e=await fetch("https://flyk.com/api/metars.geojson");if(!e.ok)throw new Error("Failed to fetch wind data");const t=await e.json(),r={...t,features:t.features.filter((e=>null!==e.properties.windDirection&&null!==e.properties.wind))};a(r)}catch(e){console.error("Error fetching wind data:",e)}},c=()=>{r&&(r.getLayer("wind-layer")&&r.removeLayer("wind-layer"),r.getSource("wind")&&r.removeSource("wind"))};(0,t.useEffect)((()=>{if(r)return o?(l(),s.current=setInterval(l,36e4)):(c(),s.current&&clearInterval(s.current)),()=>{c(),s.current&&clearInterval(s.current)}}),[r,o]),(0,t.useEffect)((()=>{r&&o&&i&&r&&i&&r.loadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAiCAYAAACnSgJKAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAH6ADAAQAAAABAAAAIgAAAAApNqnBAAABgklEQVRYCe2WPUsDQRCGE7+CjSAKQYRUKhaijYU/QOytbSxTCHa2gtgKksJOUlj6A6xsYqetWAkBG0GIjUoEP5+BOxjCnTd3zJ3NDbzc7Ozs+87OZTdXrdhsgbQdMA9GB5b8MH4DV+AE9IGbLcH0CkQkCR1yhoCbncGUJKrnN6zKliqXrWRB3oo13yJes5IFeeZ8i3hKbXt6KW7vlWNm2XbHZtqpyrbbe+WY+a9tHwk2Uuc5GbOpsZh4XHiaicWIyW9iD+Bdzx0w0H+Jefo9tFa1+EuB4rKx01Bc3rm0okjrarF1Bh8gz3aH3NfojGtx8bfAFwiT8njewS8/xkhrEs1DVDi7YDZSVQX38L0LeIRzTmn86R46FvAMV9oP0ErLoQD51l8Dqa3KijbI+grkFpNTlNmGWXkO0hbwyZrNzKpqodzrF8BagNzf28DN5FLoAEsBu26qimgC/yahgH2V7+5OwXgbU8Cxu1oE4Qyx+4EC2ozldBRiDVQuwRM4AnIqMtkvR/MpGEdFkDgAAAAASUVORK5CYII=",((e,t)=>{e?console.error("Error loading arrow icon:",e):(r.hasImage("arrow-icon")||r.addImage("arrow-icon",t),r.getSource("wind")?r.getSource("wind").setData(i):r.addSource("wind",{type:"geojson",data:i}),r.getLayer("wind-layer")||r.addLayer({id:"wind-layer",type:"symbol",source:"wind",layout:{"icon-image":"arrow-icon","icon-size":.4,"icon-rotate":["coalesce",["get","windDirection"],0],"icon-allow-overlap":!0,"text-field":["format",["to-string",["round",["coalesce",["get","wind"],0]]]," kt"],"text-size":10,"text-offset":[1,0],"text-anchor":"left","text-allow-overlap":!0,"text-font":["Open Sans Bold"]},paint:{"text-color":"black","text-halo-color":"white","text-halo-width":2},minzoom:5}))}))}),[r,o,i]);return(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Surface Wind",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!o;n(e),localStorage.setItem("windVisible",e.toString())},children:(0,We.jsx)("img",{className:"w-6",src:et,alt:"Wind"})})};const rt=r.p+"static/media/vlara-logo.b4c2c23040d0ec5aad7adb44a534284a.svg";function ot(e,t){return function(){return e.apply(t,arguments)}}const{toString:nt}=Object.prototype,{getPrototypeOf:it}=Object,at=(st=Object.create(null),e=>{const t=nt.call(e);return st[t]||(st[t]=t.slice(8,-1).toLowerCase())});var st;const lt=e=>(e=e.toLowerCase(),t=>at(t)===e),ct=e=>t=>typeof t===e,{isArray:ut}=Array,dt=ct("undefined");const ht=lt("ArrayBuffer");const ft=ct("string"),mt=ct("function"),pt=ct("number"),gt=e=>null!==e&&"object"===typeof e,_t=e=>{if("object"!==at(e))return!1;const t=it(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},yt=lt("Date"),vt=lt("File"),xt=lt("Blob"),bt=lt("FileList"),Lt=lt("URLSearchParams"),[At,wt,St,Et]=["ReadableStream","Request","Response","Headers"].map(lt);function Tt(e,t){let r,o,{allOwnKeys:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),ut(e))for(r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else{const o=n?Object.getOwnPropertyNames(e):Object.keys(e),i=o.length;let a;for(r=0;r<i;r++)a=o[r],t.call(null,e[a],a,e)}}function Pt(e,t){t=t.toLowerCase();const r=Object.keys(e);let o,n=r.length;for(;n-- >0;)if(o=r[n],t===o.toLowerCase())return o;return null}const Ct="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:global,Rt=e=>!dt(e)&&e!==Ct;const Mt=(It="undefined"!==typeof Uint8Array&&it(Uint8Array),e=>It&&e instanceof It);var It;const Ot=lt("HTMLFormElement"),Dt=(e=>{let{hasOwnProperty:t}=e;return(e,r)=>t.call(e,r)})(Object.prototype),kt=lt("RegExp"),Nt=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),o={};Tt(r,((r,n)=>{let i;!1!==(i=t(r,n,e))&&(o[n]=i||r)})),Object.defineProperties(e,o)};const Bt=lt("AsyncFunction"),Ft=((e,t)=>{return e?setImmediate:t?(r=`axios@${Math.random()}`,o=[],Ct.addEventListener("message",(e=>{let{source:t,data:n}=e;t===Ct&&n===r&&o.length&&o.shift()()}),!1),e=>{o.push(e),Ct.postMessage(r,"*")}):e=>setTimeout(e);var r,o})("function"===typeof setImmediate,mt(Ct.postMessage)),zt="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Ct):"undefined"!==typeof process&&process.nextTick||Ft,Ut={isArray:ut,isArrayBuffer:ht,isBuffer:function(e){return null!==e&&!dt(e)&&null!==e.constructor&&!dt(e.constructor)&&mt(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||mt(e.append)&&("formdata"===(t=at(e))||"object"===t&&mt(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ht(e.buffer),t},isString:ft,isNumber:pt,isBoolean:e=>!0===e||!1===e,isObject:gt,isPlainObject:_t,isReadableStream:At,isRequest:wt,isResponse:St,isHeaders:Et,isUndefined:dt,isDate:yt,isFile:vt,isBlob:xt,isRegExp:kt,isFunction:mt,isStream:e=>gt(e)&&mt(e.pipe),isURLSearchParams:Lt,isTypedArray:Mt,isFileList:bt,forEach:Tt,merge:function e(){const{caseless:t}=Rt(this)&&this||{},r={},o=(o,n)=>{const i=t&&Pt(r,n)||n;_t(r[i])&&_t(o)?r[i]=e(r[i],o):_t(o)?r[i]=e({},o):ut(o)?r[i]=o.slice():r[i]=o};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&Tt(arguments[n],o);return r},extend:function(e,t,r){let{allOwnKeys:o}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Tt(t,((t,o)=>{r&&mt(t)?e[o]=ot(t,r):e[o]=t}),{allOwnKeys:o}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,o)=>{let n,i,a;const s={};if(t=t||{},null==e)return t;do{for(n=Object.getOwnPropertyNames(e),i=n.length;i-- >0;)a=n[i],o&&!o(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==r&&it(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:at,kindOfTest:lt,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const o=e.indexOf(t,r);return-1!==o&&o===r},toArray:e=>{if(!e)return null;if(ut(e))return e;let t=e.length;if(!pt(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=r.next())&&!o.done;){const r=o.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const o=[];for(;null!==(r=e.exec(t));)o.push(r);return o},isHTMLForm:Ot,hasOwnProperty:Dt,hasOwnProp:Dt,reduceDescriptors:Nt,freezeMethods:e=>{Nt(e,((t,r)=>{if(mt(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const o=e[r];mt(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))}))},toObjectSet:(e,t)=>{const r={},o=e=>{e.forEach((e=>{r[e]=!0}))};return ut(e)?o(e):o(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,r){return t.toUpperCase()+r})),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Pt,global:Ct,isContextDefined:Rt,isSpecCompliantForm:function(e){return!!(e&&mt(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),r=(e,o)=>{if(gt(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[o]=e;const n=ut(e)?[]:{};return Tt(e,((e,t)=>{const i=r(e,o+1);!dt(i)&&(n[t]=i)})),t[o]=void 0,n}}return e};return r(e,0)},isAsyncFn:Bt,isThenable:e=>e&&(gt(e)||mt(e))&&mt(e.then)&&mt(e.catch),setImmediate:Ft,asap:zt};function Vt(e,t,r,o,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),o&&(this.request=o),n&&(this.response=n,this.status=n.status?n.status:null)}Ut.inherits(Vt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ut.toJSONObject(this.config),code:this.code,status:this.status}}});const Ht=Vt.prototype,Gt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Gt[e]={value:e}})),Object.defineProperties(Vt,Gt),Object.defineProperty(Ht,"isAxiosError",{value:!0}),Vt.from=(e,t,r,o,n,i)=>{const a=Object.create(Ht);return Ut.toFlatObject(e,a,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Vt.call(a,e.message,t,r,o,n),a.cause=e,a.name=e.name,i&&Object.assign(a,i),a};const jt=Vt;function Wt(e){return Ut.isPlainObject(e)||Ut.isArray(e)}function Kt(e){return Ut.endsWith(e,"[]")?e.slice(0,-2):e}function Jt(e,t,r){return e?e.concat(t).map((function(e,t){return e=Kt(e),!r&&t?"["+e+"]":e})).join(r?".":""):t}const Zt=Ut.toFlatObject(Ut,{},null,(function(e){return/^is[A-Z]/.test(e)}));const Yt=function(e,t,r){if(!Ut.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const o=(r=Ut.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Ut.isUndefined(t[e])}))).metaTokens,n=r.visitor||c,i=r.dots,a=r.indexes,s=(r.Blob||"undefined"!==typeof Blob&&Blob)&&Ut.isSpecCompliantForm(t);if(!Ut.isFunction(n))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(Ut.isDate(e))return e.toISOString();if(!s&&Ut.isBlob(e))throw new jt("Blob is not supported. Use a Buffer instead.");return Ut.isArrayBuffer(e)||Ut.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,n){let s=e;if(e&&!n&&"object"===typeof e)if(Ut.endsWith(r,"{}"))r=o?r:r.slice(0,-2),e=JSON.stringify(e);else if(Ut.isArray(e)&&function(e){return Ut.isArray(e)&&!e.some(Wt)}(e)||(Ut.isFileList(e)||Ut.endsWith(r,"[]"))&&(s=Ut.toArray(e)))return r=Kt(r),s.forEach((function(e,o){!Ut.isUndefined(e)&&null!==e&&t.append(!0===a?Jt([r],o,i):null===a?r:r+"[]",l(e))})),!1;return!!Wt(e)||(t.append(Jt(n,r,i),l(e)),!1)}const u=[],d=Object.assign(Zt,{defaultVisitor:c,convertValue:l,isVisitable:Wt});if(!Ut.isObject(e))throw new TypeError("data must be an object");return function e(r,o){if(!Ut.isUndefined(r)){if(-1!==u.indexOf(r))throw Error("Circular reference detected in "+o.join("."));u.push(r),Ut.forEach(r,(function(r,i){!0===(!(Ut.isUndefined(r)||null===r)&&n.call(t,r,Ut.isString(i)?i.trim():i,o,d))&&e(r,o?o.concat(i):[i])})),u.pop()}}(e),t};function qt(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function $t(e,t){this._pairs=[],e&&Yt(e,this,t)}const Xt=$t.prototype;Xt.append=function(e,t){this._pairs.push([e,t])},Xt.toString=function(e){const t=e?function(t){return e.call(this,t,qt)}:qt;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};const Qt=$t;function er(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tr(e,t,r){if(!t)return e;const o=r&&r.encode||er;Ut.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let i;if(i=n?n(t,r):Ut.isURLSearchParams(t)?t.toString():new Qt(t,r).toString(o),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}const rr=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ut.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},or={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},nr={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:Qt,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ir="undefined"!==typeof window&&"undefined"!==typeof document,ar="object"===typeof navigator&&navigator||void 0,sr=ir&&(!ar||["ReactNative","NativeScript","NS"].indexOf(ar.product)<0),lr="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,cr=ir&&window.location.href||"http://localhost",ur={...e,...nr};const dr=function(e){function t(e,r,o,n){let i=e[n++];if("__proto__"===i)return!0;const a=Number.isFinite(+i),s=n>=e.length;if(i=!i&&Ut.isArray(o)?o.length:i,s)return Ut.hasOwnProp(o,i)?o[i]=[o[i],r]:o[i]=r,!a;o[i]&&Ut.isObject(o[i])||(o[i]=[]);return t(e,r,o[i],n)&&Ut.isArray(o[i])&&(o[i]=function(e){const t={},r=Object.keys(e);let o;const n=r.length;let i;for(o=0;o<n;o++)i=r[o],t[i]=e[i];return t}(o[i])),!a}if(Ut.isFormData(e)&&Ut.isFunction(e.entries)){const r={};return Ut.forEachEntry(e,((e,o)=>{t(function(e){return Ut.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),o,r,0)})),r}return null};const hr={transitional:or,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",o=r.indexOf("application/json")>-1,n=Ut.isObject(e);n&&Ut.isHTMLForm(e)&&(e=new FormData(e));if(Ut.isFormData(e))return o?JSON.stringify(dr(e)):e;if(Ut.isArrayBuffer(e)||Ut.isBuffer(e)||Ut.isStream(e)||Ut.isFile(e)||Ut.isBlob(e)||Ut.isReadableStream(e))return e;if(Ut.isArrayBufferView(e))return e.buffer;if(Ut.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(n){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Yt(e,new ur.classes.URLSearchParams,Object.assign({visitor:function(e,t,r,o){return ur.isNode&&Ut.isBuffer(e)?(this.append(t,e.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=Ut.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Yt(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return n||o?(t.setContentType("application/json",!1),function(e,t,r){if(Ut.isString(e))try{return(t||JSON.parse)(e),Ut.trim(e)}catch(o){if("SyntaxError"!==o.name)throw o}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||hr.transitional,r=t&&t.forcedJSONParsing,o="json"===this.responseType;if(Ut.isResponse(e)||Ut.isReadableStream(e))return e;if(e&&Ut.isString(e)&&(r&&!this.responseType||o)){const r=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(n){if(r){if("SyntaxError"===n.name)throw jt.from(n,jt.ERR_BAD_RESPONSE,this,null,this.response);throw n}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ur.classes.FormData,Blob:ur.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ut.forEach(["delete","get","head","post","put","patch"],(e=>{hr.headers[e]={}}));const fr=hr,mr=Ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pr=Symbol("internals");function gr(e){return e&&String(e).trim().toLowerCase()}function _r(e){return!1===e||null==e?e:Ut.isArray(e)?e.map(_r):String(e)}function yr(e,t,r,o,n){return Ut.isFunction(o)?o.call(this,t,r):(n&&(t=r),Ut.isString(t)?Ut.isString(o)?-1!==t.indexOf(o):Ut.isRegExp(o)?o.test(t):void 0:void 0)}class vr{constructor(e){e&&this.set(e)}set(e,t,r){const o=this;function n(e,t,r){const n=gr(t);if(!n)throw new Error("header name must be a non-empty string");const i=Ut.findKey(o,n);(!i||void 0===o[i]||!0===r||void 0===r&&!1!==o[i])&&(o[i||t]=_r(e))}const i=(e,t)=>Ut.forEach(e,((e,r)=>n(e,r,t)));if(Ut.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(Ut.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))i((e=>{const t={};let r,o,n;return e&&e.split("\n").forEach((function(e){n=e.indexOf(":"),r=e.substring(0,n).trim().toLowerCase(),o=e.substring(n+1).trim(),!r||t[r]&&mr[r]||("set-cookie"===r?t[r]?t[r].push(o):t[r]=[o]:t[r]=t[r]?t[r]+", "+o:o)})),t})(e),t);else if(Ut.isHeaders(e))for(const[a,s]of e.entries())n(s,a,r);else null!=e&&n(t,e,r);return this}get(e,t){if(e=gr(e)){const r=Ut.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=r.exec(e);)t[o[1]]=o[2];return t}(e);if(Ut.isFunction(t))return t.call(this,e,r);if(Ut.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=gr(e)){const r=Ut.findKey(this,e);return!(!r||void 0===this[r]||t&&!yr(0,this[r],r,t))}return!1}delete(e,t){const r=this;let o=!1;function n(e){if(e=gr(e)){const n=Ut.findKey(r,e);!n||t&&!yr(0,r[n],n,t)||(delete r[n],o=!0)}}return Ut.isArray(e)?e.forEach(n):n(e),o}clear(e){const t=Object.keys(this);let r=t.length,o=!1;for(;r--;){const n=t[r];e&&!yr(0,this[n],n,e,!0)||(delete this[n],o=!0)}return o}normalize(e){const t=this,r={};return Ut.forEach(this,((o,n)=>{const i=Ut.findKey(r,n);if(i)return t[i]=_r(o),void delete t[n];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,r)=>t.toUpperCase()+r))}(n):String(n).trim();a!==n&&delete t[n],t[a]=_r(o),r[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Ut.forEach(this,((r,o)=>{null!=r&&!1!==r&&(t[o]=e&&Ut.isArray(r)?r.join(", "):r)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,r]=e;return t+": "+r})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var r=arguments.length,o=new Array(r>1?r-1:0),n=1;n<r;n++)o[n-1]=arguments[n];return o.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[pr]=this[pr]={accessors:{}}).accessors,r=this.prototype;function o(e){const o=gr(e);t[o]||(!function(e,t){const r=Ut.toCamelCase(" "+t);["get","set","has"].forEach((o=>{Object.defineProperty(e,o+r,{value:function(e,r,n){return this[o].call(this,t,e,r,n)},configurable:!0})}))}(r,e),t[o]=!0)}return Ut.isArray(e)?e.forEach(o):o(e),this}}vr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ut.reduceDescriptors(vr.prototype,((e,t)=>{let{value:r}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(e){this[o]=e}}})),Ut.freezeMethods(vr);const xr=vr;function br(e,t){const r=this||fr,o=t||r,n=xr.from(o.headers);let i=o.data;return Ut.forEach(e,(function(e){i=e.call(r,i,n.normalize(),t?t.status:void 0)})),n.normalize(),i}function Lr(e){return!(!e||!e.__CANCEL__)}function Ar(e,t,r){jt.call(this,null==e?"canceled":e,jt.ERR_CANCELED,t,r),this.name="CanceledError"}Ut.inherits(Ar,jt,{__CANCEL__:!0});const wr=Ar;function Sr(e,t,r){const o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(new jt("Request failed with status code "+r.status,[jt.ERR_BAD_REQUEST,jt.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}const Er=function(e,t){e=e||10;const r=new Array(e),o=new Array(e);let n,i=0,a=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=o[a];n||(n=l),r[i]=s,o[i]=l;let u=a,d=0;for(;u!==i;)d+=r[u++],u%=e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),l-n<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}};const Tr=function(e,t){let r,o,n=0,i=1e3/t;const a=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();n=i,r=null,o&&(clearTimeout(o),o=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-n;for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];t>=i?a(l,e):(r=l,o||(o=setTimeout((()=>{o=null,a(r)}),i-t)))},()=>r&&a(r)]},Pr=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=0;const n=Er(50,250);return Tr((r=>{const i=r.loaded,a=r.lengthComputable?r.total:void 0,s=i-o,l=n(s);o=i;e({loaded:i,total:a,progress:a?i/a:void 0,bytes:s,rate:l||void 0,estimated:l&&a&&i<=a?(a-i)/l:void 0,event:r,lengthComputable:null!=a,[t?"download":"upload"]:!0})}),r)},Cr=(e,t)=>{const r=null!=e;return[o=>t[0]({lengthComputable:r,total:e,loaded:o}),t[1]]},Rr=e=>function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];return Ut.asap((()=>e(...r)))},Mr=ur.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,ur.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(ur.origin),ur.navigator&&/(msie|trident)/i.test(ur.navigator.userAgent)):()=>!0,Ir=ur.hasStandardBrowserEnv?{write(e,t,r,o,n,i){const a=[e+"="+encodeURIComponent(t)];Ut.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),Ut.isString(o)&&a.push("path="+o),Ut.isString(n)&&a.push("domain="+n),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Or(e,t,r){let o=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(o||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Dr=e=>e instanceof xr?{...e}:e;function kr(e,t){t=t||{};const r={};function o(e,t,r,o){return Ut.isPlainObject(e)&&Ut.isPlainObject(t)?Ut.merge.call({caseless:o},e,t):Ut.isPlainObject(t)?Ut.merge({},t):Ut.isArray(t)?t.slice():t}function n(e,t,r,n){return Ut.isUndefined(t)?Ut.isUndefined(e)?void 0:o(void 0,e,0,n):o(e,t,0,n)}function i(e,t){if(!Ut.isUndefined(t))return o(void 0,t)}function a(e,t){return Ut.isUndefined(t)?Ut.isUndefined(e)?void 0:o(void 0,e):o(void 0,t)}function s(r,n,i){return i in t?o(r,n):i in e?o(void 0,r):void 0}const l={url:i,method:i,data:i,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,r)=>n(Dr(e),Dr(t),0,!0)};return Ut.forEach(Object.keys(Object.assign({},e,t)),(function(o){const i=l[o]||n,a=i(e[o],t[o],o);Ut.isUndefined(a)&&i!==s||(r[o]=a)})),r}const Nr=e=>{const t=kr({},e);let r,{data:o,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:a,headers:s,auth:l}=t;if(t.headers=s=xr.from(s),t.url=tr(Or(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&s.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):""))),Ut.isFormData(o))if(ur.hasStandardBrowserEnv||ur.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(r=s.getContentType())){const[e,...t]=r?r.split(";").map((e=>e.trim())).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(ur.hasStandardBrowserEnv&&(n&&Ut.isFunction(n)&&(n=n(t)),n||!1!==n&&Mr(t.url))){const e=i&&a&&Ir.read(a);e&&s.set(i,e)}return t},Br="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise((function(t,r){const o=Nr(e);let n=o.data;const i=xr.from(o.headers).normalize();let a,s,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:f}=o;function m(){c&&c(),u&&u(),o.cancelToken&&o.cancelToken.unsubscribe(a),o.signal&&o.signal.removeEventListener("abort",a)}let p=new XMLHttpRequest;function g(){if(!p)return;const o=xr.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());Sr((function(e){t(e),m()}),(function(e){r(e),m()}),{data:d&&"text"!==d&&"json"!==d?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:o,config:e,request:p}),p=null}p.open(o.method.toUpperCase(),o.url,!0),p.timeout=o.timeout,"onloadend"in p?p.onloadend=g:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(g)},p.onabort=function(){p&&(r(new jt("Request aborted",jt.ECONNABORTED,e,p)),p=null)},p.onerror=function(){r(new jt("Network Error",jt.ERR_NETWORK,e,p)),p=null},p.ontimeout=function(){let t=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const n=o.transitional||or;o.timeoutErrorMessage&&(t=o.timeoutErrorMessage),r(new jt(t,n.clarifyTimeoutError?jt.ETIMEDOUT:jt.ECONNABORTED,e,p)),p=null},void 0===n&&i.setContentType(null),"setRequestHeader"in p&&Ut.forEach(i.toJSON(),(function(e,t){p.setRequestHeader(t,e)})),Ut.isUndefined(o.withCredentials)||(p.withCredentials=!!o.withCredentials),d&&"json"!==d&&(p.responseType=o.responseType),f&&([l,u]=Pr(f,!0),p.addEventListener("progress",l)),h&&p.upload&&([s,c]=Pr(h),p.upload.addEventListener("progress",s),p.upload.addEventListener("loadend",c)),(o.cancelToken||o.signal)&&(a=t=>{p&&(r(!t||t.type?new wr(null,e,p):t),p.abort(),p=null)},o.cancelToken&&o.cancelToken.subscribe(a),o.signal&&(o.signal.aborted?a():o.signal.addEventListener("abort",a)));const _=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(o.url);_&&-1===ur.protocols.indexOf(_)?r(new jt("Unsupported protocol "+_+":",jt.ERR_BAD_REQUEST,e)):p.send(n||null)}))},Fr=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,o=new AbortController;const n=function(e){if(!r){r=!0,a();const t=e instanceof Error?e:this.reason;o.abort(t instanceof jt?t:new wr(t instanceof Error?t.message:t))}};let i=t&&setTimeout((()=>{i=null,n(new jt(`timeout ${t} of ms exceeded`,jt.ETIMEDOUT))}),t);const a=()=>{e&&(i&&clearTimeout(i),i=null,e.forEach((e=>{e.unsubscribe?e.unsubscribe(n):e.removeEventListener("abort",n)})),e=null)};e.forEach((e=>e.addEventListener("abort",n)));const{signal:s}=o;return s.unsubscribe=()=>Ut.asap(a),s}},zr=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let o,n=0;for(;n<r;)o=n+t,yield e.slice(n,o),n=o},Ur=async function*(e){if(e[Symbol.asyncIterator])return void(yield*e);const t=e.getReader();try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{await t.cancel()}},Vr=(e,t,r,o)=>{const n=async function*(e,t){for await(const r of Ur(e))yield*zr(r,t)}(e,t);let i,a=0,s=e=>{i||(i=!0,o&&o(e))};return new ReadableStream({async pull(e){try{const{done:t,value:o}=await n.next();if(t)return s(),void e.close();let i=o.byteLength;if(r){let e=a+=i;r(e)}e.enqueue(new Uint8Array(o))}catch(t){throw s(t),t}},cancel:e=>(s(e),n.return())},{highWaterMark:2})},Hr="function"===typeof fetch&&"function"===typeof Request&&"function"===typeof Response,Gr=Hr&&"function"===typeof ReadableStream,jr=Hr&&("function"===typeof TextEncoder?(Wr=new TextEncoder,e=>Wr.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Wr;const Kr=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];return!!e(...r)}catch(n){return!1}},Jr=Gr&&Kr((()=>{let e=!1;const t=new Request(ur.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),Zr=Gr&&Kr((()=>Ut.isReadableStream(new Response("").body))),Yr={stream:Zr&&(e=>e.body)};var qr;Hr&&(qr=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!Yr[e]&&(Yr[e]=Ut.isFunction(qr[e])?t=>t[e]():(t,r)=>{throw new jt(`Response type '${e}' is not supported`,jt.ERR_NOT_SUPPORT,r)})})));const $r=async(e,t)=>{const r=Ut.toFiniteNumber(e.getContentLength());return null==r?(async e=>{if(null==e)return 0;if(Ut.isBlob(e))return e.size;if(Ut.isSpecCompliantForm(e)){const t=new Request(ur.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Ut.isArrayBufferView(e)||Ut.isArrayBuffer(e)?e.byteLength:(Ut.isURLSearchParams(e)&&(e+=""),Ut.isString(e)?(await jr(e)).byteLength:void 0)})(t):r},Xr=Hr&&(async e=>{let{url:t,method:r,data:o,signal:n,cancelToken:i,timeout:a,onDownloadProgress:s,onUploadProgress:l,responseType:c,headers:u,withCredentials:d="same-origin",fetchOptions:h}=Nr(e);c=c?(c+"").toLowerCase():"text";let f,m=Fr([n,i&&i.toAbortSignal()],a);const p=m&&m.unsubscribe&&(()=>{m.unsubscribe()});let g;try{if(l&&Jr&&"get"!==r&&"head"!==r&&0!==(g=await $r(u,o))){let e,r=new Request(t,{method:"POST",body:o,duplex:"half"});if(Ut.isFormData(o)&&(e=r.headers.get("content-type"))&&u.setContentType(e),r.body){const[e,t]=Cr(g,Pr(Rr(l)));o=Vr(r.body,65536,e,t)}}Ut.isString(d)||(d=d?"include":"omit");const n="credentials"in Request.prototype;f=new Request(t,{...h,signal:m,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:o,duplex:"half",credentials:n?d:void 0});let i=await fetch(f);const a=Zr&&("stream"===c||"response"===c);if(Zr&&(s||a&&p)){const e={};["status","statusText","headers"].forEach((t=>{e[t]=i[t]}));const t=Ut.toFiniteNumber(i.headers.get("content-length")),[r,o]=s&&Cr(t,Pr(Rr(s),!0))||[];i=new Response(Vr(i.body,65536,r,(()=>{o&&o(),p&&p()})),e)}c=c||"text";let _=await Yr[Ut.findKey(Yr,c)||"text"](i,e);return!a&&p&&p(),await new Promise(((t,r)=>{Sr(t,r,{data:_,headers:xr.from(i.headers),status:i.status,statusText:i.statusText,config:e,request:f})}))}catch(_){if(p&&p(),_&&"TypeError"===_.name&&/fetch/i.test(_.message))throw Object.assign(new jt("Network Error",jt.ERR_NETWORK,e,f),{cause:_.cause||_});throw jt.from(_,_&&_.code,e,f)}}),Qr={http:null,xhr:Br,fetch:Xr};Ut.forEach(Qr,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(r){}Object.defineProperty(e,"adapterName",{value:t})}}));const eo=e=>`- ${e}`,to=e=>Ut.isFunction(e)||null===e||!1===e,ro=e=>{e=Ut.isArray(e)?e:[e];const{length:t}=e;let r,o;const n={};for(let i=0;i<t;i++){let t;if(r=e[i],o=r,!to(r)&&(o=Qr[(t=String(r)).toLowerCase()],void 0===o))throw new jt(`Unknown adapter '${t}'`);if(o)break;n[t||"#"+i]=o}if(!o){const e=Object.entries(n).map((e=>{let[t,r]=e;return`adapter ${t} `+(!1===r?"is not supported by the environment":"is not available in the build")}));let r=t?e.length>1?"since :\n"+e.map(eo).join("\n"):" "+eo(e[0]):"as no adapter specified";throw new jt("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return o};function oo(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new wr(null,e)}function no(e){oo(e),e.headers=xr.from(e.headers),e.data=br.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ro(e.adapter||fr.adapter)(e).then((function(t){return oo(e),t.data=br.call(e,e.transformResponse,t),t.headers=xr.from(t.headers),t}),(function(t){return Lr(t)||(oo(e),t&&t.response&&(t.response.data=br.call(e,e.transformResponse,t.response),t.response.headers=xr.from(t.response.headers))),Promise.reject(t)}))}const io="1.8.4",ao={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{ao[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));const so={};ao.transitional=function(e,t,r){function o(e,t){return"[Axios v1.8.4] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,n,i)=>{if(!1===e)throw new jt(o(n," has been removed"+(t?" in "+t:"")),jt.ERR_DEPRECATED);return t&&!so[n]&&(so[n]=!0,console.warn(o(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,i)}},ao.spelling=function(e){return(t,r)=>(console.warn(`${r} is likely a misspelling of ${e}`),!0)};const lo={assertOptions:function(e,t,r){if("object"!==typeof e)throw new jt("options must be an object",jt.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let n=o.length;for(;n-- >0;){const i=o[n],a=t[i];if(a){const t=e[i],r=void 0===t||a(t,i,e);if(!0!==r)throw new jt("option "+i+" must be "+r,jt.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new jt("Unknown option "+i,jt.ERR_BAD_OPTION)}},validators:ao},co=lo.validators;class uo{constructor(e){this.defaults=e,this.interceptors={request:new rr,response:new rr}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(o){}}throw r}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=kr(this.defaults,t);const{transitional:r,paramsSerializer:o,headers:n}=t;void 0!==r&&lo.assertOptions(r,{silentJSONParsing:co.transitional(co.boolean),forcedJSONParsing:co.transitional(co.boolean),clarifyTimeoutError:co.transitional(co.boolean)},!1),null!=o&&(Ut.isFunction(o)?t.paramsSerializer={serialize:o}:lo.assertOptions(o,{encode:co.function,serialize:co.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),lo.assertOptions(t,{baseUrl:co.spelling("baseURL"),withXsrfToken:co.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=n&&Ut.merge(n.common,n[t.method]);n&&Ut.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete n[e]})),t.headers=xr.concat(i,n);const a=[];let s=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))}));const l=[];let c;this.interceptors.response.forEach((function(e){l.push(e.fulfilled,e.rejected)}));let u,d=0;if(!s){const e=[no.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=a.length;let h=t;for(d=0;d<u;){const e=a[d++],t=a[d++];try{h=e(h)}catch(f){t.call(this,f);break}}try{c=no.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return tr(Or((e=kr(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}Ut.forEach(["delete","get","head","options"],(function(e){uo.prototype[e]=function(t,r){return this.request(kr(r||{},{method:e,url:t,data:(r||{}).data}))}})),Ut.forEach(["post","put","patch"],(function(e){function t(t){return function(r,o,n){return this.request(kr(n||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}uo.prototype[e]=t(),uo.prototype[e+"Form"]=t(!0)}));const ho=uo;class fo{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const r=this;this.promise.then((e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null})),this.promise.then=e=>{let t;const o=new Promise((e=>{r.subscribe(e),t=e})).then(e);return o.cancel=function(){r.unsubscribe(t)},o},e((function(e,o,n){r.reason||(r.reason=new wr(e,o,n),t(r.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new fo((function(t){e=t})),cancel:e}}}const mo=fo;const po={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(po).forEach((e=>{let[t,r]=e;po[r]=t}));const go=po;const _o=function e(t){const r=new ho(t),o=ot(ho.prototype.request,r);return Ut.extend(o,ho.prototype,r,{allOwnKeys:!0}),Ut.extend(o,r,null,{allOwnKeys:!0}),o.create=function(r){return e(kr(t,r))},o}(fr);_o.Axios=ho,_o.CanceledError=wr,_o.CancelToken=mo,_o.isCancel=Lr,_o.VERSION=io,_o.toFormData=Yt,_o.AxiosError=jt,_o.Cancel=_o.CanceledError,_o.all=function(e){return Promise.all(e)},_o.spread=function(e){return function(t){return e.apply(null,t)}},_o.isAxiosError=function(e){return Ut.isObject(e)&&!0===e.isAxiosError},_o.mergeConfig=kr,_o.AxiosHeaders=xr,_o.formToJSON=e=>dr(Ut.isHTMLForm(e)?new FormData(e):e),_o.getAdapter=ro,_o.HttpStatusCode=go,_o.default=_o;const yo=_o,vo=()=>{const[e,r]=(0,t.useState)([]);(0,t.useEffect)((()=>{o();const e=setInterval(o,3e5);return()=>clearInterval(e)}),[]);const o=async()=>{try{const e=await yo.get("https://lara-backend.lusep.fi/data/efin_reservations.json");e.data&&Array.isArray(e.data)&&r(e.data)}catch(e){console.error("Error fetching data:",e)}},n=e=>{switch(e){case"pending":return"#FFD580";case"active":return"#90EE90";case"cancelled":return"#FFCCCB";default:return"transparent"}},i=e=>{const t=new Date(e);return`${String(t.getUTCDate()).padStart(2,"0")}/${String(t.getUTCMonth()+1).padStart(2,"0")}/${t.getUTCFullYear()}, ${String(t.getUTCHours()).padStart(2,"0")}:${String(t.getUTCMinutes()).padStart(2,"0")}z`};return(0,We.jsxs)("div",{children:[(0,We.jsx)("div",{className:"text-sm bg-gray-400",style:{display:"flex",gap:"4px",paddingBottom:"8px"},children:(0,We.jsx)("button",{onClick:()=>window.open("https://lara.lusep.fi/","_blank"),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"4px 8px"},children:"V-LARA"})}),(0,We.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,We.jsx)("thead",{children:(0,We.jsxs)("tr",{className:"bg-gray-400 text-white text-sm",style:{textAlign:"left"},children:[(0,We.jsx)("th",{style:{padding:"2px"},children:"ID"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"CS"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Activity"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Areas"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Start"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"End"})]})}),(0,We.jsx)("tbody",{className:"monospace-font text-sm table-line",children:e.length>0?e.map((e=>(0,We.jsxs)("tr",{style:{backgroundColor:n(e.status)},children:[(0,We.jsx)("td",{style:{padding:"4px"},children:e.reservation_id}),(0,We.jsx)("td",{style:{padding:"4px"},children:e.callsigns.join(", ")}),(0,We.jsx)("td",{style:{padding:"4px"},children:e.activity_type}),(0,We.jsx)("td",{style:{padding:"4px"},children:e.areas.map((e=>e.area_id)).join(", ")}),(0,We.jsx)("td",{style:{padding:"4px"},children:i(e.start)}),(0,We.jsx)("td",{style:{padding:"4px"},children:i(e.end)})]},e.reservation_id))):(0,We.jsx)("tr",{children:(0,We.jsx)("td",{colSpan:"8",style:{textAlign:"center",padding:"16px"},children:"No Reservations Found"})})})]})]})},xo="reservations-99lghr",bo="area-labels",Lo=e=>{let{map:r,openWindows:o,setOpenWindows:n}=e;const[i,a]=(0,t.useState)(!1),[s,l]=(0,t.useState)(!1),c=(0,t.useCallback)((async()=>{if(r&&s)try{console.log("Fetching data...");const e=await fetch("https://lara-backend.lusep.fi/data/efin_reservations.json");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json(),r={};t.forEach((e=>{const t=e.status||"unknown";e.areas.forEach((e=>{const o=`EF${e.area_id}`;r[o]=t,console.log(`Mapping ${o} -> ${t}`)}))})),u(r)}catch(e){console.error("Failed to fetch areas:",e)}}),[r,s]),u=(0,t.useCallback)((e=>{r&&r.getLayer(xo)&&(console.log("Updating feature states..."),r.once("idle",(()=>{r.queryRenderedFeatures({layers:[xo]}).forEach((t=>{const o=t.properties.code,n=t.id;if(e[o]){const t=e[o];console.log(`Applying status: ${t} to ${o} (Feature ID: ${n})`),r.setFeatureState({source:"composite",sourceLayer:xo,id:n},{status:t})}})),r.setPaintProperty(xo,"line-color",["case",["==",["feature-state","status"],"pending"],"orange",["==",["feature-state","status"],"active"],"red",["==",["feature-state","status"],"reserved"],"#0492c2","transparent"]),r.getLayer(bo)||(r.addLayer({id:bo,type:"symbol",source:"composite","source-layer":xo,layout:{"text-field":["get","name"],"text-size":9,"text-font":["Open Sans Bold"],"text-allow-overlap":!1,"text-ignore-placement":!1},paint:{"text-color":"black","text-halo-color":"white","text-halo-width":1,"text-opacity":["case",["==",["feature-state","status"],"cancelled"],0,["==",["feature-state","status"],"pending"],1,["==",["feature-state","status"],"active"],1,["==",["feature-state","status"],"reserved"],1,0]}}),r.on("mouseenter",bo,(()=>{r.getCanvas().style.cursor="pointer"})),r.on("mouseleave",bo,(()=>{r.getCanvas().style.cursor="default"})),r.on("click",bo,(e=>{const t=(0,We.jsx)(vo,{});n((e=>[...e,{id:Date.now(),title:"LARA RESERVATIONS",content:t}]))}))),r.triggerRepaint()})))}),[r]);return(0,t.useEffect)((()=>{if(!r)return;const e=()=>{l(!0),i&&(console.log("Initial fetch on map load..."),c())};return r.isStyleLoaded()?e():r.on("load",e),()=>{r.off("load",e)}}),[r,i,c]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Airspace reservations",className:`w-8 h-8 ${i?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!i;a(e),r&&r.getLayer(xo)&&(r.setLayoutProperty(xo,"visibility",e?"visible":"none"),r.setLayoutProperty(bo,"visibility",e?"visible":"none"),e&&c())},children:(0,We.jsx)("img",{className:"w-5",src:rt,alt:"Lara"})})},Ao=e=>{let{map:r}=e;const[o,n]=(0,t.useState)("true"===localStorage.getItem("fixVisible"));return(0,t.useEffect)((()=>{if(!r)return;const e="points-661xjs",t=()=>{o?r.setLayoutProperty(e,"visibility","visible"):r.setLayoutProperty(e,"visibility","none")};return r.isStyleLoaded()?t():r.on("load",t),()=>{r.isStyleLoaded()&&r.setLayoutProperty(e,"visibility","none"),r.off("load",t)}}),[r,o]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"Waypoints",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!o;n(e),localStorage.setItem("fixVisible",e.toString())},children:(0,We.jsx)("span",{role:"img","aria-label":"FIX",className:"text-sm",children:"FIX"})})},wo=e=>{let{map:r}=e;const[o,n]=(0,t.useState)("true"===localStorage.getItem("vfrVisible"));return(0,t.useEffect)((()=>{if(!r)return;const e="vfr-bureuo",t=()=>{o?r.setLayoutProperty(e,"visibility","visible"):r.setLayoutProperty(e,"visibility","none")};return r.isStyleLoaded()?t():r.on("load",t),()=>{r.isStyleLoaded()&&r.setLayoutProperty(e,"visibility","none"),r.off("load",t)}}),[r,o]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"VFR reporting points",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!o;n(e),localStorage.setItem("vfrVisible",e.toString())},children:(0,We.jsx)("span",{role:"img","aria-label":"VFR",className:"text-sm",children:"VFR"})})};const So=r.p+"static/media/vor.e4ece808b80f82143f8e126cc8b791a2.svg",Eo=e=>{let{map:r}=e;const[o,n]=(0,t.useState)("true"===localStorage.getItem("vorVisible"));return(0,t.useEffect)((()=>{if(!r)return;const e="vor-5kawzi",t=()=>{o?r.setLayoutProperty(e,"visibility","visible"):r.setLayoutProperty(e,"visibility","none")};return r.isStyleLoaded()?t():r.on("load",t),()=>{r.isStyleLoaded()&&r.setLayoutProperty(e,"visibility","none"),r.off("load",t)}}),[r,o]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"VOR stations",className:`w-8 h-8 ${o?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!o;n(e),localStorage.setItem("vorVisible",e.toString())},children:(0,We.jsx)("img",{className:"w-5",src:So,alt:"VOR"})})};const To=r.p+"static/media/sigmet.a6b6d12e7a29caffbd88ee2f9aebd651.svg",Po=e=>{let{map:r,openWindows:o,setOpenWindows:n}=e;const[i,a]=(0,t.useState)((()=>{const e=localStorage.getItem("sigmetVisible");return!!e&&JSON.parse(e)})),[s,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(!1);(0,t.useEffect)((()=>{if(!r||!i||c)return;return(async()=>{try{const e=await fetch("https://aviationweather.gov/api/data/isigmet?format=geojson");if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json();l(t),d(r,t),u(!0)}catch(e){console.error("Failed fetching SIGMETs:",e)}})(),()=>{r.getSource("sigmet")&&(r.removeLayer("sigmet-layer"),r.removeLayer("sigmet-labels"),r.removeSource("sigmet"))}}),[r,i,c]);const d=(e,t)=>{e.getSource("sigmet")?e.getSource("sigmet").setData(t):e.addSource("sigmet",{type:"geojson",data:t}),e.getLayer("sigmet-layer")||e.addLayer({id:"sigmet-layer",type:"fill",source:"sigmet",paint:{"fill-color":["case",["==",["get","hazard"],"ICE"],"rgba(100, 150, 255, 0.4)","rgba(255, 100, 0, 0.4)"],"fill-outline-color":["case",["==",["get","hazard"],"ICE"],"rgba(50, 100, 255, 0.8)","rgba(255, 50, 0, 0.8)"]}}),e.getLayer("sigmet-labels")||(e.addLayer({id:"sigmet-labels",type:"symbol",source:"sigmet",layout:{"text-field":["get","hazard"],"text-size":10,"text-font":["Open Sans Bold"],"text-allow-overlap":!0,"text-offset":[0,1]},paint:{"text-color":"black","text-halo-color":"white","text-halo-width":1}}),e.on("mouseenter","sigmet-layer",(()=>{e.getCanvas().style.cursor="pointer"})),e.on("mouseleave","sigmet-layer",(()=>{e.getCanvas().style.cursor="default"})),e.on("click","sigmet-layer",(e=>{const t=e.features[0].properties,r=t.firName||"Unknown FIR",o=t.hazard||"Unknown",i=t.qualifier||"None",a=e=>{if(!e)return"Unknown";const t=new Date(e);return`${t.getUTCDate().toString().padStart(2,"0")}/${(t.getUTCMonth()+1).toString().padStart(2,"0")}/${t.getUTCFullYear()} ${t.getUTCHours().toString().padStart(2,"0")}:${t.getUTCMinutes().toString().padStart(2,"0")}z`},s=a(t.validTimeFrom),l=a(t.validTimeTo),c=t.rawSigmet||"No raw SIGMET text available",u=(0,We.jsxs)("div",{className:"p-2 monospace-font text-sm overflow-y-auto mb-6",style:{userSelect:"text"},children:[(0,We.jsx)("h3",{className:"small-title",children:"SIGMET Details"}),(0,We.jsxs)("p",{children:[(0,We.jsx)("strong",{children:"FIR:"})," ",r]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("strong",{children:"Hazard:"})," ",o]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("strong",{children:"Qualifier:"})," ",i]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("strong",{children:"Valid From:"})," ",s]}),(0,We.jsxs)("p",{children:[(0,We.jsx)("strong",{children:"Valid To:"})," ",l]}),(0,We.jsx)("h4",{className:"small-title",style:{marginTop:"10px"},children:"Raw SIGMET"}),(0,We.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word"},children:c})]});n((e=>{const t=e.findIndex((e=>e.title===`SIGMET: ${r}`));if(-1!==t){const r=[...e];return r[t]={...r[t],content:u},r}return[...e,{id:`sigmet-window-${Date.now()}`,title:`SIGMET: ${r}`,content:u}]}))}))),h()},h=()=>{if(!r)return;const e=i?"visible":"none";r.getLayer("sigmet-layer")&&r.setLayoutProperty("sigmet-layer","visibility",e),r.getLayer("sigmet-labels")&&r.setLayoutProperty("sigmet-labels","visibility",e)};return(0,t.useEffect)((()=>{h()}),[i]),(0,We.jsx)("button",{"data-tooltip-id":"map-buttons-tooltip","data-tooltip-content":"SIGMET",className:`w-8 h-8 ${i?"bg-gray-600":"bg-gray-400"} text-white flex items-center justify-center`,onClick:()=>{const e=!i;a(e),localStorage.setItem("sigmetVisible",JSON.stringify(e))},children:(0,We.jsx)("img",{className:"w-6",src:To,alt:"Sigmets"})})};a().accessToken="pk.eyJ1Ijoib3R0b3R1aGt1bmVuIiwiYSI6ImNseG41dW9vaDAwNzQycXNleWI1MmowbHcifQ.1ZMRPeOQ7z9GRzKILnFNAQ";const Co=e=>{let{openWindows:r,setOpenWindows:o}=e;const n=(0,t.useRef)(null),[i,s]=(0,t.useState)(null),l=(0,t.useContext)(Ml);return(0,t.useEffect)((()=>{const e=new(a().Map)({container:n.current,style:"mapbox://styles/ottotuhkunen/cm8hnlorw012z01qrfr8t4nz3",center:[24,64.8],zoom:4.2});return s(e),()=>e.remove()}),[]),(0,We.jsxs)("div",{className:"relative h-full w-full",children:[(0,We.jsxs)("div",{className:"absolute left-0 top-7 h-full w-10 flex flex-col items-center p-2 space-y-1 z-10",children:[(0,We.jsx)(Ye,{map:i,traffic:l,openWindows:r,setOpenWindows:o}),(0,We.jsx)($e,{map:i}),(0,We.jsx)(qe,{map:i,openWindows:r,setOpenWindows:o}),(0,We.jsx)(Lo,{map:i,openWindows:r,setOpenWindows:o}),(0,We.jsx)(Ao,{map:i}),(0,We.jsx)(wo,{map:i}),(0,We.jsx)(Eo,{map:i}),(0,We.jsx)(Qe,{map:i}),(0,We.jsx)(tt,{map:i}),(0,We.jsx)(Po,{map:i,openWindows:r,setOpenWindows:o}),(0,We.jsx)(Je,{map:i,openWindows:r,setOpenWindows:o})]}),(0,We.jsx)("div",{ref:n,className:"h-full w-full z-0"}),(0,We.jsx)(je,{id:"map-buttons-tooltip",place:"right",effect:"solid",className:"z-50","data-tooltip-place":"right",style:{backgroundColor:"#4B5563",padding:"2px 6px",borderRadius:"0"}})]})};function Ro(e,t){let{checkForDefaultPrevented:r=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(o){if(e?.(o),!1===r||!o.defaultPrevented)return t?.(o)}}function Mo(e,t){if("function"===typeof e)return e(t);null!==e&&void 0!==e&&(e.current=t)}function Io(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>{let r=!1;const o=t.map((t=>{const o=Mo(t,e);return r||"function"!=typeof o||(r=!0),o}));if(r)return()=>{for(let e=0;e<o.length;e++){const r=o[e];"function"==typeof r?r():Mo(t[e],null)}}}}function Oo(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t.useCallback(Io(...r),r)}function Do(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=[];const n=()=>{const r=o.map((e=>t.createContext(e)));return function(o){const n=o?.[e]||r;return t.useMemo((()=>({[`__scope${e}`]:{...o,[e]:n}})),[o,n])}};return n.scopeName=e,[function(r,n){const i=t.createContext(n),a=o.length;o=[...o,n];const s=r=>{const{scope:o,children:n,...s}=r,l=o?.[e]?.[a]||i,c=t.useMemo((()=>s),Object.values(s));return(0,We.jsx)(l.Provider,{value:c,children:n})};return s.displayName=r+"Provider",[s,function(o,s){const l=s?.[e]?.[a]||i,c=t.useContext(l);if(c)return c;if(void 0!==n)return n;throw new Error(`\`${o}\` must be used within \`${r}\``)}]},ko(n,...r)]}function ko(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const n=r[0];if(1===r.length)return n;const i=()=>{const e=r.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(r){const o=e.reduce(((e,t)=>{let{useScope:o,scopeName:n}=t;return{...e,...o(r)[`__scope${n}`]}}),{});return t.useMemo((()=>({[`__scope${n.scopeName}`]:o})),[o])}};return i.scopeName=n.scopeName,i}function No(e){const r=t.useRef(e);return t.useEffect((()=>{r.current=e})),t.useMemo((()=>function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return r.current?.(...t)}),[])}function Bo(e){let{prop:r,defaultProp:o,onChange:n=()=>{}}=e;const[i,a]=function(e){let{defaultProp:r,onChange:o}=e;const n=t.useState(r),[i]=n,a=t.useRef(i),s=No(o);return t.useEffect((()=>{a.current!==i&&(s(i),a.current=i)}),[i,a,s]),n}({defaultProp:o,onChange:n}),s=void 0!==r,l=s?r:i,c=No(n);return[l,t.useCallback((e=>{if(s){const t="function"===typeof e?e(r):e;t!==r&&c(t)}else a(e)}),[s,r,a,c])]}var Fo=r(950),zo=t.forwardRef(((e,r)=>{const{children:o,...n}=e,i=t.Children.toArray(o),a=i.find(Ho);if(a){const e=a.props.children,o=i.map((r=>r===a?t.Children.count(e)>1?t.Children.only(null):t.isValidElement(e)?e.props.children:null:r));return(0,We.jsx)(Uo,{...n,ref:r,children:t.isValidElement(e)?t.cloneElement(e,void 0,o):null})}return(0,We.jsx)(Uo,{...n,ref:r,children:o})}));zo.displayName="Slot";var Uo=t.forwardRef(((e,r)=>{const{children:o,...n}=e;if(t.isValidElement(o)){const e=function(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;if(r)return e.ref;if(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(o),i=function(e,t){const r={...t};for(const o in t){const n=e[o],i=t[o];/^on[A-Z]/.test(o)?n&&i?r[o]=function(){i(...arguments),n(...arguments)}:n&&(r[o]=n):"style"===o?r[o]={...n,...i}:"className"===o&&(r[o]=[n,i].filter(Boolean).join(" "))}return{...e,...r}}(n,o.props);return o.type!==t.Fragment&&(i.ref=r?Io(r,e):e),t.cloneElement(o,i)}return t.Children.count(o)>1?t.Children.only(null):null}));Uo.displayName="SlotClone";var Vo=e=>{let{children:t}=e;return(0,We.jsx)(We.Fragment,{children:t})};function Ho(e){return t.isValidElement(e)&&e.type===Vo}var Go=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((e,r)=>{const o=t.forwardRef(((e,t)=>{const{asChild:o,...n}=e,i=o?zo:r;return"undefined"!==typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,We.jsx)(i,{...n,ref:t})}));return o.displayName=`Primitive.${r}`,{...e,[r]:o}}),{});function jo(e,t){e&&Fo.flushSync((()=>e.dispatchEvent(t)))}function Wo(e){const r=e+"CollectionProvider",[o,n]=Do(r),[i,a]=o(r,{collectionRef:{current:null},itemMap:new Map}),s=e=>{const{scope:r,children:o}=e,n=t.useRef(null),a=t.useRef(new Map).current;return(0,We.jsx)(i,{scope:r,itemMap:a,collectionRef:n,children:o})};s.displayName=r;const l=e+"CollectionSlot",c=t.forwardRef(((e,t)=>{const{scope:r,children:o}=e,n=Oo(t,a(l,r).collectionRef);return(0,We.jsx)(zo,{ref:n,children:o})}));c.displayName=l;const u=e+"CollectionItemSlot",d="data-radix-collection-item",h=t.forwardRef(((e,r)=>{const{scope:o,children:n,...i}=e,s=t.useRef(null),l=Oo(r,s),c=a(u,o);return t.useEffect((()=>(c.itemMap.set(s,{ref:s,...i}),()=>{c.itemMap.delete(s)}))),(0,We.jsx)(zo,{[d]:"",ref:l,children:n})}));return h.displayName=u,[{Provider:s,Slot:c,ItemSlot:h},function(r){const o=a(e+"CollectionConsumer",r),n=t.useCallback((()=>{const e=o.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${d}]`)),r=Array.from(o.itemMap.values()).sort(((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current)));return r}),[o.collectionRef,o.itemMap]);return n},n]}var Ko=t.createContext(void 0);function Jo(e){const r=t.useContext(Ko);return e||r||"ltr"}var Zo,Yo="dismissableLayer.update",qo="dismissableLayer.pointerDownOutside",$o="dismissableLayer.focusOutside",Xo=t.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Qo=t.forwardRef(((e,r)=>{const{disableOutsidePointerEvents:o=!1,onEscapeKeyDown:n,onPointerDownOutside:i,onFocusOutside:a,onInteractOutside:s,onDismiss:l,...c}=e,u=t.useContext(Xo),[d,h]=t.useState(null),f=d?.ownerDocument??globalThis?.document,[,m]=t.useState({}),p=Oo(r,(e=>h(e))),g=Array.from(u.layers),[_]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(_),v=d?g.indexOf(d):-1,x=u.layersWithOutsidePointerEventsDisabled.size>0,b=v>=y,L=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalThis?.document;const o=No(e),n=t.useRef(!1),i=t.useRef((()=>{}));return t.useEffect((()=>{const e=e=>{if(e.target&&!n.current){let t=function(){rn(qo,o,n,{discrete:!0})};const n={originalEvent:e};"touch"===e.pointerType?(r.removeEventListener("click",i.current),i.current=t,r.addEventListener("click",i.current,{once:!0})):t()}else r.removeEventListener("click",i.current);n.current=!1},t=window.setTimeout((()=>{r.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(t),r.removeEventListener("pointerdown",e),r.removeEventListener("click",i.current)}}),[r,o]),{onPointerDownCapture:()=>n.current=!0}}((e=>{const t=e.target,r=[...u.branches].some((e=>e.contains(t)));b&&!r&&(i?.(e),s?.(e),e.defaultPrevented||l?.())}),f),A=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalThis?.document;const o=No(e),n=t.useRef(!1);return t.useEffect((()=>{const e=e=>{if(e.target&&!n.current){rn($o,o,{originalEvent:e},{discrete:!1})}};return r.addEventListener("focusin",e),()=>r.removeEventListener("focusin",e)}),[r,o]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}((e=>{const t=e.target;[...u.branches].some((e=>e.contains(t)))||(a?.(e),s?.(e),e.defaultPrevented||l?.())}),f);return function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:globalThis?.document;const o=No(e);t.useEffect((()=>{const e=e=>{"Escape"===e.key&&o(e)};return r.addEventListener("keydown",e,{capture:!0}),()=>r.removeEventListener("keydown",e,{capture:!0})}),[o,r])}((e=>{v===u.layers.size-1&&(n?.(e),!e.defaultPrevented&&l&&(e.preventDefault(),l()))}),f),t.useEffect((()=>{if(d)return o&&(0===u.layersWithOutsidePointerEventsDisabled.size&&(Zo=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),tn(),()=>{o&&1===u.layersWithOutsidePointerEventsDisabled.size&&(f.body.style.pointerEvents=Zo)}}),[d,f,o,u]),t.useEffect((()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),tn())}),[d,u]),t.useEffect((()=>{const e=()=>m({});return document.addEventListener(Yo,e),()=>document.removeEventListener(Yo,e)}),[]),(0,We.jsx)(Go.div,{...c,ref:p,style:{pointerEvents:x?b?"auto":"none":void 0,...e.style},onFocusCapture:Ro(e.onFocusCapture,A.onFocusCapture),onBlurCapture:Ro(e.onBlurCapture,A.onBlurCapture),onPointerDownCapture:Ro(e.onPointerDownCapture,L.onPointerDownCapture)})}));Qo.displayName="DismissableLayer";var en=t.forwardRef(((e,r)=>{const o=t.useContext(Xo),n=t.useRef(null),i=Oo(r,n);return t.useEffect((()=>{const e=n.current;if(e)return o.branches.add(e),()=>{o.branches.delete(e)}}),[o.branches]),(0,We.jsx)(Go.div,{...e,ref:i})}));function tn(){const e=new CustomEvent(Yo);document.dispatchEvent(e)}function rn(e,t,r,o){let{discrete:n}=o;const i=r.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),n?jo(i,a):i.dispatchEvent(a)}en.displayName="DismissableLayerBranch";var on=0;function nn(){t.useEffect((()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??an()),document.body.insertAdjacentElement("beforeend",e[1]??an()),on++,()=>{1===on&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),on--}}),[])}function an(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var sn="focusScope.autoFocusOnMount",ln="focusScope.autoFocusOnUnmount",cn={bubbles:!1,cancelable:!0},un=t.forwardRef(((e,r)=>{const{loop:o=!1,trapped:n=!1,onMountAutoFocus:i,onUnmountAutoFocus:a,...s}=e,[l,c]=t.useState(null),u=No(i),d=No(a),h=t.useRef(null),f=Oo(r,(e=>c(e))),m=t.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;t.useEffect((()=>{if(n){let e=function(e){if(m.paused||!l)return;const t=e.target;l.contains(t)?h.current=t:mn(h.current,{select:!0})},t=function(e){if(m.paused||!l)return;const t=e.relatedTarget;null!==t&&(l.contains(t)||mn(h.current,{select:!0}))},r=function(e){if(document.activeElement===document.body)for(const t of e)t.removedNodes.length>0&&mn(l)};document.addEventListener("focusin",e),document.addEventListener("focusout",t);const o=new MutationObserver(r);return l&&o.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),o.disconnect()}}}),[n,l,m.paused]),t.useEffect((()=>{if(l){pn.add(m);const t=document.activeElement;if(!l.contains(t)){const r=new CustomEvent(sn,cn);l.addEventListener(sn,u),l.dispatchEvent(r),r.defaultPrevented||(!function(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=document.activeElement;for(const o of e)if(mn(o,{select:t}),document.activeElement!==r)return}((e=dn(l),e.filter((e=>"A"!==e.tagName))),{select:!0}),document.activeElement===t&&mn(l))}return()=>{l.removeEventListener(sn,u),setTimeout((()=>{const e=new CustomEvent(ln,cn);l.addEventListener(ln,d),l.dispatchEvent(e),e.defaultPrevented||mn(t??document.body,{select:!0}),l.removeEventListener(ln,d),pn.remove(m)}),0)}}var e}),[l,u,d,m]);const p=t.useCallback((e=>{if(!o&&!n)return;if(m.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,r=document.activeElement;if(t&&r){const t=e.currentTarget,[n,i]=function(e){const t=dn(e),r=hn(t,e),o=hn(t.reverse(),e);return[r,o]}(t);n&&i?e.shiftKey||r!==i?e.shiftKey&&r===n&&(e.preventDefault(),o&&mn(i,{select:!0})):(e.preventDefault(),o&&mn(n,{select:!0})):r===t&&e.preventDefault()}}),[o,n,m.paused]);return(0,We.jsx)(Go.div,{tabIndex:-1,...s,ref:f,onKeyDown:p})}));function dn(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function hn(e,t){for(const r of e)if(!fn(r,{upTo:t}))return r}function fn(e,t){let{upTo:r}=t;if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==r&&e===r)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function mn(e){let{select:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&function(e){return e instanceof HTMLInputElement&&"select"in e}(e)&&t&&e.select()}}un.displayName="FocusScope";var pn=function(){let e=[];return{add(t){const r=e[0];t!==r&&r?.pause(),e=gn(e,t),e.unshift(t)},remove(t){e=gn(e,t),e[0]?.resume()}}}();function gn(e,t){const r=[...e],o=r.indexOf(t);return-1!==o&&r.splice(o,1),r}var _n=Boolean(globalThis?.document)?t.useLayoutEffect:()=>{},yn=o["useId".toString()]||(()=>{}),vn=0;function xn(e){const[r,o]=t.useState(yn());return _n((()=>{e||o((e=>e??String(vn++)))}),[e]),e||(r?`radix-${r}`:"")}var bn="undefined"!==typeof document?t.useLayoutEffect:t.useEffect;function Ln(e,t){if(e===t)return!0;if(typeof e!==typeof t)return!1;if("function"===typeof e&&e.toString()===t.toString())return!0;let r,o,n;if(e&&t&&"object"===typeof e){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(o=r;0!==o--;)if(!Ln(e[o],t[o]))return!1;return!0}if(n=Object.keys(e),r=n.length,r!==Object.keys(t).length)return!1;for(o=r;0!==o--;)if(!{}.hasOwnProperty.call(t,n[o]))return!1;for(o=r;0!==o--;){const r=n[o];if(("_owner"!==r||!e.$$typeof)&&!Ln(e[r],t[r]))return!1}return!0}return e!==e&&t!==t}function An(e){if("undefined"===typeof window)return 1;return(e.ownerDocument.defaultView||window).devicePixelRatio||1}function wn(e,t){const r=An(e);return Math.round(t*r)/r}function Sn(e){const r=t.useRef(e);return bn((()=>{r.current=e})),r}const En=e=>({name:"arrow",options:e,fn(t){const{element:r,padding:o}="function"===typeof e?e(t):e;return r&&(n=r,{}.hasOwnProperty.call(n,"current"))?null!=r.current?ve({element:r.current,padding:o}).fn(t):{}:r?ve({element:r,padding:o}).fn(t):{};var n}}),Tn=(e,t)=>({...me(e),options:[e,t]}),Pn=(e,t)=>({...pe(e),options:[e,t]}),Cn=(e,t)=>({...xe(e),options:[e,t]}),Rn=(e,t)=>({...ge(e),options:[e,t]}),Mn=(e,t)=>({..._e(e),options:[e,t]}),In=(e,t)=>({...ye(e),options:[e,t]}),On=(e,t)=>({...En(e),options:[e,t]});var Dn=t.forwardRef(((e,t)=>{const{children:r,width:o=10,height:n=5,...i}=e;return(0,We.jsx)(Go.svg,{...i,ref:t,width:o,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:(0,We.jsx)("polygon",{points:"0,0 30,0 15,10"})})}));Dn.displayName="Arrow";var kn=Dn;var Nn="Popper",[Bn,Fn]=Do(Nn),[zn,Un]=Bn(Nn),Vn=e=>{const{__scopePopper:r,children:o}=e,[n,i]=t.useState(null);return(0,We.jsx)(zn,{scope:r,anchor:n,onAnchorChange:i,children:o})};Vn.displayName=Nn;var Hn="PopperAnchor",Gn=t.forwardRef(((e,r)=>{const{__scopePopper:o,virtualRef:n,...i}=e,a=Un(Hn,o),s=t.useRef(null),l=Oo(r,s);return t.useEffect((()=>{a.onAnchorChange(n?.current||s.current)})),n?null:(0,We.jsx)(Go.div,{...i,ref:l})}));Gn.displayName=Hn;var jn="PopperContent",[Wn,Kn]=Bn(jn),Jn=t.forwardRef(((e,r)=>{const{__scopePopper:o,side:n="bottom",sideOffset:i=0,align:a="center",alignOffset:s=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:f=!1,updatePositionStrategy:m="optimized",onPlaced:p,...g}=e,_=Un(jn,o),[y,v]=t.useState(null),x=Oo(r,(e=>v(e))),[b,L]=t.useState(null),A=function(e){const[r,o]=t.useState(void 0);return _n((()=>{if(e){o({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const r=t[0];let n,i;if("borderBoxSize"in r){const e=r.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;o({width:n,height:i})}));return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}o(void 0)}),[e]),r}(b),w=A?.width??0,S=A?.height??0,E=n+("center"!==a?"-"+a:""),T="number"===typeof d?d:{top:0,right:0,bottom:0,left:0,...d},P=Array.isArray(u)?u:[u],C=P.length>0,R={padding:T,boundary:P.filter($n),altBoundary:C},{refs:M,floatingStyles:I,placement:O,isPositioned:D,middlewareData:k}=function(e){void 0===e&&(e={});const{placement:r="bottom",strategy:o="absolute",middleware:n=[],platform:i,elements:{reference:a,floating:s}={},transform:l=!0,whileElementsMounted:c,open:u}=e,[d,h]=t.useState({x:0,y:0,strategy:o,placement:r,middlewareData:{},isPositioned:!1}),[f,m]=t.useState(n);Ln(f,n)||m(n);const[p,g]=t.useState(null),[_,y]=t.useState(null),v=t.useCallback((e=>{e!==A.current&&(A.current=e,g(e))}),[]),x=t.useCallback((e=>{e!==w.current&&(w.current=e,y(e))}),[]),b=a||p,L=s||_,A=t.useRef(null),w=t.useRef(null),S=t.useRef(d),E=null!=c,T=Sn(c),P=Sn(i),C=Sn(u),R=t.useCallback((()=>{if(!A.current||!w.current)return;const e={placement:r,strategy:o,middleware:f};P.current&&(e.platform=P.current),be(A.current,w.current,e).then((e=>{const t={...e,isPositioned:!1!==C.current};M.current&&!Ln(S.current,t)&&(S.current=t,Fo.flushSync((()=>{h(t)})))}))}),[f,r,o,P,C]);bn((()=>{!1===u&&S.current.isPositioned&&(S.current.isPositioned=!1,h((e=>({...e,isPositioned:!1}))))}),[u]);const M=t.useRef(!1);bn((()=>(M.current=!0,()=>{M.current=!1})),[]),bn((()=>{if(b&&(A.current=b),L&&(w.current=L),b&&L){if(T.current)return T.current(b,L,R);R()}}),[b,L,R,T,E]);const I=t.useMemo((()=>({reference:A,floating:w,setReference:v,setFloating:x})),[v,x]),O=t.useMemo((()=>({reference:b,floating:L})),[b,L]),D=t.useMemo((()=>{const e={position:o,left:0,top:0};if(!O.floating)return e;const t=wn(O.floating,d.x),r=wn(O.floating,d.y);return l?{...e,transform:"translate("+t+"px, "+r+"px)",...An(O.floating)>=1.5&&{willChange:"transform"}}:{position:o,left:t,top:r}}),[o,l,O.floating,d.x,d.y]);return t.useMemo((()=>({...d,update:R,refs:I,elements:O,floatingStyles:D})),[d,R,I,O,D])}({strategy:"fixed",placement:E,whileElementsMounted:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return fe(...t,{animationFrame:"always"===m})},elements:{reference:_.anchor},middleware:[Tn({mainAxis:i+S,alignmentAxis:s}),c&&Pn({mainAxis:!0,crossAxis:!1,limiter:"partial"===h?Cn():void 0,...R}),c&&Rn({...R}),Mn({...R,apply:e=>{let{elements:t,rects:r,availableWidth:o,availableHeight:n}=e;const{width:i,height:a}=r.reference,s=t.floating.style;s.setProperty("--radix-popper-available-width",`${o}px`),s.setProperty("--radix-popper-available-height",`${n}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${a}px`)}}),b&&On({element:b,padding:l}),Xn({arrowWidth:w,arrowHeight:S}),f&&In({strategy:"referenceHidden",...R})]}),[N,B]=Qn(O),F=No(p);_n((()=>{D&&F?.()}),[D,F]);const z=k.arrow?.x,U=k.arrow?.y,V=0!==k.arrow?.centerOffset,[H,G]=t.useState();return _n((()=>{y&&G(window.getComputedStyle(y).zIndex)}),[y]),(0,We.jsx)("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...I,transform:D?I.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:H,"--radix-popper-transform-origin":[k.transformOrigin?.x,k.transformOrigin?.y].join(" "),...k.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,We.jsx)(Wn,{scope:o,placedSide:N,onArrowChange:L,arrowX:z,arrowY:U,shouldHideArrow:V,children:(0,We.jsx)(Go.div,{"data-side":N,"data-align":B,...g,ref:x,style:{...g.style,animation:D?void 0:"none"}})})})}));Jn.displayName=jn;var Zn="PopperArrow",Yn={top:"bottom",right:"left",bottom:"top",left:"right"},qn=t.forwardRef((function(e,t){const{__scopePopper:r,...o}=e,n=Kn(Zn,r),i=Yn[n.placedSide];return(0,We.jsx)("span",{ref:n.onArrowChange,style:{position:"absolute",left:n.arrowX,top:n.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[n.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[n.placedSide],visibility:n.shouldHideArrow?"hidden":void 0},children:(0,We.jsx)(kn,{...o,ref:t,style:{...o.style,display:"block"}})})}));function $n(e){return null!==e}qn.displayName=Zn;var Xn=e=>({name:"transformOrigin",options:e,fn(t){const{placement:r,rects:o,middlewareData:n}=t,i=0!==n.arrow?.centerOffset,a=i?0:e.arrowWidth,s=i?0:e.arrowHeight,[l,c]=Qn(r),u={start:"0%",center:"50%",end:"100%"}[c],d=(n.arrow?.x??0)+a/2,h=(n.arrow?.y??0)+s/2;let f="",m="";return"bottom"===l?(f=i?u:`${d}px`,m=-s+"px"):"top"===l?(f=i?u:`${d}px`,m=`${o.floating.height+s}px`):"right"===l?(f=-s+"px",m=i?u:`${h}px`):"left"===l&&(f=`${o.floating.width+s}px`,m=i?u:`${h}px`),{data:{x:f,y:m}}}});function Qn(e){const[t,r="center"]=e.split("-");return[t,r]}var ei=Vn,ti=Gn,ri=Jn,oi=qn,ni=t.forwardRef(((e,r)=>{const{container:o,...n}=e,[i,a]=t.useState(!1);_n((()=>a(!0)),[]);const s=o||i&&globalThis?.document?.body;return s?Fo.createPortal((0,We.jsx)(Go.div,{...n,ref:r}),s):null}));ni.displayName="Portal";var ii=e=>{const{present:r,children:o}=e,n=function(e){const[r,o]=t.useState(),n=t.useRef({}),i=t.useRef(e),a=t.useRef("none"),s=e?"mounted":"unmounted",[l,c]=function(e,r){return t.useReducer(((e,t)=>r[e][t]??e),e)}(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return t.useEffect((()=>{const e=ai(n.current);a.current="mounted"===l?e:"none"}),[l]),_n((()=>{const t=n.current,r=i.current;if(r!==e){const o=a.current,n=ai(t);if(e)c("MOUNT");else if("none"===n||"none"===t?.display)c("UNMOUNT");else{c(r&&o!==n?"ANIMATION_OUT":"UNMOUNT")}i.current=e}}),[e,c]),_n((()=>{if(r){let e;const t=r.ownerDocument.defaultView??window,o=o=>{const a=ai(n.current).includes(o.animationName);if(o.target===r&&a&&(c("ANIMATION_END"),!i.current)){const o=r.style.animationFillMode;r.style.animationFillMode="forwards",e=t.setTimeout((()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=o)}))}},s=e=>{e.target===r&&(a.current=ai(n.current))};return r.addEventListener("animationstart",s),r.addEventListener("animationcancel",o),r.addEventListener("animationend",o),()=>{t.clearTimeout(e),r.removeEventListener("animationstart",s),r.removeEventListener("animationcancel",o),r.removeEventListener("animationend",o)}}c("ANIMATION_END")}),[r,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:t.useCallback((e=>{e&&(n.current=getComputedStyle(e)),o(e)}),[])}}(r),i="function"===typeof o?o({present:n.isPresent}):t.Children.only(o),a=Oo(n.ref,function(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;if(r)return e.ref;if(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r)return e.props.ref;return e.props.ref||e.ref}(i));return"function"===typeof o||n.isPresent?t.cloneElement(i,{ref:a}):null};function ai(e){return e?.animationName||"none"}ii.displayName="Presence";var si="rovingFocusGroup.onEntryFocus",li={bubbles:!1,cancelable:!0},ci="RovingFocusGroup",[ui,di,hi]=Wo(ci),[fi,mi]=Do(ci,[hi]),[pi,gi]=fi(ci),_i=t.forwardRef(((e,t)=>(0,We.jsx)(ui.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,We.jsx)(ui.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,We.jsx)(yi,{...e,ref:t})})})));_i.displayName=ci;var yi=t.forwardRef(((e,r)=>{const{__scopeRovingFocusGroup:o,orientation:n,loop:i=!1,dir:a,currentTabStopId:s,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:d=!1,...h}=e,f=t.useRef(null),m=Oo(r,f),p=Jo(a),[g=null,_]=Bo({prop:s,defaultProp:l,onChange:c}),[y,v]=t.useState(!1),x=No(u),b=di(o),L=t.useRef(!1),[A,w]=t.useState(0);return t.useEffect((()=>{const e=f.current;if(e)return e.addEventListener(si,x),()=>e.removeEventListener(si,x)}),[x]),(0,We.jsx)(pi,{scope:o,orientation:n,dir:p,loop:i,currentTabStopId:g,onItemFocus:t.useCallback((e=>_(e)),[_]),onItemShiftTab:t.useCallback((()=>v(!0)),[]),onFocusableItemAdd:t.useCallback((()=>w((e=>e+1))),[]),onFocusableItemRemove:t.useCallback((()=>w((e=>e-1))),[]),children:(0,We.jsx)(Go.div,{tabIndex:y||0===A?-1:0,"data-orientation":n,...h,ref:m,style:{outline:"none",...e.style},onMouseDown:Ro(e.onMouseDown,(()=>{L.current=!0})),onFocus:Ro(e.onFocus,(e=>{const t=!L.current;if(e.target===e.currentTarget&&t&&!y){const t=new CustomEvent(si,li);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=b().filter((e=>e.focusable));Li([e.find((e=>e.active)),e.find((e=>e.id===g)),...e].filter(Boolean).map((e=>e.ref.current)),d)}}L.current=!1})),onBlur:Ro(e.onBlur,(()=>v(!1)))})})})),vi="RovingFocusGroupItem",xi=t.forwardRef(((e,r)=>{const{__scopeRovingFocusGroup:o,focusable:n=!0,active:i=!1,tabStopId:a,...s}=e,l=xn(),c=a||l,u=gi(vi,o),d=u.currentTabStopId===c,h=di(o),{onFocusableItemAdd:f,onFocusableItemRemove:m}=u;return t.useEffect((()=>{if(n)return f(),()=>m()}),[n,f,m]),(0,We.jsx)(ui.ItemSlot,{scope:o,id:c,focusable:n,active:i,children:(0,We.jsx)(Go.span,{tabIndex:d?0:-1,"data-orientation":u.orientation,...s,ref:r,onMouseDown:Ro(e.onMouseDown,(e=>{n?u.onItemFocus(c):e.preventDefault()})),onFocus:Ro(e.onFocus,(()=>u.onItemFocus(c))),onKeyDown:Ro(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,r){const o=function(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}(e.key,r);return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(o)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(o)?void 0:bi[o]}(e,u.orientation,u.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=h().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();const i=n.indexOf(e.currentTarget);n=u.loop?(o=i+1,(r=n).map(((e,t)=>r[(o+t)%r.length]))):n.slice(i+1)}setTimeout((()=>Li(n)))}var r,o}))})})}));xi.displayName=vi;var bi={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Li(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=document.activeElement;for(const o of e){if(o===r)return;if(o.focus({preventScroll:t}),document.activeElement!==r)return}}var Ai=_i,wi=xi,Si=function(e){return"undefined"===typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},Ei=new WeakMap,Ti=new WeakMap,Pi={},Ci=0,Ri=function(e){return e&&(e.host||Ri(e.parentNode))},Mi=function(e,t,r,o){var n=function(e,t){return t.map((function(t){if(e.contains(t))return t;var r=Ri(t);return r&&e.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",e,". Doing nothing"),null)})).filter((function(e){return Boolean(e)}))}(t,Array.isArray(e)?e:[e]);Pi[r]||(Pi[r]=new WeakMap);var i=Pi[r],a=[],s=new Set,l=new Set(n),c=function(e){e&&!s.has(e)&&(s.add(e),c(e.parentNode))};n.forEach(c);var u=function(e){e&&!l.has(e)&&Array.prototype.forEach.call(e.children,(function(e){if(s.has(e))u(e);else try{var t=e.getAttribute(o),n=null!==t&&"false"!==t,l=(Ei.get(e)||0)+1,c=(i.get(e)||0)+1;Ei.set(e,l),i.set(e,c),a.push(e),1===l&&n&&Ti.set(e,!0),1===c&&e.setAttribute(r,"true"),n||e.setAttribute(o,"true")}catch(d){console.error("aria-hidden: cannot operate on ",e,d)}}))};return u(t),s.clear(),Ci++,function(){a.forEach((function(e){var t=Ei.get(e)-1,n=i.get(e)-1;Ei.set(e,t),i.set(e,n),t||(Ti.has(e)||e.removeAttribute(o),Ti.delete(e)),n||e.removeAttribute(r)})),--Ci||(Ei=new WeakMap,Ei=new WeakMap,Ti=new WeakMap,Pi={})}},Ii=function(e,t,r){void 0===r&&(r="data-aria-hidden");var o=Array.from(Array.isArray(e)?e:[e]),n=t||Si(e);return n?(o.push.apply(o,Array.from(n.querySelectorAll("[aria-live]"))),Mi(o,n,r,"aria-hidden")):function(){return null}};var Oi=function(){return Oi=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},Oi.apply(this,arguments)};function Di(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}Object.create;function ki(e,t,r){if(r||2===arguments.length)for(var o,n=0,i=t.length;n<i;n++)!o&&n in t||(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}Object.create;"function"===typeof SuppressedError&&SuppressedError;var Ni="right-scroll-bar-position",Bi="width-before-scroll-bar";function Fi(e,t){return"function"===typeof e?e(t):e&&(e.current=t),e}var zi="undefined"!==typeof window?t.useLayoutEffect:t.useEffect,Ui=new WeakMap;function Vi(e,r){var o=function(e,r){var o=(0,t.useState)((function(){return{value:e,callback:r,facade:{get current(){return o.value},set current(e){var t=o.value;t!==e&&(o.value=e,o.callback(e,t))}}}}))[0];return o.callback=r,o.facade}(r||null,(function(t){return e.forEach((function(e){return Fi(e,t)}))}));return zi((function(){var t=Ui.get(o);if(t){var r=new Set(t),n=new Set(e),i=o.current;r.forEach((function(e){n.has(e)||Fi(e,null)})),n.forEach((function(e){r.has(e)||Fi(e,i)}))}Ui.set(o,e)}),[e]),o}function Hi(e){return e}function Gi(e,t){void 0===t&&(t=Hi);var r=[],o=!1,n={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(e){var n=t(e,o);return r.push(n),function(){r=r.filter((function(e){return e!==n}))}},assignSyncMedium:function(e){for(o=!0;r.length;){var t=r;r=[],t.forEach(e)}r={push:function(t){return e(t)},filter:function(){return r}}},assignMedium:function(e){o=!0;var t=[];if(r.length){var n=r;r=[],n.forEach(e),t=r}var i=function(){var r=t;t=[],r.forEach(e)},a=function(){return Promise.resolve().then(i)};a(),r={push:function(e){t.push(e),a()},filter:function(e){return t=t.filter(e),r}}}};return n}var ji=function(e){void 0===e&&(e={});var t=Gi(null);return t.options=Oi({async:!0,ssr:!1},e),t}(),Wi=function(){},Ki=t.forwardRef((function(e,r){var o=t.useRef(null),n=t.useState({onScrollCapture:Wi,onWheelCapture:Wi,onTouchMoveCapture:Wi}),i=n[0],a=n[1],s=e.forwardProps,l=e.children,c=e.className,u=e.removeScrollBar,d=e.enabled,h=e.shards,f=e.sideCar,m=e.noIsolation,p=e.inert,g=e.allowPinchZoom,_=e.as,y=void 0===_?"div":_,v=e.gapMode,x=Di(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),b=f,L=Vi([o,r]),A=Oi(Oi({},x),i);return t.createElement(t.Fragment,null,d&&t.createElement(b,{sideCar:ji,removeScrollBar:u,shards:h,noIsolation:m,inert:p,setCallbacks:a,allowPinchZoom:!!g,lockRef:o,gapMode:v}),s?t.cloneElement(t.Children.only(l),Oi(Oi({},A),{ref:L})):t.createElement(y,Oi({},A,{className:c,ref:L}),l))}));Ki.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Ki.classNames={fullWidth:Bi,zeroRight:Ni};var Ji,Zi=function(e){var r=e.sideCar,o=Di(e,["sideCar"]);if(!r)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=r.read();if(!n)throw new Error("Sidecar medium not found");return t.createElement(n,Oi({},o))};Zi.isSideCarExport=!0;function Yi(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=Ji||r.nc;return t&&e.setAttribute("nonce",t),e}var qi=function(){var e=0,t=null;return{add:function(r){var o,n;0==e&&(t=Yi())&&(n=r,(o=t).styleSheet?o.styleSheet.cssText=n:o.appendChild(document.createTextNode(n)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){! --e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},$i=function(){var e=function(){var e=qi();return function(r,o){t.useEffect((function(){return e.add(r),function(){e.remove()}}),[r&&o])}}();return function(t){var r=t.styles,o=t.dynamic;return e(r,o),null}},Xi={left:0,top:0,right:0,gap:0},Qi=function(e){return parseInt(e||"",10)||0},ea=function(e){if(void 0===e&&(e="margin"),"undefined"===typeof window)return Xi;var t=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],o=t["padding"===e?"paddingTop":"marginTop"],n=t["padding"===e?"paddingRight":"marginRight"];return[Qi(r),Qi(o),Qi(n)]}(e),r=document.documentElement.clientWidth,o=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,o-r+t[2]-t[0])}},ta=$i(),ra="data-scroll-locked",oa=function(e,t,r,o){var n=e.left,i=e.top,a=e.right,s=e.gap;return void 0===r&&(r="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(o,";\n   padding-right: ").concat(s,"px ").concat(o,";\n  }\n  body[").concat(ra,"] {\n    overflow: hidden ").concat(o,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(o,";"),"margin"===r&&"\n    padding-left: ".concat(n,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(a,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(s,"px ").concat(o,";\n    "),"padding"===r&&"padding-right: ".concat(s,"px ").concat(o,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(Ni," {\n    right: ").concat(s,"px ").concat(o,";\n  }\n  \n  .").concat(Bi," {\n    margin-right: ").concat(s,"px ").concat(o,";\n  }\n  \n  .").concat(Ni," .").concat(Ni," {\n    right: 0 ").concat(o,";\n  }\n  \n  .").concat(Bi," .").concat(Bi," {\n    margin-right: 0 ").concat(o,";\n  }\n  \n  body[").concat(ra,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(s,"px;\n  }\n")},na=function(){var e=parseInt(document.body.getAttribute(ra)||"0",10);return isFinite(e)?e:0},ia=function(e){var r=e.noRelative,o=e.noImportant,n=e.gapMode,i=void 0===n?"margin":n;t.useEffect((function(){return document.body.setAttribute(ra,(na()+1).toString()),function(){var e=na()-1;e<=0?document.body.removeAttribute(ra):document.body.setAttribute(ra,e.toString())}}),[]);var a=t.useMemo((function(){return ea(i)}),[i]);return t.createElement(ta,{styles:oa(a,!r,i,o?"":"!important")})},aa=!1;if("undefined"!==typeof window)try{var sa=Object.defineProperty({},"passive",{get:function(){return aa=!0,!0}});window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch(Dl){aa=!1}var la=!!aa&&{passive:!1},ca=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return"hidden"!==r[t]&&!(r.overflowY===r.overflowX&&!function(e){return"TEXTAREA"===e.tagName}(e)&&"visible"===r[t])},ua=function(e,t){var r=t.ownerDocument,o=t;do{if("undefined"!==typeof ShadowRoot&&o instanceof ShadowRoot&&(o=o.host),da(e,o)){var n=ha(e,o);if(n[1]>n[2])return!0}o=o.parentNode}while(o&&o!==r.body);return!1},da=function(e,t){return"v"===e?function(e){return ca(e,"overflowY")}(t):function(e){return ca(e,"overflowX")}(t)},ha=function(e,t){return"v"===e?[(r=t).scrollTop,r.scrollHeight,r.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var r},fa=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},ma=function(e){return[e.deltaX,e.deltaY]},pa=function(e){return e&&"current"in e?e.current:e},ga=function(e){return"\n  .block-interactivity-".concat(e," {pointer-events: none;}\n  .allow-interactivity-").concat(e," {pointer-events: all;}\n")},_a=0,ya=[];function va(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const xa=(ba=function(e){var r=t.useRef([]),o=t.useRef([0,0]),n=t.useRef(),i=t.useState(_a++)[0],a=t.useState($i)[0],s=t.useRef(e);t.useEffect((function(){s.current=e}),[e]),t.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=ki([e.lockRef.current],(e.shards||[]).map(pa),!0).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-".concat(i))})),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach((function(e){return e.classList.remove("allow-interactivity-".concat(i))}))}}}),[e.inert,e.lockRef.current,e.shards]);var l=t.useCallback((function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var r,i=fa(e),a=o.current,l="deltaX"in e?e.deltaX:a[0]-i[0],c="deltaY"in e?e.deltaY:a[1]-i[1],u=e.target,d=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===d&&"range"===u.type)return!1;var h=ua(d,u);if(!h)return!0;if(h?r=d:(r="v"===d?"h":"v",h=ua(d,u)),!h)return!1;if(!n.current&&"changedTouches"in e&&(l||c)&&(n.current=r),!r)return!0;var f=n.current||r;return function(e,t,r,o,n){var i=function(e,t){return"h"===e&&"rtl"===t?-1:1}(e,window.getComputedStyle(t).direction),a=i*o,s=r.target,l=t.contains(s),c=!1,u=a>0,d=0,h=0;do{var f=ha(e,s),m=f[0],p=f[1]-f[2]-i*m;(m||p)&&da(e,s)&&(d+=p,h+=m),s=s instanceof ShadowRoot?s.host:s.parentNode}while(!l&&s!==document.body||l&&(t.contains(s)||t===s));return(u&&(n&&Math.abs(d)<1||!n&&a>d)||!u&&(n&&Math.abs(h)<1||!n&&-a>h))&&(c=!0),c}(f,t,e,"h"===f?l:c,!0)}),[]),c=t.useCallback((function(e){var t=e;if(ya.length&&ya[ya.length-1]===a){var o="deltaY"in t?ma(t):fa(t),n=r.current.filter((function(e){return e.name===t.type&&(e.target===t.target||t.target===e.shadowParent)&&function(e,t){return e[0]===t[0]&&e[1]===t[1]}(e.delta,o)}))[0];if(n&&n.should)t.cancelable&&t.preventDefault();else if(!n){var i=(s.current.shards||[]).map(pa).filter(Boolean).filter((function(e){return e.contains(t.target)}));(i.length>0?l(t,i[0]):!s.current.noIsolation)&&t.cancelable&&t.preventDefault()}}}),[]),u=t.useCallback((function(e,t,o,n){var i={name:e,delta:t,target:o,should:n,shadowParent:va(o)};r.current.push(i),setTimeout((function(){r.current=r.current.filter((function(e){return e!==i}))}),1)}),[]),d=t.useCallback((function(e){o.current=fa(e),n.current=void 0}),[]),h=t.useCallback((function(t){u(t.type,ma(t),t.target,l(t,e.lockRef.current))}),[]),f=t.useCallback((function(t){u(t.type,fa(t),t.target,l(t,e.lockRef.current))}),[]);t.useEffect((function(){return ya.push(a),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:f}),document.addEventListener("wheel",c,la),document.addEventListener("touchmove",c,la),document.addEventListener("touchstart",d,la),function(){ya=ya.filter((function(e){return e!==a})),document.removeEventListener("wheel",c,la),document.removeEventListener("touchmove",c,la),document.removeEventListener("touchstart",d,la)}}),[]);var m=e.removeScrollBar,p=e.inert;return t.createElement(t.Fragment,null,p?t.createElement(a,{styles:ga(i)}):null,m?t.createElement(ia,{gapMode:e.gapMode}):null)},ji.useMedium(ba),Zi);var ba,La=t.forwardRef((function(e,r){return t.createElement(Ki,Oi({},e,{ref:r,sideCar:xa}))}));La.classNames=Ki.classNames;const Aa=La;var wa=["Enter"," "],Sa=["ArrowUp","PageDown","End"],Ea=["ArrowDown","PageUp","Home",...Sa],Ta={ltr:[...wa,"ArrowRight"],rtl:[...wa,"ArrowLeft"]},Pa={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Ca="Menu",[Ra,Ma,Ia]=Wo(Ca),[Oa,Da]=Do(Ca,[Ia,Fn,mi]),ka=Fn(),Na=mi(),[Ba,Fa]=Oa(Ca),[za,Ua]=Oa(Ca),Va=e=>{const{__scopeMenu:r,open:o=!1,children:n,dir:i,onOpenChange:a,modal:s=!0}=e,l=ka(r),[c,u]=t.useState(null),d=t.useRef(!1),h=No(a),f=Jo(i);return t.useEffect((()=>{const e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),(0,We.jsx)(ei,{...l,children:(0,We.jsx)(Ba,{scope:r,open:o,onOpenChange:h,content:c,onContentChange:u,children:(0,We.jsx)(za,{scope:r,onClose:t.useCallback((()=>h(!1)),[h]),isUsingKeyboardRef:d,dir:f,modal:s,children:n})})})};Va.displayName=Ca;var Ha=t.forwardRef(((e,t)=>{const{__scopeMenu:r,...o}=e,n=ka(r);return(0,We.jsx)(ti,{...n,...o,ref:t})}));Ha.displayName="MenuAnchor";var Ga="MenuPortal",[ja,Wa]=Oa(Ga,{forceMount:void 0}),Ka=e=>{const{__scopeMenu:t,forceMount:r,children:o,container:n}=e,i=Fa(Ga,t);return(0,We.jsx)(ja,{scope:t,forceMount:r,children:(0,We.jsx)(ii,{present:r||i.open,children:(0,We.jsx)(ni,{asChild:!0,container:n,children:o})})})};Ka.displayName=Ga;var Ja="MenuContent",[Za,Ya]=Oa(Ja),qa=t.forwardRef(((e,t)=>{const r=Wa(Ja,e.__scopeMenu),{forceMount:o=r.forceMount,...n}=e,i=Fa(Ja,e.__scopeMenu),a=Ua(Ja,e.__scopeMenu);return(0,We.jsx)(Ra.Provider,{scope:e.__scopeMenu,children:(0,We.jsx)(ii,{present:o||i.open,children:(0,We.jsx)(Ra.Slot,{scope:e.__scopeMenu,children:a.modal?(0,We.jsx)($a,{...n,ref:t}):(0,We.jsx)(Xa,{...n,ref:t})})})})})),$a=t.forwardRef(((e,r)=>{const o=Fa(Ja,e.__scopeMenu),n=t.useRef(null),i=Oo(r,n);return t.useEffect((()=>{const e=n.current;if(e)return Ii(e)}),[]),(0,We.jsx)(Qa,{...e,ref:i,trapFocus:o.open,disableOutsidePointerEvents:o.open,disableOutsideScroll:!0,onFocusOutside:Ro(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>o.onOpenChange(!1)})})),Xa=t.forwardRef(((e,t)=>{const r=Fa(Ja,e.__scopeMenu);return(0,We.jsx)(Qa,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})})),Qa=t.forwardRef(((e,r)=>{const{__scopeMenu:o,loop:n=!1,trapFocus:i,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,disableOutsideScroll:p,...g}=e,_=Fa(Ja,o),y=Ua(Ja,o),v=ka(o),x=Na(o),b=Ma(o),[L,A]=t.useState(null),w=t.useRef(null),S=Oo(r,w,_.onContentChange),E=t.useRef(0),T=t.useRef(""),P=t.useRef(0),C=t.useRef(null),R=t.useRef("right"),M=t.useRef(0),I=p?Aa:t.Fragment,O=p?{as:zo,allowPinchZoom:!0}:void 0,D=e=>{const t=T.current+e,r=b().filter((e=>!e.disabled)),o=document.activeElement,n=r.find((e=>e.ref.current===o))?.textValue,i=function(e,t,r){const o=t.length>1&&Array.from(t).every((e=>e===t[0])),n=o?t[0]:t,i=r?e.indexOf(r):-1;let a=(s=e,l=Math.max(i,0),s.map(((e,t)=>s[(l+t)%s.length])));var s,l;1===n.length&&(a=a.filter((e=>e!==r)));const c=a.find((e=>e.toLowerCase().startsWith(n.toLowerCase())));return c!==r?c:void 0}(r.map((e=>e.textValue)),t,n),a=r.find((e=>e.textValue===i))?.ref.current;!function e(t){T.current=t,window.clearTimeout(E.current),""!==t&&(E.current=window.setTimeout((()=>e("")),1e3))}(t),a&&setTimeout((()=>a.focus()))};t.useEffect((()=>()=>window.clearTimeout(E.current)),[]),nn();const k=t.useCallback((e=>R.current===C.current?.side&&function(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return function(e,t){const{x:r,y:o}=e;let n=!1;for(let i=0,a=t.length-1;i<t.length;a=i++){const e=t[i].x,s=t[i].y,l=t[a].x,c=t[a].y;s>o!==c>o&&r<(l-e)*(o-s)/(c-s)+e&&(n=!n)}return n}(r,t)}(e,C.current?.area)),[]);return(0,We.jsx)(Za,{scope:o,searchRef:T,onItemEnter:t.useCallback((e=>{k(e)&&e.preventDefault()}),[k]),onItemLeave:t.useCallback((e=>{k(e)||(w.current?.focus(),A(null))}),[k]),onTriggerLeave:t.useCallback((e=>{k(e)&&e.preventDefault()}),[k]),pointerGraceTimerRef:P,onPointerGraceIntentChange:t.useCallback((e=>{C.current=e}),[]),children:(0,We.jsx)(I,{...O,children:(0,We.jsx)(un,{asChild:!0,trapped:i,onMountAutoFocus:Ro(a,(e=>{e.preventDefault(),w.current?.focus({preventScroll:!0})})),onUnmountAutoFocus:s,children:(0,We.jsx)(Qo,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:f,onDismiss:m,children:(0,We.jsx)(Ai,{asChild:!0,...x,dir:y.dir,orientation:"vertical",loop:n,currentTabStopId:L,onCurrentTabStopIdChange:A,onEntryFocus:Ro(c,(e=>{y.isUsingKeyboardRef.current||e.preventDefault()})),preventScrollOnEntryFocus:!0,children:(0,We.jsx)(ri,{role:"menu","aria-orientation":"vertical","data-state":Ts(_.open),"data-radix-menu-content":"",dir:y.dir,...v,...g,ref:S,style:{outline:"none",...g.style},onKeyDown:Ro(g.onKeyDown,(e=>{const t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,o=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!r&&o&&D(e.key));const n=w.current;if(e.target!==n)return;if(!Ea.includes(e.key))return;e.preventDefault();const i=b().filter((e=>!e.disabled)).map((e=>e.ref.current));Sa.includes(e.key)&&i.reverse(),function(e){const t=document.activeElement;for(const r of e){if(r===t)return;if(r.focus(),document.activeElement!==t)return}}(i)})),onBlur:Ro(e.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(E.current),T.current="")})),onPointerMove:Ro(e.onPointerMove,Rs((e=>{const t=e.target,r=M.current!==e.clientX;if(e.currentTarget.contains(t)&&r){const t=e.clientX>M.current?"right":"left";R.current=t,M.current=e.clientX}})))})})})})})})}));qa.displayName=Ja;var es=t.forwardRef(((e,t)=>{const{__scopeMenu:r,...o}=e;return(0,We.jsx)(Go.div,{role:"group",...o,ref:t})}));es.displayName="MenuGroup";var ts=t.forwardRef(((e,t)=>{const{__scopeMenu:r,...o}=e;return(0,We.jsx)(Go.div,{...o,ref:t})}));ts.displayName="MenuLabel";var rs="MenuItem",os="menu.itemSelect",ns=t.forwardRef(((e,r)=>{const{disabled:o=!1,onSelect:n,...i}=e,a=t.useRef(null),s=Ua(rs,e.__scopeMenu),l=Ya(rs,e.__scopeMenu),c=Oo(r,a),u=t.useRef(!1);return(0,We.jsx)(is,{...i,ref:c,disabled:o,onClick:Ro(e.onClick,(()=>{const e=a.current;if(!o&&e){const t=new CustomEvent(os,{bubbles:!0,cancelable:!0});e.addEventListener(os,(e=>n?.(e)),{once:!0}),jo(e,t),t.defaultPrevented?u.current=!1:s.onClose()}})),onPointerDown:t=>{e.onPointerDown?.(t),u.current=!0},onPointerUp:Ro(e.onPointerUp,(e=>{u.current||e.currentTarget?.click()})),onKeyDown:Ro(e.onKeyDown,(e=>{const t=""!==l.searchRef.current;o||t&&" "===e.key||wa.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))})}));ns.displayName=rs;var is=t.forwardRef(((e,r)=>{const{__scopeMenu:o,disabled:n=!1,textValue:i,...a}=e,s=Ya(rs,o),l=Na(o),c=t.useRef(null),u=Oo(r,c),[d,h]=t.useState(!1),[f,m]=t.useState("");return t.useEffect((()=>{const e=c.current;e&&m((e.textContent??"").trim())}),[a.children]),(0,We.jsx)(Ra.ItemSlot,{scope:o,disabled:n,textValue:i??f,children:(0,We.jsx)(wi,{asChild:!0,...l,focusable:!n,children:(0,We.jsx)(Go.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...a,ref:u,onPointerMove:Ro(e.onPointerMove,Rs((e=>{if(n)s.onItemLeave(e);else if(s.onItemEnter(e),!e.defaultPrevented){e.currentTarget.focus({preventScroll:!0})}}))),onPointerLeave:Ro(e.onPointerLeave,Rs((e=>s.onItemLeave(e)))),onFocus:Ro(e.onFocus,(()=>h(!0))),onBlur:Ro(e.onBlur,(()=>h(!1)))})})})})),as=t.forwardRef(((e,t)=>{const{checked:r=!1,onCheckedChange:o,...n}=e;return(0,We.jsx)(ms,{scope:e.__scopeMenu,checked:r,children:(0,We.jsx)(ns,{role:"menuitemcheckbox","aria-checked":Ps(r)?"mixed":r,...n,ref:t,"data-state":Cs(r),onSelect:Ro(n.onSelect,(()=>o?.(!!Ps(r)||!r)),{checkForDefaultPrevented:!1})})})}));as.displayName="MenuCheckboxItem";var ss="MenuRadioGroup",[ls,cs]=Oa(ss,{value:void 0,onValueChange:()=>{}}),us=t.forwardRef(((e,t)=>{const{value:r,onValueChange:o,...n}=e,i=No(o);return(0,We.jsx)(ls,{scope:e.__scopeMenu,value:r,onValueChange:i,children:(0,We.jsx)(es,{...n,ref:t})})}));us.displayName=ss;var ds="MenuRadioItem",hs=t.forwardRef(((e,t)=>{const{value:r,...o}=e,n=cs(ds,e.__scopeMenu),i=r===n.value;return(0,We.jsx)(ms,{scope:e.__scopeMenu,checked:i,children:(0,We.jsx)(ns,{role:"menuitemradio","aria-checked":i,...o,ref:t,"data-state":Cs(i),onSelect:Ro(o.onSelect,(()=>n.onValueChange?.(r)),{checkForDefaultPrevented:!1})})})}));hs.displayName=ds;var fs="MenuItemIndicator",[ms,ps]=Oa(fs,{checked:!1}),gs=t.forwardRef(((e,t)=>{const{__scopeMenu:r,forceMount:o,...n}=e,i=ps(fs,r);return(0,We.jsx)(ii,{present:o||Ps(i.checked)||!0===i.checked,children:(0,We.jsx)(Go.span,{...n,ref:t,"data-state":Cs(i.checked)})})}));gs.displayName=fs;var _s=t.forwardRef(((e,t)=>{const{__scopeMenu:r,...o}=e;return(0,We.jsx)(Go.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})}));_s.displayName="MenuSeparator";var ys=t.forwardRef(((e,t)=>{const{__scopeMenu:r,...o}=e,n=ka(r);return(0,We.jsx)(oi,{...n,...o,ref:t})}));ys.displayName="MenuArrow";var vs="MenuSub",[xs,bs]=Oa(vs),Ls=e=>{const{__scopeMenu:r,children:o,open:n=!1,onOpenChange:i}=e,a=Fa(vs,r),s=ka(r),[l,c]=t.useState(null),[u,d]=t.useState(null),h=No(i);return t.useEffect((()=>(!1===a.open&&h(!1),()=>h(!1))),[a.open,h]),(0,We.jsx)(ei,{...s,children:(0,We.jsx)(Ba,{scope:r,open:n,onOpenChange:h,content:u,onContentChange:d,children:(0,We.jsx)(xs,{scope:r,contentId:xn(),triggerId:xn(),trigger:l,onTriggerChange:c,children:o})})})};Ls.displayName=vs;var As="MenuSubTrigger",ws=t.forwardRef(((e,r)=>{const o=Fa(As,e.__scopeMenu),n=Ua(As,e.__scopeMenu),i=bs(As,e.__scopeMenu),a=Ya(As,e.__scopeMenu),s=t.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,u={__scopeMenu:e.__scopeMenu},d=t.useCallback((()=>{s.current&&window.clearTimeout(s.current),s.current=null}),[]);return t.useEffect((()=>d),[d]),t.useEffect((()=>{const e=l.current;return()=>{window.clearTimeout(e),c(null)}}),[l,c]),(0,We.jsx)(Ha,{asChild:!0,...u,children:(0,We.jsx)(is,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":i.contentId,"data-state":Ts(o.open),...e,ref:Io(r,i.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),o.open||o.onOpenChange(!0))},onPointerMove:Ro(e.onPointerMove,Rs((t=>{a.onItemEnter(t),t.defaultPrevented||e.disabled||o.open||s.current||(a.onPointerGraceIntentChange(null),s.current=window.setTimeout((()=>{o.onOpenChange(!0),d()}),100))}))),onPointerLeave:Ro(e.onPointerLeave,Rs((e=>{d();const t=o.content?.getBoundingClientRect();if(t){const r=o.content?.dataset.side,n="right"===r,i=n?-5:5,s=t[n?"left":"right"],c=t[n?"right":"left"];a.onPointerGraceIntentChange({area:[{x:e.clientX+i,y:e.clientY},{x:s,y:t.top},{x:c,y:t.top},{x:c,y:t.bottom},{x:s,y:t.bottom}],side:r}),window.clearTimeout(l.current),l.current=window.setTimeout((()=>a.onPointerGraceIntentChange(null)),300)}else{if(a.onTriggerLeave(e),e.defaultPrevented)return;a.onPointerGraceIntentChange(null)}}))),onKeyDown:Ro(e.onKeyDown,(t=>{const r=""!==a.searchRef.current;e.disabled||r&&" "===t.key||Ta[n.dir].includes(t.key)&&(o.onOpenChange(!0),o.content?.focus(),t.preventDefault())}))})})}));ws.displayName=As;var Ss="MenuSubContent",Es=t.forwardRef(((e,r)=>{const o=Wa(Ja,e.__scopeMenu),{forceMount:n=o.forceMount,...i}=e,a=Fa(Ja,e.__scopeMenu),s=Ua(Ja,e.__scopeMenu),l=bs(Ss,e.__scopeMenu),c=t.useRef(null),u=Oo(r,c);return(0,We.jsx)(Ra.Provider,{scope:e.__scopeMenu,children:(0,We.jsx)(ii,{present:n||a.open,children:(0,We.jsx)(Ra.Slot,{scope:e.__scopeMenu,children:(0,We.jsx)(Qa,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:u,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{s.isUsingKeyboardRef.current&&c.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:Ro(e.onFocusOutside,(e=>{e.target!==l.trigger&&a.onOpenChange(!1)})),onEscapeKeyDown:Ro(e.onEscapeKeyDown,(e=>{s.onClose(),e.preventDefault()})),onKeyDown:Ro(e.onKeyDown,(e=>{const t=e.currentTarget.contains(e.target),r=Pa[s.dir].includes(e.key);t&&r&&(a.onOpenChange(!1),l.trigger?.focus(),e.preventDefault())}))})})})})}));function Ts(e){return e?"open":"closed"}function Ps(e){return"indeterminate"===e}function Cs(e){return Ps(e)?"indeterminate":e?"checked":"unchecked"}function Rs(e){return t=>"mouse"===t.pointerType?e(t):void 0}Es.displayName=Ss;var Ms=Va,Is=Ha,Os=Ka,Ds=qa,ks=es,Ns=ts,Bs=ns,Fs=as,zs=us,Us=hs,Vs=gs,Hs=_s,Gs=ys,js=ws,Ws=Es,Ks="DropdownMenu",[Js,Zs]=Do(Ks,[Da]),Ys=Da(),[qs,$s]=Js(Ks),Xs=e=>{const{__scopeDropdownMenu:r,children:o,dir:n,open:i,defaultOpen:a,onOpenChange:s,modal:l=!0}=e,c=Ys(r),u=t.useRef(null),[d=!1,h]=Bo({prop:i,defaultProp:a,onChange:s});return(0,We.jsx)(qs,{scope:r,triggerId:xn(),triggerRef:u,contentId:xn(),open:d,onOpenChange:h,onOpenToggle:t.useCallback((()=>h((e=>!e))),[h]),modal:l,children:(0,We.jsx)(Ms,{...c,open:d,onOpenChange:h,dir:n,modal:l,children:o})})};Xs.displayName=Ks;var Qs="DropdownMenuTrigger",el=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,disabled:o=!1,...n}=e,i=$s(Qs,r),a=Ys(r);return(0,We.jsx)(Is,{asChild:!0,...a,children:(0,We.jsx)(Go.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...n,ref:Io(t,i.triggerRef),onPointerDown:Ro(e.onPointerDown,(e=>{o||0!==e.button||!1!==e.ctrlKey||(i.onOpenToggle(),i.open||e.preventDefault())})),onKeyDown:Ro(e.onKeyDown,(e=>{o||(["Enter"," "].includes(e.key)&&i.onOpenToggle(),"ArrowDown"===e.key&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())}))})})}));el.displayName=Qs;var tl=e=>{const{__scopeDropdownMenu:t,...r}=e,o=Ys(t);return(0,We.jsx)(Os,{...o,...r})};tl.displayName="DropdownMenuPortal";var rl="DropdownMenuContent",ol=t.forwardRef(((e,r)=>{const{__scopeDropdownMenu:o,...n}=e,i=$s(rl,o),a=Ys(o),s=t.useRef(!1);return(0,We.jsx)(Ds,{id:i.contentId,"aria-labelledby":i.triggerId,...a,...n,ref:r,onCloseAutoFocus:Ro(e.onCloseAutoFocus,(e=>{s.current||i.triggerRef.current?.focus(),s.current=!1,e.preventDefault()})),onInteractOutside:Ro(e.onInteractOutside,(e=>{const t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,o=2===t.button||r;i.modal&&!o||(s.current=!0)})),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));ol.displayName=rl;var nl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(ks,{...n,...o,ref:t})}));nl.displayName="DropdownMenuGroup";var il=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Ns,{...n,...o,ref:t})}));il.displayName="DropdownMenuLabel";var al=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Bs,{...n,...o,ref:t})}));al.displayName="DropdownMenuItem";var sl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Fs,{...n,...o,ref:t})}));sl.displayName="DropdownMenuCheckboxItem";var ll=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(zs,{...n,...o,ref:t})}));ll.displayName="DropdownMenuRadioGroup";var cl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Us,{...n,...o,ref:t})}));cl.displayName="DropdownMenuRadioItem";var ul=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Vs,{...n,...o,ref:t})}));ul.displayName="DropdownMenuItemIndicator";var dl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Hs,{...n,...o,ref:t})}));dl.displayName="DropdownMenuSeparator";var hl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Gs,{...n,...o,ref:t})}));hl.displayName="DropdownMenuArrow";var fl=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(js,{...n,...o,ref:t})}));fl.displayName="DropdownMenuSubTrigger";var ml=t.forwardRef(((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,n=Ys(r);return(0,We.jsx)(Ws,{...n,...o,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}));ml.displayName="DropdownMenuSubContent";var pl=Xs,gl=el,_l=tl,yl=ol,vl=al;const xl=()=>{const[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)(!1),[i,a]=(0,t.useState)(!0);(0,t.useEffect)((()=>{s();const e=setInterval(s,3e5);return()=>clearInterval(e)}),[]);const s=async()=>{try{const e=await yo.get("https://ecfmp.vatsim.net/api/v1/flow-measure");if(e.data&&Array.isArray(e.data)){const t=e.data.filter((e=>{var t;return null===(t=e.notified_flight_information_regions)||void 0===t?void 0:t.includes(20)}));r(t)}}catch(Dl){console.error("Error fetching data:",Dl)}},l=e=>(new Date).toISOString()>e,c=e=>{const t=new Date,r=new Date(e)-t;return r>0&&r<=864e5},u=(e,t)=>{const r=new Date(e),o=new Date(t);return r.toDateString()===o.toDateString()?t.split("T")[1].substring(0,5):t.replace("T"," ").substring(0,16)},d=(e,t)=>{if(t)return"Withdrawn";const r=new Date,o=new Date(e)-r;if(o<=0)return"Expired";return`${Math.floor(o/36e5)}h ${Math.floor(o%36e5/6e4)}m left`},h=e=>null!==e&&void 0!==e&&e.type&&{minimum_departure_interval:"MDI",average_departure_interval:"ADI",per_hour:"Rate",miles_in_trail:"MIT",max_ias:"Max IAS",max_mach:"Max Mach",ias_reduction:"IAS Reduction",mach_reduction:"Mach Reduction",prohibit:"Prohibit",ground_stop:"GROUND STOP",mandatory_route:"Mandatory Route"}[e.type]||"NIL",f=e=>{if(null===e||void 0===e||!e.value)return"NIL";const{type:t,value:r}=e;switch(t){case"minimum_departure_interval":case"average_departure_interval":const t=Math.floor(r/60),o=r%60;return 0===o?`${t} min`:`${t} min ${o} sec`;case"per_hour":return`${r} / h`;case"miles_in_trail":return`${r} nm`;case"max_ias":case"ias_reduction":return`${r} kt`;case"max_mach":return`0.${r}`;case"mach_reduction":return`0.0${r}`;case"prohibit":return"Prohibited";case"ground_stop":return" ";case"mandatory_route":return e.value.join(" OR ");default:return"NIL"}},m=e.filter((e=>!(!o&&l(e.endtime))&&!(!i&&c(e.starttime))));return(0,We.jsxs)("div",{children:[(0,We.jsxs)("div",{className:"text-sm bg-gray-400",style:{display:"flex",gap:"4px",paddingBottom:"8px"},children:[(0,We.jsx)("button",{onClick:()=>a(!i),style:{backgroundColor:i?"orange":"transparent",color:i?"white":"orange",border:"1px solid orange",padding:"4px 8px"},children:i?"Hide Notified":"Show Notified"}),(0,We.jsx)("button",{onClick:()=>n(!o),style:{backgroundColor:o?"red":"transparent",color:o?"white":"red",border:"1px solid red",padding:"4px 8px"},children:o?"Hide Expired":"Show Expired"}),(0,We.jsx)("button",{onClick:()=>window.open("https://ecfmp.vatsim.net/dashboard/flow-measures/create","_blank"),style:{backgroundColor:"#4CAF50",color:"white",border:"none",padding:"4px 8px"},children:"New"})]}),(0,We.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",textAlign:"left"},children:[(0,We.jsx)("thead",{children:(0,We.jsxs)("tr",{className:"bg-gray-400 text-white text-sm",children:[(0,We.jsx)("th",{style:{padding:"2px"},children:"ID"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Start"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"End"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Type"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Value"}),(0,We.jsx)("th",{style:{padding:"2px"},children:"Filters"})]})}),(0,We.jsx)("tbody",{className:"monospace-font text-sm table-line",children:m.length>0?m.map((e=>{return(0,We.jsxs)("tr",{style:{backgroundColor:l(e.endtime)?"#FFCCCB":c(e.starttime)?"#FFD580":"transparent"},children:[(0,We.jsx)("td",{style:{padding:"8px"},children:(0,We.jsx)("a",{href:`https://ecfmp.vatsim.net/dashboard/flow-measures/${e.id}`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",textDecoration:"none"},children:e.ident})}),(0,We.jsx)("td",{style:{padding:"8px"},title:d(e.starttime,e.withdrawn_at),children:(o=e.starttime,o.replace("T","  ").replace(/:\d{2}\.\d{3}Z$/,"Z").replace(/:\d{2}Z$/,""))}),(0,We.jsxs)("td",{style:{padding:"8px"},title:d(e.endtime,e.withdrawn_at),children:[(0,We.jsx)("span",{style:{textDecoration:e.withdrawn_at?"line-through":"none"},children:u(e.starttime,e.endtime)}),e.withdrawn_at&&(0,We.jsx)("span",{style:{marginLeft:"5px"},children:(r=e.withdrawn_at,r.split("T")[1].substring(0,5))})]}),(0,We.jsx)("td",{style:{padding:"8px"},children:h(e.measure)}),(0,We.jsx)("td",{style:{padding:"8px"},children:f(e.measure)}),(0,We.jsx)("td",{style:{padding:"8px"},children:(t=e.filters,Array.isArray(t)&&0!==t.length?t.map((e=>{const{type:t,value:r}=e;switch(t){case"ADEP":case"ADES":return`${t}: ${Array.isArray(r)?r.join(", "):r}`;case"level_above":return`FL${r}+`;case"level_below":return`FL${r}-`;case"level":return`FL=${Array.isArray(r)?r.join("/"):r}`;case"waypoint":return`Via: ${Array.isArray(r)?r.join(" OR "):r}`;case"member_event":return"Event Member";case"member_not_event":return"Not Event Member";default:return`${t}: ${JSON.stringify(r)}`}})).join(" | "):"None")})]},e.ident);var t,r,o})):(0,We.jsx)("tr",{children:(0,We.jsx)("td",{colSpan:"6",style:{textAlign:"center",padding:"16px"},children:"No Flow Measures"})})})]})]})},bl=r.p+"static/media/airports.05129f2dfe991bdf9e9a.txt",Ll=JSON.parse('[{"icao":"A002","code":"LG1P","manufacturer":"IRKUT","model":"A-002"},{"icao":"A1","code":"ML1P","manufacturer":"DOUGLAS","model":"A1, EA1, AD Skyraider"},{"icao":"A10","code":"ML2J","manufacturer":"FAIRCHILD, US","model":"A10, OA10 Thunderbolt 2"},{"icao":"A109","code":"LH2T","manufacturer":"AGUSTA","model":"A109, Power"},{"icao":"A119","code":"LH1T","manufacturer":"AGUSTA","model":"A119 Koala"},{"icao":"A122","code":"LL1P","manufacturer":"AEROTEC","model":"A122 Uirapuru (T23)"},{"icao":"A124","code":"HL4J","manufacturer":"ANTONOV","model":"An124 Ruslan"},{"icao":"A129","code":"LH2T","manufacturer":"AGUSTA","model":"A129 Mangusta"},{"icao":"A139","code":"LH2T","manufacturer":"AGUSTA","model":"AB139"},{"icao":"A140","code":"ML2T","manufacturer":"ANTONOV","model":"An140"},{"icao":"A148","code":"ML2J","manufacturer":"ANTONOV","model":"An148"},{"icao":"A149","code":"MH2T","manufacturer":"AGUSTA","model":"AW-149"},{"icao":"A158","code":"ML2J","manufacturer":"ANTONOV","model":"An-158"},{"icao":"A16","code":"LL1P","manufacturer":"AVIADESIGN","model":"A-16 Sport Falcon"},{"icao":"A169","code":"LH2T","manufacturer":"AGUSTAWESTLAND","model":"AW-169"},{"icao":"A178","code":"ML2J","manufacturer":"ANTONOV","model":"An-178"},{"icao":"A189","code":"MH2T","manufacturer":"AGUSTAWESTLAND","model":"AW-189"},{"icao":"A19","code":"LL1P","manufacturer":"AEROPRACT","model":"A19"},{"icao":"A19N","code":"ML2J","manufacturer":"AIRBUS","model":"A319 Neo"},{"icao":"A20","code":"ML2P","manufacturer":"DOUGLAS","model":"A20 Havoc"},{"icao":"A205","code":"LG1P","manufacturer":"OSKBES-MAI","model":"MAI-205"},{"icao":"A20J","code":"LL1J","manufacturer":"SCHLEICHER","model":"ASW-20J"},{"icao":"A20N","code":"ML2J","manufacturer":"AIRBUS","model":"A320 Neo"},{"icao":"A21","code":"LL1P","manufacturer":"AEROPRACT","model":"A21 Solo"},{"icao":"A210","code":"LL1P","manufacturer":"AQUILA","model":"A210"},{"icao":"A211","code":"LL1P","manufacturer":"ALFA\ufffdM","model":"A211"},{"icao":"A21N","code":"ML2J","manufacturer":"AIRBUS","model":"A321 Neo"},{"icao":"A22","code":"LL1P","manufacturer":"SADLER","model":"A22 Piranha"},{"icao":"A223","code":"LL1P","manufacturer":"OSKBES-MAI","model":"MAI-223 Kityonok"},{"icao":"A225","code":"HL6J","manufacturer":"ANTONOV","model":"An225 Mriya"},{"icao":"A23","code":"LL1P","manufacturer":"AEROPRACT","model":"A23 Dragon"},{"icao":"A25","code":"LA1P","manufacturer":"AEROPRACT","model":"A25 Breeze"},{"icao":"A251","code":"LA2P","manufacturer":"AVIATIK-ALYANS","model":"Aleks-251"},{"icao":"A27","code":"LL1P","manufacturer":"AEROPRACT","model":"A27"},{"icao":"A270","code":"LL1T","manufacturer":"AERO VODOCHODY, CZECH","model":"Ae270 Ibis"},{"icao":"A29","code":"LL1P","manufacturer":"AVANTAGE","model":"A-29"},{"icao":"A2RT","code":"LH2T","manufacturer":"KAZAN","model":"Ansat 2RT"},{"icao":"A3","code":"ML2J","manufacturer":"DOUGLAS","model":"A3, ERA3, NRA3, TA3 Skywarrior"},{"icao":"A306","code":"HL2J","manufacturer":"AIRBUS","model":"A300B4600"},{"icao":"A30B","code":"HL2J","manufacturer":"AIRBUS","model":"A300B2/41/2/100/200, A300C4200"},{"icao":"A31","code":"LL1P","manufacturer":"AVANTAGE","model":"A-31 Spectrum"},{"icao":"A310","code":"HL2J","manufacturer":"AIRBUS","model":"A310 (CC150 Polaris)"},{"icao":"A318","code":"ML2J","manufacturer":"AIRBUS","model":"A318"},{"icao":"A319","code":"ML2J","manufacturer":"AIRBUS","model":"A319"},{"icao":"A320","code":"ML2J","manufacturer":"AIRBUS","model":"A320"},{"icao":"A321","code":"ML2J","manufacturer":"AIRBUS","model":"A321"},{"icao":"A32E","code":"LL1E","manufacturer":"SCHLEICHER","model":"ASG-32EL"},{"icao":"A32P","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASG-32Mi"},{"icao":"A33","code":"LL1P","manufacturer":"AEROPRACT","model":"A-33"},{"icao":"A332","code":"HL2J","manufacturer":"AIRBUS","model":"A330-200"},{"icao":"A333","code":"HL2J","manufacturer":"AIRBUS","model":"A330-300"},{"icao":"A337","code":"HL2J","manufacturer":"AIRBUS","model":"A330-700 Beluga XL"},{"icao":"A338","code":"HL2J","manufacturer":"AIRBUS","model":"A330-800"},{"icao":"A339","code":"HL2J","manufacturer":"AIRBUS","model":"A330-900"},{"icao":"A33E","code":"LL1E","manufacturer":"SCHLEICHER","model":"AS-33Me"},{"icao":"A33P","code":"LL1P","manufacturer":"SCHLEICHER","model":"AS-33Es"},{"icao":"A342","code":"HL4J","manufacturer":"AIRBUS","model":"A340-200"},{"icao":"A343","code":"HL4J","manufacturer":"AIRBUS","model":"A340-300"},{"icao":"A345","code":"HL4J","manufacturer":"AIRBUS","model":"A340-500"},{"icao":"A346","code":"HL4J","manufacturer":"AIRBUS","model":"A340-600"},{"icao":"A34E","code":"LL1E","manufacturer":"SCHLEICHER","model":"AS-34Me"},{"icao":"A35","code":"LL1P","manufacturer":"AVANTAGE","model":"A-35 Scanner"},{"icao":"A358","code":"HL2J","manufacturer":"AIRBUS","model":"A350-800"},{"icao":"A359","code":"HL2J","manufacturer":"AIRBUS","model":"A350-900"},{"icao":"A35K","code":"HL2J","manufacturer":"AIRBUS","model":"A350-1000"},{"icao":"A37","code":"LL2J","manufacturer":"CESSNA","model":"A37 Dragonfly (318D/E), OA37"},{"icao":"A388","code":"JL4J","manufacturer":"AIRBUS","model":"A380-800"},{"icao":"A3ST","code":"HL2J","manufacturer":"AIRBUS","model":"A300ST Super Transporter, Beluga"},{"icao":"A4","code":"ML1J","manufacturer":"DOUGLAS","model":"A4, TA4 Skyhawk"},{"icao":"A400","code":"HL4T","manufacturer":"AIRBUS","model":"A400M"},{"icao":"A411","code":"LL2P","manufacturer":"OSKBES-MAI","model":"MAI-411"},{"icao":"A5","code":"LA1P","manufacturer":"ICON","model":"A-5"},{"icao":"A50","code":"HL4J","manufacturer":"BERIEV","model":"A50, Be976"},{"icao":"A500","code":"LL2P","manufacturer":"ADAM","model":"A500, Carbon Aero"},{"icao":"A504","code":"LL1P","manufacturer":"AVRO","model":"504, Replica"},{"icao":"A6","code":"ML2J","manufacturer":"GRUMMAN","model":"A6, EA6, KA6 Intruder, Prowler (G128)"},{"icao":"A600","code":"LH1P","manufacturer":"ROTORWAY","model":"A-600 Talon"},{"icao":"A660","code":"LL1T","manufacturer":"AYRES","model":"660 Turbo Thrush"},{"icao":"A7","code":"ML1J","manufacturer":"LTV","model":"A7, EA7, TA7 Corsair"},{"icao":"A700","code":"LL2J","manufacturer":"ADAM","model":"A-700 AdamJet"},{"icao":"A743","code":"ML2J","manufacturer":"ANTONOV","model":"An-74-300"},{"icao":"A748","code":"ML2T","manufacturer":"AIL","model":"748"},{"icao":"A890","code":"LL1P","manufacturer":"AVIATIKA","model":"890"},{"icao":"A9","code":"LL1P","manufacturer":"AAMSA","model":"A9 Quail"},{"icao":"A900","code":"LL1P","manufacturer":"AVIATIKA","model":"900 Acrobat"},{"icao":"A910","code":"LL1P","manufacturer":"OSKBES-MAI","model":"MAI-910, MAI-960 Interfly"},{"icao":"AA1","code":"LL1P","manufacturer":"AMERICAN","model":"AA1 Yankee, Trainer, Tr2"},{"icao":"AA37","code":"LL2P","manufacturer":"AEROPRACT","model":"A-37"},{"icao":"AA5","code":"LL1P","manufacturer":"AMERICAN","model":"AA5 Traveler"},{"icao":"AAT3","code":"LL1P","manufacturer":"AERO","model":"AT-3"},{"icao":"AAT4","code":"LL1P","manufacturer":"AERO","model":"AT-4"},{"icao":"AB11","code":"LL1P","manufacturer":"AERO BOERO","model":"AB115"},{"icao":"AB15","code":"LL1P","manufacturer":"AERO BOERO","model":"AB150"},{"icao":"AB18","code":"LL1P","manufacturer":"AERO BOERO","model":"AB180"},{"icao":"AB95","code":"LL1P","manufacturer":"AERO BOERO","model":"AB95"},{"icao":"AC10","code":"LG1P","manufacturer":"FD-COMPOSITES","model":"AC-10 Arrow-Copter"},{"icao":"AC11","code":"LL1P","manufacturer":"COMMANDER","model":"Commander 114/115"},{"icao":"AC31","code":"LH1T","manufacturer":"AVICOPTER","model":"AC-311"},{"icao":"AC33","code":"MH3T","manufacturer":"AVICOPTER","model":"AC-313"},{"icao":"AC4","code":"LL1P","manufacturer":"LIGHT WING","model":"AC-4"},{"icao":"AC50","code":"LL2P","manufacturer":"AERO COMMANDER","model":"500 Commander 500"},{"icao":"AC52","code":"LL2P","manufacturer":"AERO DESIGN & ENGINEERING CO, US","model":"Commander 520"},{"icao":"AC56","code":"LL2P","manufacturer":"AERO COMMANDER","model":"560 Commander 560"},{"icao":"AC5A","code":"LL1P","manufacturer":"NANJING","model":"AC-500 Aircar"},{"icao":"AC5M","code":"LL1P","manufacturer":"AVIASTROITEL","model":"AC-5M"},{"icao":"AC68","code":"LL2P","manufacturer":"AERO COMMANDER","model":"680F, 680FP Commander 680F/680FP"},{"icao":"AC6L","code":"LL2P","manufacturer":"AERO COMMANDER","model":"680FL Grand Commander"},{"icao":"AC72","code":"LL2P","manufacturer":"AERO COMMANDER","model":"720 Alti Cruiser"},{"icao":"AC80","code":"LL2T","manufacturer":"AERO COMMANDER","model":"680T, 680V Turbo Commander"},{"icao":"AC90","code":"LL2T","manufacturer":"GULFSTREAM AEROSPACE","model":"690 Jetprop Commander 840/900"},{"icao":"AC95","code":"LL2T","manufacturer":"GULFSTREAM AEROSPACE","model":"695 Jetprop Commander 980/1000"},{"icao":"ACAM","code":"LL2P","manufacturer":"LEZA\ufffdLOCKWOOD","model":"Air Cam"},{"icao":"ACAR","code":"LL1P","manufacturer":"AUSTER","model":"J5B/E/G/H/P/T/V Autocar"},{"icao":"ACED","code":"LL1P","manufacturer":"POWELL","model":"P70 Acey Deucy"},{"icao":"ACJR","code":"LA1P","manufacturer":"SPENCER","model":"Air Car Junior"},{"icao":"ACPL","code":"LL1P","manufacturer":"OPTION AIR","model":"Acapella"},{"icao":"ACR2","code":"LL1P","manufacturer":"ACRO SPORT","model":"AcroSport 2"},{"icao":"ACRD","code":"LL2P","manufacturer":"AVIA, RUSSIA","model":"Accord"},{"icao":"ACRO","code":"LL1P","manufacturer":"ACRO SPORT","model":"AcroSport 1, Super AcroSport"},{"icao":"ACSR","code":"LL1P","manufacturer":"MILLICER","model":"M9 Aircruiser"},{"icao":"AD20","code":"LL1P","manufacturer":"BEIJING KEYUAN","model":"AD200"},{"icao":"ADEL","code":"LG1P","manufacturer":"USTINOV","model":"Adel"},{"icao":"ADVE","code":"LL1P","manufacturer":"AUSTER","model":"J5 Adventurer"},{"icao":"ADVN","code":"LA1P","manufacturer":"ADVENTURE AIR","model":"Adventurer"},{"icao":"AE45","code":"LL2P","manufacturer":"AERO VODOCHODY, CZECH","model":"45"},{"icao":"AEA1","code":"LL1P","manufacturer":"AMERICAN EAGLE","model":"A1/101"},{"icao":"AERK","code":"LL1P","manufacturer":"AERONCA","model":"K Sea Scout"},{"icao":"AEST","code":"LL2P","manufacturer":"AEROSTAR, US","model":"600, 601"},{"icao":"AFOX","code":"LL1P","manufacturer":"HALLEY","model":"Apollo Fox"},{"icao":"AG02","code":"LL1P","manufacturer":"GATARD","model":"AG02 Poussin"},{"icao":"AG10","code":"LL1P","manufacturer":"CAIGA","model":"AG-100"},{"icao":"AG60","code":"MA4T","manufacturer":"CAIGA","model":"AG-600 Kunlong"},{"icao":"AGSH","code":"LA1P","manufacturer":"AERO GARE","model":"Sea Hawker"},{"icao":"AI10","code":"LL1P","manufacturer":"IKAR","model":"Ai-10 Ikar"},{"icao":"AIGT","code":"LL1P","manufacturer":"AUSTER","model":"J5F/K/L Aiglet Trainer"},{"icao":"AIRD","code":"LL1P","manufacturer":"BEAGLE","model":"A109 Airedale"},{"icao":"AIRL","code":"LL2P","manufacturer":"AERONIX","model":"Airelle"},{"icao":"AJ27","code":"ML2J","manufacturer":"COMAC","model":"ARJ-21-700 Xiangfeng"},{"icao":"AJET","code":"ML2J","manufacturer":"AOI","model":"Alpha Jet"},{"icao":"AK1","code":"LL1P","manufacturer":"AKAFLIEG KARLSRUHE","model":"AK1"},{"icao":"AKOY","code":"LA1P","manufacturer":"LISA","model":"Akoya"},{"icao":"AKRO","code":"LL1P","manufacturer":"STEPHENS","model":"Akro"},{"icao":"ALBU","code":"LL1P","manufacturer":"AVIATION DEVELOPMENT","model":"Alaskan Bushmaster"},{"icao":"ALC1","code":"LL1P","manufacturer":"ALTAIR COELHO","model":"AC11"},{"icao":"ALGR","code":"LL1P","manufacturer":"FANTASY AIR","model":"Allegro"},{"icao":"ALH","code":"LH2T","manufacturer":"HINDUSTAN","model":"ALH"},{"icao":"ALIG","code":"LL1P","manufacturer":"ARION","model":"LS-1 Lightning"},{"icao":"ALIZ","code":"ML1T","manufacturer":"BREGUET","model":"1050 Aliz\ufffd"},{"icao":"ALO2","code":"LH1T","manufacturer":"AEROSPATIALE","model":"SA318 Alouette 2"},{"icao":"ALO3","code":"LH1T","manufacturer":"AEROSPATIALE","model":"SA316/319 Alouette 3 (HD16)"},{"icao":"ALPI","code":"LL1P","manufacturer":"AUSTER","model":"J5Q/R Alpine"},{"icao":"ALSL","code":"LL1P","manufacturer":"AIRLONY","model":"Skylane"},{"icao":"ALTO","code":"LL1P","manufacturer":"DIRECT FLY","model":"Alto"},{"icao":"AM3","code":"LL1P","manufacturer":"AERFER","model":"AM3"},{"icao":"AMX","code":"ML1J","manufacturer":"AERITALIA","model":"AMX"},{"icao":"AN12","code":"ML4T","manufacturer":"ANTONOV","model":"An12"},{"icao":"AN2","code":"LL1P","manufacturer":"ANTONOV","model":"An2"},{"icao":"AN22","code":"HL4T","manufacturer":"ANTONOV","model":"An22 Antheus"},{"icao":"AN24","code":"ML2T","manufacturer":"ANTONOV","model":"An24"},{"icao":"AN26","code":"ML2T","manufacturer":"ANTONOV","model":"An26"},{"icao":"AN28","code":"LL2T","manufacturer":"ANTONOV","model":"An28"},{"icao":"AN3","code":"LL1T","manufacturer":"ANTONOV","model":"An3"},{"icao":"AN30","code":"ML2T","manufacturer":"ANTONOV","model":"An30"},{"icao":"AN32","code":"ML2T","manufacturer":"ANTONOV","model":"An32, Firekiller (Sutlej)"},{"icao":"AN38","code":"ML2T","manufacturer":"ANTONOV","model":"An38"},{"icao":"AN70","code":"ML4T","manufacturer":"ANTONOV","model":"An70"},{"icao":"AN72","code":"ML2J","manufacturer":"ANTONOV","model":"An72/74"},{"icao":"AN8","code":"ML2T","manufacturer":"ANTONOV","model":"An8"},{"icao":"ANGL","code":"LL2P","manufacturer":"KING?S","model":"44 Angel"},{"icao":"ANKA","code":"LL1P","manufacturer":"TAI","model":"Anka"},{"icao":"ANSN","code":"LL2P","manufacturer":"AVRO","model":"652 Anson"},{"icao":"ANST","code":"LH2T","manufacturer":"KAZAN","model":"Ansat"},{"icao":"AP20","code":"LL1P","manufacturer":"AEROPRAKT","model":"A20, Sky Cruiser, Super Cruiser"},{"icao":"AP22","code":"LL1P","manufacturer":"AEROPRAKT","model":"A-22 Sharik, Foxbat, Valor, Vision"},{"icao":"AP24","code":"LA1P","manufacturer":"AEROPRAKT","model":"A-24 Viking"},{"icao":"AP26","code":"LL2P","manufacturer":"AEROPRAKT","model":"A26, Vulcan"},{"icao":"AP28","code":"LL2P","manufacturer":"AEROPRAKT","model":"A28, Victor"},{"icao":"AP32","code":"LL1P","manufacturer":"AEROPRAKT","model":"A-32 Vixxen"},{"icao":"AP36","code":"LL2P","manufacturer":"AEROPRAKT","model":"A-36 Vulcan"},{"icao":"APM2","code":"LL1P","manufacturer":"MONIOT","model":"APM20/21 Lionceau, Lion"},{"icao":"APM3","code":"LL1P","manufacturer":"ISSOIRE","model":"APM-30 Lion"},{"icao":"APM4","code":"LL1P","manufacturer":"ISSOIRE","model":"APM-40 Simba"},{"icao":"APUP","code":"LL1P","manufacturer":"AEROPUP","model":"Aeropup"},{"icao":"AR11","code":"LL1P","manufacturer":"AERONCA","model":"11 Chief"},{"icao":"AR15","code":"LL1P","manufacturer":"AERONCA","model":"15 Sedan"},{"icao":"AR50","code":"LL1P","manufacturer":"AERONCA","model":"50 Chief"},{"icao":"AR5T","code":"LL1P","manufacturer":"AERONCA","model":"50 Tandem"},{"icao":"AR65","code":"LL1P","manufacturer":"AERONCA","model":"65 Super Chief"},{"icao":"AR6T","code":"LL1P","manufacturer":"AERONCA","model":"65 Defender, Tandem, YO-58/O-58/L-3 Grasshopper"},{"icao":"AR79","code":"LL1P","manufacturer":"ARADO","model":"Ar79"},{"icao":"ARCE","code":"LL1E","manufacturer":"SCHEMPP-HIRTH","model":"Arcus E"},{"icao":"ARCP","code":"LL1P","manufacturer":"SCHEMPP-HIRTH","model":"Arcus M, T"},{"icao":"ARES","code":"LL1J","manufacturer":"RUTAN","model":"151 Ares"},{"icao":"ARKS","code":"LL1P","manufacturer":"ACEAIR","model":"A-200 Aeris/Aeriks 200"},{"icao":"ARON","code":"LL1P","manufacturer":"GENERAL AVIA","model":"F220 Airone"},{"icao":"ARV1","code":"LL1P","manufacturer":"ARV","model":"ARV1 Super 2"},{"icao":"ARVA","code":"LL2T","manufacturer":"IAI","model":"101, 102, 201, 202 Arava"},{"icao":"ARWF","code":"LL1P","manufacturer":"ARROW, US","model":"F Sport"},{"icao":"AS02","code":"LL1P","manufacturer":"FFA","model":"AS20215/18/26 Bravo, Wren"},{"icao":"AS14","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASK14"},{"icao":"AS16","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASK16"},{"icao":"AS20","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASW20TOP"},{"icao":"AS21","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASK-21Mi"},{"icao":"AS22","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASW22BE/BLE"},{"icao":"AS24","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASW24E/TOP"},{"icao":"AS25","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASH25E/M"},{"icao":"AS26","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASH26E"},{"icao":"AS28","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASW-28E"},{"icao":"AS29","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASW-27-18E, ASG-29E/29Es"},{"icao":"AS2T","code":"LL1T","manufacturer":"FFA","model":"AS20232TP Turbine Bravo"},{"icao":"AS30","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASH-30Mi"},{"icao":"AS31","code":"LL1P","manufacturer":"SCHLEICHER","model":"ASH-31Mi"},{"icao":"AS32","code":"MH2T","manufacturer":"AEROSPATIALE","model":"AS332/532 Super Puma, Tiger, Cougar (Hkp10 HD21, HT21)"},{"icao":"AS3B","code":"MH2T","manufacturer":"EUROCOPTER","model":"AS-532A2/U2 Cougar Mk2, AS-332L2 Super Puma Mk2"},{"icao":"AS50","code":"LH1T","manufacturer":"AEROSPATIALE","model":"AS350/550 Ecureuil, AStar, SuperStar, Fennec"},{"icao":"AS55","code":"LH2T","manufacturer":"AEROSPATIALE","model":"AS355/555 Ecureuil 2, TwinStar, Fennec"},{"icao":"AS65","code":"LH2T","manufacturer":"AEROSPATIALE","model":"SA365F/K/M/N/S, AS365/366/565 Dauphin 2, Panther (HH65 Dol phin, Dolpheen)"},{"icao":"AS80","code":"LL1P","manufacturer":"STARCK","model":"AS80 Holiday"},{"icao":"ASO4","code":"LL1P","manufacturer":"ASSO AEREI","model":"Asso 4 Whisky"},{"icao":"ASTO","code":"LL1P","manufacturer":"TECNAM","model":"Astore"},{"icao":"ASTR","code":"ML2J","manufacturer":"IAI","model":"1125 Astra, Gulfstream 100 (C38)"},{"icao":"AT2P","code":"LL1P","manufacturer":"AIR TRACTOR","model":"AT-250"},{"icao":"AT3","code":"ML2J","manufacturer":"AIDC","model":"AT3 TzuChung"},{"icao":"AT3P","code":"LL1P","manufacturer":"AIR TRACTOR","model":"AT300/301/401"},{"icao":"AT3T","code":"LL1T","manufacturer":"AIR TRACTOR","model":"AT302/400/402"},{"icao":"AT43","code":"ML2T","manufacturer":"ATR","model":"ATR42-200/300/320"},{"icao":"AT44","code":"ML2T","manufacturer":"ATR","model":"ATR42-400"},{"icao":"AT45","code":"ML2T","manufacturer":"ATR","model":"ATR42-500"},{"icao":"AT46","code":"ML2T","manufacturer":"ATR","model":"ATR42-600"},{"icao":"AT5P","code":"LL1P","manufacturer":"AIR TRACTOR","model":"AT501"},{"icao":"AT5T","code":"LL1T","manufacturer":"AIR TRACTOR","model":"AT502/503"},{"icao":"AT6T","code":"LL1T","manufacturer":"AIR TRACTOR","model":"AT602"},{"icao":"AT72","code":"ML2T","manufacturer":"ATR","model":"ATR72-200"},{"icao":"AT73","code":"ML2T","manufacturer":"ATR","model":"ATR-72-211, ATR-72-212"},{"icao":"AT75","code":"ML2T","manufacturer":"ATR","model":"ATR72-500"},{"icao":"AT76","code":"ML2T","manufacturer":"ATR","model":"ATR72-600"},{"icao":"AT8T","code":"LL1T","manufacturer":"AIR TRACTOR","model":"AT802"},{"icao":"ATAC","code":"LL1P","manufacturer":"AIRCRAFT TECHNOLOGIES","model":"Acro 1"},{"icao":"ATG1","code":"LL2J","manufacturer":"ATG","model":"ATG-1 Javelin"},{"icao":"ATIS","code":"LL1P","manufacturer":"AIRCRAFT TECHNOLOGIES","model":"Atlantis"},{"icao":"ATL","code":"LL1P","manufacturer":"ROBIN","model":"ATL"},{"icao":"ATLA","code":"ML2T","manufacturer":"BREGUET","model":"1150 Atlantic"},{"icao":"ATP","code":"ML2T","manufacturer":"BRITISH AEROSPACE","model":"ATP"},{"icao":"ATTL","code":"LL1P","manufacturer":"EURONEF","model":"ATTL1"},{"icao":"AU11","code":"LL1P","manufacturer":"BEAGLE-AUSTER","model":"E-3 Auster AOP11"},{"icao":"AUJ2","code":"LL1P","manufacturer":"AUSTER","model":"J2 Arrow"},{"icao":"AUJ4","code":"LL1P","manufacturer":"AUSTER","model":"J4 Archer"},{"icao":"AUS3","code":"LL1P","manufacturer":"TAYLORCRAFT AEROPLANES, UK","model":"Auster 3 (E)"},{"icao":"AUS4","code":"LL1P","manufacturer":"TAYLORCRAFT AEROPLANES, UK","model":"Auster 4 (G)"},{"icao":"AUS5","code":"LL1P","manufacturer":"AUSTER","model":"Auster 5 (J, 5 Alpha)"},{"icao":"AUS6","code":"LL1P","manufacturer":"AUSTER","model":"Auster AOP6 (K, 6A)"},{"icao":"AUS7","code":"LL1P","manufacturer":"AUSTER","model":"Auster T7 (Q)"},{"icao":"AUS9","code":"LL1P","manufacturer":"AUSTER","model":"Auster AOP9 (B5)"},{"icao":"AV68","code":"LL1P","manufacturer":"ALPLA","model":"AVO68 Samburo"},{"icao":"AVAM","code":"LA1P","manufacturer":"AVID","model":"Avid Amphibian, Catalina"},{"icao":"AVID","code":"LL1P","manufacturer":"AVID","model":"Avid Flyer, Avid Commuter"},{"icao":"AVIN","code":"LL1P","manufacturer":"AVRO","model":"594, 616 Avian"},{"icao":"AVK4","code":"LL2T","manufacturer":"AVTEK","model":"400"},{"icao":"AVLN","code":"LA1T","manufacturer":"AIRMASTER","model":"Avalon 680"},{"icao":"AVTR","code":"LA1P","manufacturer":"AERO ADVENTURE","model":"Aventura 2"},{"icao":"B06","code":"LH1T","manufacturer":"AGUSTA","model":"AB206 JetRanger, LongRanger (Hkp6)"},{"icao":"B06T","code":"LH2T","manufacturer":"BELL","model":"206LT TwinRanger"},{"icao":"B1","code":"HL4J","manufacturer":"ROCKWELL","model":"B1 Lancer"},{"icao":"B103","code":"LA2P","manufacturer":"BERIEV","model":"Be103"},{"icao":"B105","code":"LH2T","manufacturer":"BOLKOW","model":"BO105"},{"icao":"B13","code":"LL1P","manufacturer":"AKAFLIEG BERLIN","model":"B13"},{"icao":"B14A","code":"LL1P","manufacturer":"BELLANCA","model":"14 Junior, Cruisair, Cruisair Senior, Cruisemaster"},{"icao":"B14B","code":"LL1P","manufacturer":"DOUGLAS","model":"14 Bellanca 260"},{"icao":"B14C","code":"LL1P","manufacturer":"BELLANCA","model":"14 Bellanca 260/A/B/C"},{"icao":"B150","code":"LH1T","manufacturer":"WINNER","model":"B-150"},{"icao":"B17","code":"ML4P","manufacturer":"BOEING","model":"B17 Flying Fortress"},{"icao":"B170","code":"ML2P","manufacturer":"BRISTOL","model":"170 Freighter"},{"icao":"B18T","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"18 (turbine)"},{"icao":"B190","code":"ML2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"1900 (C12J)"},{"icao":"B2","code":"HL4J","manufacturer":"NORTHROP","model":"B2 Spirit"},{"icao":"B209","code":"LL1P","manufacturer":"BOLKOW","model":"BO209 Monsun"},{"icao":"B212","code":"LH2T","manufacturer":"AGUSTA","model":"AB212 (HA18)"},{"icao":"B214","code":"MH1T","manufacturer":"BELL","model":"214A/B/C, Big Lifter"},{"icao":"B222","code":"LH2T","manufacturer":"BELL","model":"222"},{"icao":"B23","code":"ML2P","manufacturer":"DOUGLAS","model":"B23, UC67 Dragon"},{"icao":"B230","code":"LH2T","manufacturer":"BELL","model":"230"},{"icao":"B23E","code":"LL1E","manufacturer":"BRM AERO","model":"Bristell B23 Energic"},{"icao":"B24","code":"ML4P","manufacturer":"CONSOLIDATED","model":"B24, C87, LB30 Liberator"},{"icao":"B25","code":"ML2P","manufacturer":"NORTH AMERICAN","model":"B25, TB25, PBJ Mitchell"},{"icao":"B26","code":"ML2P","manufacturer":"DOUGLAS","model":"A26, B26, CB26, RB26, TB26, UB26, VB26 Invader"},{"icao":"B26M","code":"ML2P","manufacturer":"MARTIN","model":"B26 Marauder (179)"},{"icao":"B29","code":"ML4P","manufacturer":"BOEING","model":"B29 Superfortress"},{"icao":"B305","code":"LH1P","manufacturer":"BRANTLY","model":"305"},{"icao":"B350","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"B300 Super King Air 350"},{"icao":"B360","code":"LL1P","manufacturer":"YAKOVLEV AIRCRAFT","model":"Bear 360"},{"icao":"B36T","code":"LL1T","manufacturer":"ALLISON","model":"36 Turbine Bonanza"},{"icao":"B377","code":"MA4P","manufacturer":"BOEING","model":"377 Stratocruiser"},{"icao":"B37M","code":"ML2J","manufacturer":"BOEING","model":"737-7 MAX"},{"icao":"B38M","code":"ML2J","manufacturer":"BOEING","model":"737-8 MAX"},{"icao":"B39M","code":"ML2J","manufacturer":"BOEING","model":"737-9 MAX"},{"icao":"B3XM","code":"ML2J","manufacturer":"BOEING","model":"737-10"},{"icao":"B407","code":"LH1T","manufacturer":"BELL","model":"407"},{"icao":"B412","code":"LH2T","manufacturer":"AGUSTA","model":"AB412, Griffon (Hkp11)"},{"icao":"B427","code":"LH2T","manufacturer":"BELL","model":"427"},{"icao":"B429","code":"LH2T","manufacturer":"BELL","model":"GlobalRanger"},{"icao":"B430","code":"LH2T","manufacturer":"BELL","model":"430"},{"icao":"B461","code":"ML4J","manufacturer":"BRITISH AEROSPACE","model":"BAe-146-100 Statesman"},{"icao":"B462","code":"ML4J","manufacturer":"BRITISH AEROSPACE","model":"BAe-146-200 Statesman, Quiet Trader"},{"icao":"B463","code":"ML4J","manufacturer":"BRITISH AEROSPACE","model":"BAe-146-300"},{"icao":"B47G","code":"LH1P","manufacturer":"AGUSTA","model":"AB47G (HE7)"},{"icao":"B47J","code":"LH1P","manufacturer":"AGUSTA","model":"AB47J"},{"icao":"B47T","code":"LH1T","manufacturer":"SOLOY","model":"Bell 47"},{"icao":"B505","code":"LH1T","manufacturer":"BELL","model":"505 Jet Ranger X"},{"icao":"B52","code":"HL8J","manufacturer":"BOEING","model":"B52 Stratofortress"},{"icao":"B525","code":"MH2T","manufacturer":"BELL","model":"525 Relentless"},{"icao":"B58T","code":"LL2P","manufacturer":"BEECH","model":"58P Pressurized Baron"},{"icao":"B60","code":"LL1P","manufacturer":"BOISAVIA","model":"B60, B601 to 606 Mercurey"},{"icao":"B609","code":"MT2T","manufacturer":"AGUSTA","model":"BA609"},{"icao":"B60T","code":"LL2T","manufacturer":"BEECH AIRCRAFT CORPORATION","model":"B60 Turbine Duke"},{"icao":"B7","code":"LL1J","manufacturer":"BOEING","model":"BTX-1"},{"icao":"B701","code":"ML4J","manufacturer":"BOEING","model":"B707-100"},{"icao":"B703","code":"HL4J","manufacturer":"BOEING","model":"B707-300 / C18"},{"icao":"B712","code":"ML2J","manufacturer":"BOEING","model":"B717-200"},{"icao":"B720","code":"ML4J","manufacturer":"BOEING","model":"B720"},{"icao":"B721","code":"ML3J","manufacturer":"BOEING","model":"B727-100 / C22"},{"icao":"B722","code":"ML3J","manufacturer":"BOEING","model":"B727-200"},{"icao":"B72Q","code":"ML3J","manufacturer":"BOEING","model":"727 Stage 3 (US ONLY)"},{"icao":"B731","code":"ML2J","manufacturer":"BOEING","model":"B737-100"},{"icao":"B732","code":"ML2J","manufacturer":"BOEING","model":"B737-200"},{"icao":"B733","code":"ML2J","manufacturer":"BOEING","model":"B737-300"},{"icao":"B734","code":"ML2J","manufacturer":"BOEING","model":"B737-400"},{"icao":"B735","code":"ML2J","manufacturer":"BOEING","model":"B737-500"},{"icao":"B736","code":"ML2J","manufacturer":"BOEING","model":"B737-600"},{"icao":"B737","code":"ML2J","manufacturer":"BOEING","model":"B737-700 / BBJ / C40"},{"icao":"B738","code":"ML2J","manufacturer":"BOEING","model":"B737-800 / BBJ2"},{"icao":"B739","code":"ML2J","manufacturer":"BOEING","model":"B737-900"},{"icao":"B73Q","code":"ML2J","manufacturer":"BOEING","model":"737 Stage 3 (US ONLY)"},{"icao":"B741","code":"HL4J","manufacturer":"BOEING","model":"B747-100"},{"icao":"B742","code":"HL4J","manufacturer":"BOEING","model":"B747-200 /E4 / VC25"},{"icao":"B743","code":"HL4J","manufacturer":"BOEING","model":"B747-300"},{"icao":"B744","code":"HL4J","manufacturer":"BOEING","model":"B747-400(ER) (International, winglets)"},{"icao":"B748","code":"HL4J","manufacturer":"BOEING","model":"B747-800 (Intercontinental, Freighter)"},{"icao":"B74D","code":"HL4J","manufacturer":"BOEING","model":"B747-400 (Domestic, no winglets)"},{"icao":"B74R","code":"HL4J","manufacturer":"BOEING","model":"B747SR"},{"icao":"B74S","code":"HL4J","manufacturer":"BOEING","model":"B747SP"},{"icao":"B752","code":"ML2J","manufacturer":"BOEING","model":"B757-200 / C32"},{"icao":"B753","code":"ML2J","manufacturer":"BOEING","model":"B757-300"},{"icao":"B762","code":"HL2J","manufacturer":"BOEING","model":"B767-200(ER)"},{"icao":"B763","code":"HL2J","manufacturer":"BOEING","model":"B767-300(ER)"},{"icao":"B764","code":"HL2J","manufacturer":"BOEING","model":"B767-400(ER)"},{"icao":"B772","code":"HL2J","manufacturer":"BOEING","model":"B777-200(ER)"},{"icao":"B773","code":"HL2J","manufacturer":"BOEING","model":"B777-300"},{"icao":"B778","code":"HL2J","manufacturer":"BOEING","model":"B777-800"},{"icao":"B779","code":"HL2J","manufacturer":"BOEING","model":"B777-900"},{"icao":"B77L","code":"HL2J","manufacturer":"BOEING","model":"B777-200LR"},{"icao":"B77W","code":"HL2J","manufacturer":"BOEING","model":"B777-300ER"},{"icao":"B788","code":"HL2J","manufacturer":"BOEING","model":"B787-8"},{"icao":"B789","code":"HL2J","manufacturer":"BOEING","model":"B787-9"},{"icao":"B78X","code":"HL2J","manufacturer":"BOEING","model":"B787-10"},{"icao":"BA11","code":"ML2J","manufacturer":"BAC","model":"111 OneEleven"},{"icao":"BA46","code":"ML4J","manufacturer":"AI (R)","model":"RJ70 Avroliner"},{"icao":"BABY","code":"LH1P","manufacturer":"CANADIAN HOME ROTORS","model":"Baby Belle"},{"icao":"BALL","code":"----","manufacturer":"-","model":"Balloon"},{"icao":"BAR6","code":"LL1P","manufacturer":"BARR","model":"BarrSix"},{"icao":"BARC","code":"LL1P","manufacturer":"BUETHE","model":"Barracuda"},{"icao":"BASS","code":"LL2P","manufacturer":"BEAGLE","model":"B206 (Basset)"},{"icao":"BBAT","code":"LL1P","manufacturer":"BRADLEY","model":"BA100 Aerobat"},{"icao":"BBIR","code":"LL1P","manufacturer":"HOVEY","model":"Beta Bird"},{"icao":"BCA3","code":"LL1P","manufacturer":"BUHL","model":"CA-3 Sport Airsedan"},{"icao":"BCAT","code":"LL1P","manufacturer":"GRUMMAN","model":"F8F Bearcat (G58)"},{"icao":"BCS1","code":"ML2J","manufacturer":"AIRBUS","model":"A-220-100, BD-500 CSeries CS100"},{"icao":"BCS3","code":"ML2J","manufacturer":"AIRBUS","model":"A-220-300, BD-500 CSeries CS300"},{"icao":"BD10","code":"LL1J","manufacturer":"BEDE","model":"BD10"},{"icao":"BD12","code":"LL1P","manufacturer":"BEDE","model":"BD12"},{"icao":"BD17","code":"LL1P","manufacturer":"BEDE","model":"BD17 Nuggett"},{"icao":"BD4","code":"LL1P","manufacturer":"BEDE","model":"BD4"},{"icao":"BD5","code":"LL1P","manufacturer":"BEDE","model":"BD5B/D/G Micro"},{"icao":"BD5J","code":"LL1J","manufacturer":"BEDE","model":"BD5J Micro"},{"icao":"BD5T","code":"LL1T","manufacturer":"BEDE","model":"BD5TP"},{"icao":"BDOG","code":"LL1P","manufacturer":"BEAGLE","model":"B125 Bulldog"},{"icao":"BE10","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"100 King Air (U21F Ute)"},{"icao":"BE12","code":"MA2T","manufacturer":"BERIEV","model":"Be12/14 Tchaika"},{"icao":"BE17","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"17 Staggerwing (UC43 Traveler)"},{"icao":"BE18","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"18 (piston) (C45, RC45, TC45, UC45, AT7, AT11 Kansan, SNB, JRB, Expeditor, Navigator)"},{"icao":"BE19","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"19 Musketeer Sport, Sport"},{"icao":"BE20","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"200, 1300 Super King Air, Commuter (C12A to F, C12L/R, UC12, RC12, Tp101, Huron)"},{"icao":"BE22","code":"LL1T","manufacturer":"TEXTRON","model":"220 Denali"},{"icao":"BE23","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"23 Musketeer, Sundowner"},{"icao":"BE24","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"24 Musketeer Super, Sierra"},{"icao":"BE30","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"300 Super King Air"},{"icao":"BE32","code":"ML2T","manufacturer":"BERIEV","model":"Be30/32"},{"icao":"BE33","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"33 Debonair, Bonanza (E24)"},{"icao":"BE35","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"35 Bonanza"},{"icao":"BE36","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"36 Bonanza (piston)"},{"icao":"BE40","code":"ML2J","manufacturer":"HAWKER BEECHCRAFT CORP","model":"400 Beechjet (T1 Jayhawk, T400, Hawker 400)"},{"icao":"BE4W","code":"ML2J","manufacturer":"BEECH","model":"Beechjet (400XT/400XPR)"},{"icao":"BE50","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"50 Twin Bonanza (U8D/E/G, RU8 Seminole)"},{"icao":"BE55","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"55 Baron (T42 Cochise, C55, E20)"},{"icao":"BE56","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"56 Turbo Baron"},{"icao":"BE58","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"58 Baron"},{"icao":"BE60","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"60 Duke"},{"icao":"BE65","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"65 Queen Air (U8F Seminole)"},{"icao":"BE70","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"70 Queen Air"},{"icao":"BE76","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"76 Duchess"},{"icao":"BE77","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"77 Skipper"},{"icao":"BE80","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"80 Queen Air (Zamir)"},{"icao":"BE88","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"88 Queen Air"},{"icao":"BE95","code":"LL2P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"95 Travel Air"},{"icao":"BE99","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"99 Airliner"},{"icao":"BE9L","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"90, A90 to E90 King Air (T44, VC6)"},{"icao":"BE9T","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"F90 King Air"},{"icao":"BEAR","code":"LL1P","manufacturer":"R & B","model":"Bearhawk"},{"icao":"BELF","code":"ML4T","manufacturer":"SHORT","model":"SC5 Belfast"},{"icao":"BER2","code":"MA2J","manufacturer":"BERIEV","model":"Be200"},{"icao":"BER4","code":"MA2J","manufacturer":"BERIEV","model":"A40 Albatross"},{"icao":"BETA","code":"LL1P","manufacturer":"ROLLASON","model":"Beta"},{"icao":"BEVR","code":"LL1P","manufacturer":"ASAP","model":"Beaver"},{"icao":"BF19","code":"LL1P","manufacturer":"PODESVA","model":"Bf-109G-2"},{"icao":"BFIT","code":"LL1P","manufacturer":"BRISTOL","model":"F2B Fighter, Replica"},{"icao":"BILO","code":"LL1P","manufacturer":"PENA","model":"Bilouis"},{"icao":"BIPL","code":"LL1P","manufacturer":"EAA","model":"Biplane"},{"icao":"BIRD","code":"LL1P","manufacturer":"TAYLOR, C. GILBERT, US","model":"TA2/3 Bird"},{"icao":"BISC","code":"LL1P","manufacturer":"BOT AIRCRAFT","model":"SC-07 Speed Cruiser, Sky Cruiser"},{"icao":"BK17","code":"LH2T","manufacturer":"CASA","model":"BK117"},{"icao":"BKUT","code":"LL1P","manufacturer":"BERKUT","model":"Berkut"},{"icao":"BL11","code":"LL1P","manufacturer":"BLERIOT","model":"11, Replica"},{"icao":"BL17","code":"LL1P","manufacturer":"BELLANCA","model":"17 Viking, Super Viking, Turbo Viking"},{"icao":"BL19","code":"LL1P","manufacturer":"AVIABELLANCA","model":"19 Skyrocket"},{"icao":"BL8","code":"LL1P","manufacturer":"AMERICAN CHAMPION","model":"8 Scout, Super Decathlon"},{"icao":"BLBU","code":"LL1P","manufacturer":"AMEUR","model":"Balbuzard, Baljims"},{"icao":"BLCF","code":"HL4J","manufacturer":"BOEING","model":"747-400LCF Dreamlifter"},{"icao":"BLEN","code":"LL2P","manufacturer":"BRISTOL","model":"149 Blenheim, Bolingbroke"},{"icao":"BLKS","code":"LL1P","manufacturer":"AIRCRAFT SPRUCE","model":"Baby Lakes, Buddy Baby Lakes, Super Baby Lakes"},{"icao":"BM6","code":"LL1P","manufacturer":"MARANDA","model":"BM6 Lark"},{"icao":"BMAN","code":"LL1P","manufacturer":"AAK","model":"Bushman"},{"icao":"BN2P","code":"LL2P","manufacturer":"AVIONES FAIREY","model":"BN2A/B Islander, Defender, Maritime  Defender"},{"icao":"BN2T","code":"LL2T","manufacturer":"BRITTEN\ufffdNORMAN","model":"BN2T Turbine Islander, Turbine Defender, Defender 4000"},{"icao":"BO40","code":"LL1P","manufacturer":"BOEING","model":"40"},{"icao":"BOLT","code":"LL1P","manufacturer":"STEEN","model":"Skybolt"},{"icao":"BOOM","code":"LL2P","manufacturer":"RUTAN","model":"202 Boomerang"},{"icao":"BPAT","code":"LL1P","manufacturer":"R & B","model":"Bearhawk Patrol"},{"icao":"BPOD","code":"LL4E","manufacturer":"RUTAN","model":"367 BiPod"},{"icao":"BR14","code":"LL1P","manufacturer":"BREGUET","model":"14 Replica"},{"icao":"BR23","code":"LL1P","manufacturer":"BRM AERO","model":"Bristell B23"},{"icao":"BR54","code":"LG1P","manufacturer":"BARNETT","model":"BRC-540"},{"icao":"BR60","code":"LL1P","manufacturer":"BRUMBY","model":"600 Brumby"},{"icao":"BR61","code":"LL1P","manufacturer":"BRUMBY","model":"610 Evolution"},{"icao":"BR8","code":"LL1P","manufacturer":"BRM AERO","model":"Bristell B8"},{"icao":"BRAV","code":"LL1P","manufacturer":"TECNAM","model":"P-2004 Bravo"},{"icao":"BRB2","code":"LH1P","manufacturer":"BRANTLY","model":"B2"},{"icao":"BREZ","code":"LL1P","manufacturer":"BREEZER","model":"Breezer"},{"icao":"BROU","code":"LL1P","manufacturer":"MAX HOLSTE","model":"MH1521 Broussard"},{"icao":"BS60","code":"LL2T","manufacturer":"BEECH\ufffdSFERMA","model":"60 Marquis"},{"icao":"BSCA","code":"HL4J","manufacturer":"BOEING","model":"B747SCA Shuttle Carrier"},{"icao":"BSTP","code":"MH2T","manufacturer":"BELL","model":"214ST SuperTransport"},{"icao":"BSTR","code":"LL1P","manufacturer":"CUSTOM FLIGHT","model":"Bright Star"},{"icao":"BT36","code":"LL1P","manufacturer":"BEECH","model":"Bonanza (A36TC/B36TC)"},{"icao":"BT7","code":"ML1J","manufacturer":"BOEING","model":"T-7 Red Hawk, BTX-1"},{"icao":"BTUB","code":"LL1P","manufacturer":"KIMBREL","model":"Dormoy Bathtub"},{"icao":"BU20","code":"LL3P","manufacturer":"AIRCRAFT HYDRO\ufffdFORMING","model":"Bushmaster 2000"},{"icao":"BU31","code":"LL1P","manufacturer":"AERO VODOCHODY, CZECH","model":"Z131 (C104)"},{"icao":"BU33","code":"LL1P","manufacturer":"BITZ","model":"B\ufffd133 Jungmeister"},{"icao":"BU81","code":"LL1P","manufacturer":"BUCKER","model":"B\ufffd181 Bestmann"},{"icao":"BUC","code":"ML2J","manufacturer":"HAWKER SIDDELEY","model":"Buccaneer"},{"icao":"BUCA","code":"LA1P","manufacturer":"ADVANCED AEROMARINE","model":"Mallard"},{"icao":"BULT","code":"LL1P","manufacturer":"BROKAW","model":"BJ520 Bullet"},{"icao":"BUSH","code":"LL1P","manufacturer":"RAINBOW","model":"BushCat"},{"icao":"BW60","code":"LL1P","manufacturer":"BLACKWING","model":"BW-600"},{"icao":"BW6T","code":"LL1P","manufacturer":"BLACKWING","model":"BW-635"},{"icao":"BX2","code":"LL1P","manufacturer":"BRANDLI","model":"BX2 Cherry"},{"icao":"C02T","code":"LL2T","manufacturer":"AJI","model":"Turbo Star 402"},{"icao":"C04T","code":"LL2T","manufacturer":"CESSNA","model":"404 (turbine)"},{"icao":"C06T","code":"LL1T","manufacturer":"CESSNA","model":"206 (turbine)"},{"icao":"C07T","code":"LL1T","manufacturer":"CESSNA","model":"207 (turbine)"},{"icao":"C08T","code":"LLCT","manufacturer":"SOLOY","model":"208 DualPac Caravan, Pathfinder 21"},{"icao":"C1","code":"ML2J","manufacturer":"KAWASAKI","model":"C1"},{"icao":"C101","code":"LL1J","manufacturer":"CASA","model":"C101 Aviojet (E25 Mirlo, A36 Halc\ufffdn, T36)"},{"icao":"C10T","code":"LL1T","manufacturer":"ADVANCED AIRCRAFT","model":"Spirit 750, Turbine P210"},{"icao":"C119","code":"ML2P","manufacturer":"FAIRCHILD, US","model":"C119, R4Q Flying Boxcar (F78)"},{"icao":"C120","code":"LL1P","manufacturer":"CESSNA","model":"120"},{"icao":"C123","code":"ML2P","manufacturer":"FAIRCHILD, US","model":"C123 Provider"},{"icao":"C125","code":"ML3P","manufacturer":"NORTHROP","model":"C125 Raider"},{"icao":"C130","code":"ML4T","manufacturer":"LOCKHEED","model":"C130A/B/E/F/H, AC130, CC130, DC130, EC130/E/G/H/Q, HC130, JC13 0, KC130B/F/H/R/T, LC130, MC130, NC130, RC130, TC130, VC130, WC130E/H, T"},{"icao":"C133","code":"ML4T","manufacturer":"DOUGLAS","model":"C133 Cargomaster"},{"icao":"C135","code":"HL4J","manufacturer":"BOEING","model":"C135B/C/E/K Stratolifter, EC135, NKC135, OC135, TC135, WC135"},{"icao":"C140","code":"LL1P","manufacturer":"CESSNA","model":"140"},{"icao":"C141","code":"HL4J","manufacturer":"LOCKHEED","model":"C141, Starlifter (L300)"},{"icao":"C14T","code":"LL2T","manufacturer":"AJI","model":"Turbo Star 414"},{"icao":"C15","code":"ML4J","manufacturer":"MCDONNELL DOUGLAS","model":"YC15"},{"icao":"C150","code":"LL1P","manufacturer":"CESSNA","model":"150"},{"icao":"C152","code":"LL1P","manufacturer":"CESSNA","model":"152"},{"icao":"C160","code":"ML2T","manufacturer":"TRANSALL","model":"C160"},{"icao":"C162","code":"LL1P","manufacturer":"CESSNA","model":"162 Skycatcher"},{"icao":"C17","code":"HL4J","manufacturer":"BOEING","model":"C17 Globemaster 3"},{"icao":"C170","code":"LL1P","manufacturer":"CESSNA","model":"170"},{"icao":"C172","code":"LL1P","manufacturer":"CESSNA","model":"172"},{"icao":"C175","code":"LL1P","manufacturer":"CESSNA","model":"175, Skylark"},{"icao":"C177","code":"LL1P","manufacturer":"CESSNA","model":"177, Cardinal"},{"icao":"C180","code":"LL1P","manufacturer":"CESSNA","model":"180, Skywagon 180 (U17C)"},{"icao":"C182","code":"LL1P","manufacturer":"CESSNA","model":"182"},{"icao":"C185","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"185"},{"icao":"C188","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"188, AC05 AgWagon, AgTrainer, Pijao"},{"icao":"C190","code":"LL1P","manufacturer":"CESSNA","model":"190"},{"icao":"C195","code":"LL1P","manufacturer":"CESSNA","model":"195 (LC126)"},{"icao":"C2","code":"ML2T","manufacturer":"GRUMMAN","model":"C2 Greyhound"},{"icao":"C205","code":"LL1P","manufacturer":"CESSNA","model":"205"},{"icao":"C206","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"206"},{"icao":"C207","code":"LL1P","manufacturer":"CESSNA","model":"207 (Turbo)Skywagon 207, (Turbo)Stationair 7/8"},{"icao":"C208","code":"LL1T","manufacturer":"CESSNA","model":"208 Caravan 1, (Super)Cargomaster, Grand  Caravan (C98, U27)"},{"icao":"C210","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"210"},{"icao":"C212","code":"ML2T","manufacturer":"CASA","model":"C212 Aviocar (T12, TE12, TR12, D3, Tp89)"},{"icao":"C21T","code":"LL2T","manufacturer":"ADVANCED AIRCRAFT","model":"Regent 1500"},{"icao":"C22J","code":"LL2J","manufacturer":"CAPRONI VIZZOLA","model":"C22J Ventura"},{"icao":"C240","code":"LL1P","manufacturer":"CESSNA","model":"T240 Corvalis TTx"},{"icao":"C25A","code":"LL2J","manufacturer":"CESSNA","model":"525A Citation CJ2"},{"icao":"C25B","code":"LL2J","manufacturer":"CESSNA","model":"525B Citation CJ3"},{"icao":"C25C","code":"ML2J","manufacturer":"CESSNA","model":"525C Citation CJ4"},{"icao":"C25M","code":"LL2J","manufacturer":"CESSNA","model":"525 Citation M2"},{"icao":"C270","code":"LL1P","manufacturer":"CAUDRON","model":"C270 Luciole, C272/275"},{"icao":"C27J","code":"ML2T","manufacturer":"ALENIA","model":"C27J Spartan"},{"icao":"C295","code":"ML2T","manufacturer":"CASA","model":"C295"},{"icao":"C303","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"T303"},{"icao":"C306","code":"LL1P","manufacturer":"CEA-UFMG","model":"CEA-306 CB-10 Triathlon"},{"icao":"C309","code":"LL1P","manufacturer":"CEA","model":"CEA-309 Mehari"},{"icao":"C30J","code":"ML4T","manufacturer":"LOCKHEED MARTIN","model":"C130J, EC130J, KC130J, WC130J Hercules (C4/5)"},{"icao":"C310","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"310"},{"icao":"C311","code":"LL1P","manufacturer":"CEA","model":"CEA-311 Anequim"},{"icao":"C320","code":"LL2P","manufacturer":"CESSNA","model":"320 (Executive)Skyknight"},{"icao":"C335","code":"LL2P","manufacturer":"CESSNA","model":"335"},{"icao":"C336","code":"LL2P","manufacturer":"CESSNA","model":"336 Skymaster"},{"icao":"C337","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"337"},{"icao":"C340","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"340"},{"icao":"C365","code":"LL1T","manufacturer":"EKW","model":"C3605"},{"icao":"C402","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"402"},{"icao":"C404","code":"LL2P","manufacturer":"CESSNA","model":"404 Titan"},{"icao":"C408","code":"ML2T","manufacturer":"CESSNA","model":"408 SkyCourier"},{"icao":"C411","code":"LL2P","manufacturer":"CESSNA","model":"411"},{"icao":"C414","code":"LL2P","manufacturer":"AVIONES COLOMBIA","model":"414"},{"icao":"C42","code":"LL1P","manufacturer":"IKARUS","model":"Bison"},{"icao":"C421","code":"LL2P","manufacturer":"CESSNA","model":"421, Golden Eagle, Executive Commuter"},{"icao":"C425","code":"LL2T","manufacturer":"CESSNA","model":"425 Corsair, Conquest 1"},{"icao":"C441","code":"LL2T","manufacturer":"CESSNA","model":"441 Conquest, Conquest 2"},{"icao":"C46","code":"ML2P","manufacturer":"CURTISS","model":"C46 Commando (CW20)"},{"icao":"C5","code":"HL4J","manufacturer":"LOCKHEED","model":"C5 Galaxy (L500)"},{"icao":"C500","code":"LL2J","manufacturer":"CESSNA","model":"500 Citation, Citation 1"},{"icao":"C501","code":"LL2J","manufacturer":"CESSNA","model":"501 Citation 1SP"},{"icao":"C510","code":"LL2J","manufacturer":"CESSNA","model":"Citation Mustang"},{"icao":"C525","code":"LL2J","manufacturer":"CESSNA","model":"525 CitationJet Citation CJ1"},{"icao":"C526","code":"LL2J","manufacturer":"CESSNA","model":"526 CitationJet"},{"icao":"C550","code":"LL2J","manufacturer":"CESSNA","model":"550, S550, 552 Citation 2/S2/Bravo (T47, U20)"},{"icao":"C551","code":"LL2J","manufacturer":"CESSNA","model":"551 Citation 2SP"},{"icao":"C55B","code":"LL2J","manufacturer":"CESSNA","model":"550B Citation Bravo"},{"icao":"C560","code":"ML2J","manufacturer":"CESSNA","model":"560 Citation 5/5 Ultra/5 Ultra Encore (UC35.OT47, TR20)"},{"icao":"C56X","code":"ML2J","manufacturer":"CESSNA","model":"560XL Citation Excel"},{"icao":"C5M","code":"HL4J","manufacturer":"LOCKHEED","model":"C-5M Super Galaxy"},{"icao":"C650","code":"ML2J","manufacturer":"CESSNA","model":"650 Citation 3/6/7"},{"icao":"C680","code":"ML2J","manufacturer":"CESSNA","model":"680 Citation Sovereign"},{"icao":"C68A","code":"ML2J","manufacturer":"CESSNA","model":"680A Citation Latitude"},{"icao":"C700","code":"ML2J","manufacturer":"CESSNA","model":"Citation Longitude"},{"icao":"C72R","code":"LL1P","manufacturer":"CESSNA","model":"172RG"},{"icao":"C750","code":"ML2J","manufacturer":"CESSNA","model":"750 Citation 10"},{"icao":"C77R","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"177RG"},{"icao":"C82","code":"ML2P","manufacturer":"FAIRCHILD, US","model":"C82 Packet (F78)"},{"icao":"C82R","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"R182"},{"icao":"C82S","code":"LL1P","manufacturer":"CESSNA","model":"T182 Turbo Skylane"},{"icao":"C82T","code":"LL1P","manufacturer":"CESSNA","model":"TR182 Turbo Skylane RG"},{"icao":"C919","code":"ML2J","manufacturer":"COMAC","model":"C919"},{"icao":"C97","code":"ML4P","manufacturer":"BOEING","model":"C97 Stratofreighter"},{"icao":"CA12","code":"LL1T","manufacturer":"COMP AIR","model":"Comp Air 12"},{"icao":"CA19","code":"LL1P","manufacturer":"COMMONWEALTH","model":"CA-13/19 Boomerang"},{"icao":"CA1P","code":"LL1P","manufacturer":"AEROCOMP","model":"Comp Air 10"},{"icao":"CA1T","code":"LL1T","manufacturer":"AEROCOMP","model":"Comp Air 10T"},{"icao":"CA25","code":"LL1P","manufacturer":"COMMONWEALTH,  AUSTRALIA","model":"CA25 Winjeel"},{"icao":"CA3","code":"LL1P","manufacturer":"AEROCOMP","model":"Comp Air 3"},{"icao":"CA4","code":"LL1P","manufacturer":"AEROCOMP","model":"Comp Air 4, Comp Monster"},{"icao":"CA41","code":"LL1P","manufacturer":"CORVUS","model":"CA-41 Racer"},{"icao":"CA6","code":"LL1P","manufacturer":"AEROCOMP","model":"Comp Air 6"},{"icao":"CA61","code":"LL1P","manufacturer":"CVJETKOVIC","model":"CA61 Mini Ace"},{"icao":"CA65","code":"LL1P","manufacturer":"CVJETKOVIC","model":"CA65, Skyfly"},{"icao":"CA7P","code":"LL1P","manufacturer":"AEROCOMP","model":"Comp Air 7"},{"icao":"CA7T","code":"LL1T","manufacturer":"AEROCOMP","model":"Comp Air 7T"},{"icao":"CA8","code":"LL1T","manufacturer":"AEROCOMP","model":"Comp Air 8"},{"icao":"CA9","code":"LL1T","manufacturer":"COMP AIR","model":"Comp Air 9"},{"icao":"CABI","code":"LL1T","manufacturer":"UNIVERSAL COMPOSITE","model":"Carbon Bird"},{"icao":"CABN","code":"LL1P","manufacturer":"PARAMOUNT","model":"Cabinaire"},{"icao":"CAD2","code":"LL1P","manufacturer":"CLASS","model":"Bush Caddy R-80/120"},{"icao":"CAD4","code":"LL1P","manufacturer":"CLASS","model":"Bush Caddy L-160/162/164"},{"icao":"CAJ","code":"LL1J","manufacturer":"COMP AIR","model":"CA-J Comp Air Jet"},{"icao":"CAML","code":"LL1P","manufacturer":"SOPWITH","model":"Camel, Replica"},{"icao":"CAMP","code":"LL1P","manufacturer":"GREGA","model":"GN1 Aircamper"},{"icao":"CAN4","code":"LL1P","manufacturer":"CAMPANA","model":"AN4"},{"icao":"CAPL","code":"LL1P","manufacturer":"CAPELLA","model":"Capella"},{"icao":"CAR","code":"LL1P","manufacturer":"AEROCAR","model":"Aerocar"},{"icao":"CARV","code":"ML4P","manufacturer":"AVIATION TRADERS","model":"ATL98 Carvair"},{"icao":"CASS","code":"LL1P","manufacturer":"CASSUTT","model":"Special"},{"icao":"CAT","code":"MA2P","manufacturer":"BOEING CANADA","model":"PBY Catalina, Canso"},{"icao":"CAT1","code":"LL1P","manufacturer":"CREATIVE FLIGHT","model":"MPA Aerocat SR"},{"icao":"CAT2","code":"LL2P","manufacturer":"CREATIVE FLIGHT","model":"MPA Aerocat TR"},{"icao":"CAW","code":"LL1P","manufacturer":"CESSNA","model":"AW"},{"icao":"CB1","code":"LL1P","manufacturer":"HATZ","model":"CB1 Biplane"},{"icao":"CC19","code":"LL1P","manufacturer":"CUB CRAFTERS","model":"CC-19 XCub"},{"icao":"CCOP","code":"LG1P","manufacturer":"CARTERCOPTERS","model":"Cartercopter"},{"icao":"CD2","code":"LA2T","manufacturer":"CLAUDIUS DORNIER","model":"CD2 Seastar"},{"icao":"CDC6","code":"LL1P","manufacturer":"CESSNA","model":"DC6"},{"icao":"CDUS","code":"LG1P","manufacturer":"AUTOGYRO","model":"Calidus"},{"icao":"CDW1","code":"LL1P","manufacturer":"CHILTON","model":"DW1"},{"icao":"CE15","code":"LS1P","manufacturer":"CHERNOV","model":"Che15"},{"icao":"CE22","code":"LA2P","manufacturer":"CHERNOV","model":"Che22 Corvette"},{"icao":"CE23","code":"LA1P","manufacturer":"CHERNOV","model":"Che-23"},{"icao":"CE25","code":"LA2P","manufacturer":"CHERNOV","model":"Che25"},{"icao":"CE27","code":"LA2P","manufacturer":"CHERNOV","model":"Che-27"},{"icao":"CE43","code":"LL1P","manufacturer":"CERVA","model":"CE43 Guepard"},{"icao":"CEGL","code":"LL1P","manufacturer":"CELAIR","model":"Eagle 300"},{"icao":"CELR","code":"LL1P","manufacturer":"MIRAGE","model":"Celerity"},{"icao":"CENT","code":"LL1P","manufacturer":"FOUND","model":"100 Centennial"},{"icao":"CFRE","code":"LA1P","manufacturer":"COLYAER","model":"Freedom"},{"icao":"CG3","code":"LL1P","manufacturer":"CAUDRON","model":"G3"},{"icao":"CGAN","code":"LS1P","manufacturer":"COLYAER","model":"Gannet"},{"icao":"CH1","code":"LL1T","manufacturer":"AIDC","model":"TCH1, ACH1, RCH1 ChungTsing"},{"icao":"CH10","code":"LL1P","manufacturer":"ZENAIR","model":"CH100 MonoZ\ufffdnith, MonoZ"},{"icao":"CH12","code":"LH1P","manufacturer":"CICARE","model":"CH-12"},{"icao":"CH14","code":"LH1T","manufacturer":"CICARE","model":"CH-14 Aguilucho"},{"icao":"CH15","code":"LL1P","manufacturer":"ZENAIR","model":"CH150 AcroZ\ufffdnith AcroZ"},{"icao":"CH18","code":"LL1P","manufacturer":"ZENAIR","model":"CH180 Super AcroZ\ufffdnith, Super AcroZ"},{"icao":"CH20","code":"LL1P","manufacturer":"HEINTZ","model":"CH200 Z\ufffdnith"},{"icao":"CH25","code":"LL1P","manufacturer":"ZENAIR","model":"CH250 Z\ufffdnith"},{"icao":"CH2T","code":"LL1P","manufacturer":"AMD","model":"CH2000/2T Zenith, Alarus"},{"icao":"CH3","code":"LL1P","manufacturer":"CHRISLEA","model":"CH-3 Super Ace, Skyjeep"},{"icao":"CH30","code":"LL1P","manufacturer":"ZENAIR","model":"CH300 TriZ\ufffdnith, TriZ"},{"icao":"CH40","code":"LL2P","manufacturer":"CHAMPION","model":"402 Lancer"},{"icao":"CH50","code":"LL1P","manufacturer":"ZENAIR","model":"CH50 Mini Z\ufffdnith, MiniZ"},{"icao":"CH60","code":"LL1P","manufacturer":"CZAW","model":"CH601 Zodiac"},{"icao":"CH62","code":"LL2P","manufacturer":"ZENAIR","model":"CH620 Gemini"},{"icao":"CH64","code":"LL1P","manufacturer":"AMD","model":"CH640 Zodiac"},{"icao":"CH65","code":"LL1P","manufacturer":"AMD","model":"CH-650 Zodiac"},{"icao":"CH7","code":"LH1P","manufacturer":"HELI-SPORT","model":"CH-7 Kompress"},{"icao":"CH70","code":"LL1P","manufacturer":"CZAW","model":"CH701 Stol"},{"icao":"CH75","code":"LL1P","manufacturer":"AMD","model":"CH-750 Stol"},{"icao":"CH7A","code":"LL1P","manufacturer":"AERONCA","model":"7AC/BCM/CC/CCM/DC/EC Champion,Traveler (L16)"},{"icao":"CH7B","code":"LL1P","manufacturer":"AMERICAN CHAMPION","model":"7GCBC Citabria Adventure/Explorer"},{"icao":"CH80","code":"LL1P","manufacturer":"ZENAIR","model":"CH801 Stol"},{"icao":"CHAN","code":"LL1P","manufacturer":"CADCOR","model":"Chanute"},{"icao":"CHCS","code":"LL1P","manufacturer":"NOIN","model":"Choucas"},{"icao":"CHGO","code":"LL1P","manufacturer":"KOREAN AIR","model":"CHK91 ChangGong 91"},{"icao":"CHIC","code":"LL1P","manufacturer":"PODESVA","model":"Chico"},{"icao":"CHIF","code":"LH1P","manufacturer":"PAWNEE","model":"Chief"},{"icao":"CHIN","code":"LL1P","manufacturer":"ASAP","model":"Chinook"},{"icao":"CHIP","code":"LL1P","manufacturer":"LEGER","model":"SuperChipmunk"},{"icao":"CHR1","code":"LL1P","manufacturer":"ELMWOOD","model":"CA05 Christavia Mk1"},{"icao":"CHR4","code":"LL1P","manufacturer":"ELMWOOD","model":"CH8 Christavia Mk4"},{"icao":"CHSY","code":"LG1P","manufacturer":"CHAYAIR","model":"Sycamore"},{"icao":"CICA","code":"LL2P","manufacturer":"HYDROPLANE","model":"Cicada, SkyWind"},{"icao":"CJ1","code":"LL1P","manufacturer":"CORBY","model":"CJ1 Starlet"},{"icao":"CJ6","code":"LL1P","manufacturer":"HONGDU","model":"CJ6, PT6"},{"icao":"CJET","code":"LL1P","manufacturer":"CENTURY AEROSPACE, US","model":"Century Jet, CA100"},{"icao":"CKUO","code":"ML2J","manufacturer":"AIDC","model":"FCK1ChingKuo"},{"icao":"CL2P","code":"MA2P","manufacturer":"CANADAIR","model":"CL215 (UD13 (piston engine))"},{"icao":"CL2T","code":"MA2T","manufacturer":"CANADAIR","model":"CL215T/415 SuperScooper (UD13 (turbine))"},{"icao":"CL30","code":"ML2J","manufacturer":"BOMBARDIER","model":"BD100 Challenger 300"},{"icao":"CL35","code":"ML2J","manufacturer":"BOMBARDIER","model":"Challenger 350"},{"icao":"CL41","code":"LL1J","manufacturer":"CANADAIR","model":"CL41 Tutor (CT114)"},{"icao":"CL44","code":"ML4T","manufacturer":"CANADAIR","model":"CL44 Forty Four"},{"icao":"CL4G","code":"ML4T","manufacturer":"CANADAIR","model":"CL44O Guppy"},{"icao":"CL60","code":"ML2J","manufacturer":"BOMBARDIER","model":"CL600 Challenger 600/601/604 (CC144, CE144)"},{"icao":"CL8","code":"LL1P","manufacturer":"CARRIOU","model":"CL8 RSA Club"},{"icao":"CLA","code":"LL1P","manufacturer":"CALLAIR","model":"A2/3/4"},{"icao":"CLB1","code":"LL1P","manufacturer":"AERO COMMANDER","model":"B1 Ag Commander"},{"icao":"CLBR","code":"LL1P","manufacturer":"FISHER","model":"Celebrity"},{"icao":"CLD2","code":"LG1P","manufacturer":"ROTORTEC","model":"Cloud Dancer 2"},{"icao":"CLDS","code":"LL1P","manufacturer":"REARWIN","model":"8125/8135/8090 Cloudster"},{"icao":"CLON","code":"LG1P","manufacturer":"AUTOGYRO","model":"Cavalon"},{"icao":"CMA3","code":"LL1P","manufacturer":"COLYAER","model":"Martin 3"},{"icao":"CMAS","code":"LL1P","manufacturer":"CESSNA","model":"C34/37/38/145/165, Airmaster"},{"icao":"CMD1","code":"LG1P","manufacturer":"AIR COMMAND","model":"Commander 147"},{"icao":"CMDE","code":"LG1P","manufacturer":"AIR COMMAND","model":"Commander Elite"},{"icao":"CMDT","code":"LG1P","manufacturer":"AIR COMMAND","model":"Commander Tandem 618/Mazda"},{"icao":"CN12","code":"LL1P","manufacturer":"CIRCA","model":"Nieuport 12-7/8"},{"icao":"CN35","code":"ML2T","manufacturer":"AIRTECH, INDONESIA/SPAIN","model":"CN235, Persuader (T19)"},{"icao":"CNBR","code":"ML2J","manufacturer":"BAC","model":"Canberra"},{"icao":"CNDR","code":"LL2T","manufacturer":"GENERAL AVIA","model":"F20TP Condor"},{"icao":"CNGP","code":"LL1P","manufacturer":"CESSNA","model":"NGP"},{"icao":"CNUK","code":"LL1P","manufacturer":"FLEET","model":"80 Canuck"},{"icao":"CO50","code":"LL1P","manufacturer":"COBALT","model":"Co-50 Valkyrie"},{"icao":"COAR","code":"LL1P","manufacturer":"COBRA","model":"Arrow"},{"icao":"COBR","code":"LL1P","manufacturer":"DEBORDE\ufffdROLLAND","model":"Cobra"},{"icao":"COL3","code":"LL1P","manufacturer":"LANCAIR","model":"LC40, Columbia 300"},{"icao":"COL4","code":"LL1P","manufacturer":"CESSNA","model":"400 Corvalis TT "},{"icao":"COLT","code":"LL1P","manufacturer":"TEXAS AIRCRAFT","model":"TA-01 Colt"},{"icao":"COMT","code":"ML4J","manufacturer":"DE HAVILLAND","model":"DH106 Comet"},{"icao":"COMU","code":"LH1P","manufacturer":"HELICOM","model":"H1 Commuter"},{"icao":"CONC","code":"HL4J","manufacturer":"AEROSPATIALE","model":"Concorde"},{"icao":"CONI","code":"ML4P","manufacturer":"LOCKHEED","model":"L049/749/1049 Constellation, Super Constellation, Starliner (C121, RC121, EC121, VC121, WV, R7V, Warning Star)"},{"icao":"COOT","code":"LA1P","manufacturer":"AEROCAR","model":"Coot, Super Coot"},{"icao":"CORO","code":"LL1P","manufacturer":"CORVUS","model":"CA-21 Phantom, Corone, Crusader"},{"icao":"CORR","code":"LL1P","manufacturer":"SIVEL","model":"SD27 Corriedale"},{"icao":"CORS","code":"ML1P","manufacturer":"CHANCE VOUGHT","model":"F4U, AU Corsair (V166)"},{"icao":"CORV","code":"LL2P","manufacturer":"WOLFSBERG","model":"Corvus"},{"icao":"COUG","code":"LL1P","manufacturer":"ACRO SPORT","model":"Cougar"},{"icao":"COUR","code":"LL1P","manufacturer":"HELIO","model":"H391/392/395/250/295/700/800, HT295 Courier, StratoCourier, Super Courier (U10)"},{"icao":"COY2","code":"LL1P","manufacturer":"RANS","model":"S6 Coyote 2"},{"icao":"COZJ","code":"LL1J","manufacturer":"CO-Z","model":"CozyJet"},{"icao":"COZY","code":"LL1P","manufacturer":"AEROCAD","model":"AeroCanard"},{"icao":"CP10","code":"LL1P","manufacturer":"AKROTECH EUROPE","model":"CAP10"},{"icao":"CP13","code":"LL1P","manufacturer":"CAARP","model":"CP1310/1315/1330 Super Emeraude"},{"icao":"CP20","code":"LL1P","manufacturer":"CAARP","model":"CAP20"},{"icao":"CP21","code":"LL1P","manufacturer":"MUDRY","model":"CAP21"},{"icao":"CP22","code":"LL1P","manufacturer":"AKROTECH EUROPE","model":"CAP222"},{"icao":"CP23","code":"LL1P","manufacturer":"AKROTECH EUROPE","model":"CAP232"},{"icao":"CP30","code":"LL1P","manufacturer":"BINDER","model":"CP301 Smaragd"},{"icao":"CP32","code":"LL1P","manufacturer":"ERPALS","model":"CP320/324 Emeraude"},{"icao":"CP60","code":"LL1P","manufacturer":"PIEL","model":"CP60, CP601 to 608 Diamant, Super Diamant"},{"icao":"CP65","code":"LL1P","manufacturer":"PORTERFIELD","model":"CP65 Collegiate"},{"icao":"CP75","code":"LL1P","manufacturer":"PIEL","model":"CP70/701/750/751/760 B\ufffdryl"},{"icao":"CP80","code":"LL1P","manufacturer":"PIEL","model":"CP80/801/802 Z\ufffdphir"},{"icao":"CP90","code":"LL1P","manufacturer":"PIEL","model":"CP90 Pinocchio"},{"icao":"CPNA","code":"LL1P","manufacturer":"PENA","model":"Capena"},{"icao":"CPUP","code":"LL1P","manufacturer":"CULP","model":"Sopwith Pup"},{"icao":"CR10","code":"LL1P","manufacturer":"DYN?AERO","model":"CR100/110/120"},{"icao":"CRA1","code":"LL1P","manufacturer":"CRANFIELD","model":"A1 Eagle"},{"icao":"CRAC","code":"LL1P","manufacturer":"PLUMB","model":"CJ3 Cracker Jack"},{"icao":"CRBN","code":"LL1P","manufacturer":"CURTISS","model":"50 Robin"},{"icao":"CRER","code":"LL1P","manufacturer":"RANS","model":"S7 Courier"},{"icao":"CRES","code":"LL1T","manufacturer":"NEW ZEALAND","model":"Cresco"},{"icao":"CRIO","code":"LA1P","manufacturer":"MICROLEVE","model":"Corsario"},{"icao":"CRJ1","code":"ML2J","manufacturer":"CANADAIR","model":"CL600 Regional Jet CRJ100, RJ100"},{"icao":"CRJ2","code":"ML2J","manufacturer":"CANADAIR","model":"CL600 Regional Jet CRJ200, RJ200"},{"icao":"CRJ7","code":"ML2J","manufacturer":"CANADAIR","model":"CL600 Regional Jet CRJ700"},{"icao":"CRJ9","code":"ML2J","manufacturer":"CANADAIR","model":"CL600 Regional Jet CRJ900"},{"icao":"CRJX","code":"ML2J","manufacturer":"BOMBARDIER","model":"CRJ-1000"},{"icao":"CRUZ","code":"LL1P","manufacturer":"CZECH SPORT AIRCRAFT","model":"SportCruiser"},{"icao":"CT4","code":"LL1P","manufacturer":"AESL","model":"CT4 Airtrainer"},{"icao":"CTAH","code":"LL1P","manufacturer":"RAINBOW","model":"Cheetah"},{"icao":"CTLN","code":"LA1P","manufacturer":"FLY SYNTHESIS","model":"Catalina"},{"icao":"CUB2","code":"LL1P","manufacturer":"ACES HIGH","model":"Cuby 2"},{"icao":"CUCA","code":"LL1P","manufacturer":"CULVER","model":"LAR, LCA, LFA, Cadet (PQ8/14)"},{"icao":"CULP","code":"LL1P","manufacturer":"CULP","model":"Special"},{"icao":"CULV","code":"LL1P","manufacturer":"CULVER","model":"V"},{"icao":"CULX","code":"LL2P","manufacturer":"FISHER AERO","model":"Culex"},{"icao":"CV99","code":"ML4J","manufacturer":"CONVAIR","model":"CV990"},{"icao":"CVLP","code":"ML2P","manufacturer":"CONVAIR","model":"CV240/340/440 Convairliner, Metropolitan (C131, HC131, RC131, TC131, VC131F/G, T29, VT29, ET29, VT29,   Samaritan)"},{"icao":"CVLT","code":"ML2T","manufacturer":"CANADAIR","model":"CL66, CV580 (CC109 Cosmopolitan)"},{"icao":"CX5","code":"LL1P","manufacturer":"THATCHER","model":"CX-5"},{"icao":"CYCL","code":"LL1P","manufacturer":"CARLSON","model":"Skycycle"},{"icao":"CYGT","code":"LL1P","manufacturer":"HAWKER","model":"Cygnet"},{"icao":"D1","code":"LL2P","manufacturer":"DERRINGER","model":"New Derringer"},{"icao":"D11","code":"LL1P","manufacturer":"AERO\ufffdDIFUSION","model":"D112/119/1190S Popuplane, Compostela"},{"icao":"D139","code":"LL1P","manufacturer":"DORNA","model":"D139PT1 Blue Bird"},{"icao":"D140","code":"LL1P","manufacturer":"JODEL","model":"D140 Mousquetaire, Abeille"},{"icao":"D150","code":"LL1P","manufacturer":"JODEL","model":"D150 Mascaret"},{"icao":"D18","code":"LL1P","manufacturer":"JODEL","model":"D18/19"},{"icao":"D201","code":"LL1P","manufacturer":"D?APUZZO","model":"D201 Sportwing"},{"icao":"D21","code":"LL1P","manufacturer":"FOKKER","model":"D-21 Replica"},{"icao":"D228","code":"LL2T","manufacturer":"DORNIER","model":"228"},{"icao":"D25","code":"LL1P","manufacturer":"NEW STANDARD","model":"D25"},{"icao":"D250","code":"LL1P","manufacturer":"CENTRE EST","model":"DR200/250, Capitaine"},{"icao":"D253","code":"LL1P","manufacturer":"CENTRE EST","model":"DR253 Regent"},{"icao":"D28D","code":"LL2P","manufacturer":"DORNIER","model":"Do28D/D1/D2, 1282 Skyservant"},{"icao":"D28T","code":"LL2T","manufacturer":"DORNIER","model":"Do28D6, 1286 Turbo Skyservant"},{"icao":"D31","code":"LL1P","manufacturer":"DRUINE","model":"D31 Turbulent"},{"icao":"D328","code":"ML2T","manufacturer":"DORNIER","model":"328"},{"icao":"D39","code":"LL1P","manufacturer":"AKAFLIEG DARMSTADT","model":"D39"},{"icao":"D4","code":"LL1P","manufacturer":"AUSTER","model":"D4"},{"icao":"D5","code":"LL1P","manufacturer":"AUSTER","model":"D5"},{"icao":"D5TU","code":"LL1P","manufacturer":"DRUINE","model":"D5 Turbi"},{"icao":"D6","code":"LL1P","manufacturer":"AUSTER","model":"D6"},{"icao":"D6CR","code":"LL1P","manufacturer":"DRUINE","model":"D60/61/62 Condor"},{"icao":"D7","code":"LL1P","manufacturer":"FOKKER","model":"D7, Replica"},{"icao":"D8","code":"LL1P","manufacturer":"FOKKER","model":"D8, Replica"},{"icao":"DA2","code":"LL1P","manufacturer":"DAVIS","model":"DA2"},{"icao":"DA36","code":"LL1E","manufacturer":"DIAMOND","model":"DA-36 E-Star"},{"icao":"DA40","code":"LL1P","manufacturer":"DIAMOND","model":"DA40 Katana, Diamond Star"},{"icao":"DA42","code":"LL2P","manufacturer":"DIAMOND","model":"DA42 Twinstar"},{"icao":"DA5","code":"LL1P","manufacturer":"DAVIS","model":"DA5"},{"icao":"DA50","code":"LL1P","manufacturer":"DIAMOND","model":"DA-50 Magnum, SuperStar"},{"icao":"DA62","code":"LL2P","manufacturer":"DIAMOND","model":"DA62"},{"icao":"DAHU","code":"LL1P","manufacturer":"PENA","model":"Dahu"},{"icao":"DAKH","code":"LL1P","manufacturer":"FISHER","model":"Dakota Hawk"},{"icao":"DAL1","code":"LL1P","manufacturer":"SPEZIO","model":"DAL1 Tuholer"},{"icao":"DAL4","code":"LL1P","manufacturer":"DALLACH","model":"D-4 Fascination"},{"icao":"DAL5","code":"LL1P","manufacturer":"DALLACH","model":"D-5 Evolution"},{"icao":"DART","code":"LL1P","manufacturer":"PARRISH","model":"Dart"},{"icao":"DC10","code":"HL3J","manufacturer":"MCDONNELL DOUGLAS","model":"DC10, MD10 (KC10 Extender, KDC10)"},{"icao":"DC2","code":"ML2P","manufacturer":"DOUGLAS","model":"DC2"},{"icao":"DC3","code":"ML2P","manufacturer":"DOUGLAS","model":"DC3, DST (C41, C47, C47A to J, AC47, EC47, HC47, LC47, RC47, TC47, VC47 Skytrain, C53 Skytrooper, C117A/B/C, R4D1 to 7, Dakota)"},{"icao":"DC3S","code":"ML2P","manufacturer":"DOUGLAS","model":"Super DC3 (C117D, LC117, TC117, VC117, R4D8)"},{"icao":"DC3T","code":"ML2T","manufacturer":"BASLER","model":"Turbo 67"},{"icao":"DC4","code":"ML4P","manufacturer":"DOUGLAS","model":"DC4 (C54, EC54, HC54, TC54, VC54, R5D Skymaster)"},{"icao":"DC6","code":"ML4P","manufacturer":"DOUGLAS","model":"DC6 (C118, VC118, R6D Liftmaster)"},{"icao":"DC7","code":"ML4P","manufacturer":"DOUGLAS","model":"DC7, Seven Seas"},{"icao":"DC85","code":"HL4J","manufacturer":"DOUGLAS","model":"DC8-50, Jet Trader (EC24)"},{"icao":"DC86","code":"HL4J","manufacturer":"DOUGLAS","model":"DC8-60"},{"icao":"DC87","code":"HL4J","manufacturer":"DOUGLAS","model":"DC8-70"},{"icao":"DC8Q","code":"HL4J","manufacturer":"DOUGLAS","model":"DC8 Stage 3 (US ONLY)"},{"icao":"DC91","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9-10"},{"icao":"DC92","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9-20"},{"icao":"DC93","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9-30"},{"icao":"DC94","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9-40"},{"icao":"DC95","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9-50"},{"icao":"DC9Q","code":"ML2J","manufacturer":"DOUGLAS","model":"DC9 Stage 3 (US ONLY)"},{"icao":"DEAG","code":"LG1P","manufacturer":"AMAX","model":"Double Eagle"},{"icao":"DEFI","code":"LL2P","manufacturer":"RUTAN","model":"40 Defiant"},{"icao":"DELF","code":"LL1P","manufacturer":"LYAVIN","model":"Delfin"},{"icao":"DFL6","code":"LL1P","manufacturer":"DAMOURE\ufffdFABRE","model":"DFL6 Saphir"},{"icao":"DFLY","code":"LL1P","manufacturer":"VIKING","model":"Dragonfly"},{"icao":"DG15","code":"LL1P","manufacturer":"HOWARD AIRCRFT, US","model":"DGA15 (GH Nightingale, NH)"},{"icao":"DG1T","code":"LL1P","manufacturer":"DG FLUGZEUGBAU","model":"DG-1000M, DG-1001M, DG-1001T"},{"icao":"DG40","code":"LL1P","manufacturer":"GLASER\ufffdDIRKS","model":"DG400"},{"icao":"DG50","code":"LL1P","manufacturer":"GLASER\ufffdDIRKS","model":"DG500M"},{"icao":"DG60","code":"LL1P","manufacturer":"GLASER\ufffdDIRKS","model":"DG600M"},{"icao":"DG80","code":"LL1P","manufacturer":"DG FLUGZEUGBAU","model":"DG800"},{"icao":"DH2T","code":"LL1T","manufacturer":"DE HAVILLAND CANADA","model":"DHC2 Mk3 Turbo Beaver"},{"icao":"DH3T","code":"LL1T","manufacturer":"DE HAVILLAND CANADA","model":"DHC3 Turbo Otter"},{"icao":"DH4T","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC-4 Turbo Caribou"},{"icao":"DH60","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH60 Moth, Moth Major"},{"icao":"DH80","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH80 Puss Moth"},{"icao":"DH82","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH82 Tiger Moth, Queen Bee"},{"icao":"DH83","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH83 Fox Moth"},{"icao":"DH84","code":"LL2P","manufacturer":"DE HAVILLAND","model":"DH-84 Dragon"},{"icao":"DH85","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH85 Leopard Moth"},{"icao":"DH87","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH87 Hornet Moth"},{"icao":"DH88","code":"LL2P","manufacturer":"DE HAVILLAND","model":"DH88 Comet, Replica"},{"icao":"DH89","code":"LL2P","manufacturer":"DE HAVILLAND","model":"DH89 Dragon Rapide"},{"icao":"DH8A","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC8100 Dash 8 (E9, CT142, CC142)"},{"icao":"DH8B","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC8200 Dash 8"},{"icao":"DH8C","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC8300 Dash 8"},{"icao":"DH8D","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC8400 Dash 8"},{"icao":"DH90","code":"LL2P","manufacturer":"DE HAVILLAND","model":"DH90 Dragonfly"},{"icao":"DH94","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DH94 Moth Minor"},{"icao":"DHA3","code":"LL3P","manufacturer":"DE HAVILLAND AUSTRALIA","model":"DHA3 Drover"},{"icao":"DHC1","code":"LL1P","manufacturer":"DE HAVILLAND","model":"DHC1 Chipmunk"},{"icao":"DHC2","code":"LL1P","manufacturer":"AIRTECH, CANADA","model":"DHC2PZL3S Beaver"},{"icao":"DHC3","code":"LL1P","manufacturer":"AIRTECH, CANADA","model":"DHC3PZL3S/1000 Otter"},{"icao":"DHC4","code":"ML2P","manufacturer":"DE HAVILLAND CANADA","model":"DHC4 Caribou (C7, CV2)"},{"icao":"DHC5","code":"ML2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC5 Buffalo (C8, CV7, CC115, C115)"},{"icao":"DHC6","code":"LL2T","manufacturer":"DE HAVILLAND CANADA","model":"DHC6 Twin Otter (UV18, CC138)"},{"icao":"DHC7","code":"ML4T","manufacturer":"DE HAVILLAND CANADA","model":"DHC7 Dash 7 (O5, EO5, RC7)"},{"icao":"DIES","code":"LL1P","manufacturer":"PENNEC-LUCAS","model":"Dieselis"},{"icao":"DIJ3","code":"LL1P","manufacturer":"DIJKMAN\ufffdDULKES","model":"Dijkhastar 3"},{"icao":"DIJ4","code":"LA1P","manufacturer":"DIJKMAN-DULKES","model":"Dijkhastar 4"},{"icao":"DIMO","code":"LL1P","manufacturer":"DIAMOND","model":"HK36 Super Dimona, Katana Xtreme"},{"icao":"DINO","code":"LL1P","manufacturer":"GANZAVIA","model":"GAK22 Din\ufffd"},{"icao":"DIPR","code":"LA1P","manufacturer":"COLLINS","model":"Dipper"},{"icao":"DISC","code":"LL1P","manufacturer":"SCHEMPP\ufffdHIRTH","model":"Discus BT/BM"},{"icao":"DJET","code":"LL1J","manufacturer":"DIAMOND","model":"DJ-1 D-Jet"},{"icao":"DJIN","code":"LH1T","manufacturer":"SUD","model":"SO1221 Djinn"},{"icao":"DLH2","code":"LL1E","manufacturer":"LANGE","model":"E-1 Antares DLR-H2"},{"icao":"DNGO","code":"LA1T","manufacturer":"AERORIC","model":"Dingo"},{"icao":"DO27","code":"LL1P","manufacturer":"CASA","model":"C127 (U9)"},{"icao":"DO28","code":"LL2P","manufacturer":"DORNIER","model":"Do28A/B (Agur)"},{"icao":"DOCX","code":"LL1P","manufacturer":"KOVACH\ufffdELMENDORF","model":"ES3 Doc\'s RX"},{"icao":"DON","code":"LL1P","manufacturer":"UNIKOMTRANSO","model":"Don"},{"icao":"DOVE","code":"LL2P","manufacturer":"DE HAVILLAND","model":"DH104 Dove (Devon), Sea Devon"},{"icao":"DR1","code":"LL1P","manufacturer":"FOKKER","model":"Dr1, Replica"},{"icao":"DR10","code":"LL1P","manufacturer":"CENTRE EST","model":"DR100/105/1050/1051 Ambassadeur, Sicile, Sicile Record"},{"icao":"DR22","code":"LL1P","manufacturer":"CENTRE EST","model":"DR220/221 Dauphin, 2+2"},{"icao":"DR30","code":"LL1P","manufacturer":"CENTRE EST","model":"DR315/340/360/380 Petit Prince, Major,     Chevalier, Prince"},{"icao":"DR40","code":"LL1P","manufacturer":"ROBIN","model":"DR400/500 Cadet, Chevalier, Dauphin 4/80/2+2, Earl, Major, Major 80, Petit Prince, President, Regent, Remo 180/200/212, Remorqueur, 2+2"},{"icao":"DRAG","code":"LH1P","manufacturer":"CRAE","model":"Dragon Fly"},{"icao":"DRIF","code":"LL1P","manufacturer":"AUSTFLIGHT","model":"Drifter"},{"icao":"DRTG","code":"LL1P","manufacturer":"APPLEGATE & WEYANT","model":"Dart GC"},{"icao":"DSA1","code":"LL1P","manufacturer":"SMITH, FRANK W., US","model":"DSA1 Miniplane"},{"icao":"DSK","code":"LL1P","manufacturer":"KILLINGSWORTH","model":"DSK1/2 Hawk, Golden Hawk"},{"icao":"DSLK","code":"LL1P","manufacturer":"DRIGGS","model":"Skylark"},{"icao":"DT45","code":"LL1T","manufacturer":"DIAMOND","model":"Dart-450"},{"icao":"DTA1","code":"LL1P","manufacturer":"VERHEES","model":"D-1 Delta"},{"icao":"DTA2","code":"LL1P","manufacturer":"VERHEES","model":"D-2 Delta"},{"icao":"DUB2","code":"LL1P","manufacturer":"DUBNA","model":"2 Osa"},{"icao":"DUCE","code":"LL1P","manufacturer":"BAKENG","model":"Duce"},{"icao":"DUOD","code":"LL1P","manufacturer":"SCHEMPP-HIRTH","model":"Duo Discus T, XT, XLT"},{"icao":"DUR5","code":"LL1P","manufacturer":"DURAND","model":"Mk5"},{"icao":"DV1","code":"LL1P","manufacturer":"DOVA","model":"DV-1 Skylark"},{"icao":"DV2","code":"LL1P","manufacturer":"DOVA","model":"DV-2 Infinity"},{"icao":"DV20","code":"LL1P","manufacturer":"DIAMOND","model":"DA20/22, DV20 Katana, Speed Katana, Eclipse, Evolution"},{"icao":"DW1","code":"LL1P","manufacturer":"BELLANCA","model":"DW1 Eagle"},{"icao":"DWD2","code":"LL1P","manufacturer":"DEWOITINE","model":"D26/27"},{"icao":"DYH2","code":"LH1P","manufacturer":"DYNALI","model":"H-2"},{"icao":"E110","code":"LL2T","manufacturer":"EMBRAER","model":"EMB110/111 Bandeirante (C95, EC95, P95, R95, SC95)"},{"icao":"E120","code":"ML2T","manufacturer":"EMBRAER","model":"EMB120 Brasilia (VC97)"},{"icao":"E121","code":"LL2T","manufacturer":"EMBRAER","model":"EMB121 Xingu (VU9, EC9)"},{"icao":"E135","code":"ML2J","manufacturer":"EMBRAER","model":"EMB135 ECJ135, Legacy"},{"icao":"E145","code":"ML2J","manufacturer":"EMBRAER","model":"EMB145, ERJ145 (R99)"},{"icao":"E170","code":"ML2J","manufacturer":"EMBRAER","model":"170, 175, ERJ170"},{"icao":"E190","code":"ML2J","manufacturer":"EMBRAER","model":"190, 195, ERJ190"},{"icao":"E195","code":"ML2J","manufacturer":"EMBRAER","model":"195, ERJ-190-200"},{"icao":"E2","code":"ML2T","manufacturer":"GRUMMAN","model":"E2, TE2 Hawkeye, Daya"},{"icao":"E200","code":"LL1P","manufacturer":"EXTRA","model":"200"},{"icao":"E230","code":"LL1P","manufacturer":"EXTRA","model":"230"},{"icao":"E275","code":"ML2J","manufacturer":"EMBRAER","model":"E175-E2, ERJ-190-500"},{"icao":"E290","code":"ML2J","manufacturer":"EMBRAER","model":"E190-E2, ERJ-190-300"},{"icao":"E295","code":"ML2J","manufacturer":"EMBRAER","model":"E195-E2, ERJ-190-400"},{"icao":"E29E","code":"LL1E","manufacturer":"BINDER","model":"EB-29DE"},{"icao":"E2CB","code":"LL1P","manufacturer":"TAYLOR AIRCRAFT, US","model":"E2 Cub"},{"icao":"E300","code":"LL1P","manufacturer":"EXTRA","model":"300, 330, 350"},{"icao":"E314","code":"LL1T","manufacturer":"EMBRAER","model":"EMB312H/314 Super Tucano, ALX (A29, AT29, YA29)"},{"icao":"E350","code":"LL1T","manufacturer":"CESSNA","model":"E350"},{"icao":"E35L","code":"ML2J","manufacturer":"EMBRAER","model":"Legacy 650"},{"icao":"E390","code":"ML2J","manufacturer":"EMBRAER","model":"KC-390, C-390 Millennium, EMB-390"},{"icao":"E3CF","code":"HL4J","manufacturer":"BOEING","model":"E3A (CFM56), E3D/F, Sentry"},{"icao":"E3TF","code":"HL4J","manufacturer":"BOEING","model":"E3A (TF33), E3B/C, JE3, Sentry"},{"icao":"E400","code":"LL1P","manufacturer":"EXTRA","model":"400"},{"icao":"E45X","code":"ML2J","manufacturer":"EMBRAER","model":"EMB145XR"},{"icao":"E500","code":"LL1T","manufacturer":"EXTRA","model":"EA-500"},{"icao":"E50P","code":"LL2J","manufacturer":"EMBRAER","model":"Phenom 100"},{"icao":"E530","code":"ML2J","manufacturer":"CESSNA","model":"E530 Scorpion"},{"icao":"E545","code":"ML2J","manufacturer":"EMBRAER","model":"EMB-545 Legacy 450"},{"icao":"E550","code":"ML2J","manufacturer":"EMBRAER ","model":"EMB-550 Legacy 500"},{"icao":"E55P","code":"ML2J","manufacturer":"EMBRAER","model":"EMB-505 Phenom 300"},{"icao":"E6","code":"HL4J","manufacturer":"BOEING","model":"E6 Mercury"},{"icao":"E737","code":"ML2J","manufacturer":"BOEING","model":"737-700 Wedgetail"},{"icao":"E75L","code":"ML2J","manufacturer":"EMBRAER","model":"ERJ-170-200 (long wing)"},{"icao":"E75S","code":"ML2J","manufacturer":"EMBRAER","model":"ERJ-170-200 (short wing)"},{"icao":"E767","code":"HL2J","manufacturer":"BOEING","model":"E767"},{"icao":"E7BH","code":"LL1P","manufacturer":"E-7 GROUP","model":"E-7 Bush Hog"},{"icao":"EA40","code":"LL1J","manufacturer":"ECLIPSE","model":"E400"},{"icao":"EA50","code":"LL2J","manufacturer":"ECLIPSE","model":"Eclipse 500"},{"icao":"EAEA","code":"LL1P","manufacturer":"GROSSO","model":"Easy Eagle"},{"icao":"EAGL","code":"LL1P","manufacturer":"AVIAT","model":"Eagle"},{"icao":"EAGT","code":"LL1P","manufacturer":"AMEAGLE","model":"American Eaglet"},{"icao":"EAGX","code":"LL1P","manufacturer":"EAGLE AIRCRAFT","model":"Eagle XTS/100/150"},{"icao":"EB29","code":"LL1P","manufacturer":"BINDER","model":"EB-29, EB-29D"},{"icao":"EBOY","code":"LL1P","manufacturer":"FMA, PETROLINI","model":"IAe-20 El Boyero"},{"icao":"EC20","code":"LH1T","manufacturer":"EUROCOPTER","model":"EC120 Colibri"},{"icao":"EC25","code":"MH2T","manufacturer":"EUROCOPTER","model":"EC225/725"},{"icao":"EC30","code":"LH1T","manufacturer":"EUROCOPTER","model":"EC130"},{"icao":"EC35","code":"LH2T","manufacturer":"EUROCOPTER","model":"EC135/635"},{"icao":"EC45","code":"LH2T","manufacturer":"EUROCOPTER","model":"EC145"},{"icao":"EC55","code":"LH2T","manufacturer":"EUROCOPTER","model":"EC155"},{"icao":"EC6","code":"LL1P","manufacturer":"CROSES","model":"EC6/8 Criquet, Tourisme"},{"icao":"EC75","code":"MH2T","manufacturer":"AIRBUS HELICOPTERS","model":"EC-175"},{"icao":"ECHO","code":"LL1P","manufacturer":"TECNAM","model":"P92 Echo, SeaSky"},{"icao":"EDGE","code":"LL1P","manufacturer":"ZIVKO","model":"Edge 540"},{"icao":"EDGT","code":"LL1P","manufacturer":"ZIVKO","model":"Edge 540 T"},{"icao":"EF2","code":"LL1E","manufacturer":"BYE AEROSPACE","model":"eFlyer 2"},{"icao":"EFAN","code":"LL2E","manufacturer":"AIRBUS","model":"E-Fan"},{"icao":"EFOX","code":"LL1P","manufacturer":"AEROTREK","model":"A-220/240"},{"icao":"EFUS","code":"LL1E","manufacturer":"MAGNUS","model":"MG-11 eFusion"},{"icao":"EGL3","code":"LH1T","manufacturer":"ROTORWAY","model":"Eagle 300T"},{"icao":"EGRT","code":"LL1T","manufacturer":"GROB","model":"G520, D500 Egrett 2, Strato 1"},{"icao":"EH10","code":"MH3T","manufacturer":"AGUSTA","model":"EH101"},{"icao":"EL10","code":"LG1P","manufacturer":"ELA AVIACION","model":"ELA-10 Eclipse"},{"icao":"EL20","code":"LL1P","manufacturer":"ELITAR","model":"IE-202"},{"icao":"ELA7","code":"LG1P","manufacturer":"ELA AVIACION","model":"ELA-07"},{"icao":"ELF","code":"LL1P","manufacturer":"PARNALL","model":"Elf"},{"icao":"ELIT","code":"LL2J","manufacturer":"EPIC","model":"Elite"},{"icao":"ELPS","code":"LL1P","manufacturer":"EXPLORER AVIATION","model":"Ellipse"},{"icao":"ELSP","code":"LL1P","manufacturer":"A2 CZ","model":"Ellipse Spirit"},{"icao":"ELST","code":"LL1P","manufacturer":"PUTZER","model":"Elster"},{"icao":"ELTO","code":"LH1P","manufacturer":"CONTINENTAL COPTERS","model":"El Tomcat"},{"icao":"ELTR","code":"LL1P","manufacturer":"ELITAR","model":"IE100 Elitar"},{"icao":"EM10","code":"LL1J","manufacturer":"MARGANSKI","model":"EM-10 Bielik"},{"icao":"EM11","code":"LL2P","manufacturer":"MARGANSKI","model":"EM-11 Orka"},{"icao":"EN28","code":"LH1P","manufacturer":"ENSTROM","model":"F28, 280, Shark, Falcon, Sentinel"},{"icao":"EN48","code":"LH1T","manufacturer":"ENSTROM","model":"480, TH28"},{"icao":"EP9","code":"LL1P","manufacturer":"EDGAR PERCIVAL","model":"EP9"},{"icao":"EPER","code":"LL1P","manufacturer":"EPERVIER","model":"Epervier"},{"icao":"EPIC","code":"LL1T","manufacturer":"EPIC","model":"Dynasty / LT / E-1000"},{"icao":"EPX1","code":"LL1P","manufacturer":"EPERVIER","model":"X-1"},{"icao":"ERAC","code":"LL1P","manufacturer":"DICKEY","model":"ERacer"},{"icao":"ERCO","code":"LL1P","manufacturer":"AIR PRODUCTS","model":"F1 Aircoupe"},{"icao":"ES11","code":"LH1T","manufacturer":"AVIOTECNICA","model":"ES-101 Exec, Raven"},{"icao":"ES13","code":"LL1P","manufacturer":"EARLY BIRD","model":"Spad 13 80%"},{"icao":"ESCA","code":"LL1T","manufacturer":"EPIC","model":"Escape"},{"icao":"ESCP","code":"LL1P","manufacturer":"JUST","model":"Escapade"},{"icao":"ESQL","code":"LL1P","manufacturer":"MOURA","model":"Esqualo"},{"icao":"ETA","code":"LL1P","manufacturer":"BINDER","model":"Eta"},{"icao":"ETAR","code":"ML1J","manufacturer":"DASSAULT","model":"Etendard 4"},{"icao":"EUFI","code":"ML2J","manufacturer":"ALENIA","model":"Eurofighter 2000, Typhoon"},{"icao":"EUPA","code":"LL1P","manufacturer":"EUROPA AVIATION","model":"Europa"},{"icao":"EURT","code":"LL1P","manufacturer":"FFT","model":"Eurotrainer 2000"},{"icao":"EV55","code":"LL2P","manufacturer":"EVEKTOR","model":"EV-55 Outback"},{"icao":"EV97","code":"LL1P","manufacturer":"EVEKTOR","model":"EV-97 EuroStar, Harmony"},{"icao":"EVAN","code":"LL2P","manufacturer":"EVANGEL","model":"4500 Evangel"},{"icao":"EVIC","code":"LL1J","manufacturer":"EPIC AIRCRAFT","model":"Epic Victory"},{"icao":"EVOP","code":"LL1P","manufacturer":"LANCAIR","model":"Evolution Piston"},{"icao":"EVOT","code":"LL1T","manufacturer":"LANCAIR","model":"Evolution Turbine"},{"icao":"EVSS","code":"LL1P","manufacturer":"EVEKTOR","model":"SportStar"},{"icao":"EX3R","code":"ML1P","manufacturer":"AEA","model":"Explorer 350R"},{"icao":"EX5T","code":"LL1T","manufacturer":"EXPLORER AIRCRAFT","model":"Explorer 500T"},{"icao":"EXEC","code":"LH1P","manufacturer":"ROTORWAY","model":"Exec"},{"icao":"EXEJ","code":"LH1T","manufacturer":"ROTORWAY","model":"JetExec"},{"icao":"EXNG","code":"LL1P","manufacturer":"EXTRA","model":"NG"},{"icao":"EXPL","code":"LH2T","manufacturer":"BOEING","model":"MD902 Explorer, Combat Explorer"},{"icao":"EXPR","code":"LL1P","manufacturer":"EXPRESS","model":"90, Express, Express 2000, Express 2000RG, Loadmaster"},{"icao":"EZFL","code":"LL1P","manufacturer":"AEROCOMP","model":"EZ Flyer"},{"icao":"EZFT","code":"LL2P","manufacturer":"BLUE YONDER","model":"Twin EZ Flyer"},{"icao":"EZHV","code":"LL1P","manufacturer":"BLUE YONDER","model":"E-Z Harvard"},{"icao":"EZIK","code":"LL1P","manufacturer":"ISTRA","model":"Ezhik"},{"icao":"EZKC","code":"LL1P","manufacturer":"BLUE YONDER","model":"EZ King Cobra"},{"icao":"F1","code":"ML2J","manufacturer":"MITSUBISHI","model":"F1"},{"icao":"F100","code":"ML2J","manufacturer":"FOKKER","model":"100"},{"icao":"F104","code":"ML1J","manufacturer":"AERITALIA","model":"F104 Starfighter"},{"icao":"F106","code":"ML1J","manufacturer":"CONVAIR","model":"QF106 Delta Dart"},{"icao":"F111","code":"ML2J","manufacturer":"GENERAL DYNAMICS","model":"F111, EF111, RF111 Aardvark, Raven"},{"icao":"F117","code":"ML2J","manufacturer":"LOCKHEED","model":"F117 Nighthawk"},{"icao":"F13","code":"LL1P","manufacturer":"JUNKERS","model":"F-13 Replica"},{"icao":"F14","code":"ML2J","manufacturer":"GRUMMAN","model":"F14 Tomcat"},{"icao":"F15","code":"ML2J","manufacturer":"BOEING","model":"F15 Eagle, Ra?am"},{"icao":"F156","code":"LL1P","manufacturer":"FIESELER","model":"Fi156 Storch"},{"icao":"F16","code":"ML1J","manufacturer":"FOKKER","model":"F16 Fighting Falcon"},{"icao":"F16X","code":"ML1J","manufacturer":"GENERAL DYNAMICS","model":"F16XL Fighting Falcon"},{"icao":"F18","code":"ML2J","manufacturer":"BOEING","model":"F18, ATF18 Hornet"},{"icao":"F18H","code":"ML2J","manufacturer":"BOEING","model":"HORNET"},{"icao":"F18S","code":"ML2J","manufacturer":"BOEING","model":"SUPER HORNET"},{"icao":"F1FV","code":"LL1P","manufacturer":"AVION","model":"F-1 Favorit"},{"icao":"F2","code":"ML1J","manufacturer":"MITSUBISHI","model":"F2"},{"icao":"F22","code":"ML2J","manufacturer":"BOEING","model":"F22 Raptor"},{"icao":"F260","code":"LL1P","manufacturer":"AERMACCHI","model":"SF260E/F, Warrior"},{"icao":"F26T","code":"LL1T","manufacturer":"AERMACCHI","model":"SF260TP"},{"icao":"F27","code":"ML2T","manufacturer":"CONAIR","model":"F27 Firefighter"},{"icao":"F28","code":"ML2J","manufacturer":"FOKKER","model":"F28 Fellowship"},{"icao":"F2TH","code":"ML2J","manufacturer":"DASSAULT","model":"Falcon 2000"},{"icao":"F30","code":"LL1P","manufacturer":"GOLDEN CAR","model":"F-30 Brio"},{"icao":"F35","code":"ML1J","manufacturer":"LOCKHEED MARTIN","model":"F-35A/C"},{"icao":"F3F","code":"LL1P","manufacturer":"GRUMMAN","model":"F3F (G11/32), Replica"},{"icao":"F4","code":"ML2J","manufacturer":"IAI","model":"F4 Kurnass"},{"icao":"F402","code":"LL1T","manufacturer":"FALCON AIR","model":"Falcon 402"},{"icao":"F406","code":"LL2T","manufacturer":"CESSNA","model":"F406 Caravan 2, Vigilant"},{"icao":"F41E","code":"LL2P","manufacturer":"AEROSAMARA","model":"F-41 El\'brus"},{"icao":"F421","code":"LL1T","manufacturer":"FALCON AIR","model":"Falcon 421"},{"icao":"F5","code":"ML2J","manufacturer":"AIDC","model":"F5 ChungCheng"},{"icao":"F50","code":"ML2T","manufacturer":"FOKKER","model":"50, Maritime Enforcer"},{"icao":"F5SA","code":"ML2J","manufacturer":"IRIAF","model":"S-100 Saeghe"},{"icao":"F60","code":"ML2T","manufacturer":"FOKKER","model":"60"},{"icao":"F600","code":"LL2T","manufacturer":"GENERAL AVIA","model":"F600"},{"icao":"F70","code":"ML2J","manufacturer":"FOKKER","model":"70"},{"icao":"F8","code":"ML1J","manufacturer":"CHANCE VOUGHT","model":"F8, RF8, F8U Crusader"},{"icao":"F86","code":"ML1J","manufacturer":"CANADAIR","model":"CL13 Sabre"},{"icao":"F8L","code":"LL1P","manufacturer":"AEROMERE","model":"F8L Falco"},{"icao":"F900","code":"ML3J","manufacturer":"DASSAULT","model":"Falcon 900, Myst\ufffdre 900"},{"icao":"F9F","code":"ML1J","manufacturer":"GRUMMAN","model":"F9F Panther (G79)"},{"icao":"FA01","code":"LL1P","manufacturer":"FL\ufffdMING AIR","model":"FA-01 Saphir, Smaragd"},{"icao":"FA02","code":"LL1P","manufacturer":"FL\ufffdMING AIR","model":"FA-02 Smaragd VLA"},{"icao":"FA03","code":"LL1P","manufacturer":"FL\ufffdMING AIR","model":"FA-03 Smaragd TMG"},{"icao":"FA04","code":"LL1P","manufacturer":"FL\ufffdMING AIR","model":"FA-04 Peregrine"},{"icao":"FA10","code":"ML2J","manufacturer":"DASSAULT","model":"Falcon 10, Myst\ufffdre 10"},{"icao":"FA11","code":"LL1P","manufacturer":"FAIRCHILD, CANADA","model":"F11 Husky"},{"icao":"FA20","code":"ML2J","manufacturer":"DASSAULT","model":"Falcon 20, Myst\ufffdre 20 (T11, TM11)"},{"icao":"FA24","code":"LL1P","manufacturer":"FAIRCHILD, US","model":"F24 (UC61, JK, Forwarder, Argus)"},{"icao":"FA50","code":"ML3J","manufacturer":"DASSAULT","model":"Falcon 50, Myst\ufffdre 50"},{"icao":"FA5X","code":"ML2J","manufacturer":"DASSAULT","model":"Falcon 5X"},{"icao":"FA62","code":"LL1P","manufacturer":"FAIRCHILD, US","model":"M62 (PT19/23/26, T19 Cornell)"},{"icao":"FA6X","code":"ML2J","manufacturer":"DASSAULT","model":"Falcon 6X"},{"icao":"FA7X","code":"ML3J","manufacturer":"DASSAULT","model":"Falcon 7X"},{"icao":"FA8X","code":"ML3J","manufacturer":"DASSAULT","model":"Falcon 8X"},{"icao":"FAET","code":"LL1P","manufacturer":"ATEC","model":"321 Faeta"},{"icao":"FALC","code":"LL1P","manufacturer":"AMERICAN AIRCRAFT","model":"Falcon XP"},{"icao":"FALM","code":"LL1P","manufacturer":"MILES","model":"M3 Falcon Major"},{"icao":"FANL","code":"LL1P","manufacturer":"RHEIN","model":"FL1 Fanliner"},{"icao":"FANT","code":"LL1P","manufacturer":"RHEIN","model":"Fantrainer"},{"icao":"FB1A","code":"LL1P","manufacturer":"BOWERS","model":"Fly Baby 1A"},{"icao":"FB1B","code":"LL1P","manufacturer":"BOWERS","model":"Fly Baby 1B"},{"icao":"FB5","code":"LL1P","manufacturer":"EURO-FLY","model":"FB-5 Star Light"},{"icao":"FBA2","code":"LL1P","manufacturer":"FOUND","model":"FBA2, Bush Hawk"},{"icao":"FBIR","code":"LL1P","manufacturer":"FREEWING","model":"Freebird"},{"icao":"FC1","code":"ML1J","manufacturer":"CHENGDU","model":"FC-1 Super 7, Xiaolong, JF-17 Thunder"},{"icao":"FD2E","code":"LL1E","manufacturer":"FLIGHT DESIGN","model":"F-2e"},{"icao":"FDCT","code":"LL1P","manufacturer":"FLIGHT DESIGN","model":"CT"},{"icao":"FDF2","code":"LL1P","manufacturer":"FLIGHT DESIGN","model":"F-2"},{"icao":"FDMC","code":"LL1P","manufacturer":"FLIGHT DESIGN","model":"MC"},{"icao":"FE51","code":"LL1P","manufacturer":"FIGHTER ESCORT WINGS","model":"P51"},{"icao":"FEST","code":"LL1P","manufacturer":"AEROSTAR","model":"R40S Festival"},{"icao":"FF82","code":"ML2T","manufacturer":"AMERICAN UTILICRAFT","model":"FF1080200 Freight Feeder"},{"icao":"FFLY","code":"LL1P","manufacturer":"FAIREY","model":"Firefly"},{"icao":"FG01","code":"LL1P","manufacturer":"FARIGOUX","model":"FG01 Origan"},{"icao":"FGT","code":"LL1P","manufacturer":"MIDWEST AEROSPORT","model":"Formula GT"},{"icao":"FH11","code":"LH1T","manufacturer":"FAIRCHILD HILLER","model":"FH1100"},{"icao":"FIBO","code":"LL1P","manufacturer":"STARFIRE","model":"Firebolt Convertible"},{"icao":"FIKD","code":"LL1P","manufacturer":"FIKE","model":"D"},{"icao":"FIKE","code":"LL1P","manufacturer":"FIKE","model":"E"},{"icao":"FINC","code":"LL1P","manufacturer":"FLEET","model":"10, 11, 16 (Finch)"},{"icao":"FJ10","code":"LL2J","manufacturer":"AEROSTAR AIRCRAFT","model":"FJ100"},{"icao":"FJR3","code":"LL1P","manufacturer":"FAJR","model":"F-3"},{"icao":"FK12","code":"LL1P","manufacturer":"B & F TECHNIK","model":"FK-12 Comet"},{"icao":"FK14","code":"LL1P","manufacturer":"B & F TECHNIK","model":"FK-14 Polaris"},{"icao":"FK9","code":"LL1P","manufacturer":"B & F TECHNIK","model":"FK-9"},{"icao":"FL3","code":"LL1P","manufacturer":"AVIA, ITALY","model":"L3 Aviastarlet"},{"icao":"FL53","code":"LL1P","manufacturer":"METEOR","model":"FL53"},{"icao":"FL54","code":"LL1P","manufacturer":"METEOR","model":"FL54"},{"icao":"FL55","code":"LL1P","manufacturer":"METEOR","model":"FL55"},{"icao":"FLAM","code":"LL2P","manufacturer":"DASSAULT","model":"MD311/312 Flamant"},{"icao":"FLCO","code":"LL1P","manufacturer":"LEONARDO","model":"Falco"},{"icao":"FLE2","code":"LL1P","manufacturer":"FLEET","model":"2"},{"icao":"FLE7","code":"LL1P","manufacturer":"FLEET","model":"7 (Fawn)"},{"icao":"FLIZ","code":"LL1P","manufacturer":"FLITZER","model":"Z-1/Z-21 Flitzer"},{"icao":"FLSH","code":"LL1P","manufacturer":"EURO-FLY","model":"Flash"},{"icao":"FLSS","code":"LL1P","manufacturer":"FLYER","model":"Flyer NG, SS"},{"icao":"FM25","code":"LL1P","manufacturer":"FLYING MACHINES","model":"FM-250 Vampire"},{"icao":"FMGO","code":"LL1P","manufacturer":"AAK","model":"Flamingo"},{"icao":"FN33","code":"LA1P","manufacturer":"NARDI","model":"FN333 Riviera"},{"icao":"FNKB","code":"LL1P","manufacturer":"AKRON","model":"Funk B"},{"icao":"FOOF","code":"LL1P","manufacturer":"STEWART, DONALD, US","model":"JD2 Foo Fighter"},{"icao":"FORT","code":"LL1P","manufacturer":"FLEET","model":"60 Fort"},{"icao":"FOUG","code":"LL2J","manufacturer":"AEROSPATIALE","model":"CM170R Magister"},{"icao":"FOX","code":"LL1P","manufacturer":"DENNEY","model":"Kitfox"},{"icao":"FOXT","code":"LL1P","manufacturer":"TEAM TANGO","model":"Foxtrot4"},{"icao":"FRBD","code":"LL1P","manufacturer":"NORTHROP GRUMMAN","model":"H-03, R-03 Firebird"},{"icao":"FREE","code":"LL1P","manufacturer":"CABRINHA","model":"RC412 Free Spirit"},{"icao":"FREL","code":"MH3T","manufacturer":"AEROSPATIALE","model":"SA321 Super Frelon"},{"icao":"FRNT","code":"LL1P","manufacturer":"SKY RAIDER","model":"Frontier"},{"icao":"FRON","code":"LL1P","manufacturer":"FRONTIER","model":"Frontier MD2"},{"icao":"FS51","code":"LL1P","manufacturer":"FALCONAR","model":"SAL P-51D Mustang"},{"icao":"FT30","code":"LL1P","manufacturer":"NAI","model":"FT300"},{"icao":"FU24","code":"LL1P","manufacturer":"AIR PARTS","model":"Fletcher FU24"},{"icao":"FURY","code":"LL1P","manufacturer":"HAWKER","model":"Fury, Sea Fury"},{"icao":"FUSI","code":"LL1P","manufacturer":"MAGNUS","model":"MG-11 Fusion"},{"icao":"FW02","code":"LA1P","manufacturer":"FLYWHALE","model":"FW-02 Flywhale"},{"icao":"FW19","code":"LL1P","manufacturer":"FOUR WINDS","model":"192"},{"icao":"FW21","code":"LL1P","manufacturer":"FOUR WINDS","model":"FX-210"},{"icao":"FW44","code":"LL1P","manufacturer":"FMA","model":"Fw44 Stieglitz"},{"icao":"FW90","code":"LL1P","manufacturer":"FLUG WERK","model":"Fw190, Replica"},{"icao":"FWSB","code":"LA1P","manufacturer":"FLEETWINGS","model":"F-4 Sea Bird"},{"icao":"FX1","code":"LL1P","manufacturer":"INNOVAVIATION","model":"FX-1"},{"icao":"G1","code":"LL1P","manufacturer":"G1 AVIATION","model":"G-1 G\ufffdlinotte, Go\ufffdland, Grive, Spyl"},{"icao":"G103","code":"LL1P","manufacturer":"GROB","model":"G103C Twin 3SL"},{"icao":"G109","code":"LL1P","manufacturer":"GROB","model":"G109, Ranger (Vigilant)"},{"icao":"G115","code":"LL1P","manufacturer":"GROB","model":"G115A/B/C/D/E, Bavarian (Heron), Tutor"},{"icao":"G120","code":"LL1P","manufacturer":"GROB","model":"G120"},{"icao":"G12T","code":"LL1T","manufacturer":"GROB","model":"G-120TP"},{"icao":"G140","code":"LL1T","manufacturer":"GROB","model":"G-140TP"},{"icao":"G150","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"Gulfstream G150"},{"icao":"G159","code":"ML2T","manufacturer":"GRUMMAN","model":"G159 Gulfstream 1 (TC4 Academe, VC4)"},{"icao":"G15T","code":"LL1P","manufacturer":"GROB","model":"G115T Acro"},{"icao":"G160","code":"LL1T","manufacturer":"GROB","model":"G-160 Ranger"},{"icao":"G164","code":"LL1P","manufacturer":"AERO MOD","model":"G164 Super Ag Max"},{"icao":"G180","code":"LL1P","manufacturer":"GENERAL AIRCRAFT","model":"G180 Skyfarer"},{"icao":"G200","code":"LL1P","manufacturer":"AKROTECH","model":"G200"},{"icao":"G202","code":"LL1P","manufacturer":"AKROTECH","model":"G202"},{"icao":"G21","code":"LA2P","manufacturer":"GRUMMAN","model":"G21A/38/39 Goose (JRF)"},{"icao":"G21M","code":"LA4P","manufacturer":"MCKINNON","model":"G21C/D Goose"},{"icao":"G21T","code":"LA2T","manufacturer":"MCKINNON","model":"G21E/G Turbo Goose"},{"icao":"G222","code":"ML2T","manufacturer":"AERITALIA","model":"G222"},{"icao":"G250","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"Gulfstream G250"},{"icao":"G280","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"Gulfstream G280"},{"icao":"G2CA","code":"LH1P","manufacturer":"GUIMBAL","model":"G-2 Cabri"},{"icao":"G2GL","code":"LL1J","manufacturer":"SOKO","model":"G2 Galeb (N60)"},{"icao":"G2T1","code":"LL1P","manufacturer":"WACO CLASSIC","model":"2T1 Sport Trainer, Sport"},{"icao":"G3","code":"LL1P","manufacturer":"REMOS","model":"G-3 Mirage"},{"icao":"G300","code":"LL1P","manufacturer":"AKROTECH","model":"G300"},{"icao":"G44","code":"LA2P","manufacturer":"GANNET","model":"G44 Super Widgeon"},{"icao":"G46","code":"LL1P","manufacturer":"FIAT","model":"G46"},{"icao":"G4SG","code":"LL1J","manufacturer":"SOKO","model":"G4 Super Galeb (N62)"},{"icao":"G59","code":"LL1P","manufacturer":"FIAT","model":"G59"},{"icao":"G64T","code":"LL1T","manufacturer":"AG\ufffdCAT","model":"G164 Super Turbine"},{"icao":"G70","code":"LL1P","manufacturer":"GROPPO","model":"G-70"},{"icao":"G73","code":"LA2P","manufacturer":"GRUMMAN","model":"G73 Mallard"},{"icao":"G73T","code":"LA2T","manufacturer":"FRAKES","model":"G73T Turbo Mallard"},{"icao":"G800","code":"LL1P","manufacturer":"AERODIS","model":"G802 Orion"},{"icao":"G850","code":"ML2P","manufacturer":"GROB","model":"G850 Strato 2C"},{"icao":"G96","code":"ML2P","manufacturer":"GRUMMAN","model":"C1, TF Trader (G96)"},{"icao":"G97","code":"LL1P","manufacturer":"SAI","model":"G-97 Spotter"},{"icao":"GA10","code":"LL1T","manufacturer":"GIPPSAERO","model":"GA-10"},{"icao":"GA20","code":"LL1P","manufacturer":"GIPPSLAND","model":"GA200 Fatman"},{"icao":"GA5C","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G-7 Gulfstream G500"},{"icao":"GA6C","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G-7 Gulfstream G600"},{"icao":"GA7","code":"LL2P","manufacturer":"GRUMMAN AMERICAN","model":"GA7 Cougar"},{"icao":"GA7C","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"Gulfstream G700"},{"icao":"GA8","code":"LL1P","manufacturer":"GIPPSLAND","model":"GA8 Airvan"},{"icao":"GA8C","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G-8 Gulfstream G800"},{"icao":"GABR","code":"LL1P","manufacturer":"BLACKSHAPE","model":"Bk-160 Gabriel, BS-115 Gabriel"},{"icao":"GALX","code":"ML2J","manufacturer":"IAI","model":"1126 Galaxy, Gulfstream 200"},{"icao":"GANT","code":"MLCT","manufacturer":"FAIREY","model":"Gannet"},{"icao":"GAUN","code":"LL1P","manufacturer":"GLOSTER","model":"Gauntlet"},{"icao":"GAVI","code":"LL1P","manufacturer":"AERO MERCANTIL","model":"358 Gavilan"},{"icao":"GAZL","code":"LH1T","manufacturer":"ABHCO","model":"SA342 Gazelle"},{"icao":"GB1","code":"LL1P","manufacturer":"GAME COMPOSITES","model":"GB-1 GameBird"},{"icao":"GBSP","code":"LL1P","manufacturer":"BEETS","model":"GB Special"},{"icao":"GC1","code":"LL1P","manufacturer":"GLOBE","model":"GC1 Swift"},{"icao":"GDUK","code":"LA2P","manufacturer":"ELLISON-MAHON","model":"Gweduck"},{"icao":"GEMI","code":"LL2P","manufacturer":"MILES","model":"M65 Gemini"},{"icao":"GENI","code":"LL1E","manufacturer":"IFB","model":"E-Genius"},{"icao":"GEPE","code":"LL1P","manufacturer":"AERO SERVICES","model":"Gu\ufffdpe"},{"icao":"GF20","code":"LL1P","manufacturer":"GROB","model":"GF200"},{"icao":"GFLY","code":"ML1J","manufacturer":"SCALED","model":"311 Global Flyer"},{"icao":"GL5T","code":"ML2J","manufacturer":"BOMBARDIER","model":"BD700 Global 5000"},{"icao":"GL7T","code":"ML2J","manufacturer":"BOMBARDIER","model":"Global 7000/7500"},{"icao":"GLAD","code":"LL1P","manufacturer":"GLOSTER","model":"Gladiator"},{"icao":"GLAS","code":"LL1P","manufacturer":"STODDARD\ufffdHAMILTON","model":"Glasair"},{"icao":"GLEX","code":"ML2J","manufacturer":"BOMBARDIER","model":"BD700 Global Express"},{"icao":"GLF2","code":"ML2J","manufacturer":"GRUMMAN","model":"G1159, G1159B Gulfstream 2/2B/2SP (C20J, VC11)"},{"icao":"GLF3","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G1159A Gulfstream 3/SRA1 (C20A/B/C/D/E)"},{"icao":"GLF4","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G1159C Gulfstream 4/4SP/SRA4 (C20F/G/H, S102, Tp102, U4)"},{"icao":"GLF5","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"G1159D Gulfstream 5 (C37)"},{"icao":"GLF6","code":"ML2J","manufacturer":"GULFSTREAM AEROSPACE","model":"Gulfstream G650"},{"icao":"GLID","code":"----","manufacturer":"-","model":"Glider/Sailplane"},{"icao":"GLSP","code":"LL1P","manufacturer":"NEW GLASTAR","model":"Sportsman 2+2"},{"icao":"GLST","code":"LL1P","manufacturer":"STODDARD\ufffdHAMILTON","model":"SH4 GlaStar"},{"icao":"GLTU","code":"LL1T","manufacturer":"STODDARD\ufffdHAMILTON","model":"Turbine Glasair"},{"icao":"GM01","code":"LL1P","manufacturer":"YALO","model":"GM01 Gniady"},{"icao":"GM17","code":"LL1T","manufacturer":"INTRACOM","model":"GM-17 Viper"},{"icao":"GMGC","code":"LL1P","manufacturer":"IBIS","model":"Grand Magic"},{"icao":"GNAT","code":"LL1J","manufacturer":"FOLLAND","model":"Fo144 Gnat"},{"icao":"GOBU","code":"LG1P","manufacturer":"BUTTERFLY","model":"Golden Butterfly"},{"icao":"GOLF","code":"LL1P","manufacturer":"TECNAM","model":"P96 GOLF"},{"icao":"GOOS","code":"LA1P","manufacturer":"QUIKKIT","model":"Glass Goose"},{"icao":"GOTR","code":"LL1P","manufacturer":"GLOSTER","model":"Trainer"},{"icao":"GP1","code":"LL1P","manufacturer":"JIHLAVAN","model":"Skyleader GP One"},{"icao":"GP3","code":"LA1P","manufacturer":"OSPREY","model":"GP3 Osprey 2"},{"icao":"GP4","code":"LL1P","manufacturer":"OSPREY","model":"GP4"},{"icao":"GPRO","code":"LL1P","manufacturer":"GENEVATION","model":"GenPro"},{"icao":"GR51","code":"LL1T","manufacturer":"EXCLUSIVE","model":"Grand 51"},{"icao":"GRAF","code":"LL1P","manufacturer":"LUNDY","model":"Graflite"},{"icao":"GRFN","code":"LL1P","manufacturer":"GRIFFON AERO","model":"Griffon"},{"icao":"GRIF","code":"LL1P","manufacturer":"CANADA AIR","model":"RV Griffin"},{"icao":"GRIZ","code":"LL1T","manufacturer":"AEROTEK","model":"Turbo Grizzly"},{"icao":"GSIS","code":"LL1P","manufacturer":"INNOVATION","model":"Genesis, Genesis Revelation"},{"icao":"GSPN","code":"LL2J","manufacturer":"GROB","model":"G-180 SPn Utility Jet"},{"icao":"GUEP","code":"LL1P","manufacturer":"AERO SERVICES","model":"Guepard, Guepy, Super Guepard"},{"icao":"GURI","code":"LL1P","manufacturer":"AEROMOT","model":"AMT600 Guri"},{"icao":"GX","code":"LL1P","manufacturer":"REMOS","model":"GX"},{"icao":"GY10","code":"LL1P","manufacturer":"GARDAN","model":"GY100 Bagheera"},{"icao":"GY20","code":"LL1P","manufacturer":"CAB","model":"GY20 Minicab"},{"icao":"GY30","code":"LL1P","manufacturer":"CAB","model":"GY30 Supercab"},{"icao":"GY80","code":"LL1P","manufacturer":"GARDAN","model":"GY80 Horizon"},{"icao":"GYRO","code":"----","manufacturer":"-","model":"Micro-/Ultralight autogyro"},{"icao":"H111","code":"ML2P","manufacturer":"CASA","model":"2111"},{"icao":"H12T","code":"LH1T","manufacturer":"HILLER","model":"UH12ET/E3T/E4T"},{"icao":"H160","code":"LH2T","manufacturer":"AIRBUS HELICOPTERS","model":"H-160"},{"icao":"H2","code":"LH2T","manufacturer":"KAMAN","model":"SH2 Seasprite, Super Seasprite (K20, K894)"},{"icao":"H202","code":"LL1P","manufacturer":"HB\ufffdAIRCRAFT","model":"HB202 Fledger"},{"icao":"H204","code":"LL1P","manufacturer":"HB-FLUGTECHNIK","model":"HB-204 Tornado"},{"icao":"H207","code":"LL1P","manufacturer":"HB\ufffdFLUGTECHNIK","model":"HB207 Alfa"},{"icao":"H21","code":"LH1P","manufacturer":"VERTOL","model":"H21, CH21 Shawnee, Work Horse (42, 43, 44)"},{"icao":"H25A","code":"ML2J","manufacturer":"DE HAVILLAND","model":"DH125, HS-125-1, HS-125-2 Dominie, HS-125-3, HS-125-400, HS-125-600"},{"icao":"H25B","code":"ML2J","manufacturer":"BRITISH AEROSPACE","model":"BAe 125-700/800 (C29, U125)"},{"icao":"H25C","code":"ML2J","manufacturer":"BRITISH AEROSPACE","model":"BAe 125-1000"},{"icao":"H269","code":"LH1P","manufacturer":"BREDANARDI","model":"NH300"},{"icao":"H40","code":"LL1P","manufacturer":"HOFFMAN","model":"H40"},{"icao":"H43A","code":"LH1P","manufacturer":"KAMAN","model":"H43A, HH43A, UH43, OH43, HUK, HOK (K600)"},{"icao":"H43B","code":"LH1T","manufacturer":"KAMAN","model":"HH43B/F Huskie (K6003/5)"},{"icao":"H46","code":"MH2T","manufacturer":"BOEING VERTOL","model":"CH46, HH46, UH46, Hkp4, CH113, Sea Knight, Labrador, Voyageur (107)"},{"icao":"H47","code":"MH2T","manufacturer":"BOEING","model":"CH47, MH47 Chinook"},{"icao":"H500","code":"LH1T","manufacturer":"AGUSTA","model":"NH500"},{"icao":"H53","code":"MH2T","manufacturer":"SIKORSKY","model":"S65 (CH53A/C/D/G, HH53, MH53H/J, RH53, TH53, VH53, Sea Stallion, Yasur)"},{"icao":"H53S","code":"MH3T","manufacturer":"SIKORSKY","model":"S80 (CH53E, MH53E Super Stallion, Sea Dragon)"},{"icao":"H60","code":"MH2T","manufacturer":"ASTA","model":"S70 Seahawk"},{"icao":"H64","code":"MH2T","manufacturer":"BOEING","model":"AH64 Longbow Apache"},{"icao":"H66","code":"LH2T","manufacturer":"BOEING","model":"RAH66 Comanche"},{"icao":"HA2","code":"LG1P","manufacturer":"HOLLMANN","model":"HA2 Sportster"},{"icao":"HA31","code":"LL1P","manufacturer":"HINDUSTAN","model":"HA31 Basant"},{"icao":"HA4T","code":"ML2J","manufacturer":"HAWKER BEECHCRAFT CORP","model":"Hawker 4000"},{"icao":"HAHU","code":"LL1P","manufacturer":"SINDLINGER","model":"HH1 Hawker Hurricane"},{"icao":"HAR","code":"ML1J","manufacturer":"ALENIA","model":"AV8 Harrier"},{"icao":"HAW3","code":"LG1P","manufacturer":"GROEN","model":"H2X Hawk 3"},{"icao":"HAWK","code":"ML1J","manufacturer":"BOEING","model":"T45 Goshawk"},{"icao":"HB21","code":"LL1P","manufacturer":"BRDITSCHKA","model":"HB21 Hobbyliner, Hobbylifter"},{"icao":"HB23","code":"LL1P","manufacturer":"BRDITSCHKA","model":"HB23 Hobbyliner, Scanliner"},{"icao":"HB3","code":"LL1P","manufacturer":"BRDITSCHKA","model":"HB3"},{"icao":"HCAT","code":"LL1P","manufacturer":"GRUMMAN","model":"F6F Hellcat (G50)"},{"icao":"HD34","code":"ML2P","manufacturer":"HUREL\ufffdDUBOIS","model":"HD34"},{"icao":"HDJT","code":"LL2J","manufacturer":"HONDA","model":"HA-420 HondaJet"},{"icao":"HEAD","code":"LL1P","manufacturer":"STEWART, DONALD, US","model":"JD1, SAC1 Headwind"},{"icao":"HERN","code":"LL4P","manufacturer":"DE HAVILLAND","model":"DH114 Heron"},{"icao":"HF20","code":"ML2J","manufacturer":"HFB","model":"HFB320 Hansa"},{"icao":"HI27","code":"LL1P","manufacturer":"HIRTH","model":"Hi27 Acrostar"},{"icao":"HIGH","code":"LL1P","manufacturer":"JUST","model":"Highlander"},{"icao":"HIND","code":"LL1P","manufacturer":"HAWKER","model":"Hind"},{"icao":"HL2","code":"LL1P","manufacturer":"LAMBACH","model":"HL-2 Replica"},{"icao":"HLD4","code":"LL1P","manufacturer":"HALBERSTADT","model":"D4, Replica"},{"icao":"HM38","code":"LL1P","manufacturer":"FALCONAR","model":"HM380"},{"icao":"HMNY","code":"ML1P","manufacturer":"EVEKTOR\ufffdAEROTECHNIK","model":"EV97VLA Harmony"},{"icao":"HN70","code":"LL1P","manufacturer":"NICOLLIER","model":"HN700 Menestrel 2"},{"icao":"HORN","code":"LL1P","manufacturer":"WALLERKOWSKI","model":"Hornisse"},{"icao":"HORZ","code":"LL1P","manufacturer":"FISHER","model":"Horizon"},{"icao":"HPR7","code":"ML2T","manufacturer":"HANDLEY PAGE","model":"HPR7 Herald"},{"icao":"HPTR","code":"LA1P","manufacturer":"IDEA","model":"Hydropteron"},{"icao":"HPZL","code":"LL1P","manufacturer":"HISTORICAL AIRCRAFT","model":"PZL P11C"},{"icao":"HR10","code":"LL1P","manufacturer":"ROBIN","model":"HR100 Royal, Safari, Tiara, President"},{"icao":"HR20","code":"LL1P","manufacturer":"ROBIN","model":"HR200, R200, Acrobin"},{"icao":"HRM9","code":"LL1P","manufacturer":"ELBIT","model":"Hermes 900, Kochav"},{"icao":"HRNT","code":"LL1P","manufacturer":"AAK","model":"Hornet"},{"icao":"HROC","code":"LL1P","manufacturer":"HARMON, JAMES B","model":"Rocket"},{"icao":"HRON","code":"LL1P","manufacturer":"IAI","model":"Heron, Harfang"},{"icao":"HRYA","code":"LL1P","manufacturer":"HISTORICAL AIRCRAFT","model":"Ryan Trainer"},{"icao":"HSMT","code":"LH1P","manufacturer":"ROTORSMART","model":"HeliSmart"},{"icao":"HT16","code":"LL1J","manufacturer":"HINDUSTAN","model":"HJT16 Kiran"},{"icao":"HT2","code":"LL1P","manufacturer":"HINDUSTAN","model":"HT2"},{"icao":"HT32","code":"LL1P","manufacturer":"HINDUSTAN","model":"HPT32 Deepak"},{"icao":"HT34","code":"LL1T","manufacturer":"HINDUSTAN","model":"HTT34"},{"icao":"HT36","code":"LL1J","manufacturer":"HINDUSTAN","model":"HJT-36 Sitara"},{"icao":"HT40","code":"LL1T","manufacturer":"HINDUSTAN","model":"HTT-40"},{"icao":"HU1","code":"LL1P","manufacturer":"SHENYANG SAILPLANE","model":"HU1 Seagull"},{"icao":"HU2","code":"LL1P","manufacturer":"SHENYANG SAILPLANE","model":"HU2 Petrel"},{"icao":"HUCO","code":"LH1T","manufacturer":"BELL","model":"AH1E/F/P/S, TAH1, TH1S, HA14 HueyCobra (209)"},{"icao":"HUML","code":"LL1P","manufacturer":"HUMMEL","model":"Hummel Bird"},{"icao":"HUMM","code":"LL1P","manufacturer":"AEROTEK, SOUTH AFRICA","model":"Hummingbird"},{"icao":"HUNT","code":"ML1J","manufacturer":"HAWKER","model":"Hunter"},{"icao":"HURI","code":"LL1P","manufacturer":"HAWKER","model":"Hurricane, Sea Hurricane"},{"icao":"HURK","code":"LL1T","manufacturer":"TAI","model":"H\ufffdrkus"},{"icao":"HUSK","code":"LL1P","manufacturer":"AVIAT","model":"A1 Husky"},{"icao":"HW4P","code":"LG1P","manufacturer":"GROEN","model":"Hawk 4 (piston)"},{"icao":"HW4T","code":"LG1T","manufacturer":"GROEN","model":"Hawk 4 (turbine)"},{"icao":"HX2","code":"LH1T","manufacturer":"HELOWERKS","model":"HX-2 Wasp"},{"icao":"HYPR","code":"LL1P","manufacturer":"P&M AVIATION","model":"HypR"},{"icao":"I103","code":"LL1P","manufacturer":"ILYUSHIN","model":"Il103"},{"icao":"I114","code":"ML2T","manufacturer":"ILYUSHIN","model":"Il114"},{"icao":"I115","code":"LL1P","manufacturer":"AISA","model":"I115"},{"icao":"I11B","code":"LL1P","manufacturer":"AISA","model":"I11B Peque"},{"icao":"I153","code":"LL1P","manufacturer":"POLIKARPOV","model":"I153"},{"icao":"I15B","code":"LL1P","manufacturer":"POLIKARPOV","model":"I-15bis"},{"icao":"I16","code":"LL1P","manufacturer":"POLIKARPOV","model":"I16"},{"icao":"I22","code":"ML1J","manufacturer":"INSTYTUT LOTNICTWA","model":"I22 Iryda"},{"icao":"I23","code":"LL1P","manufacturer":"INSTYTUT LOTNICTWA","model":"I23, Manager"},{"icao":"I3","code":"LL1P","manufacturer":"INTERAVIA","model":"I3"},{"icao":"I66","code":"LL1P","manufacturer":"IANNOTTA","model":"I66 San Francisco"},{"icao":"I828","code":"LL1T","manufacturer":"ICA","model":"IAR828"},{"icao":"IA46","code":"LL1P","manufacturer":"DINFIA","model":"IA46 Ranquel, Super Ranquel"},{"icao":"IA50","code":"ML2T","manufacturer":"DINFIA","model":"IA50 Guarani 2"},{"icao":"IA51","code":"LL1P","manufacturer":"DINFIA","model":"IA51 Tehuelche"},{"icao":"IA58","code":"LL2T","manufacturer":"FMA","model":"IA58 Pucar\ufffd"},{"icao":"IA63","code":"LL1J","manufacturer":"FMA","model":"IA63 Pampa"},{"icao":"IFUR","code":"LL1P","manufacturer":"ISAACS","model":"Fury"},{"icao":"IL14","code":"ML2P","manufacturer":"AVIA\ufffdZAVODY, CZECH","model":"Av14"},{"icao":"IL18","code":"ML4T","manufacturer":"ILYUSHIN","model":"Il18/20/22/24, Bizon, Zebra"},{"icao":"IL28","code":"ML2J","manufacturer":"HARBIN","model":"H5, HJ5, HZ5"},{"icao":"IL38","code":"ML4T","manufacturer":"ILYUSHIN","model":"Il38"},{"icao":"IL62","code":"HL4J","manufacturer":"ILYUSHIN","model":"Il62"},{"icao":"IL76","code":"HL4J","manufacturer":"ILYUSHIN","model":"Il76/78/82, Gajaraj"},{"icao":"IL86","code":"HL4J","manufacturer":"ILYUSHIN","model":"Il86/87"},{"icao":"IL96","code":"HL4J","manufacturer":"ILYUSHIN","model":"Il96"},{"icao":"IMPU","code":"LL1P","manufacturer":"IMPULSE","model":"Impulse, Xcite, Xturn"},{"icao":"INCQ","code":"LL1P","manufacturer":"INPAER","model":"Conquest"},{"icao":"INEC","code":"LL1P","manufacturer":"INPAER","model":"Excel"},{"icao":"INEX","code":"LL1P","manufacturer":"INPAER","model":"Explorer"},{"icao":"ION","code":"LL1P","manufacturer":"ION","model":"Ion"},{"icao":"IP06","code":"LL1P","manufacturer":"IPE","model":"IPE-06 Curucaca"},{"icao":"IP10","code":"LL1P","manufacturer":"IPE","model":"IPE-010"},{"icao":"IP26","code":"LL1P","manufacturer":"IPAI","model":"IPAI26 Tuca"},{"icao":"IP6A","code":"LL1P","manufacturer":"IPE","model":"IPE-06A"},{"icao":"IPAN","code":"LL1P","manufacturer":"EMBRAER","model":"EMB200/201/202 Ipanema (U19)"},{"icao":"IR21","code":"LL1P","manufacturer":"ICA","model":"IAR821"},{"icao":"IR22","code":"LL1P","manufacturer":"ICA","model":"IAR822/826"},{"icao":"IR23","code":"LL1P","manufacturer":"ICA","model":"IAR823"},{"icao":"IR24","code":"LL1P","manufacturer":"ICA","model":"IAR824"},{"icao":"IR25","code":"LL1T","manufacturer":"ICA","model":"IAR825TP Triumf"},{"icao":"IR27","code":"LL1P","manufacturer":"BUCURESTI","model":"IAR827, Dacic"},{"icao":"IR28","code":"LL1P","manufacturer":"ICA","model":"IS28MA, IAR28MA"},{"icao":"IR31","code":"LL1P","manufacturer":"ICA","model":"IAR831 Pelican"},{"icao":"IR46","code":"LL1P","manufacturer":"IAR","model":"IAR46"},{"icao":"IR99","code":"LL1J","manufacturer":"AVIOANE","model":"IAR99/109 Soim, Swift"},{"icao":"IS2","code":"LH1P","manufacturer":"INSTYTUT LOTNICTWA","model":"IS2"},{"icao":"IS28","code":"LL1P","manufacturer":"IAR","model":"IS28M2"},{"icao":"ISAT","code":"LL1P","manufacturer":"AEROJAMES","model":"01 Isatis"},{"icao":"ISPT","code":"LL1P","manufacturer":"ISAACS","model":"Spitfire"},{"icao":"J1","code":"LL1P","manufacturer":"AUSTER","model":"J1 Autocrat, Aiglet, Alpha, Workmaster, Kingsland"},{"icao":"J10","code":"ML1J","manufacturer":"CHENGDU","model":"J10, F10"},{"icao":"J177","code":"LL1P","manufacturer":"AERODYNOS","model":"JA-177 Pingouin, Evolution"},{"icao":"J2","code":"LL1P","manufacturer":"PIPER","model":"J2 Cub"},{"icao":"J20","code":"ML2J","manufacturer":"CHENGDU","model":"J-20"},{"icao":"J3","code":"LL1P","manufacturer":"CUB","model":"J3, L4 Cub, Prospector"},{"icao":"J300","code":"LL1P","manufacturer":"ALMS","model":"J-300 Joker"},{"icao":"J328","code":"ML2J","manufacturer":"FAIRCHILD DORNIER","model":"328JET, Envoy 3"},{"icao":"J4","code":"LL1P","manufacturer":"PIPER","model":"J4 Cub Coupe"},{"icao":"J4B2","code":"LG1P","manufacturer":"BARNETT","model":"J4B2"},{"icao":"J5","code":"LL1P","manufacturer":"PIPER","model":"J5 Cub Cruiser (L14, AE)"},{"icao":"J728","code":"ML2J","manufacturer":"FAIRCHILD DORNIER","model":"728JET, Envoy 7"},{"icao":"J8A","code":"ML2J","manufacturer":"SHENYANG","model":"J81, F81"},{"icao":"J8B","code":"ML2J","manufacturer":"SHENYANG","model":"J82, F82"},{"icao":"JAB2","code":"LL1P","manufacturer":"JABIRU","model":"J160/J170"},{"icao":"JAB4","code":"LL1P","manufacturer":"JABIRU","model":"J200/J400"},{"icao":"JABI","code":"LL1P","manufacturer":"JABIRU","model":"LSA/SK/SP/SPT/ST/ST3"},{"icao":"JACE","code":"LL1P","manufacturer":"ACE","model":"Junior Ace"},{"icao":"JAG2","code":"LH1T","manufacturer":"JAG HELICOPTERS","model":"JAG"},{"icao":"JAGR","code":"ML2J","manufacturer":"BAC","model":"Jaguar"},{"icao":"JAJ5","code":"LL1P","manufacturer":"ALPHA","model":"J5 Marco"},{"icao":"JAJ6","code":"LL1P","manufacturer":"J & AS","model":"J6 Fregata"},{"icao":"JANU","code":"LL1P","manufacturer":"SCHEMPP\ufffdHIRTH","model":"Janus BM/CM/CT"},{"icao":"JARO","code":"LL1P","manufacturer":"JACKAROO","model":"Thruxton Jackaroo"},{"icao":"JAST","code":"LL1J","manufacturer":"SOKO","model":"J1, RJ1, TJ1 Jastreb (J21, IJ21, NJ21, TJ21)"},{"icao":"JB1","code":"LA1P","manufacturer":"INDEPENDENT","model":"X-JB-1 SeaDragon"},{"icao":"JB15","code":"LL1P","manufacturer":"OBERLERCHNER","model":"JOB15"},{"icao":"JC01","code":"LL1P","manufacturer":"COUPE","model":"JC01"},{"icao":"JC02","code":"LL1P","manufacturer":"COUPE","model":"JC02/200"},{"icao":"JCOM","code":"ML2J","manufacturer":"AERO COMMANDER","model":"1121 Jet Commander"},{"icao":"JCRU","code":"LL1T","manufacturer":"AASI","model":"Jetcruzer"},{"icao":"JD2","code":"LL1P","manufacturer":"DYKE","model":"JD2 Delta"},{"icao":"JDOE","code":"LL1P","manufacturer":"AMERICAN HOMEBUILTS","model":"John Doe"},{"icao":"JE2","code":"LG1P","manufacturer":"EICH","model":"JE2 Gyroplane"},{"icao":"JFOX","code":"LL1P","manufacturer":"EUROALA","model":"Jet Fox"},{"icao":"JH7","code":"ML2J","manufacturer":"XIAN","model":"JH7, B7, FBC1 Flying Leopard"},{"icao":"JK05","code":"LL1P","manufacturer":"EKOLOT","model":"JK-05 Beetle, Junior, Pathmaker"},{"icao":"JL9","code":"ML1J","manufacturer":"GUIZHOU","model":"JL-9 Shanying, FTC-2000 Shanying"},{"icao":"JN76","code":"LL1P","manufacturer":"CAUDRON","model":"CR760, JN760 Cyclone, Replica"},{"icao":"JPM1","code":"LL1P","manufacturer":"MARIE","model":"JPM01 Medoc, Tanagra"},{"icao":"JPRO","code":"LL1J","manufacturer":"BAC","model":"145, 167 Jet Provost, Strikemaster"},{"icao":"JRC1","code":"LL1P","manufacturer":"CHALARD","model":"JRC01 Julcar"},{"icao":"JS1","code":"LL2T","manufacturer":"HANDLEY PAGE","model":"HP137 Jetstream 1"},{"icao":"JS20","code":"LL2T","manufacturer":"HANDLEY PAGE","model":"HP137 Jetstream 200 (T.Mk.1/2)"},{"icao":"JS3","code":"LL2T","manufacturer":"CENTURY AIRCRAFT, US","model":"Jetstream 3"},{"icao":"JS31","code":"LL2T","manufacturer":"BRITISH AEROSPACE","model":"BAe3100 Jetstream 31 (T.Mk.3)"},{"icao":"JS32","code":"ML2T","manufacturer":"BRITISH AEROSPACE","model":"BAe3200 Jetstream Super 31"},{"icao":"JS41","code":"ML2T","manufacturer":"AI (R)","model":"BAe4100 Jetstream 41"},{"icao":"JSQA","code":"LL1J","manufacturer":"GENERAL AVIA","model":"F1300 Jet Squalus"},{"icao":"JSX","code":"LL1J","manufacturer":"SONEX","model":"JSX SubSonex"},{"icao":"JT2","code":"LL1P","manufacturer":"TAYLOR, JOHN F., US","model":"JT2 Titch"},{"icao":"JU52","code":"ML3P","manufacturer":"CASA","model":"352L"},{"icao":"JUN1","code":"LL1P","manufacturer":"KAMINSKAS","model":"RK1 Jungster 1"},{"icao":"JUN2","code":"LL1P","manufacturer":"KAMINSKAS","model":"RK2 Jungster 2"},{"icao":"JUNR","code":"LL1P","manufacturer":"ANDREASSON","model":"BA7, MFI9"},{"icao":"JUPI","code":"LL1P","manufacturer":"LAMMER GEYER","model":"Jupiter"},{"icao":"K100","code":"LL1T","manufacturer":"QUEST","model":"Kodiak 100"},{"icao":"K126","code":"LH1T","manufacturer":"ICA","model":"Ka126"},{"icao":"K200","code":"LL1T","manufacturer":"QUEST","model":"Kodiak 200"},{"icao":"K209","code":"LH1T","manufacturer":"FAMA","model":"K-209 KISS"},{"icao":"K226","code":"LH2T","manufacturer":"KAMOV","model":"Ka226"},{"icao":"K250","code":"LL1P","manufacturer":"KESTREL AIRCRAFT, US","model":"K250"},{"icao":"K35A","code":"HL4J","manufacturer":"BOEING","model":"KC135A Stratotanker (J57 engines)"},{"icao":"K35E","code":"HL4J","manufacturer":"BOEING","model":"KC135D/E Stratotanker (TF33 engines)"},{"icao":"K35R","code":"HL4J","manufacturer":"BOEING","model":"KC135R/T, C135FR, Stratotanker (CFM56 engines)"},{"icao":"K50","code":"ML1J","manufacturer":"KOREA AIROSPACE","model":"T50 Golden Eagle"},{"icao":"K51","code":"LL1P","manufacturer":"KOVACS","model":"K51 Peregrino"},{"icao":"K8","code":"LL1J","manufacturer":"HONGDU","model":"K8 Karakorum"},{"icao":"K900","code":"LL1T","manufacturer":"QUEST","model":"Kodiak 900"},{"icao":"KA25","code":"MH2T","manufacturer":"KAMOV","model":"Ka25"},{"icao":"KA26","code":"LH2P","manufacturer":"KAMOV","model":"Ka26"},{"icao":"KA27","code":"MH2T","manufacturer":"KAMOV","model":"Ka27/28/29/31/32"},{"icao":"KA50","code":"MH2T","manufacturer":"KAMOV","model":"Ka50 Werewolf, Black Shark"},{"icao":"KA52","code":"MH2T","manufacturer":"KAMOV","model":"Ka52 Alligator"},{"icao":"KA62","code":"LH2T","manufacturer":"KAMOV","model":"Ka60/62, Kasatka"},{"icao":"KAFI","code":"LL1P","manufacturer":"KARI","model":"Firefly"},{"icao":"KAK1","code":"LL1P","manufacturer":"KIEGER","model":"AK1"},{"icao":"KAK3","code":"LL1P","manufacturer":"KIEGER","model":"AK-3"},{"icao":"KAT3","code":"LL1T","manufacturer":"KHRUNICHEV","model":"AT-3"},{"icao":"KATB","code":"LL2P","manufacturer":"KARI","model":"Twinbee"},{"icao":"KATR","code":"LL1P","manufacturer":"AEROSAMARA","model":"Katran"},{"icao":"KC2","code":"HL2J","manufacturer":"KAWASAKI","model":"C-2, XC-2, RC-2"},{"icao":"KE3","code":"HL4J","manufacturer":"BOEING","model":"KE3"},{"icao":"KEHA","code":"LL1P","manufacturer":"KESTREL SPORT AVIATION, CANADA","model":"Sport Hawk, Float Hawk"},{"icao":"KELA","code":"LL1P","manufacturer":"KELEHER","model":"Lark"},{"icao":"KELD","code":"LL1P","manufacturer":"KELLY","model":"D"},{"icao":"KERO","code":"LL1P","manufacturer":"REARWIN","model":"2000 Ken-Royce"},{"icao":"KEST","code":"LL1T","manufacturer":"FARNBOROUGH","model":"F-1 Kestrel"},{"icao":"KFAB","code":"LL1P","manufacturer":"KITPLANES FOR AFRICA","model":"Bushbaby, Explorer, Safari"},{"icao":"KFAS","code":"LL1P","manufacturer":"KITPLANES FOR AFRICA","model":"Safari"},{"icao":"KFIR","code":"ML1J","manufacturer":"IAI","model":"Kfir"},{"icao":"KFIS","code":"LA1P","manufacturer":"ANDERSON","model":"EA1 Kingfisher"},{"icao":"KH4","code":"LH1P","manufacturer":"KAWASAKI","model":"KH4"},{"icao":"KIS2","code":"LL1P","manufacturer":"TRI\ufffdR","model":"KIS TR1/TD"},{"icao":"KIS4","code":"LL1P","manufacturer":"PULSAR","model":"Super Cruiser"},{"icao":"KITH","code":"LL1P","manufacturer":"VIKING","model":"Kitty Hawk"},{"icao":"KITI","code":"LL1P","manufacturer":"MITCHELL\ufffdPROCTER","model":"Kittiwake"},{"icao":"KIWI","code":"LL1P","manufacturer":"TWI","model":"Kiwi"},{"icao":"KK60","code":"LL1P","manufacturer":"KARI\ufffdKEEN","model":"60 Coupe"},{"icao":"KL07","code":"LL1P","manufacturer":"BOLKOW","model":"Kl107, F207"},{"icao":"KL10","code":"LL1P","manufacturer":"FLIGHT DESIGN-VESSEL","model":"KLA-100"},{"icao":"KL25","code":"LL1P","manufacturer":"KLEMM","model":"L25"},{"icao":"KL35","code":"LL1P","manufacturer":"KLEMM","model":"Kl35"},{"icao":"KLBR","code":"LL1P","manufacturer":"KOLB","model":"King Colbra"},{"icao":"KM2","code":"LL1P","manufacturer":"FUJI","model":"KM2, TL1"},{"icao":"KMAX","code":"LH1T","manufacturer":"KAMAN","model":"K1200 KMax"},{"icao":"KNTW","code":"LL1P","manufacturer":"PAYNE","model":"Knight Twister, Sunday Knight Twister"},{"icao":"KODI","code":"LL1T","manufacturer":"QUEST AIRCRAFT COMPANY","model":"Quest Kodiak"},{"icao":"KOLL","code":"LL1P","manufacturer":"KOLB","model":"Laser"},{"icao":"KP2","code":"LL1P","manufacturer":"JIHLAVAN","model":"KP-2 Skyleader 150/200, Rapid 200, KP-2 Sova"},{"icao":"KP5","code":"LL1P","manufacturer":"JIHLAVAN","model":"KP-5 Rapid 500, Skyleader 500/600"},{"icao":"KR1","code":"LL1P","manufacturer":"RAND","model":"KR1"},{"icao":"KR2","code":"LL1P","manufacturer":"RAND","model":"KR2"},{"icao":"KR21","code":"LL1P","manufacturer":"KREIDER-REISNER","model":"KR-21, C-6 Challenger"},{"icao":"KR30","code":"LL1P","manufacturer":"EKOLOT","model":"KR-030 Topaz"},{"icao":"KR31","code":"LL1P","manufacturer":"KREIDER-REISNER","model":"KR-31, C-2 Challenger"},{"icao":"KR34","code":"LL1P","manufacturer":"FAIRCHILD, US","model":"KR34 Challenger"},{"icao":"KRAG","code":"LL1P","manufacturer":"SOKO","model":"P2 Kraguj (J20)"},{"icao":"KRAH","code":"LL1P","manufacturer":"ROCK","model":"Kr\ufffdhe"},{"icao":"KRIC","code":"LL1P","manufacturer":"FLSZ","model":"DK1 Der Kricket"},{"icao":"KSTK","code":"LL2P","manufacturer":"PHOENIX\ufffdAVIACOR","model":"M12 Kasatik"},{"icao":"KT1","code":"LL1T","manufacturer":"DAEWOO","model":"KTX1, WoongBee, KT1"},{"icao":"KTOO","code":"LL1P","manufacturer":"AMAX","model":"J6 Karatoo"},{"icao":"KZ2","code":"LL1P","manufacturer":"SAI, DENMARK","model":"KZ2 Kupe, Traener"},{"icao":"KZ3","code":"LL1P","manufacturer":"SAI, DENMARK","model":"KZ3"},{"icao":"KZ4","code":"LL2P","manufacturer":"SAI, DENMARK","model":"KZ4"},{"icao":"KZ7","code":"LL1P","manufacturer":"SAI, DENMARK","model":"KZ7 Laerke"},{"icao":"KZ8","code":"LL1P","manufacturer":"SAI, DENMARK","model":"KZ8"},{"icao":"L10","code":"LL2P","manufacturer":"LOCKHEED","model":"L10 Electra (XR2O)"},{"icao":"L101","code":"HL3J","manufacturer":"LOCKHEED","model":"L1011 TriStar"},{"icao":"L11","code":"LL1P","manufacturer":"LUSCOMBE","model":"11A Sedan"},{"icao":"L11E","code":"LL1P","manufacturer":"LUSCOMBE","model":"11E Spartan 185"},{"icao":"L12","code":"LL2P","manufacturer":"LOCKHEED","model":"L12 Electra Junior (C40, JO)"},{"icao":"L13","code":"LL1P","manufacturer":"CONVAIR","model":"L13"},{"icao":"L13M","code":"LL1P","manufacturer":"LET","model":"L13 Blanik (singleengine conversions)"},{"icao":"L13S","code":"LL1P","manufacturer":"AEROTECHNIK","model":"L13SDL/SDM/SE/SEH/SL/SW Vivat, Super Vivat"},{"icao":"L14","code":"ML2P","manufacturer":"LOCKHEED","model":"L14 Super Electra, Hudson"},{"icao":"L15","code":"ML2J","manufacturer":"HONGDU","model":"L-15 Lieying"},{"icao":"L159","code":"ML1J","manufacturer":"AERO VODOCHODY, CZECH","model":"L159"},{"icao":"L18","code":"ML2P","manufacturer":"HOWARD AERO, US","model":"250, 350"},{"icao":"L181","code":"LL1P","manufacturer":"ASSOCIATED AIR","model":"Liberty 181"},{"icao":"L188","code":"ML4T","manufacturer":"LOCKHEED","model":"L188 Electra"},{"icao":"L200","code":"LL2P","manufacturer":"LET","model":"L200 Morava"},{"icao":"L29","code":"LL1J","manufacturer":"AERO VODOCHODY, CZECH","model":"L29 Delfin"},{"icao":"L29A","code":"ML4J","manufacturer":"LOCKHEED","model":"L1329 Jetstar 6/8"},{"icao":"L29B","code":"ML4J","manufacturer":"LOCKHEED","model":"L1329 Jetstar 2/731"},{"icao":"L37","code":"ML2P","manufacturer":"HOWARD AERO, US","model":"500"},{"icao":"L380","code":"LL1P","manufacturer":"LEDERLIN","model":"380 Ladybug"},{"icao":"L39","code":"LL1J","manufacturer":"AERO VODOCHODY, CZECH","model":"L39/139 Albatross"},{"icao":"L4","code":"LA2P","manufacturer":"CHAIKA","model":"L-4, L-42, L-44"},{"icao":"L40","code":"LL1P","manufacturer":"ORLICAN","model":"L40 Meta Sokol"},{"icao":"L410","code":"LL2T","manufacturer":"LET","model":"L410/420 Turbolet"},{"icao":"L5","code":"LL1P","manufacturer":"STINSON","model":"L5, U19, OY Sentinel (V76)"},{"icao":"L59","code":"LL1J","manufacturer":"AERO VODOCHODY, CZECH","model":"L59"},{"icao":"L6","code":"LA2P","manufacturer":"AEROVOLGA","model":"L-6"},{"icao":"L60","code":"LL1P","manufacturer":"AERO VODOCHODY, CZECH","model":"L60 Brigadyr"},{"icao":"L610","code":"ML2T","manufacturer":"LET","model":"L610"},{"icao":"L70","code":"LL1P","manufacturer":"VALMET","model":"L70 Miltrainer, Vinka"},{"icao":"L8","code":"LL1P","manufacturer":"LUSCOMBE","model":"8, T8, 50, Master, Silvaire, Observer"},{"icao":"L90","code":"LL1T","manufacturer":"AERMACCHI","model":"M290TP Redigo"},{"icao":"LA25","code":"LA1P","manufacturer":"LAKE","model":"LA250/270 (Turbo)Renegade, Seawolf, Seafury"},{"icao":"LA4","code":"LA1P","manufacturer":"LAKE","model":"LA4/200, Buccaneer"},{"icao":"LA60","code":"LL1P","manufacturer":"AERMACCHI","model":"AL60, Conestoga, Trojan"},{"icao":"LA6T","code":"LL1T","manufacturer":"AERMACCHI","model":"AL-60 Turbine Grizzly"},{"icao":"LA8","code":"LA2P","manufacturer":"AEROVOLGA","model":"LA-8 Flagman"},{"icao":"LACO","code":"LL1P","manufacturer":"LAVEN","model":"LACO125/145"},{"icao":"LAE1","code":"LL1E","manufacturer":"LANGE","model":"E-1 Antares 20E"},{"icao":"LAKR","code":"LL1P","manufacturer":"LASER","model":"Akro Z"},{"icao":"LAKX","code":"LL1P","manufacturer":"AEROPLASTIKA","model":"LAKX"},{"icao":"LAMA","code":"LH1T","manufacturer":"AEROSPATIALE","model":"SA315 Lama"},{"icao":"LANC","code":"ML4P","manufacturer":"AVRO","model":"683 Lancaster"},{"icao":"LAR1","code":"LL1J","manufacturer":"FLARIS","model":"LAR-1"},{"icao":"LARK","code":"LL1P","manufacturer":"NORTH AMERICAN  ROCKWELL","model":"100 Lark Commander"},{"icao":"LAST","code":"LL1P","manufacturer":"UTVA","model":"Lasta"},{"icao":"LBUG","code":"LL1P","manufacturer":"LIGHTNING BUG","model":"Lightning Bug"},{"icao":"LCA","code":"ML1J","manufacturer":"ADA","model":"LCA"},{"icao":"LCB","code":"LL1P","manufacturer":"LAIRD","model":"LCB200 Commercial"},{"icao":"LCH","code":"LH2T","manufacturer":"HINDUSTAN","model":"LCH"},{"icao":"LCR","code":"LL1P","manufacturer":"LAIRD","model":"LC-R Speedwing"},{"icao":"LEG2","code":"LL1P","manufacturer":"LANCAIR","model":"Legacy"},{"icao":"LEGD","code":"LL1P","manufacturer":"PERFORMANCE","model":"Legend"},{"icao":"LEOP","code":"LL2J","manufacturer":"CHICHESTER\ufffdMILES","model":"Leopard"},{"icao":"LESP","code":"LL1P","manufacturer":"LANCAIR","model":"ES-P"},{"icao":"LEVI","code":"LL1P","manufacturer":"TAPANEE","model":"Levitation 4"},{"icao":"LGEZ","code":"LL1P","manufacturer":"RUTAN","model":"61 LongEZ"},{"icao":"LH10","code":"LL1P","manufacturer":"LH AVIATION","model":"LH-10 Ellipse"},{"icao":"LIBE","code":"LL1P","manufacturer":"LIBERTY","model":"Bellaire"},{"icao":"LION","code":"LL1P","manufacturer":"GRIFFON","model":"Lionheart"},{"icao":"LJ23","code":"LL2J","manufacturer":"LEAR JET","model":"23"},{"icao":"LJ24","code":"LL2J","manufacturer":"GATES LEARJET","model":"24"},{"icao":"LJ25","code":"LL2J","manufacturer":"GATES LEARJET","model":"25"},{"icao":"LJ28","code":"LL2J","manufacturer":"GATES LEARJET","model":"28, 29"},{"icao":"LJ31","code":"ML2J","manufacturer":"GATES LEARJET","model":"31"},{"icao":"LJ35","code":"ML2J","manufacturer":"GATES LEARJET","model":"35, 36 (C21, RC35, RC36, U36)"},{"icao":"LJ40","code":"ML2J","manufacturer":"LEARJET","model":"40"},{"icao":"LJ45","code":"ML2J","manufacturer":"LEARJET","model":"45"},{"icao":"LJ55","code":"ML2J","manufacturer":"GATES LEARJET","model":"55"},{"icao":"LJ60","code":"ML2J","manufacturer":"LEARJET","model":"60"},{"icao":"LJ70","code":"ML2J","manufacturer":"LEARJET","model":"70"},{"icao":"LJ75","code":"ML2J","manufacturer":"LEARJET","model":"75, LIBERTY"},{"icao":"LJ85","code":"ML2J","manufacturer":"LEARJET","model":"85"},{"icao":"LK17","code":"LL1P","manufacturer":"LAK","model":"LAK-17AT"},{"icao":"LK19","code":"LL1P","manufacturer":"LAK","model":"LAK-19T"},{"icao":"LK20","code":"LL1P","manufacturer":"LAK","model":"LAK-20M"},{"icao":"LM5","code":"LL1P","manufacturer":"LOMBARDI","model":"LM5 Aviastar"},{"icao":"LM5X","code":"LL1P","manufacturer":"LIGHT MINIATURE","model":"LM5 Super Cub"},{"icao":"LM7","code":"LL1P","manufacturer":"LOMBARDI","model":"LM7"},{"icao":"LMK1","code":"LL1P","manufacturer":"CATA","model":"LMK1 Oryx"},{"icao":"LN27","code":"LL1P","manufacturer":"FALCOMPOSITE","model":"LN-27 Furio"},{"icao":"LN3","code":"LA1P","manufacturer":"FLYGFABRIKEN","model":"LN-3 Seagull"},{"icao":"LNC2","code":"LL1P","manufacturer":"LANCAIR","model":"Lancair 200/235/320/360"},{"icao":"LNC4","code":"LL1P","manufacturer":"LANCAIR","model":"Lancair 4"},{"icao":"LNCE","code":"LL1P","manufacturer":"LANCAIR","model":"Lancair ES, Super ES"},{"icao":"LNP4","code":"LL1T","manufacturer":"LANCAIR","model":"Lancair PropJet 4"},{"icao":"LNT4","code":"LL1T","manufacturer":"LANCAIR","model":"Sentry 4T"},{"icao":"LOAD","code":"MLCT","manufacturer":"AYRES","model":"LM200 Loadmaster"},{"icao":"LOCA","code":"LL1P","manufacturer":"AEROLAB","model":"LoCamp"},{"icao":"LOVE","code":"LL1P","manufacturer":"LOVING\ufffdWAYNE","model":"WR1 Love"},{"icao":"LP1","code":"LL1P","manufacturer":"LOPRESTI","model":"LP1 Fury"},{"icao":"LR2T","code":"LH1T","manufacturer":"LOAD RANGER","model":"2000"},{"icao":"LS10","code":"LL1P","manufacturer":"DG FLUGZEUGBAU","model":"LS-10ST"},{"icao":"LS2","code":"LL1P","manufacturer":"HAT","model":"LS2"},{"icao":"LS8","code":"LL1P","manufacturer":"DG FLUGZEUGBAU","model":"LS-8T, LS-8ST"},{"icao":"LS9","code":"LL1P","manufacturer":"ROLLADEN\ufffdSCHNEIDER","model":"LS9"},{"icao":"LSTR","code":"LL1P","manufacturer":"CUSTOM FLIGHT","model":"Lite Star"},{"icao":"LTNG","code":"ML2J","manufacturer":"BAC","model":"Lightning"},{"icao":"LUL5","code":"LL1P","manufacturer":"LUCAS","model":"L5"},{"icao":"LUL6","code":"LL1P","manufacturer":"LUCAS","model":"L6"},{"icao":"LUL7","code":"LL1P","manufacturer":"LUCAS","model":"L7"},{"icao":"LUL8","code":"LL1P","manufacturer":"LUCAS","model":"L-8"},{"icao":"LV51","code":"LL1P","manufacturer":"LAVIASA","model":"LAV-51 Master, Super Master"},{"icao":"LW20","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Australian LightWing Speed SP-2000"},{"icao":"LW40","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Australian LightWing Speed SP-4000"},{"icao":"LWIN","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Australian LightWing"},{"icao":"LX32","code":"LL1P","manufacturer":"LILIENTHAL","model":"X-32 Bekas, S-2 Sintal"},{"icao":"LX34","code":"LL1P","manufacturer":"LILIENTHAL","model":"X-34 Bekas"},{"icao":"LXR","code":"LL1P","manufacturer":"ELIXIR","model":"Elixir"},{"icao":"LYNX","code":"LH2T","manufacturer":"WESTLAND","model":"Lynx, Super Lynx, Battlefield Lynx (SH14)"},{"icao":"LYSA","code":"LL1P","manufacturer":"NATIONAL STEEL","model":"Lysander"},{"icao":"M10","code":"LL1P","manufacturer":"AEROSTAR, US","model":"90"},{"icao":"M101","code":"LL1T","manufacturer":"MYASISHCHEV","model":"M101 Gzhel"},{"icao":"M106","code":"LL1P","manufacturer":"LAMBERT","model":"M-106 Mission"},{"icao":"M108","code":"LL1P","manufacturer":"LAMBERT","model":"M-108 Mission"},{"icao":"M10F","code":"LL1P","manufacturer":"MOONEY","model":"M-10T"},{"icao":"M10R","code":"LL1P","manufacturer":"MOONEY","model":"M-10J"},{"icao":"M110","code":"LL1P","manufacturer":"AVIAT","model":"110 Special"},{"icao":"M15","code":"LL1J","manufacturer":"PZL\ufffdMIELEC","model":"M15 Belphegor"},{"icao":"M17","code":"ML1J","manufacturer":"MYASISHCHEV","model":"M17 Stratosfera"},{"icao":"M18","code":"LL1P","manufacturer":"PZL\ufffdMIELEC","model":"M18 Dromader"},{"icao":"M18T","code":"LL1T","manufacturer":"MELEX","model":"T45 Turbine Dromader"},{"icao":"M2","code":"LL1P","manufacturer":"KUBICEK","model":"M-2 Scout"},{"icao":"M200","code":"LL1P","manufacturer":"AERO COMMANDER","model":"200 Commander 200"},{"icao":"M203","code":"LL1P","manufacturer":"MYASISHCHEV","model":"M203 Barsuk"},{"icao":"M20P","code":"LL1P","manufacturer":"AEROSTAR, US","model":"200, 201, 202, 220"},{"icao":"M20T","code":"LL1P","manufacturer":"MOONEY","model":"M20K/M, Encore, Bravo, 231, 252, TLS, TSE (turbocharged engine)"},{"icao":"M21","code":"LL1P","manufacturer":"PZL\ufffdMIELEC","model":"M21 Dromader Mini"},{"icao":"M212","code":"LL1P","manufacturer":"LAMBERT","model":"M-212 Mission"},{"icao":"M22","code":"LL1P","manufacturer":"MOONEY","model":"M22, Mustang"},{"icao":"M24","code":"LL1P","manufacturer":"PZL\ufffdMIELEC","model":"M24 Dromader Super"},{"icao":"M26","code":"LL1P","manufacturer":"PZL\ufffdMIELEC","model":"M26 Iskierka, Air Wolf"},{"icao":"M28","code":"LL2T","manufacturer":"PZL\ufffdMIELEC","model":"An28, Skytruck"},{"icao":"M2HK","code":"LL1P","manufacturer":"MILES","model":"M2 Hawk Major, Hawk Speed Six"},{"icao":"M308","code":"LL1P","manufacturer":"GERMAN BIANCO","model":"MB308"},{"icao":"M309","code":"ML2P","manufacturer":"ADAM","model":"M309"},{"icao":"M326","code":"LL1J","manufacturer":"AERMACCHI","model":"MB326"},{"icao":"M339","code":"LL1J","manufacturer":"AERMACCHI","model":"MB339"},{"icao":"M345","code":"LL1J","manufacturer":"LEONARDO","model":"M-345, T-345"},{"icao":"M346","code":"ML2J","manufacturer":"AERMACCHI","model":"M-346/T-346 Master"},{"icao":"M34V","code":"LH2P","manufacturer":"MIL","model":"Mi34VAZ"},{"icao":"M360","code":"LL1P","manufacturer":"AIRCRAFT TECHNOLOGIES","model":"Meyer360"},{"icao":"M36J","code":"LL2P","manufacturer":"MATRA","model":"M-360 Jupiter"},{"icao":"M4","code":"LL1P","manufacturer":"MAULE","model":"M4 Bee Dee, Jetasen, Rocket, Astro Rocket, Strata Rocket"},{"icao":"M404","code":"ML2P","manufacturer":"MARTIN","model":"404"},{"icao":"M5","code":"LL1P","manufacturer":"MAULE","model":"M5, Strata Rocket, Lunar Rocket, Patroller"},{"icao":"M55","code":"ML2J","manufacturer":"MYASISHCHEV","model":"M55 Geophysica"},{"icao":"M6","code":"LL1P","manufacturer":"MAULE","model":"M6 Super Rocket"},{"icao":"M600","code":"LL1T","manufacturer":"PIPER","model":"PA-46-600TP"},{"icao":"M7","code":"LL1P","manufacturer":"MAULE","model":"M7235/260, MT7235/260, MX7160/180/235, MXT7160/180 Super Rocket, Star Rocket, Comet, Star Craft, Orion,Sportplane"},{"icao":"M74","code":"LH1P","manufacturer":"TEXAS HELICOPTER","model":"M74 Wasp"},{"icao":"M7T","code":"LL1T","manufacturer":"MAULE","model":"M7420, MT7420, MX7420, MXT7420 Star Craft"},{"icao":"M8","code":"LL1P","manufacturer":"MAULE","model":"M8"},{"icao":"M9","code":"LL1P","manufacturer":"MAULE","model":"M-9"},{"icao":"MA1","code":"LL1P","manufacturer":"EMAIR","model":"MA1 Paymaster, Diablo"},{"icao":"MA5","code":"LL1P","manufacturer":"MARQUART","model":"MA5 Charger"},{"icao":"MA60","code":"ML2T","manufacturer":"XIAN","model":"MA-60"},{"icao":"MA6H","code":"ML2T","manufacturer":"XIAN","model":"MA-60H"},{"icao":"MAGC","code":"LL1P","manufacturer":"IBIS","model":"Magic"},{"icao":"MAGI","code":"LL1P","manufacturer":"MILES","model":"M14 Magister"},{"icao":"MAGN","code":"LL1P","manufacturer":"AVID","model":"Magnum"},{"icao":"MAJR","code":"LL1P","manufacturer":"FAIRTRAVEL","model":"Cubmajor"},{"icao":"MAKO","code":"LL1P","manufacturer":"LANCAIR","model":"Mako"},{"icao":"MAMB","code":"LL1P","manufacturer":"MELBOURNE","model":"MA2 Mamba"},{"icao":"MAME","code":"LL1P","manufacturer":"AEROCOMP","model":"Merlin"},{"icao":"MARS","code":"MS4P","manufacturer":"MARTIN","model":"JRM Mars (170)"},{"icao":"MAVR","code":"LL1P","manufacturer":"AEA","model":"Maverick"},{"icao":"MC01","code":"LL1P","manufacturer":"MONTAER","model":"MC-01"},{"icao":"MC10","code":"LL2P","manufacturer":"COLOMBAN","model":"MC10/12/15 Cricri"},{"icao":"MC23","code":"ML2J","manufacturer":"IRKUT","model":"MC-21-300"},{"icao":"MC45","code":"LL1P","manufacturer":"MEYERS","model":"MAC145"},{"icao":"MC90","code":"LL1P","manufacturer":"MONOCOUPE","model":"90"},{"icao":"MCOU","code":"LL1P","manufacturer":"CHRIS TENA","model":"Mini Coupe"},{"icao":"MCOY","code":"LL1P","manufacturer":"MONTANA","model":"Coyote"},{"icao":"MCR1","code":"LL1P","manufacturer":"COLOMBAN","model":"MC100 Banbi"},{"icao":"MCR4","code":"LL1P","manufacturer":"DYN\'AERO","model":"MCR4"},{"icao":"MCRR","code":"LL1P","manufacturer":"DYN\'AERO","model":"MCR-R180"},{"icao":"MCUL","code":"LL1P","manufacturer":"KIMBALL","model":"McCullocoupe"},{"icao":"MD11","code":"HL3J","manufacturer":"MCDONNELL DOUGLAS","model":"MD11"},{"icao":"MD3","code":"LL1P","manufacturer":"DATWYLER","model":"MD3 Swiss Trainer"},{"icao":"MD3R","code":"LL1P","manufacturer":"FLYITALIA","model":"MD-3 Rider, SportRider"},{"icao":"MD52","code":"LH1T","manufacturer":"BOEING","model":"MD520N"},{"icao":"MD60","code":"LH1T","manufacturer":"BOEING","model":"MD600N"},{"icao":"MD81","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD81"},{"icao":"MD82","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD82"},{"icao":"MD83","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD83"},{"icao":"MD87","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD87"},{"icao":"MD88","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD88"},{"icao":"MD90","code":"ML2J","manufacturer":"MCDONNELL DOUGLAS","model":"MD90"},{"icao":"ME08","code":"LL1P","manufacturer":"MESSERSCHMITT","model":"Bf108 Taifun"},{"icao":"ME09","code":"LL1P","manufacturer":"HISPANO","model":"HA1112 Buchon"},{"icao":"ME62","code":"LL2J","manufacturer":"MESSERSCHMITT","model":"Me262, Replica"},{"icao":"MEAD","code":"LL1P","manufacturer":"MEAD","model":"Adventure"},{"icao":"MEL2","code":"LL1P","manufacturer":"GARRISON","model":"Melmoth 2"},{"icao":"MERK","code":"LL2P","manufacturer":"AVIATON","model":"Merkury"},{"icao":"MESS","code":"LL1P","manufacturer":"MILES","model":"M38 Messenger"},{"icao":"METR","code":"ML2J","manufacturer":"ARMSTRONG WHITWORTH","model":"Meteor"},{"icao":"MEXP","code":"LL1P","manufacturer":"MERLIN","model":"Explorer"},{"icao":"MF10","code":"LL1P","manufacturer":"MALMO","model":"MFI10 Vipan"},{"icao":"MF17","code":"LL1P","manufacturer":"PAKISTAN","model":"Mushshak, Shahbaz, Super Mushshak Agile"},{"icao":"MG15","code":"LL1J","manufacturer":"AERO VODOCHODY, CZECH","model":"S102/103, CS102"},{"icao":"MG17","code":"LL1J","manufacturer":"CHENGDU","model":"JJ5, FT5"},{"icao":"MG19","code":"ML2J","manufacturer":"GUIZHOU","model":"J6, F6"},{"icao":"MG21","code":"ML1J","manufacturer":"AEROSTAR SA, ROMANIA","model":"MiG21 Lancer"},{"icao":"MG23","code":"ML1J","manufacturer":"HINDUSTAN","model":"MiG27 Bahadur"},{"icao":"MG25","code":"ML2J","manufacturer":"MIKOYAN","model":"MiG25"},{"icao":"MG29","code":"ML2J","manufacturer":"MAPO","model":"MiG29/33"},{"icao":"MG31","code":"ML2J","manufacturer":"MAPO","model":"MiG31"},{"icao":"MG44","code":"ML2J","manufacturer":"MIKOYAN","model":"MiG 144"},{"icao":"MGAT","code":"LL1J","manufacturer":"MAPO","model":"MiGAT"},{"icao":"MGIC","code":"LL1P","manufacturer":"KAISER FLUGZEUHBAU","model":"Magic"},{"icao":"MGNM","code":"LL1P","manufacturer":"AVIATION ENTERPRISES","model":"Magnum"},{"icao":"MH02","code":"LL2J","manufacturer":"HONDA\ufffdMISSISSIPPI","model":"MH02"},{"icao":"MH20","code":"LH2T","manufacturer":"MITSUBISHI","model":"MH2000"},{"icao":"MH46","code":"LL1P","manufacturer":"AEROSETTE","model":"MH-46 Eclipse"},{"icao":"MI10","code":"MH2T","manufacturer":"MIL","model":"Mi10"},{"icao":"MI14","code":"MH2T","manufacturer":"MIL","model":"Mi14"},{"icao":"MI2","code":"LH2T","manufacturer":"MIL","model":"Mi2"},{"icao":"MI24","code":"MH2T","manufacturer":"MIL","model":"Mi24/25/35"},{"icao":"MI26","code":"MH2T","manufacturer":"MIL","model":"Mi26"},{"icao":"MI28","code":"MH2T","manufacturer":"MIL","model":"Mi28"},{"icao":"MI34","code":"LH1P","manufacturer":"MIL","model":"Mi34, Mi34/C/P/S"},{"icao":"MI38","code":"MH2T","manufacturer":"MIL","model":"Mi38"},{"icao":"MI4","code":"LH1P","manufacturer":"HARBIN","model":"Z5, Xuanfeng"},{"icao":"MI6","code":"MH2T","manufacturer":"MIL","model":"Mi6/22"},{"icao":"MI8","code":"MH2T","manufacturer":"MIL","model":"Mi8/9/17/19/171/172"},{"icao":"MICO","code":"LL2J","manufacturer":"MARMANDE","model":"Microjet 200"},{"icao":"MIDR","code":"LL1P","manufacturer":"ACBA","model":"ACBA8 Midour 2"},{"icao":"MIMP","code":"LL1P","manufacturer":"AEROCAR","model":"MiniImp"},{"icao":"MIMU","code":"LL1P","manufacturer":"BUSHBY","model":"MM1 Midget Mustang"},{"icao":"MIR2","code":"ML1J","manufacturer":"DASSAULT","model":"Mirage 2000"},{"icao":"MIR4","code":"ML2J","manufacturer":"DASSAULT","model":"Mirage 4"},{"icao":"MIRA","code":"ML1J","manufacturer":"ATLAS","model":"Cheetah"},{"icao":"MITE","code":"LL1P","manufacturer":"MOONEY","model":"M18 Mite, Wee Scotsman"},{"icao":"MJ10","code":"LL1P","manufacturer":"JURCA","model":"MJ10 Spit"},{"icao":"MJ12","code":"LL1P","manufacturer":"JURCA","model":"MJ12 P40"},{"icao":"MJ1H","code":"LL1P","manufacturer":"JURCA","model":"MJ100 Spitfire Replica"},{"icao":"MJ2","code":"LL1P","manufacturer":"JURCA","model":"MJ2/20/22 Temp\ufffdte"},{"icao":"MJ3","code":"LL1P","manufacturer":"JURCA","model":"MJ3 Dart"},{"icao":"MJ4","code":"LL1P","manufacturer":"JURCA","model":"MJ4 Shadow"},{"icao":"MJ5","code":"LL1P","manufacturer":"JURCA","model":"MJ5 Sirocco"},{"icao":"MJ53","code":"LL1P","manufacturer":"JURCA","model":"MJ53 Autan"},{"icao":"MJ55","code":"LL1P","manufacturer":"JURCA","model":"MJ55 Biso"},{"icao":"MJ7","code":"LL1P","manufacturer":"JURCA","model":"MJ7 Gnatsum"},{"icao":"MJ77","code":"LL1P","manufacturer":"JURCA","model":"MJ77 Gnatsum"},{"icao":"MJ8","code":"LL1P","manufacturer":"JURCA","model":"MJ8 1Nine0"},{"icao":"MJ80","code":"LL1P","manufacturer":"JURCA","model":"MJ80 FockeWulf FW190 Replica"},{"icao":"MJ9","code":"LL1P","manufacturer":"JURCA","model":"MJ9"},{"icao":"MJ90","code":"LL1P","manufacturer":"JURCA","model":"MJ90 Messerschmitt Bf109 Replica"},{"icao":"MLER","code":"LL1P","manufacturer":"ALANNE","model":"MoottoriLerche"},{"icao":"MM14","code":"LG1P","manufacturer":"MAGNI","model":"M-14 Scout"},{"icao":"MM16","code":"LG1P","manufacturer":"MAGNI","model":"M-16 Tandem Trainer"},{"icao":"MM19","code":"LG1P","manufacturer":"MAGNI","model":"M-19 Shark"},{"icao":"MM21","code":"LG1P","manufacturer":"MAGNI","model":"M-21"},{"icao":"MM22","code":"LG1P","manufacturer":"MAGNI","model":"M-22 Voyager"},{"icao":"MM24","code":"LG1P","manufacturer":"MAGNI","model":"M-24 Orion"},{"icao":"MMAC","code":"LL1P","manufacturer":"MCCARLEY","model":"MiniMac"},{"icao":"MMAX","code":"LG1P","manufacturer":"MAD MAX AERO","model":"Mad Max"},{"icao":"MMUT","code":"LL1P","manufacturer":"MARA WING","model":"1-L/L-1 Malamut"},{"icao":"MNEX","code":"LL1P","manufacturer":"NORMAN","model":"Nordic 8 Mini Explorer"},{"icao":"MOCU","code":"LL1P","manufacturer":"CULP","model":"MonoCulp"},{"icao":"MOGO","code":"LL1P","manufacturer":"MONTAGNE","model":"Mountain Goat"},{"icao":"MOL1","code":"LL1P","manufacturer":"MOLNIYA","model":"1"},{"icao":"MONA","code":"LL1P","manufacturer":"MILES","model":"M17 Monarch"},{"icao":"MONI","code":"LL1P","manufacturer":"MONNETT","model":"Moni"},{"icao":"MOR2","code":"LL1P","manufacturer":"MORRISEY","model":"2150, 2000, Nifty"},{"icao":"MOSP","code":"LL1P","manufacturer":"MONG","model":"Sport"},{"icao":"MOSQ","code":"ML2P","manufacturer":"DE HAVILLAND","model":"DH98 Mosquito"},{"icao":"MOTO","code":"LL1P","manufacturer":"HUMBERT","model":"Moto Du Ciel"},{"icao":"MP02","code":"LL1P","manufacturer":"AERO-KROS","model":"MP-02 Czajka"},{"icao":"MP20","code":"LL1P","manufacturer":"PLAN","model":"MP205/207 Busard"},{"icao":"MR25","code":"LL1P","manufacturer":"MURPHY","model":"SR2500 Super Rebel"},{"icao":"MR35","code":"LL1P","manufacturer":"MURPHY","model":"SR3500 Super Rebel"},{"icao":"MR3T","code":"LL1T","manufacturer":"MURPHY","model":"SR-3500 T-Moose"},{"icao":"MRAI","code":"LL1P","manufacturer":"MONNETT","model":"Monerai P"},{"icao":"MRAM","code":"LL1P","manufacturer":"HARMON, JAMES B","model":"12 Mister America"},{"icao":"MRF1","code":"ML1J","manufacturer":"DASSAULT","model":"Mirage F1"},{"icao":"MRJ7","code":"ML2J","manufacturer":"MITSUBISHI","model":"MRJ-70"},{"icao":"MRJ9","code":"ML2J","manufacturer":"MITSUBISHI","model":"MRJ-90"},{"icao":"MRMD","code":"LA1P","manufacturer":"CSA","model":"Mermaid"},{"icao":"MRTN","code":"LL1P","manufacturer":"MIRAGE","model":"Marathon"},{"icao":"MS1","code":"LL1P","manufacturer":"MYSKY","model":"MS-1"},{"icao":"MS18","code":"LL1P","manufacturer":"SOCATA","model":"MS2000FG Morane"},{"icao":"MS23","code":"LL1P","manufacturer":"MORANE\ufffdSAULNIER","model":"MS230"},{"icao":"MS25","code":"LL1P","manufacturer":"SOCATA","model":"MS200RG Morane"},{"icao":"MS30","code":"LL1P","manufacturer":"SOCATA","model":"MS300 Epsilon 2"},{"icao":"MS31","code":"LL1P","manufacturer":"MORANE\ufffdSAULNIER","model":"MS315/317"},{"icao":"MS73","code":"LL1P","manufacturer":"MORANE\ufffdSAULNIER","model":"MS733 Alcyon"},{"icao":"MS76","code":"LL2J","manufacturer":"DINFIA","model":"MS760 Paris"},{"icao":"MSAI","code":"LL1P","manufacturer":"MORANE\ufffdSAULNIER","model":"AI, MoS27/29/30"},{"icao":"MSQ2","code":"LL1P","manufacturer":"BACKCOUNTRY","model":"Mackey SQ-2"},{"icao":"MT","code":"LG1P","manufacturer":"AUTOGYRO","model":"MT-03, MTOSport"},{"icao":"MT2","code":"ML2J","manufacturer":"MITSUBISHI","model":"T2"},{"icao":"MU2","code":"LL2T","manufacturer":"MITSUBISHI","model":"MU2, Marquise, Solitaire (LR1)"},{"icao":"MU23","code":"LL1P","manufacturer":"AKAFLIEG MUNCHEN","model":"M\ufffd23 Saurier"},{"icao":"MU30","code":"ML2J","manufacturer":"MITSUBISHI","model":"MU300 Diamond"},{"icao":"MUS2","code":"LL1P","manufacturer":"BUSHBY","model":"M2 Mustang 2"},{"icao":"MVN1","code":"LL1P","manufacturer":"MVEN","model":"1/2 Fermer, T-500, MV-500"},{"icao":"MVRK","code":"LL1P","manufacturer":"PHOENIX","model":"Maverick"},{"icao":"MX10","code":"LL1P","manufacturer":"AEROTEC ","model":"MXP-100 Aventura"},{"icao":"MX1T","code":"LL1P","manufacturer":"AEROANDINA","model":"MXP-150 Kimbaya"},{"icao":"MX2","code":"LL1P","manufacturer":"MXR","model":"MX-2"},{"icao":"MX58","code":"LL1P","manufacturer":"AEROANDINA","model":"MXP-158 Embera"},{"icao":"MX65","code":"LL1P","manufacturer":"AEROTEC ","model":"MXP-650 Amigo"},{"icao":"MX80","code":"LL1P","manufacturer":"AEROTEC ","model":"MXP-800 Fantasy"},{"icao":"MXS","code":"LL1P","manufacturer":"MXR","model":"MXS"},{"icao":"MY12","code":"LL1P","manufacturer":"MYLIUS","model":"MY102 Tornado"},{"icao":"MY13","code":"LL1P","manufacturer":"MYLIUS","model":"MY103 Mistral"},{"icao":"MYA4","code":"HL4J","manufacturer":"MYASISHCHEV","model":"M4, 3M"},{"icao":"MYS4","code":"ML1J","manufacturer":"DASSAULT","model":"MD454A Myst\ufffdre 4A"},{"icao":"N110","code":"LL1P","manufacturer":"NORD","model":"1101, 1102 Noralpha, Ramier"},{"icao":"N120","code":"LL1P","manufacturer":"NORD","model":"1200 to 1204 Norecrin"},{"icao":"N250","code":"ML2T","manufacturer":"NUSANTARA","model":"N250"},{"icao":"N260","code":"ML2T","manufacturer":"MAX HOLSTE","model":"MH260 Super Broussard"},{"icao":"N262","code":"ML2T","manufacturer":"AEROSPATIALE","model":"N262, Fr\ufffdgate, Mohawk 298"},{"icao":"N3","code":"LL1P","manufacturer":"NOSTALGAIR","model":"N3 Super Pup, Citabriette"},{"icao":"N320","code":"LL1P","manufacturer":"NORD","model":"3202"},{"icao":"N340","code":"LL1P","manufacturer":"NORD","model":"3400"},{"icao":"N3N","code":"LL1P","manufacturer":"NAVAL AIRCRAFT FACTORY","model":"N3N"},{"icao":"N5","code":"LL1P","manufacturer":"HONGDU","model":"N5"},{"icao":"NA40","code":"LH2T","manufacturer":"UNIS","model":"NA40 Bongo"},{"icao":"NAL2","code":"LL1P","manufacturer":"NAL","model":"NALLA2 Hansa"},{"icao":"NAVI","code":"LL1P","manufacturer":"NORTH AMERICAN","model":"NA145/154 Navion (L17, U18)"},{"icao":"NC85","code":"LL1P","manufacturer":"NORD","model":"NC854/858"},{"icao":"ND1T","code":"LL1T","manufacturer":"NDN","model":"NDN1T Turbo Firecracker"},{"icao":"NDAC","code":"LL1P","manufacturer":"NORMAND DUBE","model":"Aerocruiser"},{"icao":"NDAT","code":"LL1P","manufacturer":"NORMAND DUBE","model":"Aerocruiser Turbo 450"},{"icao":"NDIC","code":"LL1P","manufacturer":"NORMAN","model":"Nordic"},{"icao":"NG4","code":"LL1P","manufacturer":"ROKO AERO","model":"NG-4 Prodigy IV"},{"icao":"NG5","code":"LL1P","manufacturer":"BRM AERO","model":"Bristell NG-5, LSA, E-LSA, S-LSA, TDO, UL, HD, RG, XL8"},{"icao":"NH90","code":"MH2T","manufacturer":"NHI","model":"NH90"},{"icao":"NHCO","code":"LL1P","manufacturer":"NEW HORIZONS","model":"01 Colibri"},{"icao":"NI28","code":"LL1P","manufacturer":"NIEUPORT","model":"28 Replica"},{"icao":"NIBB","code":"LL1P","manufacturer":"AVIAMILANO","model":"F14 Nibbio"},{"icao":"NIM","code":"ML4J","manufacturer":"BRITISH AEROSPACE","model":"Nimrod"},{"icao":"NIMB","code":"LL1P","manufacturer":"SCHEMPP\ufffdHIRTH","model":"Nimbus 2M/3DM/3DT/3T/4T/4DT/4DM/4M"},{"icao":"NIPR","code":"LL1P","manufacturer":"AVIONES FAIREY","model":"T66 Nipper"},{"icao":"NM5","code":"LL1P","manufacturer":"NAL","model":"NM-5"},{"icao":"NMCU","code":"LL1P","manufacturer":"ENAER","model":"ECH02 Namcu"},{"icao":"NNJA","code":"LL1P","manufacturer":"BEST OFF","model":"Nynja"},{"icao":"NOMA","code":"LL2T","manufacturer":"GAF","model":"N2/22/24 Nomad, Floatmaster, Missionmaster, Searchmaster"},{"icao":"NORA","code":"ML2P","manufacturer":"NORD","model":"2501 to 2508 Noratlas"},{"icao":"NORS","code":"LL1P","manufacturer":"CCF","model":"Norseman"},{"icao":"NPOR","code":"LL1P","manufacturer":"REDFERN","model":"Nieuport 17/24"},{"icao":"NSTR","code":"LL1P","manufacturer":"CUSTOM FLIGHT","model":"North Star"},{"icao":"NT10","code":"LL1P","manufacturer":"NUWACO","model":"T10"},{"icao":"NXT","code":"LL1P","manufacturer":"NEMESIS","model":"NXT"},{"icao":"NXTE","code":"LL1E","manufacturer":"ELECTROFLIGHT","model":"NXTE"},{"icao":"O1","code":"LL1P","manufacturer":"CESSNA","model":"O1, TO1, OE, L19, TL19 Bird Dog (305, 321)"},{"icao":"O3","code":"LL1P","manufacturer":"LOCKHEED","model":"YO3"},{"icao":"OH1","code":"LH2T","manufacturer":"KAWASAKI","model":"OH1"},{"icao":"OKHO","code":"LG1P","manufacturer":"AERO-ASTRA","model":"Okhotnik"},{"icao":"OM1","code":"LL1P","manufacturer":"MORRISEY","model":"OM1 Bravo"},{"icao":"OMAG","code":"LL1P","manufacturer":"O\'NEILL","model":"Magnum"},{"icao":"OMGA","code":"LL1P","manufacturer":"ISAE","model":"Omega 2"},{"icao":"OMLA","code":"LL1T","manufacturer":"OMAC","model":"Laser 300"},{"icao":"ONE","code":"LL1P","manufacturer":"C2P","model":"One"},{"icao":"ONEX","code":"LL1P","manufacturer":"SONEX","model":"Onex"},{"icao":"OPCA","code":"LL1P","manufacturer":"BROOKLANDS","model":"OA7 Optica Scout"},{"icao":"OR10","code":"LA1P","manufacturer":"ORION","model":"10"},{"icao":"OR12","code":"LA2P","manufacturer":"ORION","model":"SK-12"},{"icao":"OSCR","code":"LL1P","manufacturer":"AFIC","model":"RSA200 Falcon"},{"icao":"OUDE","code":"LL1P","manufacturer":"OLYMPIC ULTRALIGHTS","model":"Desert Eagle 2"},{"icao":"OVOD","code":"LL1P","manufacturer":"VITEK","model":"Ovod"},{"icao":"OZZI","code":"LL1P","manufacturer":"BUCHANAN","model":"BAC204 Ozzie Mozzie"},{"icao":"P06T","code":"LL2P","manufacturer":"TECNAM","model":"P2006T"},{"icao":"P1","code":"ML4J","manufacturer":"KAWASAKI","model":"P-1, UP-1"},{"icao":"P100","code":"LL1P","manufacturer":"POTTIER","model":"P100"},{"icao":"P130","code":"LL1P","manufacturer":"POTTIER","model":"P130"},{"icao":"P136","code":"LA2P","manufacturer":"PIAGGIO","model":"P136"},{"icao":"P148","code":"LL1P","manufacturer":"PIAGGIO","model":"P148"},{"icao":"P149","code":"LL1P","manufacturer":"FOCKE\ufffdWULF","model":"FWP149"},{"icao":"P180","code":"LL2T","manufacturer":"PIAGGIO","model":"P180 Avanti"},{"icao":"P18T","code":"LL1T","manufacturer":"SMITH AVIATION","model":"PA-18T Super Cub"},{"icao":"P19","code":"LL1P","manufacturer":"AVIAMILANO","model":"P19 Scricciolo"},{"icao":"P1HH","code":"LL2T","manufacturer":"PIAGGIO","model":"P-1HH Hammerhead"},{"icao":"P2","code":"ML2P","manufacturer":"LOCKHEED","model":"P2D to H, SP2, P2V Neptune (L426/726/826)"},{"icao":"P208","code":"LL1P","manufacturer":"TECNAM","model":"P-2008"},{"icao":"P210","code":"LL1P","manufacturer":"AVIONES COLOMBIA","model":"P210"},{"icao":"P212","code":"LL2P","manufacturer":"TECNAM","model":"P-2012 Traveller"},{"icao":"P220","code":"LL1P","manufacturer":"AERO","model":"P220AT1/2/3"},{"icao":"P230","code":"LL1P","manufacturer":"POTTIER","model":"P230 Panda"},{"icao":"P27","code":"LL1P","manufacturer":"GRYF","model":"P-27 Skyster"},{"icao":"P270","code":"LL1P","manufacturer":"POTTIER","model":"P270"},{"icao":"P28A","code":"LL1P","manufacturer":"PIPER","model":"PA28-140/161/180/181 Archer, Cherokee, Cherokee Archer/Cruiser/ Warrior, Warrior"},{"icao":"P28B","code":"LL1P","manufacturer":"PIPER","model":"PA28-201T/235/236 Cherokee, Cherokee Charger/Pathfinder, Dakota, Turbo Dakota"},{"icao":"P28R","code":"LL1P","manufacturer":"PIPER","model":"PA28R Cherokee Arrow, Turbo Arrow 3"},{"icao":"P28S","code":"LL1P","manufacturer":"PIPER","model":"PA-28R-201T Turbo Cherokee Arrow 3, PA-28R-201T Turbo Arrow 3"},{"icao":"P28T","code":"LL1P","manufacturer":"PIPER","model":"PA28RT Turbo Arrow 4"},{"icao":"P28U","code":"LL1P","manufacturer":"PIPER","model":"PA-28RT-201T Turbo Arow 4"},{"icao":"P2J","code":"ML2T","manufacturer":"KAWASAKI","model":"P2J, EP2J, UP2J Neptune"},{"icao":"P3","code":"ML4T","manufacturer":"KAWASAKI","model":"P3, EP3, UP3 Orion"},{"icao":"P32R","code":"LL1P","manufacturer":"PIPER","model":"PA32R Lance, Turbo Saratoga SP"},{"icao":"P32T","code":"LL1P","manufacturer":"PIPER","model":"PA32RT Turbo Lance 2"},{"icao":"P337","code":"LL2P","manufacturer":"CESSNA","model":"T337G, P337 Pressurised Skymaster"},{"icao":"P38","code":"ML2P","manufacturer":"LOCKHEED","model":"P38, F5 Lightning (L222/322/422)"},{"icao":"P39","code":"LL1P","manufacturer":"BELL","model":"P39 Airacobra"},{"icao":"P40","code":"LL1P","manufacturer":"CURTISS","model":"P40, TP40 Warhawk, Kittyhawk"},{"icao":"P46T","code":"LL1T","manufacturer":"PIPER","model":"PA-46-500TP Malibu Meridian, Meridian M500"},{"icao":"P47","code":"ML1P","manufacturer":"REPUBLIC","model":"P47, F47 Thunderbolt"},{"icao":"P4Y","code":"ML4P","manufacturer":"CONVAIR","model":"PB4Y, P4Y Privateer"},{"icao":"P50","code":"LL1P","manufacturer":"POTTIER","model":"P50 Bouvreuil"},{"icao":"P51","code":"LL1P","manufacturer":"COMMONWEALTH,  AUSTRALIA","model":"CA18 Mustang"},{"icao":"P57","code":"LL1P","manufacturer":"PARTENAVIA","model":"P57 Fachiro 2"},{"icao":"P60","code":"LL1P","manufacturer":"POTTIER","model":"P60 Minacro"},{"icao":"P61","code":"ML2P","manufacturer":"NORTHROP","model":"P61 Black Widow"},{"icao":"P63","code":"LL1P","manufacturer":"BELL","model":"P63 Kingcobra"},{"icao":"P66P","code":"LL2P","manufacturer":"PIAGGIO","model":"P166, P166A/B/C/DL2/M/S, Portofino,     Albatross"},{"icao":"P66T","code":"LL2T","manufacturer":"PIAGGIO","model":"P166DL3/DP1"},{"icao":"P68","code":"LL2P","manufacturer":"PARTENAVIA","model":"P68, Victor, Observer"},{"icao":"P68T","code":"LL2T","manufacturer":"PARTENAVIA","model":"AP68TP300 Spartacus"},{"icao":"P70","code":"LL1P","manufacturer":"POTTIER","model":"P70"},{"icao":"P750","code":"LL1T","manufacturer":"PACIFIC AEROSPACE","model":"P-750 XStol"},{"icao":"P8","code":"ML2J","manufacturer":"BOEING","model":"737-800 Poseidon, P-8 Poseidon"},{"icao":"P80","code":"LL1P","manufacturer":"POTTIER","model":"P80"},{"icao":"P808","code":"LL2J","manufacturer":"PIAGGIO","model":"PD808"},{"icao":"P82","code":"ML2P","manufacturer":"NORTH AMERICAN","model":"P82, F82 Twin Mustang"},{"icao":"PA11","code":"LL1P","manufacturer":"PIPER","model":"PA11 Cub Special (L18B)"},{"icao":"PA12","code":"LL1P","manufacturer":"PIPER","model":"PA12 Super Cruiser"},{"icao":"PA14","code":"LL1P","manufacturer":"PIPER","model":"PA14 Family Cruiser"},{"icao":"PA15","code":"LL1P","manufacturer":"PIPER","model":"PA15 Vagabond"},{"icao":"PA16","code":"LL1P","manufacturer":"PIPER","model":"PA16 Clipper"},{"icao":"PA17","code":"LL1P","manufacturer":"PIPER","model":"PA17 Vagabond, Vagabond Trainer"},{"icao":"PA18","code":"LL1P","manufacturer":"PIPER","model":"PA18 Super Cub (L18C, L21, U7)"},{"icao":"PA20","code":"LL1P","manufacturer":"PIPER","model":"PA20 Pacer"},{"icao":"PA22","code":"LL1P","manufacturer":"PIPER","model":"PA22 TriPacer, Caribbean, Colt"},{"icao":"PA23","code":"LL2P","manufacturer":"MILLER, US","model":"Jet Profile"},{"icao":"PA24","code":"LL1P","manufacturer":"PIPER","model":"PA24 Comanche"},{"icao":"PA25","code":"LL1P","manufacturer":"CHINCUL","model":"PAA25 Pawnee"},{"icao":"PA27","code":"LL2P","manufacturer":"CHINCUL","model":"PAA23250 Aztec"},{"icao":"PA30","code":"LL2P","manufacturer":"PIPER","model":"PA30 Twin Comanche"},{"icao":"PA31","code":"LL2P","manufacturer":"PIPER","model":"PA31 Navajo, Navajo Chieftain, Chieftain"},{"icao":"PA32","code":"LL1P","manufacturer":"PIPER","model":"PA32 Cherokee Six, Six, Saratoga, Turbo Saratoga"},{"icao":"PA34","code":"LL2P","manufacturer":"PIPER","model":"PA34 Seneca"},{"icao":"PA36","code":"LL1P","manufacturer":"PIPER","model":"PA36 Pawnee Brave"},{"icao":"PA38","code":"LL1P","manufacturer":"PIPER","model":"PA38 Tomahawk"},{"icao":"PA44","code":"LL2P","manufacturer":"PIPER","model":"PA44 Seminole"},{"icao":"PA46","code":"LL1P","manufacturer":"PIPER","model":"PA46310P/350P Malibu, Malibu Mirage"},{"icao":"PA47","code":"LL1J","manufacturer":"PIPER","model":"PA-47 Piper Jet Altaire"},{"icao":"PACE","code":"LL1P","manufacturer":"BELLANCA","model":"CH-300 Pacemaker, CH-400 Skyrocket"},{"icao":"PAGO","code":"LL1P","manufacturer":"ALMS","model":"ADV-01 Papango"},{"icao":"PANT","code":"LL1P","manufacturer":"ROTEC","model":"Panther Plus, Sea Panther, Panther 2"},{"icao":"PAR1","code":"LL1P","manufacturer":"PARADISE","model":"P-1, P-2"},{"icao":"PAR4","code":"LL1P","manufacturer":"PARADISE","model":"P-4"},{"icao":"PARA","code":"----","manufacturer":"-","model":"Powered Parachute/Paraplane"},{"icao":"PARL","code":"LL1P","manufacturer":"PIETENPOL","model":"Aerial"},{"icao":"PAT2","code":"LL1P","manufacturer":"ATAC","model":"Patriot 2"},{"icao":"PAT4","code":"LL2T","manufacturer":"NEIVA","model":"NE821 Caraja"},{"icao":"PAUL","code":"LL1P","manufacturer":"NEIVA","model":"56 Paulistinha (L6)"},{"icao":"PAV4","code":"LG1P","manufacturer":"CARTER","model":"PAV-4"},{"icao":"PAY1","code":"LL2T","manufacturer":"CHINCUL","model":"PAA31T1500 Cheyenne 1"},{"icao":"PAY2","code":"LL2T","manufacturer":"PIPER","model":"PA31T620/T2620 Cheyenne 2"},{"icao":"PAY3","code":"LL2T","manufacturer":"PIPER","model":"PA42720 Cheyenne 3"},{"icao":"PAY4","code":"LL2T","manufacturer":"PIPER","model":"PA421000 Cheyenne 400"},{"icao":"PC12","code":"LL1T","manufacturer":"PILATUS","model":"PC12, Eagle"},{"icao":"PC21","code":"LL1T","manufacturer":"PILATUS","model":"PC-21"},{"icao":"PC24","code":"ML2J","manufacturer":"PILATUS","model":"PC-24"},{"icao":"PC6P","code":"LL1P","manufacturer":"PILATUS","model":"PC6 Porter"},{"icao":"PC6T","code":"LL1T","manufacturer":"PILATUS","model":"PC6 HeliPorter (AU23 Peacemaker)"},{"icao":"PC7","code":"LL1T","manufacturer":"ATLAS","model":"PC7 Astra"},{"icao":"PC9","code":"LL1T","manufacturer":"HAWKER DE HAVILLAND","model":"PC9"},{"icao":"PCA2","code":"LG1P","manufacturer":"PITCAIRN-CIERVA","model":"PCA-2"},{"icao":"PDIG","code":"LL2P","manufacturer":"VSTOL","model":"Pairadigm"},{"icao":"PECR","code":"LL1P","manufacturer":"PRO-COMPOSITES","model":"Personal Cruiser"},{"icao":"PEGA","code":"LL2P","manufacturer":"GENERAL AVIA","model":"F20 Pegaso"},{"icao":"PEGZ","code":"LL1P","manufacturer":"PEGASE AERO","model":"Pegazair"},{"icao":"PELI","code":"LL1P","manufacturer":"ULTRAVIA","model":"Pelican Club"},{"icao":"PEMB","code":"LL2P","manufacturer":"HUNTING","model":"P66 Pembroke"},{"icao":"PETL","code":"LL1P","manufacturer":"AERO ITBA","model":"Petrel"},{"icao":"PETR","code":"LA1P","manufacturer":"BILLIE","model":"Petrel"},{"icao":"PGEE","code":"LL1P","manufacturer":"HOLCOMB","model":"Perigee"},{"icao":"PGK1","code":"LL1P","manufacturer":"WESTERN","model":"PGK1 Hirondelle"},{"icao":"PHIL","code":"LH1P","manufacturer":"VTOL AIRCRAFT","model":"Phillicopter"},{"icao":"PHIX","code":"LG1P","manufacturer":"PHENIX","model":"Phenix"},{"icao":"PHNX","code":"LL1P","manufacturer":"FREEDOM","model":"Phoenix"},{"icao":"PIAE","code":"LL1E","manufacturer":"PIPISTREL","model":"Alpha Electro, WattsUp"},{"icao":"PIAT","code":"LL1P","manufacturer":"PIPISTREL","model":"Alpha Trainer"},{"icao":"PICO","code":"LL1P","manufacturer":"EUROSPACE","model":"F15 Excalibur"},{"icao":"PILL","code":"LL1P","manufacturer":"CASA","model":"T35 Pill\ufffdn (E26 Tamiz)"},{"icao":"PILO","code":"LL1P","manufacturer":"TECHNOFLUG","model":"Piccolo"},{"icao":"PINO","code":"LL1P","manufacturer":"GENERAL AVIA","model":"F22 Pinguino, Pinguino Sprint"},{"icao":"PIPA","code":"LL1P","manufacturer":"PIPISTREL","model":"Panthera"},{"icao":"PISI","code":"LL1P","manufacturer":"PIPISTREL","model":"Sinus"},{"icao":"PIT4","code":"LL1E","manufacturer":"PIPISTREL","model":"Taurus Electro G4"},{"icao":"PITA","code":"LL1P","manufacturer":"PIPISTREL","model":"Taurus 503"},{"icao":"PITE","code":"LL1E","manufacturer":"PIPISTREL","model":"Taurus Electro G2"},{"icao":"PIVE","code":"LL1E","manufacturer":"PIPISTREL","model":"Velis Electro"},{"icao":"PIVI","code":"LL1P","manufacturer":"PIPISTREL","model":"Virus, Surveyor"},{"icao":"PK11","code":"LL1P","manufacturer":"PIK","model":"PIK11 Tumppu"},{"icao":"PK15","code":"LL1P","manufacturer":"PIK","model":"PIK15 Hinu"},{"icao":"PK18","code":"LL1P","manufacturer":"PIK","model":"PIK18 Sytky"},{"icao":"PK19","code":"LL1P","manufacturer":"PIK","model":"PIK19 Muhinu"},{"icao":"PK20","code":"LL1P","manufacturer":"EIRI","model":"PIK20E"},{"icao":"PK21","code":"LL1P","manufacturer":"PIK","model":"PIK21 Super Sytky"},{"icao":"PK23","code":"LL1P","manufacturer":"PIK","model":"PIK23 Towmaster, Suhinu"},{"icao":"PK25","code":"LL1P","manufacturer":"PIK","model":"PIK-25 Varttimarkka"},{"icao":"PKAN","code":"LL1P","manufacturer":"UETZ","model":"U3M/4M Pelikan"},{"icao":"PL1","code":"LL1P","manufacturer":"PAZMANY","model":"PL1 Laminar"},{"icao":"PL12","code":"LL1P","manufacturer":"FLIGHT ENGINEERS","model":"PL12 Airtruk"},{"icao":"PL2","code":"LL1P","manufacturer":"PAZMANY","model":"PL2"},{"icao":"PL4","code":"LL1P","manufacturer":"PAZMANY","model":"PL4"},{"icao":"PL9","code":"LL1P","manufacturer":"PAZMANY","model":"PL9 Stork"},{"icao":"PLUS","code":"LL1P","manufacturer":"TAYLORCRAFT AEROPLANES, UK","model":"Plus C/D (Auster 1)"},{"icao":"PNR2","code":"LL1P","manufacturer":"ALPI","model":"Pioneer 200/230"},{"icao":"PNR3","code":"LL1P","manufacturer":"ALPI","model":"Pioneer 300"},{"icao":"PNR4","code":"LL1P","manufacturer":"ALPI","model":"Pioneer 400"},{"icao":"PNTH","code":"LL1P","manufacturer":"SPORT PERFORMANCE","model":"Panther"},{"icao":"PO2","code":"LL1P","manufacturer":"CSS","model":"CSS13"},{"icao":"PO60","code":"LL1P","manufacturer":"POTEZ","model":"60/600 Sauterelle"},{"icao":"POLI","code":"LL1P","manufacturer":"ALVAREZ","model":"Polliwagen"},{"icao":"PONY","code":"LA1P","manufacturer":"REDA","model":"Pony"},{"icao":"PP2","code":"LL1P","manufacturer":"PILATUS","model":"P2"},{"icao":"PP3","code":"LL1P","manufacturer":"PILATUS","model":"P3"},{"icao":"PPRO","code":"LL1P","manufacturer":"HUNTING","model":"P56 Provost"},{"icao":"PRBP","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Pocket Rocket PR-Bipe"},{"icao":"PRBR","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Pocket Rocket PR-Breeze"},{"icao":"PRCE","code":"LL2P","manufacturer":"PERCIVAL","model":"P57 Sea Prince"},{"icao":"PREN","code":"LL1P","manufacturer":"PERCIVAL","model":"P40 Prentice"},{"icao":"PRET","code":"LL1P","manufacturer":"GM&T","model":"GM&T Pretty Flight"},{"icao":"PREX","code":"LL1P","manufacturer":"PRIVATE EXPLORER","model":"Private Explorer"},{"icao":"PRIM","code":"LL1P","manufacturer":"BLACKSHAPE","model":"Bk-100 Prime"},{"icao":"PRM1","code":"LL2J","manufacturer":"HAWKER BEECHCRAFT CORP","model":"Premier 1, 390"},{"icao":"PROC","code":"LL1P","manufacturer":"PERCIVAL","model":"P28/30/31/34/44 Proctor"},{"icao":"PROT","code":"LL1P","manufacturer":"CSA","model":"Parrot"},{"icao":"PROW","code":"LL1P","manufacturer":"MORSE","model":"364, Prowler, Jaguar"},{"icao":"PRPR","code":"LL1P","manufacturer":"HOWARD HUGHES","model":"Pocket Rocket PR-582"},{"icao":"PRTS","code":"LL2J","manufacturer":"RUTAN","model":"281 Proteus"},{"icao":"PRXT","code":"LL1T","manufacturer":"PRIVATE EXPLORER","model":"T-Explorer"},{"icao":"PSTM","code":"LL1P","manufacturer":"PODESVA","model":"Stearman"},{"icao":"PSW4","code":"LH1T","manufacturer":"PZL-SWIDNIK","model":"AW-009"},{"icao":"PT21","code":"LL1P","manufacturer":"POTTIER","model":"P210 Coati"},{"icao":"PT22","code":"LL1P","manufacturer":"RYAN","model":"PT22 Recruit (ST3KR)"},{"icao":"PT70","code":"LL1P","manufacturer":"POTTIER","model":"P170"},{"icao":"PT80","code":"LL1P","manufacturer":"POTTIER","model":"P180"},{"icao":"PTMS","code":"LL1P","manufacturer":"PITTS","model":"S-12 Macho Stinker, Super Stinker"},{"icao":"PTRL","code":"LL1P","manufacturer":"NASH","model":"Petrel"},{"icao":"PTS1","code":"LL1P","manufacturer":"AEROTEK, US","model":"Pitts S1 Special"},{"icao":"PTS2","code":"LL1P","manufacturer":"AEROTEK, US","model":"Pitts S2 Special"},{"icao":"PTSS","code":"LL1P","manufacturer":"AVIAT","model":"S111 Super Stinker"},{"icao":"PUL6","code":"LL1P","manufacturer":"PULSAR","model":"Super Pulsar 600"},{"icao":"PULR","code":"LL1P","manufacturer":"P&M AVIATION","model":"PlusR"},{"icao":"PULS","code":"LL1P","manufacturer":"AERO DESIGNS","model":"Pulsar"},{"icao":"PUMA","code":"LH2T","manufacturer":"AEROSPATIALE","model":"SA330 Puma (CH33, HT19)"},{"icao":"PUP","code":"LL1P","manufacturer":"BEAGLE","model":"B121 Pup"},{"icao":"PURS","code":"LL1P","manufacturer":"RANS","model":"S11 Pursuit"},{"icao":"PUSH","code":"LL1P","manufacturer":"PRESCOTT","model":"Pusher"},{"icao":"PW4","code":"LL1P","manufacturer":"POLITECHNIKA WARSZAWSKA","model":"PW4"},{"icao":"PZ01","code":"LL1P","manufacturer":"LIPNUR","model":"PZL101 Gawron"},{"icao":"PZ02","code":"LL1P","manufacturer":"PZL\ufffdOKECIE","model":"PZL102 Kos"},{"icao":"PZ04","code":"LL1P","manufacturer":"LIPNUR","model":"Gelatik"},{"icao":"PZ05","code":"LL1P","manufacturer":"PZL\ufffdOKECIE","model":"PZL105 Flaming"},{"icao":"PZ06","code":"LL1P","manufacturer":"PZL\ufffdOKECIE","model":"PZL106A/AR/AS/B/BR/BS Kruk"},{"icao":"PZ12","code":"LL1P","manufacturer":"PZL-OKECIE","model":"PZL-112 Koliber Junior"},{"icao":"PZ26","code":"LL1P","manufacturer":"AGROLOT","model":"PZL126 Mr\ufffdwka"},{"icao":"PZ3T","code":"LL1T","manufacturer":"PZL\ufffdOKECIE","model":"PZL130 Orlik"},{"icao":"PZ4M","code":"LL1P","manufacturer":"PZL\ufffdOKECIE","model":"PZL104M Wilga 2000"},{"icao":"PZ6T","code":"LL1T","manufacturer":"PZL\ufffdOKECIE","model":"PZL106AT/BT Turbo Kruk, Turbo Javelin"},{"icao":"Q01","code":"LL1P","manufacturer":"REINER STEMME","model":"Q-01"},{"icao":"Q1","code":"LL1P","manufacturer":"GENERAL ATOMICS","model":"MQ-1 Gray Eagle, MQ-1 Predator, MQ-1 Warrior, RQ-1 Predator"},{"icao":"Q25","code":"ML1J","manufacturer":"BOEING","model":"MQ-25 Stingray"},{"icao":"Q4","code":"ML1J","manufacturer":"NORTHROP GRUMMAN","model":"EQ-4 Global Hawk, MQ4- Triton, RQ-4 EuroHawk, RQ-4 Global Hawk"},{"icao":"Q5","code":"ML2J","manufacturer":"HONGDU","model":"Q5, A5"},{"icao":"Q9","code":"LL1T","manufacturer":"GENERAL ATOMICS","model":"MQ-9 Guardian, MQ-9 Ikhana, MQ-9 Predator B, MQ-9 Reaper"},{"icao":"QAIL","code":"LL1P","manufacturer":"AEROSPORT","model":"Quail"},{"icao":"QALT","code":"LL1P","manufacturer":"FMP","model":"Qualt"},{"icao":"QEST","code":"LL1P","manufacturer":"OMNI\ufffdWELD","model":"Questor"},{"icao":"QIC2","code":"LL1P","manufacturer":"QUICKIE","model":"Quickie Q2/Q200"},{"icao":"QINT","code":"LL1P","manufacturer":"SCHEMPP-HIRTH","model":"Quintus"},{"icao":"QR01","code":"LL1P","manufacturer":"QUERCY","model":"CQR-01"},{"icao":"QUAS","code":"LL1P","manufacturer":"AEROALCOOL","model":"Quasar Lite"},{"icao":"QUIC","code":"LL1P","manufacturer":"QUICKIE","model":"Quickie"},{"icao":"R100","code":"LL1P","manufacturer":"ROBIN","model":"R1180 Aiglon"},{"icao":"R109","code":"LL1P","manufacturer":"AIRCRAFT SPRUCE","model":"DR109"},{"icao":"R11","code":"LL1P","manufacturer":"RUPERT","model":"R11"},{"icao":"R135","code":"HL4J","manufacturer":"BOEING","model":"RC135"},{"icao":"R185","code":"LL1P","manufacturer":"JOHNSON","model":"Rocket 185"},{"icao":"R2","code":"LS1P","manufacturer":"SAU","model":"R02 Robert"},{"icao":"R200","code":"LL1P","manufacturer":"ROBIN","model":"R2100/2112/2160, Alpha, Alpha Sport, Super Club"},{"icao":"R22","code":"LH1P","manufacturer":"ROBINSON","model":"R22 Beta, Mariner"},{"icao":"R2TH","code":"LL1J","manufacturer":"DASA","model":"FR06 FanRanger, Ranger 2000"},{"icao":"R300","code":"LL1P","manufacturer":"ROBIN","model":"R300/3000/3100/3120/3140"},{"icao":"R4","code":"LH1P","manufacturer":"SIKORSKY","model":"R4, H4 Hoverfly"},{"icao":"R44","code":"LH1P","manufacturer":"ROBINSON","model":"R44 Astro, Clipper, Raven"},{"icao":"R66","code":"LH1T","manufacturer":"ROBINSON","model":"R-66"},{"icao":"R721","code":"ML3J","manufacturer":"BOEING","model":"727100RE SUPER 27"},{"icao":"R722","code":"ML3J","manufacturer":"BOEING","model":"727200RE SUPER 27"},{"icao":"R90F","code":"LL1P","manufacturer":"RUSCHMEYER","model":"R90230FG"},{"icao":"R90R","code":"LL1P","manufacturer":"RUSCHMEYER","model":"R90230RG, MF85"},{"icao":"R90T","code":"LL1T","manufacturer":"RUSCHMEYER","model":"R90420AT"},{"icao":"RA14","code":"LL1P","manufacturer":"ADAM","model":"RA14 Loisirs"},{"icao":"RA17","code":"LL1P","manufacturer":"ADAM","model":"RA17"},{"icao":"RAF2","code":"LG1P","manufacturer":"ROTARY AIR FORCE","model":"RAF2000"},{"icao":"RAID","code":"LL1P","manufacturer":"SKY RAIDER","model":"Super Sky Raider"},{"icao":"RAIL","code":"LL1P","manufacturer":"AEROSPORT","model":"Rail"},{"icao":"RALL","code":"LL1P","manufacturer":"MORANE\ufffdSAULNIER","model":"MS880 to 893 Rallye, Rallye Club, Super Rallye, Rallye Commadore"},{"icao":"RANG","code":"LL1P","manufacturer":"NAVION","model":"Rangemaster"},{"icao":"RARO","code":"LL1P","manufacturer":"NEW CENTURY","model":"Radial Rocket"},{"icao":"RAV3","code":"LL1P","manufacturer":"RAVIN","model":"Ravin 300"},{"icao":"RAV5","code":"LL1P","manufacturer":"RAVIN","model":"Ravin 500"},{"icao":"RAVN","code":"ML2P","manufacturer":"WOLFSBERG","model":"Raven 257"},{"icao":"RAZM","code":"LL1P","manufacturer":"SAINT GERMAIN","model":"RazMut"},{"icao":"RBEL","code":"LL1P","manufacturer":"MURPHY","model":"Rebel, Rebel Elite"},{"icao":"RC3","code":"LA1P","manufacturer":"REPUBLIC","model":"RC3 Seabee"},{"icao":"RC70","code":"LL2P","manufacturer":"FUJI","model":"FA300"},{"icao":"RCAL","code":"LL1P","manufacturer":"MURPHY","model":"Radical"},{"icao":"RD03","code":"LL1P","manufacturer":"DURUBLE","model":"RD03 Edelweiss"},{"icao":"RD20","code":"LL1P","manufacturer":"DENIZE","model":"RD20/205 Raid Driver"},{"icao":"RDH2","code":"LL1P","manufacturer":"REDFERN","model":"DH2"},{"icao":"RELI","code":"LL1P","manufacturer":"STINSON","model":"SR, V77 Reliant (AT19)"},{"icao":"RENE","code":"LL1P","manufacturer":"MURPHY","model":"Renegade"},{"icao":"REV6","code":"LG1T","manufacturer":"GROEN","model":"Revcon 6G"},{"icao":"RF10","code":"LL1P","manufacturer":"AEROMOT","model":"AMT100/200/300 Ximango, Super Ximango, Turbo Ximango Shark"},{"icao":"RF3","code":"LL1P","manufacturer":"ALPAVIA","model":"RF3"},{"icao":"RF4","code":"LL1P","manufacturer":"ALPAVIA","model":"RF4"},{"icao":"RF47","code":"LL1P","manufacturer":"ARC ATLANTIQUE","model":"RF47"},{"icao":"RF5","code":"LL1P","manufacturer":"AERO JAEN","model":"RF5 Serrania"},{"icao":"RF6","code":"LL1P","manufacturer":"FOURNIER","model":"RF6"},{"icao":"RF9","code":"LL1P","manufacturer":"ABS","model":"RF9"},{"icao":"RFAL","code":"ML2J","manufacturer":"DASSAULT","model":"Rafale"},{"icao":"RGNT","code":"LL1P","manufacturer":"NEIVA","model":"N591/592 Regente (C42, L42)"},{"icao":"RISN","code":"LL1P","manufacturer":"SWISS EXCELLENCE","model":"Risen, Siren"},{"icao":"RJ03","code":"LL1P","manufacturer":"JUNQUA","model":"RJ03 Ibis"},{"icao":"RJ1H","code":"ML4J","manufacturer":"AI (R)","model":"RJ100 Avroliner"},{"icao":"RJ70","code":"ML4J","manufacturer":"BRITISH AEROSPACE","model":"RJ70"},{"icao":"RJ85","code":"ML4J","manufacturer":"AI (R)","model":"RJ85 Avroliner"},{"icao":"RK5","code":"LL1P","manufacturer":"KALINAUSKAS","model":"RK-5"},{"icao":"RLU1","code":"LL1P","manufacturer":"RLU","model":"RLU1 Breezy"},{"icao":"RMOU","code":"LH1T","manufacturer":"HILLBERG","model":"EH101 Rotormouse"},{"icao":"RNGR","code":"LL1P","manufacturer":"DAC","model":"RangeR"},{"icao":"ROAR","code":"LL1-","manufacturer":"VELOCITY","model":"Rocket Racer"},{"icao":"RODS","code":"LL1P","manufacturer":"AIRCRAFT SPRUCE","model":"DR107 One Design"},{"icao":"ROND","code":"LL1P","manufacturer":"AMBROSINI","model":"F4 Rondone"},{"icao":"ROSE","code":"LL1P","manufacturer":"MAUPIN","model":"Windrose"},{"icao":"RP1","code":"LH2T","manufacturer":"MITSUBISHI","model":"RP1"},{"icao":"RPUP","code":"LG1P","manufacturer":"LITTLE WING","model":"LW2+2 RotoPup"},{"icao":"RS12","code":"LL1P","manufacturer":"RANS","model":"S12 Airaile, Super Airaile"},{"icao":"RS18","code":"LL1P","manufacturer":"SPORTAVIA\ufffdPUTZER","model":"RS180 Sportsman"},{"icao":"RS20","code":"LL1P","manufacturer":"RANS","model":"S-20 Raven"},{"icao":"RS21","code":"LL1P","manufacturer":"RANS","model":"S-21 Outbound"},{"icao":"RTA4","code":"LL1P","manufacturer":"RTAF","model":"RTAF4 Chandra"},{"icao":"RUBI","code":"LL1P","manufacturer":"SCINTEX","model":"ML250 Rubis"},{"icao":"RV10","code":"LL1P","manufacturer":"VAN\'S","model":"RV-10"},{"icao":"RV12","code":"LL1P","manufacturer":"VAN\'S","model":"RV-12"},{"icao":"RV14","code":"LL1P","manufacturer":"VAN\'S","model":"RV-14"},{"icao":"RV3","code":"LL1P","manufacturer":"VAN?S","model":"RV-3"},{"icao":"RV4","code":"LL1P","manufacturer":"VAN?S","model":"RV-4"},{"icao":"RV4T","code":"LL1T","manufacturer":"VAN\'S","model":"RV-4T"},{"icao":"RV6","code":"LL1P","manufacturer":"AIEP","model":"Air Beetle"},{"icao":"RV7","code":"LL1P","manufacturer":"VAN?S","model":"RV-7"},{"icao":"RV8","code":"LL1P","manufacturer":"VAN?S","model":"RV-8"},{"icao":"RV9","code":"LL1P","manufacturer":"VAN\'S","model":"RV-9"},{"icao":"RVAL","code":"MH2T","manufacturer":"ATLAS","model":"CSH2 Rooivalk"},{"icao":"RW19","code":"LL1P","manufacturer":"RAGWING","model":"RW-19 Stork"},{"icao":"RW20","code":"LL1P","manufacturer":"RAGWING","model":"RW-20 Stork"},{"icao":"RW22","code":"LL1P","manufacturer":"RAGWING","model":"RW-22 Tiger Moth"},{"icao":"RW26","code":"LL1P","manufacturer":"RAGWING","model":"RW-26 Special 2"},{"icao":"RW3","code":"LL1P","manufacturer":"RHEIN","model":"RW3 Multoplan, Passat"},{"icao":"RX1H","code":"ML4J","manufacturer":"BAE SYSTEMS","model":"Avro RJX100"},{"icao":"RX70","code":"ML4J","manufacturer":"BAE SYSTEMS","model":"Avro RJX70"},{"icao":"RX85","code":"ML4J","manufacturer":"BAE SYSTEMS","model":"Avro RJX85"},{"icao":"RYSA","code":"LL2T","manufacturer":"PROGRESS","model":"Rysachok"},{"icao":"RYST","code":"LL1P","manufacturer":"RYAN","model":"STA, STM, STR (YPT16, PT20)"},{"icao":"S05F","code":"LL1P","manufacturer":"SIAI\ufffdMARCHETTI","model":"S20518F/20F"},{"icao":"S05R","code":"LL1P","manufacturer":"SIAI\ufffdMARCHETTI","model":"S20518R/20R/22R"},{"icao":"S1","code":"LL1P","manufacturer":"ARCTIC","model":"S1 Arctic Tern"},{"icao":"S10","code":"LL1P","manufacturer":"STINSON","model":"10, 105, HW75, HW80, Voyager"},{"icao":"S107","code":"LS1P","manufacturer":"SPRATT","model":"107"},{"icao":"S108","code":"LL1P","manufacturer":"PIPER","model":"108 Voyager, Station Wagon"},{"icao":"S10S","code":"LL1P","manufacturer":"STEMME","model":"S-10 Chrysalis"},{"icao":"S11","code":"LL1P","manufacturer":"FOKKER","model":"S11 Instructor"},{"icao":"S12","code":"LA1P","manufacturer":"SPENCER","model":"S12 Air Car"},{"icao":"S122","code":"LL2P","manufacturer":"SKYLINE","model":"SL-122  Pchelka"},{"icao":"S12S","code":"LL1P","manufacturer":"STEMME","model":"S-12 Twin Voyager"},{"icao":"S15S","code":"LL1P","manufacturer":"STEMME","model":"S-15"},{"icao":"S15U","code":"LL1P","manufacturer":"SAFRAN","model":"A-15 Patroller"},{"icao":"S200","code":"LL1J","manufacturer":"SIPA","model":"S200 Minijet"},{"icao":"S202","code":"LA2P","manufacturer":"SGAU","model":"S202"},{"icao":"S208","code":"LL1P","manufacturer":"SIAI\ufffdMARCHETTI","model":"S208"},{"icao":"S21","code":"LL1P","manufacturer":"MACDONALD","model":"S21"},{"icao":"S210","code":"ML2J","manufacturer":"AEROSPATIALE","model":"SE210 Caravelle"},{"icao":"S211","code":"LL1J","manufacturer":"PADC","model":"S211"},{"icao":"S223","code":"LL1P","manufacturer":"CASA","model":"223 Flamingo"},{"icao":"S22T","code":"LL1P","manufacturer":"CIRRUS","model":"SR22 Turbo"},{"icao":"S274","code":"LH1T","manufacturer":"IRGC","model":"Shahed 274"},{"icao":"S278","code":"LH1T","manufacturer":"HESA","model":"Shahed OH-78"},{"icao":"S285","code":"LH1T","manufacturer":"HESA","model":"Shahed AH-85"},{"icao":"S2P","code":"ML2P","manufacturer":"CONAIR","model":"Firecat"},{"icao":"S2T","code":"ML2T","manufacturer":"CONAIR","model":"Turbo Firecat"},{"icao":"S3","code":"ML2J","manufacturer":"LOCKHEED","model":"S3, ES3, US3 Viking (L394)"},{"icao":"S330","code":"LH1T","manufacturer":"SCHWEIZER","model":"269D 330"},{"icao":"S355","code":"LL1P","manufacturer":"SCALED","model":"355 Firebird"},{"icao":"S360","code":"LH1T","manufacturer":"AEROSPATIALE","model":"SA360/361 Dauphin"},{"icao":"S37","code":"ML2J","manufacturer":"SUKHOI","model":"S37 Berkut"},{"icao":"S38","code":"LA2P","manufacturer":"SIKORSKY","model":"S38, Replica"},{"icao":"S39","code":"LA1P","manufacturer":"SIKORSKY","model":"S-39"},{"icao":"S4","code":"LL1P","manufacturer":"ARCTIC","model":"S4 Privateer"},{"icao":"S400","code":"LS2P","manufacturer":"SGAU","model":"S400 Kapitan"},{"icao":"S434","code":"LH1T","manufacturer":"SIKORSKY","model":"S-434"},{"icao":"S45","code":"LL1P","manufacturer":"PARTENAIR","model":"S45 Mystere"},{"icao":"S450","code":"LL1P","manufacturer":"AERO-EAST-EUROPE","model":"SILA-450"},{"icao":"S51","code":"LH1P","manufacturer":"SIKORSKY","model":"S51 (H5, R5, HO3S)"},{"icao":"S51D","code":"LL1P","manufacturer":"STEWART AIRCRAFT, US","model":"S51D"},{"icao":"S52","code":"LH1P","manufacturer":"SIKORSKY","model":"S52 (HO5S)"},{"icao":"S55P","code":"LH1P","manufacturer":"SIKORSKY","model":"S55, S55A/C (H19, CH19, HH19, UH19, HO4S, HRS, Chickasaw)"},{"icao":"S55T","code":"LH1T","manufacturer":"SIKORSKY","model":"S55T"},{"icao":"S58P","code":"LH1P","manufacturer":"SIKORSKY","model":"S58, S58B/C/D (CH34, HH34, SH34, UH34, HSS1, HUS, Chocktaw, Seabat, Seahorse)"},{"icao":"S58T","code":"LH1T","manufacturer":"SIKORSKY","model":"S58T/DT/ET"},{"icao":"S6","code":"LL1P","manufacturer":"STEMME","model":"S-6"},{"icao":"S601","code":"LL2J","manufacturer":"AEROSPATIALE","model":"SN601 Corvette"},{"icao":"S61","code":"MH2T","manufacturer":"AGUSTA","model":"AS61A/N (SH3, ASH61)"},{"icao":"S61R","code":"MH2T","manufacturer":"AGUSTA","model":"AS61R (HH3)"},{"icao":"S62","code":"LH1T","manufacturer":"SIKORSKY","model":"S62 (HH52 Seaguard)"},{"icao":"S64","code":"MH2T","manufacturer":"SIKORSKY","model":"S64 Skycrane (CH54 Tarhe)"},{"icao":"S65C","code":"LH2T","manufacturer":"AEROSPATIALE","model":"SA365C Dauphin 2"},{"icao":"S76","code":"LH2T","manufacturer":"SIKORSKY","model":"S76, H76, AUH76, Spirit, Eagle (HE24)"},{"icao":"S900","code":"LL1P","manufacturer":"SIPA","model":"S901 to 904"},{"icao":"S92","code":"MH2T","manufacturer":"SIKORSKY","model":"S92 Helibus"},{"icao":"S97","code":"LH1T","manufacturer":"SIKORSKY","model":"S-97 Raider"},{"icao":"SA02","code":"LL1P","manufacturer":"K & S","model":"SA102.5 Cavalier"},{"icao":"SA03","code":"LL1P","manufacturer":"K & S","model":"SA103 Cavalier"},{"icao":"SA04","code":"LL1P","manufacturer":"K & S","model":"SA104 Cavalier"},{"icao":"SA05","code":"LL1P","manufacturer":"K & S","model":"SA105 Super Cavalier"},{"icao":"SA10","code":"LL1P","manufacturer":"STOLP","model":"SA100 Starduster"},{"icao":"SA11","code":"LL1P","manufacturer":"STITS","model":"SA11 Playmate"},{"icao":"SA2","code":"LL1P","manufacturer":"ICP","model":"SA-2 Vimana, Rampage"},{"icao":"SA20","code":"LA1P","manufacturer":"BERIEV","model":"SA-20"},{"icao":"SA3","code":"LL1P","manufacturer":"STITS","model":"SA3 Playboy"},{"icao":"SA30","code":"LL1P","manufacturer":"STOLP","model":"SA300 Starduster Too"},{"icao":"SA37","code":"LL1P","manufacturer":"SCHWEIZER","model":"SA237A Condor (RG8)"},{"icao":"SA38","code":"LL2P","manufacturer":"SCHWEIZER","model":"SA238A Twin Condor (RU38)"},{"icao":"SA50","code":"LL1P","manufacturer":"STOLP","model":"SA500 Starlet"},{"icao":"SA6","code":"LL1P","manufacturer":"STITS","model":"SA6 FlutRBug"},{"icao":"SA6E","code":"LL1T","manufacturer":"SREYA","model":"SA-6 Envoy"},{"icao":"SA7","code":"LL1P","manufacturer":"STITS","model":"SA7 SkyCoupe"},{"icao":"SA70","code":"LL1P","manufacturer":"STOLP","model":"SA700 Acroduster"},{"icao":"SA75","code":"LL1P","manufacturer":"STOLP","model":"SA750 Acroduster Too"},{"icao":"SA8T","code":"LL2T","manufacturer":"SCHWEIZER","model":"SA-2-38B/RU-38B Twin Condor"},{"icao":"SAB2","code":"LL1P","manufacturer":"ARNET PEREYRA","model":"Sabre 2"},{"icao":"SABA","code":"LL1P","manufacturer":"PARAVAR PARS","model":"Saba"},{"icao":"SACE","code":"LL1P","manufacturer":"ACE","model":"Super Ace"},{"icao":"SACR","code":"LL1P","manufacturer":"SMITH, BARRY, US","model":"Acro Advanced"},{"icao":"SAFF","code":"LL1P","manufacturer":"HALSTED","model":"Saffire"},{"icao":"SAH1","code":"LL1P","manufacturer":"FLS","model":"Sprint"},{"icao":"SAKO","code":"LL1P","manufacturer":"RANS","model":"S10 Sakota"},{"icao":"SALB","code":"LL1P","manufacturer":"SKYGEAR","model":"Albatross"},{"icao":"SAM","code":"LL1P","manufacturer":"SAM AIRCRAFT","model":"Sam"},{"icao":"SAND","code":"MS4P","manufacturer":"SHORT","model":"S25 Sandringham"},{"icao":"SAPH","code":"LL1P","manufacturer":"PIEL","model":"CP1320 Saphir"},{"icao":"SASH","code":"LL2P","manufacturer":"SHARK AIRCRAFT","model":"Shark"},{"icao":"SASP","code":"LL1P","manufacturer":"SUPERMARINE AIRCRAFT","model":"Spitfire Mk25/Mk26"},{"icao":"SASY","code":"LL1P","manufacturer":"PROTECH","model":"PT2 Sassy, ProStar"},{"icao":"SATA","code":"LL2J","manufacturer":"CASA","model":"HA220 Saeta"},{"icao":"SAVA","code":"LL1P","manufacturer":"SADLER","model":"Vampire"},{"icao":"SAVG","code":"LL1P","manufacturer":"ZLIN AVIATION","model":"Savage"},{"icao":"SB05","code":"LL2J","manufacturer":"SAAB","model":"105 (Sk60)"},{"icao":"SB20","code":"ML2T","manufacturer":"SAAB","model":"2000"},{"icao":"SB29","code":"ML1J","manufacturer":"SAAB","model":"29 (J29)"},{"icao":"SB32","code":"ML1J","manufacturer":"SAAB","model":"32 Lansen (J32)"},{"icao":"SB35","code":"ML1J","manufacturer":"SAAB","model":"35 Draken (J35, Sk35, F35, RF35, TF35)"},{"icao":"SB37","code":"ML1J","manufacturer":"SAAB","model":"37 Viggen (AJ37, AJS37, JA37, SF37, SH37, Sk37)"},{"icao":"SB39","code":"ML1J","manufacturer":"SAAB","model":"39 Gripen (JAS39)"},{"icao":"SB7","code":"LL1P","manufacturer":"SEABIRD","model":"SB7 Seeker"},{"icao":"SB91","code":"LL1P","manufacturer":"DE SCHELDE","model":"91 Safir (Sk50)"},{"icao":"SBD","code":"LL1P","manufacturer":"DOUGLAS","model":"SBD, A24 Dauntless"},{"icao":"SBLS","code":"LL2P","manufacturer":"SLIPSTREAM","model":"SkyBlaster"},{"icao":"SBM3","code":"LL1P","manufacturer":"E & K","model":"SBM03 Kos"},{"icao":"SBOY","code":"LL1P","manufacturer":"INTERPLANE","model":"Skyboy"},{"icao":"SBR1","code":"ML2J","manufacturer":"NORTH AMERICAN","model":"NA265 Sabreliner 40/50/60 (T39, CT39, NT39 Sabreliner, Tp86)"},{"icao":"SBR2","code":"ML2J","manufacturer":"NORTH AMERICAN  ROCKWELL","model":"NA265 Sabre 75"},{"icao":"SC01","code":"LL1P","manufacturer":"FFT","model":"SC01 Speed Canard"},{"icao":"SC7","code":"LL2T","manufacturer":"SHORT","model":"SC7 Skyvan, Skyliner"},{"icao":"SCAM","code":"LL1P","manufacturer":"AEROSPORT","model":"Scamp"},{"icao":"SCEP","code":"LL1P","manufacturer":"SLIPSTREAM","model":"Scepter"},{"icao":"SCII","code":"LG1P","manufacturer":"SPORT COPTER","model":"SportCopter 2"},{"icao":"SCOM","code":"LL1P","manufacturer":"SKYGEAR","model":"Comet"},{"icao":"SCOR","code":"LH1P","manufacturer":"ROTORWAY","model":"Scorpion"},{"icao":"SCOU","code":"LH1T","manufacturer":"WESTLAND","model":"Scout"},{"icao":"SCRO","code":"LL1P","manufacturer":"AKAFLIEG MUNCHEN","model":"Mu30 Schlacro"},{"icao":"SCTR","code":"LL1P","manufacturer":"FLAGLOR","model":"Scooter"},{"icao":"SCUB","code":"LL1P","manufacturer":"AERO KUHLMANN","model":"Scub"},{"icao":"SCW1","code":"LL1P","manufacturer":"SCWAL","model":"101"},{"icao":"SD26","code":"LL1P","manufacturer":"SKYDANCER","model":"SD-260"},{"icao":"SD4","code":"LL1P","manufacturer":"TOMARK","model":"SD-4 Viper"},{"icao":"SDUS","code":"LL1P","manufacturer":"STOLP","model":"Super Starduster"},{"icao":"SE5A","code":"LL1P","manufacturer":"RAF","model":"SE5A, Replica"},{"icao":"SE5R","code":"LL1P","manufacturer":"REPLICA PLANS","model":"SE5A Replica"},{"icao":"SEAT","code":"LA1T","manufacturer":"SEAWIND","model":"Turbine Seawind"},{"icao":"SEAW","code":"LA1P","manufacturer":"SEAWIND","model":"Seawind"},{"icao":"SERA","code":"LL1P","manufacturer":"SERVOPLANT","model":"Aerocraft"},{"icao":"SEST","code":"MA1T","manufacturer":"SEASTAR","model":"SeaStar"},{"icao":"SF2","code":"LL1P","manufacturer":"HAPI","model":"SF2 Cygnet"},{"icao":"SF23","code":"LL1P","manufacturer":"SCHEIBE","model":"SF23 Sperling"},{"icao":"SF24","code":"LL1P","manufacturer":"SCHEIBE","model":"SF24 Motorspatz"},{"icao":"SF25","code":"LL1P","manufacturer":"LORAVIA","model":"SF25 Falke"},{"icao":"SF27","code":"LL1P","manufacturer":"SCHEIBE","model":"SF27M"},{"icao":"SF28","code":"LL1P","manufacturer":"SCHEIBE","model":"SF28 Tandem Falke"},{"icao":"SF31","code":"LL1P","manufacturer":"SPORTAVIA\ufffdPUTZER","model":"SFS31 Milan"},{"icao":"SF32","code":"LL1P","manufacturer":"SCHEIBE","model":"SF32"},{"icao":"SF34","code":"ML2T","manufacturer":"SAAB","model":"340 (SF-340, S100 Argus, Tp100)"},{"icao":"SF35","code":"LL1P","manufacturer":"SCHEIBE","model":"SF35"},{"icao":"SF36","code":"LL1P","manufacturer":"SCHEIBE","model":"SF36"},{"icao":"SF50","code":"LL1J","manufacturer":"CIRRUS","model":"Vision"},{"icao":"SG37","code":"LL1P","manufacturer":"SCHWEIZER","model":"SGM237 (TG7)"},{"icao":"SG70","code":"LL1P","manufacturer":"GLASS","model":"SG-70 STOLGlass"},{"icao":"SG92","code":"LL1T","manufacturer":"TECHNOAVIA","model":"SM-92T/SMG-92 Turbo Finist"},{"icao":"SGRA","code":"LL1P","manufacturer":"SG AVIATION","model":"Rally"},{"icao":"SGUP","code":"ML4T","manufacturer":"AERO SPACELINES","model":"377SGT Super Guppy"},{"icao":"SH09","code":"LH1T","manufacturer":"KOPTER","model":"SH-09"},{"icao":"SH33","code":"ML2T","manufacturer":"SHORT","model":"330, Sherpa (C23), SD330"},{"icao":"SH36","code":"ML2T","manufacturer":"SHORT","model":"360, SD360"},{"icao":"SH4","code":"LH1P","manufacturer":"SILVERCRAFT","model":"SH4"},{"icao":"SH5","code":"MS4T","manufacturer":"HARBIN","model":"SH5, PS5"},{"icao":"SHAC","code":"ML4P","manufacturer":"AVRO","model":"696 Shackleton"},{"icao":"SHAK","code":"LA1P","manufacturer":"FREEDOM MASTER","model":"FM2 Air Shark"},{"icao":"SHAW","code":"ML1J","manufacturer":"ARMSTRONG WHITWORTH","model":"Sea Hawk"},{"icao":"SHEA","code":"LA1P","manufacturer":"SEAFLIGHT","model":"Shearwater"},{"icao":"SHEK","code":"LL1P","manufacturer":"RANS","model":"S16 Shekari"},{"icao":"SHER","code":"LL1P","manufacturer":"SHERPA","model":"Sherpa"},{"icao":"SHIP","code":"----","manufacturer":"-","model":"Airship"},{"icao":"SHOE","code":"LL1P","manufacturer":"MERCURY","model":"Shoestring"},{"icao":"SHOP","code":"LL1P","manufacturer":"SALVAY\ufffdSTARK","model":"Skyhopper"},{"icao":"SHOR","code":"LL1P","manufacturer":"HIGHER CLASS","model":"Super Hornet"},{"icao":"SHRK","code":"LL1P","manufacturer":"SHARK AERO","model":"Shark"},{"icao":"SHRT","code":"LL1T","manufacturer":"SHERPA","model":"Sherpa K-650T"},{"icao":"SIDE","code":"LL1P","manufacturer":"SMYTH","model":"S Sidewinder"},{"icao":"SIGM","code":"LL1P","manufacturer":"ELITAR","model":"Sigma"},{"icao":"SILH","code":"LL1P","manufacturer":"LUNDS TEKNISKE","model":"SA60 Silhouette"},{"icao":"SIR2","code":"LL1P","manufacturer":"RHEIN","model":"Sirius 2"},{"icao":"SIRA","code":"LL1P","manufacturer":"TECNAM","model":"Sierra P2002"},{"icao":"SJ30","code":"LL2J","manufacturer":"SINO SWEARINGEN","model":"SJ30"},{"icao":"SK10","code":"LL1P","manufacturer":"SKYETON","model":"K-10 Swift"},{"icao":"SK70","code":"LL2P","manufacturer":"STARKRAFT","model":"SK700"},{"icao":"SKAR","code":"LL1P","manufacturer":"III","model":"Sky Arrow"},{"icao":"SKIF","code":"LA1P","manufacturer":"AEROLITES","model":"AeroSkiff"},{"icao":"SKIM","code":"LA1P","manufacturer":"COLONIAL","model":"C1/2 Skimmer"},{"icao":"SKRA","code":"LL1P","manufacturer":"SYNAIRGIE","model":"Sky Ranger"},{"icao":"SKYC","code":"LL2P","manufacturer":"OMA SUD","model":"Skycar"},{"icao":"SKYO","code":"LL1P","manufacturer":"SKYOTE AEROMARINE","model":"Skyote"},{"icao":"SKYR","code":"LL1P","manufacturer":"COMMONWEALTH, US","model":"185 Skyranger"},{"icao":"SL1","code":"LL1P","manufacturer":"STAR\ufffdLITE","model":"SL1 StarLite"},{"icao":"SL39","code":"LL1P","manufacturer":"MAPO","model":"SL39"},{"icao":"SL90","code":"LL1P","manufacturer":"AVIOTECHNICA","model":"SL90 Leshii"},{"icao":"SLCH","code":"HL6J","manufacturer":"SCALED","model":"351 Stratolaunch"},{"icao":"SLG2","code":"LL1P","manufacturer":"AIRPLANE FACTORY","model":"Sling LSA"},{"icao":"SLG4","code":"LL1P","manufacturer":"AIRPLANE FACTORY","model":"Sling 4"},{"icao":"SLH4","code":"LL1P","manufacturer":"SLING AIRCRAFT","model":"Sling 4 High Wing"},{"icao":"SLK3","code":"LL1P","manufacturer":"SLICK","model":"360"},{"icao":"SLK5","code":"LL1P","manufacturer":"SLICK","model":"540"},{"icao":"SM01","code":"LL1P","manufacturer":"STERN\ufffdMALLICK","model":"SM01 Vega"},{"icao":"SM19","code":"LL1T","manufacturer":"SIAI\ufffdMARCHETTI","model":"SM1019"},{"icao":"SM20","code":"LL1T","manufacturer":"TECHNOAVIA","model":"SM-2000"},{"icao":"SM60","code":"LL3P","manufacturer":"STINSON","model":"SM-6000 Tri-Motor"},{"icao":"SM92","code":"LL1P","manufacturer":"TECHNOAVIA","model":"SM92 Finist"},{"icao":"SMAX","code":"LA1P","manufacturer":"AIRMAX","model":"M-22 SeaMax"},{"icao":"SMB2","code":"ML1J","manufacturer":"DASSAULT","model":"Super Myst\ufffdre B2"},{"icao":"SNAD","code":"LG1P","manufacturer":"CALUMET","model":"Snobird Adventurer"},{"icao":"SNAP","code":"LL1P","manufacturer":"TECNAM","model":"FR-01/100 Snap"},{"icao":"SNGY","code":"LL1P","manufacturer":"LANCAIR","model":"T-90 Calima, Synergy"},{"icao":"SNOS","code":"LL1P","manufacturer":"VSR","model":"SR1 Snoshoo"},{"icao":"SNS2","code":"LL1P","manufacturer":"SORRELL","model":"SNS2 Guppy"},{"icao":"SNS7","code":"LL1P","manufacturer":"SORRELL","model":"SNS7 Hiperbipe"},{"icao":"SNS9","code":"LL1P","manufacturer":"SORRELL","model":"SNS9 EXP2"},{"icao":"SNTA","code":"LL1P","manufacturer":"AIRSPORT","model":"Sonata"},{"icao":"SOK2","code":"LL1P","manufacturer":"SOKO","model":"2"},{"icao":"SOKL","code":"LL1P","manufacturer":"MRAZ","model":"M1 Sokol"},{"icao":"SOL1","code":"LL4E","manufacturer":"SOLAR IMPULSE","model":"1"},{"icao":"SOL2","code":"LL4E","manufacturer":"SOLAR IMPULSE","model":"2"},{"icao":"SOLI","code":"LL1P","manufacturer":"RUTAN","model":"77 Solitaire"},{"icao":"SONX","code":"LL1P","manufacturer":"SONEX","model":"Sonex"},{"icao":"SORA","code":"LL1P","manufacturer":"ACS","model":"ACS-100 Sora"},{"icao":"SP20","code":"LL1P","manufacturer":"MICCO","model":"SP20/26"},{"icao":"SP33","code":"LL2J","manufacturer":"SPECTRUM","model":"S-33 Independence"},{"icao":"SP55","code":"LL1P","manufacturer":"TECHNOAVIA","model":"SP-55"},{"icao":"SP6E","code":"LL1P","manufacturer":"SAUSER","model":"P6E Replica"},{"icao":"SP7","code":"LL1P","manufacturer":"SPARTAN","model":"7 Executive (UC71)"},{"icao":"SP91","code":"LL1P","manufacturer":"TECHNOAVIA","model":"SP91 Slava"},{"icao":"SP95","code":"LL1P","manufacturer":"TECHNOAVIA","model":"SP95"},{"icao":"SPA2","code":"LL1P","manufacturer":"STARK\ufffdTREFETHEN","model":"SportAire 2"},{"icao":"SPAR","code":"LL1P","manufacturer":"III","model":"Speed Arrow"},{"icao":"SPC2","code":"LL1P","manufacturer":"SPECTER","model":"Specter 2"},{"icao":"SPDR","code":"LL1P","manufacturer":"REARWIN","model":"6000 Speedster"},{"icao":"SPEL","code":"LL1P","manufacturer":"LOEHLE","model":"Spitfire Elite"},{"icao":"SPGY","code":"LG1P","manufacturer":"AIRCRAFT DESIGNS","model":"Sportster Gyro"},{"icao":"SPHA","code":"LG1P","manufacturer":"AMERICAN AUTOGYRO","model":"SparrowHawk, Spinus"},{"icao":"SPIR","code":"LL1P","manufacturer":"QUESTAIR","model":"Spirit"},{"icao":"SPIT","code":"LL1P","manufacturer":"SUPERMARINE","model":"Spitfire, Seafire"},{"icao":"SPOR","code":"LL1P","manufacturer":"AMAX","model":"Sport 1700"},{"icao":"SPR2","code":"LL1P","manufacturer":"CARLSON","model":"Sparrow 2, Sparrowette"},{"icao":"SPRT","code":"LL1P","manufacturer":"PRACTAVIA","model":"Sprite"},{"icao":"SPST","code":"LL1P","manufacturer":"REARWIN","model":"7000, 8500, 9000 Sportster"},{"icao":"SPT1","code":"LL1P","manufacturer":"SPITFIRE","model":"Mark 1"},{"icao":"SPUP","code":"LL1P","manufacturer":"AIRDROME AEROPLANES","model":"Sopwith Pup Replica"},{"icao":"SQ2T","code":"LL1P","manufacturer":"GLASSIC","model":"SQ2000"},{"icao":"SQES","code":"LL2P","manufacturer":"INNOVATION","model":"SkyQuest"},{"icao":"SR01","code":"LL1P","manufacturer":"EURODISPLAY","model":"SR-01 Magic"},{"icao":"SR20","code":"LL1P","manufacturer":"CIRRUS","model":"SR20"},{"icao":"SR22","code":"LL1P","manufacturer":"CIRRUS","model":"SR22"},{"icao":"SR71","code":"ML2J","manufacturer":"LOCKHEED","model":"SR71 Blackbird"},{"icao":"SRAC","code":"LL1P","manufacturer":"SPORT RACER","model":"Sport Racer"},{"icao":"SRAI","code":"LL1P","manufacturer":"GREAT PLAINS","model":"Sonerai"},{"icao":"SRAS","code":"LL1P","manufacturer":"D?APUZZO","model":"PJ260, D260/295 Senior Aero Sport"},{"icao":"SRAY","code":"LA1P","manufacturer":"DORNIER","model":"Do-S S-Ray"},{"icao":"SREY","code":"LA1P","manufacturer":"PROGRESSIVE AERODYNE","model":"SeaRey"},{"icao":"SS2","code":"ML1-","manufacturer":"RUTAN","model":"339 Space Ship Two"},{"icao":"SS2P","code":"LL1P","manufacturer":"AERO COMMANDER","model":"S2 Ag Commander"},{"icao":"SS2T","code":"LL1T","manufacturer":"AYRES","model":"S2RT11/T15/T34/T45/T65/G1/G6/G10 Turbo Thrush, V1 Vigilante"},{"icao":"SSAB","code":"ML1J","manufacturer":"NORTH AMERICAN","model":"F100 Super Sabre"},{"icao":"SSC","code":"LG1P","manufacturer":"BUTTERFLY","model":"Super Sky Cycle"},{"icao":"SSTM","code":"LA1P","manufacturer":"SG AVIATION","model":"Sea Storm"},{"icao":"ST1","code":"LL2P","manufacturer":"PHILLIPS","model":"ST1 Speedtwin"},{"icao":"ST10","code":"LL1P","manufacturer":"SOCATA","model":"ST10 Diplomate, Provence, Super Horizon"},{"icao":"ST3","code":"LL1P","manufacturer":"STEARMAN","model":"C-3"},{"icao":"ST30","code":"LL1P","manufacturer":"STAUDACHER","model":"S-300"},{"icao":"ST4","code":"LL1P","manufacturer":"STEARMAN","model":"4 Junior Speedmail, Junior Speedmail"},{"icao":"ST50","code":"LL1T","manufacturer":"ISRAVIATION","model":"ST50"},{"icao":"ST6","code":"LL1P","manufacturer":"STEARMAN","model":"YPT-9, 6 Cloudboy"},{"icao":"ST60","code":"LL1P","manufacturer":"STAUDACHER","model":"S-600"},{"icao":"ST75","code":"LL1P","manufacturer":"BOEING","model":"75 Kaydet (PT13, PT17, PT18, PT27, N2S)"},{"icao":"ST87","code":"LL1P","manufacturer":"STERN","model":"ST87 Europlane"},{"icao":"STAL","code":"LL1P","manufacturer":"AIRCRAFT DESIGNS","model":"Stallion, Super Stallion"},{"icao":"STAR","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"2000 Starship"},{"icao":"STAT","code":"LL1T","manufacturer":"AIRCRAFT DESIGNS","model":"Turbine Stallion"},{"icao":"STCH","code":"LL1P","manufacturer":"FLY SYNTHESIS","model":"Storch"},{"icao":"STFF","code":"LL1P","manufacturer":"STATLER","model":"Firefly"},{"icao":"STIL","code":"LL1P","manufacturer":"TERZI","model":"T9 Stiletto"},{"icao":"STLN","code":"LL1T","manufacturer":"HELIO","model":"HST550 Stallion (AU24)"},{"icao":"STOR","code":"LL1P","manufacturer":"STORCH AVIATION","model":"SS4 Storch, Super Storch"},{"icao":"STR2","code":"LL1P","manufacturer":"STROJNIK","model":"S2"},{"icao":"STRA","code":"LL1P","manufacturer":"STRIPLIN","model":"Lone Ranger, Sky Ranger"},{"icao":"STRE","code":"LL1P","manufacturer":"TL ULTRALIGHT","model":"Stream"},{"icao":"STRI","code":"LL1P","manufacturer":"SOPWITH","model":"Triplane Replica"},{"icao":"STRK","code":"LL1J","manufacturer":"BRITISH AEROSPACE","model":"BAC-167 Strikemaster"},{"icao":"STRM","code":"LL1P","manufacturer":"SG AVIATION","model":"Storm"},{"icao":"STST","code":"LL1P","manufacturer":"CFM","model":"SA2 Star Streak"},{"icao":"SU15","code":"ML2J","manufacturer":"SUKHOI","model":"Su15"},{"icao":"SU17","code":"ML1J","manufacturer":"SUKHOI","model":"Su17/20/22"},{"icao":"SU24","code":"ML2J","manufacturer":"SUKHOI","model":"Su24"},{"icao":"SU25","code":"ML2J","manufacturer":"SUKHOI","model":"Su25/28/39"},{"icao":"SU26","code":"LL1P","manufacturer":"SUKHOI","model":"Su26"},{"icao":"SU27","code":"ML2J","manufacturer":"SUKHOI","model":"Su27/30/32/33/34/35/37 (J11, JJ11)"},{"icao":"SU29","code":"LL1P","manufacturer":"SUKHOI","model":"Su29"},{"icao":"SU31","code":"LL1P","manufacturer":"SUKHOI","model":"Su31"},{"icao":"SU38","code":"LL1P","manufacturer":"SUKHOI","model":"Su38"},{"icao":"SU49","code":"ML1P","manufacturer":"SUKHOI","model":"Su49"},{"icao":"SU57","code":"ML2J","manufacturer":"SUKHOI","model":"Su-57, T-50"},{"icao":"SU7","code":"ML1J","manufacturer":"SUKHOI","model":"Su7"},{"icao":"SU80","code":"ML2T","manufacturer":"SUKHOI","model":"Su80"},{"icao":"SU95","code":"ML2J","manufacturer":"SUKHOI","model":"Superjet 100-95"},{"icao":"SUBA","code":"LL1P","manufacturer":"FUJI","model":"FA200 Aero Subaru"},{"icao":"SUCO","code":"MH2T","manufacturer":"BELL","model":"AH1W/Z SuperCobra (209)"},{"icao":"SUNB","code":"LL1P","manufacturer":"VERILITE","model":"100 Sunbird"},{"icao":"SUNV","code":"LL1P","manufacturer":"FOKKER","model":"Super Universal"},{"icao":"SURN","code":"MH2T","manufacturer":"KOREA AEROSPACE","model":"Surion"},{"icao":"SURU","code":"LL1P","manufacturer":"IPT","model":"IPT16 Surubim"},{"icao":"SUSO","code":"LL1P","manufacturer":"VSTOL","model":"SS-2000 Super Solution"},{"icao":"SV4","code":"LL1P","manufacturer":"AIAA","model":"SV4"},{"icao":"SVNH","code":"LL1P","manufacturer":"AEROTEC","model":"MXP-740 Savannah"},{"icao":"SW18","code":"LL1P","manufacturer":"SKYWOOD","model":"SW-18 Teddy"},{"icao":"SW2","code":"LL2T","manufacturer":"SWEARINGEN","model":"SA26 Merlin 2"},{"icao":"SW3","code":"LL2T","manufacturer":"FAIRCHILD SWEARINGEN","model":"SA226TB, SA227TT Merlin 3"},{"icao":"SW4","code":"LL2T","manufacturer":"FAIRCHILD SWEARINGEN","model":"SA227AC/AT/BC/CC/DC/PC Merlin 4/23, Metro, Expediter, Fairchild 4C (C26, UC26)"},{"icao":"SWAK","code":"LL1P","manufacturer":"ANGLIN","model":"Space Walker \ufffd"},{"icao":"SWAT","code":"LL1P","manufacturer":"BHARAT","model":"LT1/2 Swati"},{"icao":"SWIF","code":"ML1J","manufacturer":"SUPERMARINE","model":"Swift"},{"icao":"SWIN","code":"LL1P","manufacturer":"S-WING","model":"S-Wing"},{"icao":"SWOR","code":"LL1P","manufacturer":"BLACKBURN","model":"Swordfish"},{"icao":"SX30","code":"LL1P","manufacturer":"SWEARINGEN","model":"SX300"},{"icao":"SYCA","code":"LH1P","manufacturer":"BRISTOL","model":"171 Sycamore"},{"icao":"SYMP","code":"LL1P","manufacturer":"OMF","model":"OMF160 Symphony"},{"icao":"SYNC","code":"LL1P","manufacturer":"FLY SYNTHESIS","model":"Syncro"},{"icao":"SZ45","code":"LL1P","manufacturer":"SZD","model":"SZD45 Ogar"},{"icao":"SZ9M","code":"LL1P","manufacturer":"SZD","model":"SZD9bis Bocian M2000"},{"icao":"T1","code":"LL1J","manufacturer":"FUJI","model":"T1 (T1F)"},{"icao":"T10","code":"LL1P","manufacturer":"TMM-AVIA","model":"T-10 Avia-Tor"},{"icao":"T101","code":"LL1T","manufacturer":"AEROPROGRESS","model":"T101 Grach"},{"icao":"T134","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu134"},{"icao":"T144","code":"HL4J","manufacturer":"TUPOLEV","model":"Tu144"},{"icao":"T154","code":"ML3J","manufacturer":"TUPOLEV","model":"Tu154"},{"icao":"T160","code":"HL4J","manufacturer":"TUPOLEV","model":"Tu160"},{"icao":"T18","code":"LL1P","manufacturer":"SUNDERLAND","model":"S18"},{"icao":"T19","code":"LL1P","manufacturer":"THK","model":"T-19 Turkkusu, Speedfire"},{"icao":"T2","code":"LL2J","manufacturer":"NORTH AMERICAN","model":"T2 Buckeye"},{"icao":"T204","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu204/214/224/234"},{"icao":"T206","code":"LL1P","manufacturer":"CESSNA","model":"Turbo Stationair, Turbo Super Skylane, Turbo Super Skywagon"},{"icao":"T210","code":"LL1P","manufacturer":"CESSNA","model":"Turbo Centurion"},{"icao":"T211","code":"LL1P","manufacturer":"ADAMS","model":"T211"},{"icao":"T22M","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu22M"},{"icao":"T250","code":"LL1P","manufacturer":"ANDERSON\ufffdGREENWOOD","model":"T250 Aries"},{"icao":"T28","code":"LL1P","manufacturer":"HAMILTON","model":"T28 Nomair"},{"icao":"T30","code":"LL1P","manufacturer":"TERZI","model":"T30 Katana"},{"icao":"T33","code":"ML1J","manufacturer":"CANADAIR","model":"T33, CT133 Silver Star (CL30)"},{"icao":"T334","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu334"},{"icao":"T34P","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"T34A/B, E17 Mentor (45)"},{"icao":"T34T","code":"LL1T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"T34C Turbo Mentor"},{"icao":"T35","code":"LL1P","manufacturer":"TEMCO","model":"TE1 Buckaroo (T35)"},{"icao":"T37","code":"LL2J","manufacturer":"CESSNA","model":"T37 (318A/B/C)"},{"icao":"T38","code":"LL2J","manufacturer":"NORTHROP","model":"T38, AT38 Talon (N156T)"},{"icao":"T4","code":"ML2J","manufacturer":"KAWASAKI","model":"T4"},{"icao":"T40","code":"LL1P","manufacturer":"TURNER","model":"T40"},{"icao":"T411","code":"LL1P","manufacturer":"AEROPROGRESS","model":"T411 Aist2"},{"icao":"T415","code":"LL1P","manufacturer":"KHRUNICHEV","model":"T-415 Snegir"},{"icao":"T419","code":"LL1P","manufacturer":"KHRUNICHEV","model":"AT-419 Strekoza"},{"icao":"T5","code":"LL1T","manufacturer":"FUJI","model":"T5 (KM2D/Kai)"},{"icao":"T50","code":"LL2P","manufacturer":"CESSNA","model":"T50 Bobcat (AT8, AT17, UC78, Crane)"},{"icao":"T51","code":"LL1P","manufacturer":"TITAN","model":"T-51 Mustang"},{"icao":"T6","code":"LL1P","manufacturer":"NORTH AMERICAN","model":"T-6 Texan"},{"icao":"T7","code":"LL1T","manufacturer":"FUJI","model":"T-7"},{"icao":"TA15","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"15 Tourist, Foursome"},{"icao":"TA16","code":"LA1P","manufacturer":"THURSTON","model":"TA16 Trojan, Seafire"},{"icao":"TA20","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"20 Ranchwagon, Topper, Seabird, Zephyr 400"},{"icao":"TAA1","code":"LL1P","manufacturer":"TOYOTA","model":"TAA-1"},{"icao":"TAGO","code":"LL1P","manufacturer":"TEAM TANGO","model":"Tango-2"},{"icao":"TAIL","code":"LL1P","manufacturer":"AIRCRAFT SPRUCE","model":"W10 Tailwind"},{"icao":"TAMP","code":"LL1P","manufacturer":"SOCATA","model":"TB9 Tampico, Sprint, GT"},{"icao":"TARO","code":"LL1P","manufacturer":"ANAHUAC","model":"Tauro"},{"icao":"TARR","code":"LL1P","manufacturer":"PELEGRIN","model":"Tarragon"},{"icao":"TAYA","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"A"},{"icao":"TAYB","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"BC, BF, BL, Ace, Sportsman, Traveller"},{"icao":"TAYD","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"DC, DCO, DF, DL (O57, L2)"},{"icao":"TB05","code":"LL1P","manufacturer":"AMC","model":"Texas Bullet 205"},{"icao":"TB20","code":"LL1P","manufacturer":"SOCATA","model":"TB-20 Trinidad"},{"icao":"TB21","code":"LL1P","manufacturer":"SOCATA","model":"TB-21 Trinidad TC"},{"icao":"TB30","code":"LL1P","manufacturer":"AEROSPATIALE","model":"TB30 Epsilon"},{"icao":"TB31","code":"LL1T","manufacturer":"SOCATA","model":"TB31 Omega"},{"icao":"TBEE","code":"LA2P","manufacturer":"UNITED CONSULTANT","model":"UC1 Twin Bee"},{"icao":"TBM","code":"ML1P","manufacturer":"GENERAL MOTORS","model":"TBM Avenger"},{"icao":"TBM7","code":"LL1T","manufacturer":"SOCATA","model":"TBM700"},{"icao":"TBM8","code":"LL1T","manufacturer":"SOCATA","model":"TBM850"},{"icao":"TBM9","code":"LL1T","manufacturer":"SOCATA","model":"TBM900"},{"icao":"TBR3","code":"LL1P","manufacturer":"GOLDEN CIRCLE","model":"T-Bird 2 Cargo, T-Bird 3"},{"icao":"TC2","code":"LL1P","manufacturer":"AERO MIRAGE","model":"TC2"},{"icao":"TCAT","code":"ML2P","manufacturer":"GRUMMAN","model":"F7F Tigercat (G51)"},{"icao":"TCOU","code":"LL2P","manufacturer":"HELIO","model":"H500 Twin Courier (U5)"},{"icao":"TD1","code":"LL1P","manufacturer":"TAIWAN DANCER","model":"TD-1"},{"icao":"TD2","code":"LL1T","manufacturer":"TURBINE DESIGN","model":"TD-2 Tempest"},{"icao":"TD3","code":"LL1P","manufacturer":"TAIWAN DANCER","model":"TD-3 Alluvion Legend"},{"icao":"TEAL","code":"LA1P","manufacturer":"SCHWEIZER","model":"TSC1 Teal"},{"icao":"TERM","code":"LL1P","manufacturer":"SMITH, WILBUR L., US","model":"Termite"},{"icao":"TERR","code":"LL1P","manufacturer":"FOXCON","model":"Terrier"},{"icao":"TEX2","code":"LL1T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"T6,CT156, Texan 2, Harvard 2 (3000)"},{"icao":"TEXA","code":"LL1P","manufacturer":"FLY SYNTHESIS","model":"Texan"},{"icao":"TF19","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"19, F19 Sportsman"},{"icao":"TF21","code":"LL1P","manufacturer":"TAYLOR KITS","model":"TKraft"},{"icao":"TF22","code":"LL1P","manufacturer":"TAYLORCRAFT, US","model":"F22 Classic, TriClassic, Ranger, Trooper, Tracker"},{"icao":"TFK2","code":"LL1P","manufacturer":"TECHNOFLUG","model":"TFK2 Carat"},{"icao":"TFOC","code":"LL1P","manufacturer":"THUNDER WINGS","model":"FockeWulf Fw190"},{"icao":"TFUN","code":"LL1P","manufacturer":"TWI","model":"Taifun"},{"icao":"TGRS","code":"LL1P","manufacturer":"LANCAIR","model":"Tigress"},{"icao":"TIAD","code":"LL1P","manufacturer":"TRIKE ICAROS","model":"Adventure"},{"icao":"TIGR","code":"LH2T","manufacturer":"EUROCOPTER","model":"EC665 Tigre, Tiger"},{"icao":"TIJU","code":"LL1P","manufacturer":"AVIONES FAIREY","model":"Tipsy Junior"},{"icao":"TIPB","code":"LL1P","manufacturer":"AVIONES FAIREY","model":"Tipsy B/BC/Belfair/Trainer"},{"icao":"TJET","code":"LL2J","manufacturer":"MAVERICK","model":"TJ1500 TwinJet"},{"icao":"TL20","code":"LL1P","manufacturer":"TL ULTRALIGHT","model":"TL-2000 Sting, StingSport"},{"icao":"TL30","code":"LL1P","manufacturer":"TL ULTRALIGHT","model":"TL-3000 Sirius"},{"icao":"TLEG","code":"LL1T","manufacturer":"PERFORMANCE","model":"Turbine Legend"},{"icao":"TM5","code":"LL1P","manufacturer":"TM AIRCRAFT","model":"TM5"},{"icao":"TMOT","code":"LL1P","manufacturer":"FISHER","model":"R80, RS80, Tiger Moth"},{"icao":"TMUS","code":"LL1P","manufacturer":"PAPA 51","model":"Thunder Mustang"},{"icao":"TNAV","code":"LL2P","manufacturer":"CAMAIR","model":"480 Twin Navion"},{"icao":"TNDR","code":"LL1P","manufacturer":"DREAM","model":"Tundra"},{"icao":"TOBA","code":"LL1P","manufacturer":"SOCATA","model":"TB10/200 Tobago, GT"},{"icao":"TOOT","code":"LL1P","manufacturer":"MEYER","model":"Little Toot"},{"icao":"TOR","code":"ML2J","manufacturer":"AERITALIA","model":"Tornado"},{"icao":"TOUR","code":"LL1P","manufacturer":"AESL","model":"Airtourer"},{"icao":"TOXO","code":"LL1P","manufacturer":"CAG","model":"Toxo"},{"icao":"TP40","code":"LL1P","manufacturer":"THUNDER WINGS","model":"Curtiss P40"},{"icao":"TPIL","code":"LL1T","manufacturer":"ENAER","model":"T35DT/TX Auc\ufffdn, Turbo Pill\ufffdn"},{"icao":"TPIN","code":"LL2P","manufacturer":"SCOTTISH AVIATION","model":"Twin Pioneer"},{"icao":"TPST","code":"LL1P","manufacturer":"JARAN","model":"184 Tempest"},{"icao":"TR1","code":"LA1P","manufacturer":"TRIDENT","model":"TR1 Trigull"},{"icao":"TR20","code":"LL1P","manufacturer":"FEUGRAY","model":"TR200"},{"icao":"TR26","code":"LL1P","manufacturer":"FEUGRAY","model":"TR260 Sirius"},{"icao":"TR55","code":"LL1P","manufacturer":"3XTRIM","model":"550 Trener, 3X-55 Trener, 3X-LS Navigator 600"},{"icao":"TRAL","code":"LL1P","manufacturer":"GROPPO","model":"Trial"},{"icao":"TRAP","code":"LL1P","manufacturer":"CAPELLA","model":"T-Raptor"},{"icao":"TRBA","code":"LL1P","manufacturer":"PODESVA","model":"Trener Baby"},{"icao":"TRDO","code":"LL1P","manufacturer":"TITAN","model":"Tornado SS"},{"icao":"TRF1","code":"LL1P","manufacturer":"TEAM ROCKET","model":"F1"},{"icao":"TRID","code":"ML3J","manufacturer":"DE HAVILLAND","model":"DH121 Trident"},{"icao":"TRIM","code":"LL3P","manufacturer":"FORD","model":"4-AT/5-AT Tri-Motor"},{"icao":"TRIN","code":"LL1P","manufacturer":"SOCATA","model":"TB20/21 Trinidad, GT, Pashosh"},{"icao":"TRIS","code":"LL3P","manufacturer":"ANGLO NORMANDY","model":"BN2A Mk3 Trislander"},{"icao":"TRMA","code":"LL3P","manufacturer":"STINSON","model":"A Tri-Motor"},{"icao":"TRWN","code":"LL2P","manufacturer":"PACIFIC AIRMOTIVE","model":"Tradewind"},{"icao":"TS11","code":"LL1J","manufacturer":"PZL\ufffdMIELEC","model":"TS11 Iskra"},{"icao":"TS14","code":"LL1P","manufacturer":"TEST","model":"TST-14 Bonus"},{"icao":"TS1J","code":"LL1J","manufacturer":"JONKER","model":"JS-1TJ Revelation"},{"icao":"TS8","code":"LL1P","manufacturer":"PZL\ufffdMIELEC","model":"TS8 Bies"},{"icao":"TSPT","code":"LL1P","manufacturer":"THUNDER WINGS","model":"Supermarine Spitfire"},{"icao":"TSTN","code":"LL1P","manufacturer":"TERRAFUGIA","model":"Transition"},{"icao":"TSTR","code":"LG1P","manufacturer":"AIR & SPACE","model":"Twinstar"},{"icao":"TTRS","code":"LL1P","manufacturer":"HUMBERT","model":"Tetras"},{"icao":"TTWO","code":"LL1P","manufacturer":"PARKER","model":"Teenie Two"},{"icao":"TU16","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu16"},{"icao":"TU22","code":"ML2J","manufacturer":"TUPOLEV","model":"Tu22"},{"icao":"TU4","code":"ML4T","manufacturer":"TUPOLEV","model":"Tu4"},{"icao":"TU95","code":"HL4T","manufacturer":"TUPOLEV","model":"Tu95/142, Tu20"},{"icao":"TUCA","code":"LL1T","manufacturer":"AOI","model":"EMB312 Tucano"},{"icao":"TUL3","code":"LL1P","manufacturer":"PODESVA","model":"TUL-03 Amigo"},{"icao":"TUTR","code":"LL1P","manufacturer":"AVRO","model":"621 Tutor"},{"icao":"TVL4","code":"LL1P","manufacturer":"TRAVEL AIR","model":"4, 4000"},{"icao":"TVLB","code":"LL1P","manufacturer":"TRAVEL AIR","model":"B"},{"icao":"TWEN","code":"LL1P","manufacturer":"TECNAM","model":"P-2010 Twenty-Ten"},{"icao":"TWIR","code":"LL2P","manufacturer":"DYN\'AERO","model":"Twin-R"},{"icao":"TWSP","code":"LL1P","manufacturer":"TIME WARP","model":"Spitfire"},{"icao":"TWST","code":"LL1P","manufacturer":"SILENCE","model":"Twister"},{"icao":"TZRV","code":"LL1J","manufacturer":"IRIAF","model":"JT-2-2 Tazarve"},{"icao":"U15","code":"LL1P","manufacturer":"PHOENIX AIR","model":"U-15 Phoenix"},{"icao":"U16","code":"MA2P","manufacturer":"GRUMMAN","model":"HU16, SA16, UF Albatross (G64/111)"},{"icao":"U2","code":"ML1J","manufacturer":"LOCKHEED","model":"U2, ER2"},{"icao":"U21","code":"LL2T","manufacturer":"HAWKER BEECHCRAFT CORP","model":"U21A/G, EU21, JU21, RU21, Ute (A901 to 4)"},{"icao":"U22","code":"LL1P","manufacturer":"HAWKER BEECHCRAFT CORP","model":"QU22 (1074/1079)"},{"icao":"UBAT","code":"LL1P","manufacturer":"AUSTRALITE","model":"Ultrabat"},{"icao":"UF10","code":"LL1P","manufacturer":"URBAN","model":"UFM-10 Samba"},{"icao":"UF13","code":"LL1P","manufacturer":"URBAN","model":"UFM-13 Lambada"},{"icao":"UFHT","code":"LG1P","manufacturer":"UFO","model":"HeliThruster"},{"icao":"UH1","code":"LH1T","manufacturer":"BELL","model":"EH-1, TH-1, UH-1 Iroquois"},{"icao":"UH12","code":"LH1P","manufacturer":"FAIRCHILD HILLER","model":"UH12E, E4, L3, L4, SL3, SL4 (OH23 Raven)"},{"icao":"UH1Y","code":"MH2T","manufacturer":"BELL","model":"UH-1Y"},{"icao":"UHEL","code":"----","manufacturer":"-","model":"Micro-/Ultralight helicopter"},{"icao":"UL10","code":"LL1P","manufacturer":"STREAMLINE WELDING","model":"10 Ultimate Competitor/Winner"},{"icao":"UL20","code":"LL1P","manufacturer":"STREAMLINE WELDING","model":"20 Ultimate Companion"},{"icao":"UL2F","code":"LL1P","manufacturer":"AEROS","model":"UL-2000 Flamingo"},{"icao":"UL45","code":"LL1P","manufacturer":"3XTRIM","model":"450 Ultra, 3X-47 Ultra"},{"icao":"ULAC","code":"----","manufacturer":"-","model":"Micro-/Ultralight aircraft"},{"icao":"ULPA","code":"LL1P","manufacturer":"ULLMANN","model":"Panther"},{"icao":"ULTS","code":"LH1P","manufacturer":"AMERICAN SPORTSCOPTER","model":"Ultrasport 496"},{"icao":"UM18","code":"LG1P","manufacturer":"AIR & SPACE","model":"18"},{"icao":"UNIV","code":"LL1P","manufacturer":"NEIVA","model":"N621/622 Universal (T25)"},{"icao":"URRA","code":"LL1P","manufacturer":"IBIS","model":"Arrow, Urraco"},{"icao":"US1","code":"MA4T","manufacturer":"SHIN MEIWA","model":"SS2A (US1)"},{"icao":"US2","code":"MA4T","manufacturer":"SHINMAYWA","model":"US-2"},{"icao":"UT60","code":"LL1P","manufacturer":"UTVA","model":"60"},{"icao":"UT65","code":"LL1P","manufacturer":"UTVA","model":"65 Privrednik"},{"icao":"UT66","code":"LL1P","manufacturer":"UTVA","model":"66"},{"icao":"UT75","code":"LL1P","manufacturer":"UTVA","model":"75 (V53)"},{"icao":"UU12","code":"LL1P","manufacturer":"UDET","model":"U12 Flamingo, Replica"},{"icao":"V1","code":"ML2T","manufacturer":"GRUMMAN","model":"OV1, RV1, AO1 Mohawk (G134)"},{"icao":"V10","code":"LL2T","manufacturer":"NORTH AMERICAN","model":"OV10 Bronco"},{"icao":"V22","code":"MT2T","manufacturer":"BELL","model":"V22, CV22, MV22 Osprey (901)"},{"icao":"V221","code":"LL1P","manufacturer":"MSW","model":"Votec 221"},{"icao":"V252","code":"LL1P","manufacturer":"MSW","model":"Votec 252"},{"icao":"V280","code":"MT2T","manufacturer":"BELL","model":"V-280 Valor"},{"icao":"V322","code":"LL1P","manufacturer":"MSW","model":"Votec 322"},{"icao":"V351","code":"LL1P","manufacturer":"MSW","model":"Votec 351"},{"icao":"V452","code":"LL1T","manufacturer":"MSW","model":"Votec 452"},{"icao":"V500","code":"LH1P","manufacturer":"REVOLUTION","model":"Voyager 500"},{"icao":"V8SP","code":"LL1P","manufacturer":"BEACHNER","model":"V8 Special"},{"icao":"VALI","code":"LL1P","manufacturer":"CONVAIR","model":"BT13 Valiant (V54)"},{"icao":"VAMP","code":"LL1J","manufacturer":"DE HAVILLAND","model":"DH100/115 Vampire"},{"icao":"VANT","code":"LL1J","manufacturer":"VISIONAIRE","model":"VA10 Vantage"},{"icao":"VAUT","code":"ML2J","manufacturer":"SUD","model":"SO4050 Vautour"},{"icao":"VC10","code":"HL4J","manufacturer":"BAC","model":"VC10"},{"icao":"VECT","code":"ML2T","manufacturer":"EMBRAER","model":"CBA123 Vector"},{"icao":"VELO","code":"LL1P","manufacturer":"VELOCITY","model":"Velocity"},{"icao":"VELT","code":"LL2P","manufacturer":"VELOCITY","model":"Velocity V-Twin"},{"icao":"VENT","code":"LL1P","manufacturer":"SCHEMPP\ufffdHIRTH","model":"Ventus BT/CM/CT/2CM/2CT"},{"icao":"VEZE","code":"LL1P","manufacturer":"RUTAN","model":"33 VariEze"},{"icao":"VF14","code":"ML2J","manufacturer":"VFW\ufffdFOKKER","model":"VFW614"},{"icao":"VF2","code":"LL1P","manufacturer":"FRY","model":"VF-2 Esprit"},{"icao":"VF35","code":"ML1J","manufacturer":"LOCKHEED MARTIN","model":"VF35"},{"icao":"VF60","code":"LL1T","manufacturer":"VULCANAIR","model":"VF-600 Mission"},{"icao":"VG3T","code":"LL1P","manufacturer":"AVIAKIT","model":"Vega 3000"},{"icao":"VGUL","code":"LL1P","manufacturer":"PERCIVAL","model":"P10, K1 Vega Gull"},{"icao":"VIMA","code":"LL1P","manufacturer":"VALTION","model":"Viima"},{"icao":"VIMY","code":"LL2P","manufacturer":"VICKERS","model":"FB27 Vimy, Replica"},{"icao":"VIPJ","code":"LL1J","manufacturer":"VIPER","model":"ViperJet"},{"icao":"VIPR","code":"LL1P","manufacturer":"PAXMAN\'S","model":"Viper"},{"icao":"VISC","code":"ML4T","manufacturer":"VICKERS","model":"Viscount"},{"icao":"VISI","code":"LL1P","manufacturer":"PRO-COMPOSITES","model":"Vision"},{"icao":"VIVA","code":"LL1P","manufacturer":"COMPOSIT AIRPLANES","model":"Viva"},{"icao":"VIX","code":"LL1P","manufacturer":"SKYSTAR","model":"Kitfox Vixen/Voyager"},{"icao":"VIXN","code":"LL1P","manufacturer":"AMAX","model":"Vixen"},{"icao":"VJ22","code":"LA1P","manufacturer":"VOLMER","model":"VJ22 Sportsman"},{"icao":"VK3P","code":"LL1P","manufacturer":"CIRRUS","model":"VK30 Cirrus"},{"icao":"VK3T","code":"LL1T","manufacturer":"CIRRUS","model":"VK-30 Cirrus"},{"icao":"VL3","code":"LL1P","manufacturer":"AVEKO","model":"VL-3"},{"icao":"VM1","code":"LL1P","manufacturer":"VOL MEDITERRANI","model":"VM-1 Esqual"},{"icao":"VMT","code":"HL4J","manufacturer":"MYASISHCHEV","model":"VMT Atlant"},{"icao":"VNOM","code":"ML1J","manufacturer":"DE HAVILLAND","model":"DH112 Venom"},{"icao":"VNTE","code":"LL1E","manufacturer":"SCHEMPP-HIRTH","model":"Ventus 3F"},{"icao":"VNTR","code":"LL1P","manufacturer":"ICP","model":"Ventura"},{"icao":"VO10","code":"LL1P","manufacturer":"AERO COMMANDER","model":"100 Commander 100"},{"icao":"VOL2","code":"LL1P","manufacturer":"VOLANTE","model":"Volante Two"},{"icao":"VP2","code":"LL1P","manufacturer":"EVANS","model":"VP2 Volksplane"},{"icao":"VR20","code":"LL1P","manufacturer":"EGVOYAGER","model":"VR-202, VR-203"},{"icao":"VR7","code":"LL1P","manufacturer":"VASHON","model":"Ranger R7"},{"icao":"VSON","code":"LL1P","manufacturer":"AMERICAN AFFORDABLE","model":"Vision"},{"icao":"VTOR","code":"LL2T","manufacturer":"PARTENAVIA","model":"AP68TP600 Viator"},{"icao":"VTRA","code":"LL1P","manufacturer":"RANS","model":"S-19 Venterra"},{"icao":"VTUR","code":"LL1P","manufacturer":"QUESTAIR","model":"M20 Venture"},{"icao":"VULC","code":"ML4J","manufacturer":"AVRO","model":"Vulcan"},{"icao":"VUT1","code":"LL1P","manufacturer":"EVEKTOR","model":"VUT-100 Cobra"},{"icao":"VVIG","code":"LL1P","manufacturer":"RUTAN","model":"27, 32 VariViggen"},{"icao":"VW10","code":"LL1P","manufacturer":"AIRCONCEPT","model":"VoWi10 Airbuggy"},{"icao":"VWIT","code":"LL1P","manufacturer":"WITTMAN","model":"V-Witt"},{"icao":"W11","code":"LL1P","manufacturer":"WOLF","model":"W11 Boredom Fighter"},{"icao":"W201","code":"LL1P","manufacturer":"WEATHERLY","model":"201, 620"},{"icao":"W3","code":"LH2T","manufacturer":"PZL\ufffdSWIDNIK","model":"W3, S1, SRR10, Sok\ufffdl, Anakonda, Huzar, Erka, Procjon"},{"icao":"W5BC","code":"LL1P","manufacturer":"WITTMAN","model":"W-5 Buttercup Replica"},{"icao":"W62T","code":"LL1T","manufacturer":"WEATHERLY","model":"620TP/BTG"},{"icao":"WA40","code":"LL1P","manufacturer":"WASSMER","model":"WA40 Super 4"},{"icao":"WA41","code":"LL1P","manufacturer":"WASSMER","model":"WA41 Baladou"},{"icao":"WA42","code":"LL1P","manufacturer":"WASSMER","model":"WA421 Prestige"},{"icao":"WA50","code":"LL1P","manufacturer":"WASSMER","model":"WA51/52/54 Pacific, Europa, Atlantic"},{"icao":"WA80","code":"LL1P","manufacturer":"WASSMER","model":"WA80/81 Piranha"},{"icao":"WAC9","code":"LL1P","manufacturer":"WACO","model":"9"},{"icao":"WACA","code":"LL1P","manufacturer":"WACO","model":"IBA, PBA, PLA, RBA, UBA, ULA"},{"icao":"WACC","code":"LL1P","manufacturer":"WACO","model":"C, S, CUC, QDC, UKC, YKS"},{"icao":"WACD","code":"LL1P","manufacturer":"WACO","model":"D, S3HD"},{"icao":"WACE","code":"LL1P","manufacturer":"WACO","model":"E, SRE"},{"icao":"WACF","code":"LL1P","manufacturer":"CLASSIC","model":"Waco Classic"},{"icao":"WACG","code":"LL1P","manufacturer":"WACO","model":"G, CRG"},{"icao":"WACM","code":"LL1P","manufacturer":"WACO","model":"JWM, JYM"},{"icao":"WACN","code":"LL1P","manufacturer":"WACO","model":"AVN, IBA, JWM, JYM, PBA, PLA, RBA, UBA, ULA, ZVN"},{"icao":"WACO","code":"LL1P","manufacturer":"WACO","model":"O, E, GXE, CTO"},{"icao":"WACT","code":"LL1P","manufacturer":"WACO","model":"RPT"},{"icao":"WAIX","code":"LL1P","manufacturer":"SONEX","model":"Waiex"},{"icao":"WASP","code":"LH1T","manufacturer":"WESTLAND","model":"Wasp"},{"icao":"WB57","code":"ML2J","manufacturer":"MARTIN","model":"WB57 (272)"},{"icao":"WBOO","code":"LL1P","manufacturer":"DEAN-WILSON","model":"DW-200 Whitney Boomerang"},{"icao":"WCAT","code":"LL1P","manufacturer":"GENERAL MOTORS","model":"FM Wildcat"},{"icao":"WDEX","code":"LL1P","manufacturer":"RADAB","model":"Windex"},{"icao":"WESX","code":"LH2T","manufacturer":"WESTLAND","model":"WS58 Wessex"},{"icao":"WF4U","code":"LL1P","manufacturer":"WAR","model":"Vought F4U Corsair"},{"icao":"WFOC","code":"LL1P","manufacturer":"WAR","model":"FockeWulf 190"},{"icao":"WFUR","code":"LL1P","manufacturer":"WAR","model":"Hawker Sea Fury"},{"icao":"WG30","code":"LH2T","manufacturer":"WESTLAND","model":"WG30, 30"},{"icao":"WH1","code":"LL1P","manufacturer":"WENDT","model":"WH1 Traveler"},{"icao":"WH4","code":"LL1T","manufacturer":"HALL","model":"WH-4, WH-6 Harpoon"},{"icao":"WHAT","code":"LL1P","manufacturer":"WHATLEY","model":"Special"},{"icao":"WHIL","code":"LL1P","manufacturer":"REFLEX","model":"WLAC1 White Lightning"},{"icao":"WHIS","code":"LL1P","manufacturer":"GROVE","model":"GR2 Whisper"},{"icao":"WHIT","code":"LL1P","manufacturer":"MILES","model":"M11 Whitney Straight"},{"icao":"WHK2","code":"ML4J","manufacturer":"RUTAN","model":"348 White Knight Two"},{"icao":"WHKN","code":"ML2J","manufacturer":"RUTAN","model":"318 White Knight"},{"icao":"WICH","code":"LL1P","manufacturer":"JAVELIN","model":"Wichawk"},{"icao":"WILT","code":"LL1P","manufacturer":"AEROSTAR","model":"WT-01/02 Wild Thing"},{"icao":"WIND","code":"LL1P","manufacturer":"WATSON","model":"GW1 Windwagon"},{"icao":"WINE","code":"LL1P","manufacturer":"WINDECKER","model":"Eagle"},{"icao":"WIRR","code":"LL1P","manufacturer":"COMMONWEALTH,  AUSTRALIA","model":"CA16 Wirraway"},{"icao":"WISP","code":"LL1P","manufacturer":"WHISPER","model":"Whisper"},{"icao":"WLBY","code":"LL1P","manufacturer":"FLY SYNTHESIS","model":"Wallaby"},{"icao":"WM2","code":"LL1P","manufacturer":"MILLER, WILLIAM Y., US","model":"WM2"},{"icao":"WOPU","code":"LL1P","manufacturer":"AEROSPORT","model":"Woody Pusher"},{"icao":"WP40","code":"LL1P","manufacturer":"WAR","model":"Curtiss P-40 Kittyhawk"},{"icao":"WP47","code":"LL1P","manufacturer":"WAR","model":"Republic P47 Thunderbolt"},{"icao":"WS22","code":"LL1P","manufacturer":"SPRING","model":"WS202 Sprint"},{"icao":"WSP","code":"LL1P","manufacturer":"AAK","model":"Wasp"},{"icao":"WT9","code":"LL1P","manufacturer":"AEROSPOOL","model":"WT-9 Dynamic"},{"icao":"WUSH","code":"LA1P","manufacturer":"W\ufffdST","model":"Seagle, Seahawk, Shark"},{"icao":"WW1","code":"LL1P","manufacturer":"WHITE","model":"WW1 Der J\ufffdger D9"},{"icao":"WW23","code":"ML2J","manufacturer":"IAI","model":"1123 Westwind"},{"icao":"WW24","code":"ML2J","manufacturer":"IAI","model":"1124 Westwind, Westwind 1/2, Sea Scan"},{"icao":"WZ10","code":"LH2T","manufacturer":"CHANGHE","model":"WZ-10"},{"icao":"WZER","code":"LL1P","manufacturer":"WAR","model":"Mitsubishi Zero"},{"icao":"X2","code":"LH1T","manufacturer":"SIKORSKY","model":"X-2"},{"icao":"X29","code":"ML1J","manufacturer":"GRUMMAN","model":"X29 (712)"},{"icao":"X3","code":"LH2T","manufacturer":"EUROCOPTER","model":"X-3"},{"icao":"X31","code":"ML1J","manufacturer":"MBB","model":"X31"},{"icao":"X32","code":"ML1J","manufacturer":"BOEING","model":"X32"},{"icao":"X35","code":"ML1J","manufacturer":"LOCKHEED MARTIN","model":"X35"},{"icao":"X4","code":"LL1P","manufacturer":"ROBIN","model":"X4"},{"icao":"X47B","code":"ML1J","manufacturer":"NORTHROP GRUMMAN","model":"X-47B"},{"icao":"X49","code":"MH2T","manufacturer":"SIKORSKY","model":"X-49 SpeedHawk"},{"icao":"XA41","code":"LL1P","manufacturer":"XTREMEAIR","model":"XA-41, Sbach 300, Xtreme 3000"},{"icao":"XA42","code":"LL1P","manufacturer":"XTREMEAIR","model":"XA-42, Sbach 342"},{"icao":"XA85","code":"LL1P","manufacturer":"RAJ HAMSA","model":"XA-85 X-Air LS, X-AIR Hawk, X-AIR H Hanuman"},{"icao":"XAIR","code":"LL1P","manufacturer":"RAJ HAMSA","model":"X-AIR S, X-AIR Falcon, X-AIR F Gumnam"},{"icao":"XB1","code":"LL3J","manufacturer":"BOOM","model":"XB-1"},{"icao":"XL2","code":"LL1P","manufacturer":"LIBERTY","model":"XL2"},{"icao":"XNON","code":"LG1P","manufacturer":"CELIER","model":"Xenon"},{"icao":"XNOS","code":"LL1P","manufacturer":"SONEX","model":"Xenos"},{"icao":"XV15","code":"LT2T","manufacturer":"BELL","model":"XV15 (301)"},{"icao":"Y11","code":"LL2P","manufacturer":"HARBIN","model":"Y11"},{"icao":"Y112","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak112"},{"icao":"Y12","code":"LL2T","manufacturer":"HARBIN","model":"Y12, Twin Panda"},{"icao":"Y12F","code":"ML2T","manufacturer":"HARBIN","model":"Y-12F Aircar"},{"icao":"Y130","code":"ML2J","manufacturer":"YAKOVLEV","model":"Yak130"},{"icao":"Y141","code":"ML3J","manufacturer":"YAKOVLEV","model":"Yak141"},{"icao":"Y18T","code":"LL1P","manufacturer":"TECHNOAVIA","model":"SM94"},{"icao":"Y20","code":"HL4J","manufacturer":"XIAN","model":"Y-20 Kunpeng"},{"icao":"YA1","code":"LL1P","manufacturer":"YEOMAN","model":"YA-1 Cropmaster"},{"icao":"YAK3","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak3"},{"icao":"YAK9","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak9"},{"icao":"YALE","code":"LL1P","manufacturer":"NORTH AMERICAN","model":"BT9/14, NJ, Yale"},{"icao":"YARR","code":"LL1P","manufacturer":"ARROW, CANADA","model":"Yarrow Arrow"},{"icao":"YAST","code":"LL1P","manufacturer":"SGAU","model":"Yastreb"},{"icao":"YC12","code":"LL1P","manufacturer":"CHASLE","model":"YC12/121/122/123 Tourbillon"},{"icao":"YK11","code":"LL1P","manufacturer":"LET","model":"C11"},{"icao":"YK12","code":"LL1P","manufacturer":"PZL\ufffdOKECIE","model":"Yak12"},{"icao":"YK18","code":"LL1P","manufacturer":"NANCHANG","model":"CJ5"},{"icao":"YK28","code":"ML2J","manufacturer":"YAKOVLEV","model":"Yak28"},{"icao":"YK30","code":"LL1J","manufacturer":"YAKOVLEV","model":"Yak-30, Yak-32"},{"icao":"YK38","code":"ML3J","manufacturer":"YAKOVLEV","model":"Yak38"},{"icao":"YK40","code":"ML3J","manufacturer":"YAKOVLEV","model":"Yak40"},{"icao":"YK42","code":"ML3J","manufacturer":"YAKOVLEV","model":"Yak42/142"},{"icao":"YK50","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak50"},{"icao":"YK52","code":"LL1P","manufacturer":"AEROSTAR SA, ROMANIA","model":"Yak52/54"},{"icao":"YK53","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak53"},{"icao":"YK54","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak54"},{"icao":"YK55","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak55"},{"icao":"YK58","code":"LL1P","manufacturer":"YAKOVLEV","model":"Yak58"},{"icao":"YL15","code":"LL1P","manufacturer":"BOEING","model":"451 Scout"},{"icao":"YNHL","code":"LH2P","manufacturer":"AVIAIMPEX","model":"KT-112 Yanhol"},{"icao":"YS11","code":"ML2T","manufacturer":"MITSUBISHI","model":"YS11"},{"icao":"YUKN","code":"LL1P","manufacturer":"MURPHY","model":"Yukon"},{"icao":"YUNO","code":"LL1P","manufacturer":"SHUYA","model":"Yunona"},{"icao":"YURO","code":"ML2J","manufacturer":"CRAIOVA","model":"IAR93"},{"icao":"Z22","code":"LL1P","manufacturer":"MORAVAN","model":"Zlin Z22 Junak"},{"icao":"Z26","code":"LL1P","manufacturer":"MORAVAN","model":"Zlin Z26/126/226/326/426/526/626/726 Trener, Trener Master, Bo hatyr, Akrobat, Skydevil, Universal, Condor"},{"icao":"Z37P","code":"LL1P","manufacturer":"LET","model":"Z37, Z37A/C, Z237 Cmel\ufffdk, Sparka"},{"icao":"Z37T","code":"LL1T","manufacturer":"MORAVAN","model":"Z37T, Z137 Agro Turbo"},{"icao":"Z42","code":"LL1P","manufacturer":"MORAVAN","model":"Zlin Z42/142/242, Firnas 142"},{"icao":"Z43","code":"LL1P","manufacturer":"MORAVAN","model":"Zlin Z43/143, Safir 43"},{"icao":"Z50","code":"LL1P","manufacturer":"MORAVAN","model":"Zlin Z50"},{"icao":"ZA6","code":"LH1P","manufacturer":"AEROKOPTER","model":"ZA-6 Sanka, AK-1"},{"icao":"ZEP2","code":"LL1P","manufacturer":"ARNET PEREYRA","model":"Zephyr 2"},{"icao":"ZEPH","code":"LL1P","manufacturer":"ATEC","model":"122 Zephyr"},{"icao":"ZERO","code":"LL1P","manufacturer":"MITSUBISHI","model":"A6M Zero"},{"icao":"ZIA","code":"LL1P","manufacturer":"APPLEBAY","model":"Zia"},{"icao":"ZIU","code":"LL1P","manufacturer":"TAI","model":"ZIU"},{"icao":"ZULU","code":"LL1P","manufacturer":"BULAERO","model":"Zulu"}]'),Al=e=>{let{setSelectedContent:r,openWindows:o,setOpenWindows:n}=e;const[i,a]=(0,t.useState)("00:00:00 UTC"),[s,l]=(0,t.useState)(""),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)({}),[f,m]=(0,t.useState)({});(0,t.useEffect)((()=>{const e=setInterval((()=>{const e=(new Date).toISOString().slice(11,19);a(`${e} UTC`)}),1e3);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{fetch(bl).then((e=>e.text())).then((e=>{const t={};e.split("\n").forEach((e=>{const[r,o]=e.split("\t");r&&o&&(t[r]=o)})),h(t)}))}),[]),(0,t.useEffect)((()=>{try{const e={};Ll.forEach((t=>{e[t.icao]=t})),m(e)}catch(e){console.error("Error loading ATYP data:",e)}}),[]);const p=(e,t)=>{n((r=>[...r,{id:Date.now(),title:e,content:t}]))};return(0,We.jsx)(We.Fragment,{children:(0,We.jsxs)("nav",{className:"bg-gray-800 p-1 text-gray-300 flex relative z-[100] pl-2",children:[(0,We.jsxs)(pl,{children:[(0,We.jsx)(gl,{className:"cursor-pointer text-sm",children:"MET"}),(0,We.jsx)(_l,{children:(0,We.jsxs)(yl,{className:"bg-white text-black p-2",children:[(0,We.jsx)(vl,{onClick:()=>p("SWC",(0,We.jsx)("div",{className:"w-full h-full",children:(0,We.jsx)("img",{style:{width:"100%",height:"auto"},src:"https://aro.lfv.se/tor/nswc2aro.gif",alt:"SWC"})})),children:"SWC"}),(0,We.jsx)(vl,{onClick:()=>p("ILMAILUSAA",(0,We.jsx)("iframe",{style:{width:"100%",height:"100%"},src:"https://ilmailusaa.fi/"})),children:"ILMAILUS\xc4\xc4"})]})})]}),(0,We.jsx)("button",{className:"cursor-pointer text-sm",onClick:()=>p("ATFM / ECFMP",(0,We.jsx)(xl,{openWindow:p})),children:"ATFM"}),(0,We.jsx)("button",{className:"cursor-pointer text-sm",onClick:()=>p("LARA RESERVATIONS",(0,We.jsx)(vo,{})),children:"LARA"}),(0,We.jsx)("button",{className:"cursor-pointer text-sm",onClick:()=>p("FLYK MAP",(0,We.jsx)("iframe",{style:{width:"100%",height:"100%"},src:"https://flyk.com/map"})),children:"FLYK"}),(0,We.jsx)("button",{className:"cursor-pointer text-sm",onClick:()=>p("ACC SECTORS",(0,We.jsx)("iframe",{style:{width:"100%",height:"100%"},src:"https://sectors.lusep.fi/"})),children:"SECTORS"}),(0,We.jsx)("input",{type:"text",placeholder:"ICAO",value:s,onChange:e=>l(e.target.value.toUpperCase()),onKeyDown:e=>{if("Enter"===e.key){const e=d[s]||"Airport not found";p(s,(0,We.jsx)("div",{className:"p-2 monospace-font",children:e}))}},maxLength:4,className:"text-sm pl-1 monospace-font bg-gray-700 text-gray-400 border border-gray-600 w-16"}),(0,We.jsx)("input",{type:"text",placeholder:"ATYP",value:c,onChange:e=>u(e.target.value.toUpperCase()),onKeyDown:e=>{if("Enter"===e.key){const e=f[c];if(!e)return void p(c,(0,We.jsx)("div",{className:"p-2",children:"Aircraft type not found"}));const t={P:"Propeller",T:"Turboprop",J:"Jet",E:"Electric"},r={L:"Light",M:"Medium",H:"Heavy",J:"Super"}[e.code[0]]||"Unknown",o=e.code[2]||"Unknown",n=t[e.code[3]]||"Unknown";p(c,(0,We.jsxs)("div",{className:"p-4 text-sm monospace-font",children:[(0,We.jsxs)("h2",{className:"text-xl mb-2",children:[e.icao," - ",e.manufacturer," ",e.model]}),(0,We.jsxs)("div",{className:"space-y-2 w-fit",children:[(0,We.jsxs)("div",{className:"flex gap-8",children:[(0,We.jsx)("div",{className:"w-24 font-semibold",children:"Manufacturer:"}),(0,We.jsx)("div",{children:e.manufacturer})]}),(0,We.jsxs)("div",{className:"flex gap-8",children:[(0,We.jsx)("div",{className:"w-24 font-semibold",children:"Model:"}),(0,We.jsx)("div",{children:e.model})]}),(0,We.jsxs)("div",{className:"flex gap-8",children:[(0,We.jsx)("div",{className:"w-24 font-semibold",children:"WTC:"}),(0,We.jsxs)("div",{children:[r," (",e.code[0],")"]})]}),(0,We.jsxs)("div",{className:"flex gap-8",children:[(0,We.jsx)("div",{className:"w-24 font-semibold",children:"Engines:"}),(0,We.jsxs)("div",{children:[o," ",n]})]})]})]}))}},maxLength:4,className:"text-sm monospace-font pl-1 bg-gray-700 text-gray-400 border border-gray-600 w-16"}),(0,We.jsx)("div",{className:"absolute top-1 right-4 text-sm",children:i})]})})},wl=()=>{const[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)((()=>localStorage.getItem("metarMode")||"SELECT")),[i,a]=(0,t.useState)((()=>localStorage.getItem("selectedMetarAirport")||"EFHK")),s=(0,t.useContext)(Ml);(0,t.useEffect)((()=>{const e=async()=>{try{const e=await fetch("https://flyk.com/api/metars.json");let t=(await e.json()).metars.filter((e=>e.text.startsWith("METAR")));if("AUTO"===o){const e=new Set(s.map((e=>[e.flight_plan.departure,e.flight_plan.arrival])).flat().filter((e=>e.startsWith("EF"))));t=t.filter((t=>e.has(t.code)))}else"SELECT"===o&&(t=t.filter((e=>e.code===i)));r(t)}catch(e){console.error("Error fetching METARs:",e)}};if("NONE"!==o){e();const t=setInterval(e,6e4);return()=>clearInterval(t)}}),[o,i,s]),(0,t.useEffect)((()=>{localStorage.setItem("metarMode",o)}),[o]),(0,t.useEffect)((()=>{localStorage.setItem("selectedMetarAirport",i)}),[i]);return(0,We.jsxs)("div",{className:"p-1 bg-gray-300 text-white h-full overflow-y-auto",children:[(0,We.jsxs)("div",{className:"flex space-x-2 mb-1 text-xs",children:[(0,We.jsx)("button",{className:"p-1 "+("AUTO"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("AUTO"),children:"AUTO"}),(0,We.jsx)("button",{className:"p-1 "+("ALL"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("ALL"),children:"ALL"}),(0,We.jsx)("button",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("SELECT"),children:"SELECT"}),(0,We.jsx)("select",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onChange:e=>a(e.target.value),value:i,disabled:"SELECT"!==o,children:[{icao:"EFHK",name:"HELSINKI-VANTAA"},{icao:"EFET",name:"ENONTEKIO"},{icao:"EFHA",name:"HALLI"},{icao:"EFIV",name:"IVALO"},{icao:"EFJO",name:"JOENSUU"},{icao:"EFJY",name:"JYVASKYLA"},{icao:"EFKE",name:"KEMI-TORNIO"},{icao:"EFKI",name:"KAJAANI"},{icao:"EFKK",name:"KOKKOLA-PIETARSAARI"},{icao:"EFKS",name:"KUUSAMO"},{icao:"EFKT",name:"KITTILA"},{icao:"EFKU",name:"KUOPIO"},{icao:"EFLP",name:"LAPPEENRANTA"},{icao:"EFMA",name:"MARIEHAMN"},{icao:"EFMI",name:"MIKKELI"},{icao:"EFOU",name:"OULU"},{icao:"EFPO",name:"PORI"},{icao:"EFRO",name:"ROVANIEMI"},{icao:"EFSA",name:"SAVONLINNA"},{icao:"EFSI",name:"SEINAJOKI"},{icao:"EFTP",name:"TAMPERE-PIRKKALA"},{icao:"EFTU",name:"TURKU"},{icao:"EFUT",name:"UTTI"},{icao:"EFVA",name:"VAASA"}].map((e=>(0,We.jsx)("option",{value:e.icao,children:e.icao},e.icao)))})]}),(0,We.jsx)("div",{className:"overflow-y-auto text-black text-xs monospace-font",children:0===e.length?(0,We.jsx)("p",{children:"No METAR data available"}):e.map((e=>{return(0,We.jsx)("p",{className:"table-line p-1",dangerouslySetInnerHTML:{__html:(t=e.text,t.replace(/(\d{5}KT|\d{5}KTG\d{2}|VRB\d{2}KT)/g,'<span class="highlight">$1</span>').replace(/(\d{3}V\d{3})/g,'<span class="highlight">$1</span>').replace(/(Q\d{4})/g,'<span class="highlight">$1</span>').replace(/(EF[A-Z]{2}\s)/g,'<span class="highlight">$1</span>'))}},e.code);var t}))})]})},Sl=()=>{const[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)((()=>localStorage.getItem("tafMode")||"SELECT")),[i,a]=(0,t.useState)((()=>localStorage.getItem("selectedAirport")||"EFHK")),s=(0,t.useContext)(Ml),l=[{icao:"EFHK",name:"HELSINKI-VANTAA"},{icao:"EFET",name:"ENONTEKIO"},{icao:"EFHA",name:"HALLI"},{icao:"EFIV",name:"IVALO"},{icao:"EFJO",name:"JOENSUU"},{icao:"EFJY",name:"JYVASKYLA"},{icao:"EFKE",name:"KEMI-TORNIO"},{icao:"EFKI",name:"KAJAANI"},{icao:"EFKK",name:"KOKKOLA-PIETARSAARI"},{icao:"EFKS",name:"KUUSAMO"},{icao:"EFKT",name:"KITTILA"},{icao:"EFKU",name:"KUOPIO"},{icao:"EFLP",name:"LAPPEENRANTA"},{icao:"EFMA",name:"MARIEHAMN"},{icao:"EFMI",name:"MIKKELI"},{icao:"EFOU",name:"OULU"},{icao:"EFPO",name:"PORI"},{icao:"EFRO",name:"ROVANIEMI"},{icao:"EFSA",name:"SAVONLINNA"},{icao:"EFSI",name:"SEINAJOKI"},{icao:"EFTP",name:"TAMPERE-PIRKKALA"},{icao:"EFTU",name:"TURKU"},{icao:"EFUT",name:"UTTI"},{icao:"EFVA",name:"VAASA"}];(0,t.useEffect)((()=>{const e=async()=>{try{let e=[];if("ALL"===o)e=l.map((e=>e.icao));else if("AUTO"===o){const t=new Set(s.map((e=>[e.flight_plan.departure,e.flight_plan.arrival])).flat().filter((e=>e.startsWith("EF"))));e=Array.from(t)}else e=[i];const t=await fetch(`https://api.met.no/weatherapi/tafmetar/1.0/taf.xml?icao=${e.join(",")}`),n=await t.text(),a=new DOMParser,c=a.parseFromString(n,"application/xml").getElementsByTagName("metno:terminalAerodromeForecast"),u=Array.from(c).map((e=>({code:e.getElementsByTagName("metno:icaoAirportIdentifier")[0].textContent,issuedTime:e.getElementsByTagName("gml:timePosition")[0].textContent,beginPosition:e.getElementsByTagName("gml:beginPosition")[0].textContent,tafText:e.getElementsByTagName("metno:tafText")[0].textContent}))).reduce(((e,t)=>((!e[t.code]||new Date(t.beginPosition)>new Date(e[t.code].beginPosition))&&(e[t.code]=t),e)),{}),d=Object.values(u);r(d)}catch(e){console.error("Error fetching TAFs:",e)}};if("NONE"!==o){e();const t=setInterval(e,6e4);return()=>clearInterval(t)}}),[o,i,s]),(0,t.useEffect)((()=>{localStorage.setItem("tafMode",o)}),[o]),(0,t.useEffect)((()=>{localStorage.setItem("selectedAirport",i)}),[i]);return(0,We.jsxs)("div",{className:"p-1 bg-gray-300 text-white h-full overflow-y-auto",children:[(0,We.jsxs)("div",{className:"flex space-x-2 mb-1 text-xs",children:[(0,We.jsx)("button",{className:"p-1 "+("AUTO"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("AUTO"),children:"AUTO"}),(0,We.jsx)("button",{className:"p-1 "+("ALL"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("ALL"),children:"ALL"}),(0,We.jsx)("button",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("SELECT"),children:"SELECT"}),(0,We.jsx)("select",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onChange:e=>a(e.target.value),value:i,disabled:"SELECT"!==o,children:l.map((e=>(0,We.jsx)("option",{value:e.icao,children:e.icao},e.icao)))})]}),(0,We.jsx)("div",{className:"overflow-y-auto text-black text-xs monospace-font",children:0===e.length?(0,We.jsx)("p",{children:"No TAF data available"}):e.map((e=>{return(0,We.jsx)("p",{className:"table-line p-1",dangerouslySetInnerHTML:{__html:(t=e.tafText,t.replace(/(EF[A-Z]{2}\s)/g,'<span class="highlight">$1</span>').replace(/(\d{4}\/\d{4})/g,'<span class="highlight">$1</span>'))}},e.code);var t}))})]})},El=()=>{const[e,r]=(0,t.useState)("METAR");return(0,We.jsxs)("div",{className:"h-full overflow-hidden",children:[(0,We.jsxs)("nav",{className:"bg-gray-600 p-1 flex justify-between items-center",children:[(0,We.jsx)("h1",{className:"text-white text-xs font-normal",children:"MET"}),(0,We.jsx)("div",{children:[{label:"METAR",tab:"METAR"},{label:"TAF",tab:"TAF"},{label:"RCR",tab:"RCR"}].map((t=>{let{label:o,tab:n}=t;return(0,We.jsx)("button",{className:`p-1 text-xs mr-1 ${e===n?"bg-gray-700":"bg-gray-800"} text-white`,onClick:()=>r(n),children:o},o)}))})]}),(0,We.jsx)("div",{style:{position:"fixed",right:"0",width:"50%",top:"60px",bottom:"50%"},children:"METAR"===e?(0,We.jsx)(wl,{}):"TAF"===e?(0,We.jsx)(Sl,{}):(0,We.jsx)("div",{className:"relative w-full h-full overflow-hidden",children:(0,We.jsx)("iframe",{src:"https://rcr.lusep.fi/",title:"RCR",className:"border-none absolute top-0 left-0",style:{width:"167%",height:"167%",transform:"scale(0.60)",transformOrigin:"top left"}})})})]})},Tl=()=>{const[e,r]=(0,t.useState)([]),[o,n]=(0,t.useState)((()=>localStorage.getItem("metarMode")||"SELECT")),[i,a]=(0,t.useState)((()=>localStorage.getItem("selectedMetarAirport")||"EFHK")),[s,l]=(0,t.useState)(!0),c=(0,t.useContext)(Ml),u=[{icao:"EFHK",name:"HELSINKI-VANTAA"},{icao:"EFET",name:"ENONTEKIO"},{icao:"EFHA",name:"HALLI"},{icao:"EFIV",name:"IVALO"},{icao:"EFJO",name:"JOENSUU"},{icao:"EFJY",name:"JYVASKYLA"},{icao:"EFKE",name:"KEMI-TORNIO"},{icao:"EFKI",name:"KAJAANI"},{icao:"EFKK",name:"KOKKOLA-PIETARSAARI"},{icao:"EFKS",name:"KUUSAMO"},{icao:"EFKT",name:"KITTILA"},{icao:"EFKU",name:"KUOPIO"},{icao:"EFLP",name:"LAPPEENRANTA"},{icao:"EFMA",name:"MARIEHAMN"},{icao:"EFMI",name:"MIKKELI"},{icao:"EFOU",name:"OULU"},{icao:"EFPO",name:"PORI"},{icao:"EFRO",name:"ROVANIEMI"},{icao:"EFSA",name:"SAVONLINNA"},{icao:"EFSI",name:"SEINAJOKI"},{icao:"EFTP",name:"TAMPERE-PIRKKALA"},{icao:"EFTU",name:"TURKU"},{icao:"EFUT",name:"UTTI"},{icao:"EFVA",name:"VAASA"}],d=async()=>{try{const e=await fetch("https://flyk.com/api/notams.json"),t=await e.json();let n=[];if("AUTO"===o){const e=new Set(u.map((e=>e.icao))),r=new Set(c.map((e=>e.flight_plan.departure||e.flight_plan.arrival)).filter((t=>e.has(t))));n=Object.entries(t.notams).filter((e=>{let[t]=e;return r.has(t)})).flatMap((e=>{let[t,r]=e;return r.map((e=>({...e,icao:t})))}))}else"SELECT"===o?n=t.notams[i]||[]:"NAV"===o?n=t.notams.extra||[]:"ALL"===o&&(n=Object.entries(t.notams).flatMap((e=>{let[t,r]=e;return r.map((e=>({...e,icao:t})))})));console.log("Fetched NOTAMs:",n),r(n)}catch(e){console.error("Error fetching NOTAMs:",e)}};(0,t.useEffect)((()=>{let e;return s&&"NONE"!==o&&(d(),e=setInterval(d,3e5)),()=>{e&&clearInterval(e)}}),[o,i,s]),(0,t.useEffect)((()=>{localStorage.setItem("metarMode",o)}),[o]),(0,t.useEffect)((()=>{localStorage.setItem("selectedMetarAirport",i)}),[i]),(0,t.useEffect)((()=>{"AUTO"===o&&s&&d()}),[c]);const h=e=>{const t=e.startsWith("+")?e.slice(1).trim():e,r=t.indexOf(" FROM:");if(-1!==r){const e=t.slice(0,r),o=t.slice(r+1),n=o.split("TO:")[0],i=o.split("TO:")[1];return(0,We.jsxs)(We.Fragment,{children:[(0,We.jsx)("p",{className:"mb-1",children:e}),(0,We.jsxs)("span",{className:"timestamp light-font",children:[(0,We.jsx)("span",{className:"highlight-notam",children:"FROM:"})," ",n.replace("FROM:","").trim(),(0,We.jsx)("span",{className:"highlight-notam",children:" TO:"})," ",i?i.trim():""]})]})}return t},f="ALL"===o||"AUTO"===o?(e=>e.reduce(((e,t)=>{const r=t.icao;return e[r]||(e[r]=[]),e[r].push(t),e}),{}))(e):{};return(0,We.jsxs)("div",{className:"p-1 bg-gray-300 text-white h-full overflow-y-auto",children:[(0,We.jsxs)("div",{className:"flex space-x-2 mb-1 text-xs",children:[(0,We.jsx)("button",{className:"p-1 "+("AUTO"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("AUTO"),children:"AUTO"}),(0,We.jsx)("button",{className:"p-1 "+("ALL"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("ALL"),children:"ALL"}),(0,We.jsx)("button",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("SELECT"),children:"SELECT"}),(0,We.jsx)("select",{className:"p-1 "+("SELECT"===o?"bg-gray-600":"bg-gray-400"),onChange:e=>a(e.target.value),value:i,disabled:"SELECT"!==o,children:u.map((e=>(0,We.jsx)("option",{value:e.icao,children:e.icao},e.icao)))}),(0,We.jsx)("button",{className:"p-1 "+("NAV"===o?"bg-gray-600":"bg-gray-400"),onClick:()=>n("NAV"),children:"ENR"})]}),(0,We.jsx)("div",{className:"text-black text-xs monospace-font h-full",children:0===e.length?(0,We.jsx)("p",{children:"No NOTAM data available"}):"ALL"===o?u.map((e=>{const t=f[e.icao]||[];return(0,We.jsxs)("div",{children:[(0,We.jsxs)("h3",{className:"small-title",children:[e.icao," - ",e.name]}),t.length>0?(0,We.jsx)("ul",{className:"list-none pl-0",children:t.map(((e,t)=>(0,We.jsx)("li",{className:"table-line p-1",children:h(e.text)},t)))}):(0,We.jsx)("p",{children:"NIL"})]},e.icao)})):"AUTO"===o?Object.entries(f).map((e=>{let[t,r]=e;const o=u.find((e=>e.icao===t));return(0,We.jsxs)("div",{children:[(0,We.jsxs)("h3",{className:"small-title",children:[t," - ",o?o.name:"Unknown Airport"]}),(0,We.jsx)("ul",{className:"list-none pl-0",children:r.map(((e,t)=>(0,We.jsx)("li",{className:"table-line p-1",children:h(e.text)},t)))})]},t)})):"NAV"===o?(0,We.jsxs)("div",{children:[(0,We.jsx)("h3",{className:"small-title",children:"NAV WRNG / EN-ROUTE"}),(0,We.jsx)("ul",{className:"list-none pl-0",children:e.map(((e,t)=>(0,We.jsx)("li",{className:"table-line p-1",children:h(e.text)},t)))})]}):(0,We.jsxs)("div",{children:[(0,We.jsxs)("h3",{className:"small-title",children:["SELECTED ",i]}),(0,We.jsx)("ul",{className:"list-none pl-0",children:e.map(((e,t)=>(0,We.jsx)("li",{className:"table-line p-1",children:h(e.text)},t)))})]})})]})},Pl=()=>{const[e,r]=(0,t.useState)("NOTAM"),[o,n]=(0,t.useState)("https://www.ais.fi/aipsup/AipSup.htm");return(0,We.jsxs)("div",{className:"h-full overflow-hidden",children:[(0,We.jsxs)("nav",{className:"bg-gray-600 p-1 flex justify-between items-center",children:[(0,We.jsx)("h1",{className:"text-white text-xs font-normal",children:"INFO"}),(0,We.jsx)("div",{children:[{label:"NOTAM",tab:"NOTAM"},{label:"SUP",tab:"SUP"}].map((t=>{let{label:o,tab:n}=t;return(0,We.jsx)("button",{className:`p-1 text-xs mr-1 ${e===n?"bg-gray-700":"bg-gray-800"} text-white`,onClick:()=>r(n),children:o},o)}))})]}),(0,We.jsx)("div",{style:{position:"fixed",right:"0",width:"50%",top:"50%",marginTop:"33px",bottom:"0"},children:"NOTAM"===e?(0,We.jsx)(Tl,{}):(0,We.jsxs)("div",{className:"relative w-full h-full overflow-hidden",children:[(0,We.jsx)("div",{className:"absolute top-0 right-0 p-2 z-10 bg-gray-600",children:(0,We.jsx)("button",{className:"text-white text-xs p-1 bg-gray-700",onClick:()=>{n("https://www.ais.fi/aipsup/AipSup.htm?reload="+(new Date).getTime())},children:"Back to Supplements"})}),(0,We.jsx)("iframe",{src:o,title:"SUP",className:"border-none absolute top-0 left-0",style:{width:"100%",height:"100%"}})]})})]})},Cl=e=>{let{title:r,onClose:o,children:n,bringToFront:i,zIndex:a}=e;const[s,l]=(0,t.useState)({x:100,y:100}),[c,u]=(0,t.useState)({width:500,height:400}),d=(0,t.useRef)(null),h=(0,t.useRef)(null),f=(0,t.useRef)(!1),m=(e,t,r)=>Math.min(Math.max(e,t),r),p=e=>{if(f.current)return;const t=e.clientX-h.current.x,r=e.clientY-h.current.y,o=h.current.startX+t,n=h.current.startY+r,i=window.innerWidth,a=window.innerHeight,s=c.width,u=(c.height,m(o,0,i-s)),d=m(n,0,a-30);l({x:u,y:d})},g=()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",g)},_=e=>{u((t=>({width:Math.max(200,e.clientX-s.x),height:Math.max(150,e.clientY-s.y)})))},y=()=>{f.current=!1,document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",y)};return(0,We.jsxs)("div",{ref:d,className:"absolute border-4 border-gray-600 bg-white shadow-lg overflow-hidden",style:{left:`${s.x}px`,top:`${s.y}px`,width:`${c.width}px`,height:`${c.height}px`,zIndex:a},onMouseDown:i,children:[(0,We.jsxs)("div",{className:"bg-gray-600 text-white text-sm flex justify-between items-center cursor-move",onMouseDown:e=>{i(),h.current={x:e.clientX,y:e.clientY,startX:s.x,startY:s.y},document.addEventListener("mousemove",p),document.addEventListener("mouseup",g)},style:{padding:"0px 4px"},children:[(0,We.jsx)("span",{children:r}),(0,We.jsx)("button",{onClick:o,className:"text-lg/6 font-bold ",children:"\xd7"})]}),(0,We.jsx)("div",{className:"p-0 w-full h-full overflow-y-auto bg-gray-300",children:n}),(0,We.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize bg-gray-600",onMouseDown:e=>{e.stopPropagation(),f.current=!0,document.addEventListener("mousemove",_),document.addEventListener("mouseup",y)}})]})},Rl=e=>{let{openWindows:r,setOpenWindows:o}=e;const[n,i]=(0,t.useState)([]),a=(0,t.useRef)(1);return(0,We.jsx)("div",{children:r.map(((e,t)=>(0,We.jsx)(Cl,{title:e.title,onClose:()=>{return t=e.id,void o((e=>e.filter((e=>e.id!==t))));var t},bringToFront:()=>(e=>{a.current+=1,i((t=>{const r=[...t];return r[e]=a.current,r}))})(t),zIndex:n[t]+100||1,children:e.content},e.id)))})},Ml=(0,t.createContext)(),Il=()=>{const[e,r]=(0,t.useState)("Content 1"),[o,n]=(0,t.useState)([]),[i,a]=(0,t.useState)([]);return(0,t.useEffect)((()=>{const e=async()=>{try{const e=await fetch("https://data.vatsim.net/v3/vatsim-data.json"),t=(await e.json()).pilots.filter((e=>e.flight_plan&&(e.flight_plan.departure.startsWith("EF")||e.flight_plan.arrival.startsWith("EF"))));n(t)}catch(e){console.error("Error fetching VATSIM traffic data:",e)}};e();const t=setInterval(e,1e4);return()=>clearInterval(t)}),[]),(0,We.jsx)(Ml.Provider,{value:o,children:(0,We.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,We.jsx)(Al,{setSelectedContent:r,openWindows:i,setOpenWindows:a}),(0,We.jsx)("div",{style:{position:"fixed",width:"50%",height:"100%"},children:(0,We.jsx)(Co,{openWindows:i,setOpenWindows:a})}),(0,We.jsx)("div",{style:{position:"fixed",right:"0",top:"0",marginTop:"28px",width:"50%",bottom:"50%"},children:(0,We.jsx)(El,{})}),(0,We.jsx)("div",{style:{position:"fixed",right:"0",bottom:"0",width:"50%",top:"50%"},children:(0,We.jsx)(Pl,{})}),(0,We.jsx)(Rl,{openWindows:i,setOpenWindows:a})]})})},Ol=e=>{e&&e instanceof Function&&r.e(453).then(r.bind(r,453)).then((t=>{let{getCLS:r,getFID:o,getFCP:n,getLCP:i,getTTFB:a}=t;r(e),o(e),n(e),i(e),a(e)}))};n.createRoot(document.getElementById("root")).render((0,We.jsx)(t.StrictMode,{children:(0,We.jsx)(Il,{})})),Ol()})()})();
//# sourceMappingURL=main.df7580ee.js.map